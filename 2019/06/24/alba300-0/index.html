<!DOCTYPE html>
<html  lang="ko">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>뉴스 댓글 분석 프로젝트[0]: 프로젝트를 시작하며 - Beomi&#39;s Tech blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89162642-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-89162642-1');
</script>

    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="is-2-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Beomi&#39;s Tech Blog
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="https://junbuml.ee">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="카탈로그" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="https://www.dropbox.com/s/28cpxp5jvo2tjsc/0001.jpg?dl=1" alt="뉴스 댓글 분석 프로젝트[0]: 프로젝트를 시작하며">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-06-23T15:00:00.000Z">2019-06-24</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/dataanalysis/">dataanalysis</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/dataanalysis/machinelearning/">machinelearning</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/dataanalysis/machinelearning/socialdata/">socialdata</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/dataanalysis/machinelearning/socialdata/comments-analysis/">comments analysis</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                뉴스 댓글 분석 프로젝트[0]: 프로젝트를 시작하며
            
        </h1>
        <div class="content">
            <h2 id="온라인-뉴스-댓글은-정말-사람들의-목소리일까"><a href="#온라인-뉴스-댓글은-정말-사람들의-목소리일까" class="headerlink" title="온라인 뉴스 댓글은 정말 사람들의 목소리일까?"></a>온라인 뉴스 댓글은 정말 사람들의 목소리일까?</h2><blockquote>
<p>“여기 오신 모든 분들 손을 들어주세요.” (모두 손을 든다)</p>
<p>“나는 인터넷 뉴스를 보지 않는다, 하시는 분 손 내려주세요.” (조금 손을 내린다)</p>
<p>“나는 인터넷 뉴스를 보고 댓글은 보지 않는다, 하시는 분 손 내려주세요.” (좀 더 손을 내린다)</p>
<p>“아직도 반이 넘는 많은 분들이 손을 들어주시고 계시네요. 이제 손 내려주셔도 됩니다. 감사합니다.”</p>
<p>– 2018 PyConKR 발표를 시작하며</p>
</blockquote>
<a id="more"></a>

<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062433.jpg" alt="0004"></p>
<p>작년(2018) PyCon에서 “<a href="https://archive.pycon.kr/2018/program/51">온라인 뉴스 댓글은 정말 사람들의 목소리일까?</a>“ 라는 주제로 비공개 세션을 진행했다.</p>
<p>해당 발표의 CFP를 제출했을 때 사실 ‘딥러닝 일베 탐지기’와 ‘네이버 뉴스 댓글 분석’ 이라는 두 가지 주제 중 한 가지를 선택해 진행할 것이라고 생각했지만, CFP에 붙었던 주제가 네이버 댓글 분석이어서 급하게 해당 프로젝트로 선회하게 되었다.</p>
<p>발표가 나고 2~3개월동안 해도 괜찮은걸까, 할 수 있을까 하는 수많은 고민을 하다 결국은 진행하기로 했다.</p>
<h2 id="무엇을-했나-데이터-수집편"><a href="#무엇을-했나-데이터-수집편" class="headerlink" title="무엇을 했나? - 데이터 수집편"></a>무엇을 했나? - 데이터 수집편</h2><p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062446.jpg" alt=""></p>
<h3 id="1-데이터-수집하기"><a href="#1-데이터-수집하기" class="headerlink" title="1) 데이터 수집하기"></a>1) 데이터 수집하기</h3><p>처음 분석시에는 네이버에 있는 뉴스를 가져와 모든 것을 분석해 보기로 했지만, 현실의 장벽에 부딪혔다. 총 기사의 개수가 억단위를 넘어가는 상황에서 해당 기사들을 모두 긁어오는 것은 현실적인 무리가 있다고 판단해 기간별 샘플링을 하는 방법을 통해 개수를 많이 줄여서 데이터 수집 부담을 줄였다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062457.jpg" alt="0017"></p>
<h3 id="2-서버리스-크롤링"><a href="#2-서버리스-크롤링" class="headerlink" title="2) 서버리스 크롤링"></a>2) 서버리스 크롤링</h3><p>실제로 데이터를 가져오는 과정에서 AWS Lambda 서비스를 이용한 서버리스 크롤링을 통해 동시에 수백개+ 정도의 요청을 보내는 방식을 통해 보다 빠르게 데이터를 수집했다. 데이터를 저장하는 소스는 AWS S3를 이용해 Lambda에서 <code>boto3</code> 패키지를 이용해 보다 쉽게 업로드 할 수 있도록 구성했다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062510.jpg" alt="0027"></p>
<p>그리고 실제로 람다 함수를 activate하는 boto3를 이용한 로컬 async 기반 코드를 실행해 아래와 같이 서버리스 크롤링이 오토스케일링으로 자동으로 다량으로 올라갈 수 있도록 환경을 구성해보았다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062524.jpg" alt="0033"></p>
<h3 id="3-데이터-용량-줄이기"><a href="#3-데이터-용량-줄이기" class="headerlink" title="3) 데이터 용량 줄이기"></a>3) 데이터 용량 줄이기</h3><p>하지만 데이터를 모으는 것 만이 끝이 아니다. 원본 데이터는 <code>*.json</code> 파일로, 용량이 상대적으로 큰 상태였다. 따라서 이 용량을 줄이기 위해 <code>parquet</code> 파일 형식으로 변환해 저장하는 방식을 사용하면 용량과 파일 개수를 획기적으로 줄일 수 있다.</p>
<blockquote>
<p>이때 파일 개수는 PySpark Dataframe의 partition 개수에 의존한다. 즉 Repartitioning을 통해 파티션 개수를 1개로 줄이면 parquet파일도 1개로 나오고, 100개로 설정하면 파일이 100개로 쪼개진다.</p>
<p>파일 개수가 적으면 Sequential I/O가 이루어지기 때문에 속도면에서 조금 유리하지만, 실제로 PySpark가 클러스터에 작업을 분배할 때 파티션 개수에 따라 Job distribution이 이뤄지기 때문에 이후 작업시 몇 개의 Worker Node를 이용할지에 대한 생각을 한 뒤 적정한 수로 나누는 것이 좋다.</p>
<p>또한 연도/월/일과 같이 기간별 탐색이 자주 있는 경우 파일 단계에서 필터링을 걸어줄 수 있기 때문에 기간별로 다른 파일을 만들어 저장하는 것도 좋은 방법이다.</p>
</blockquote>
<p>실제로 파일을 변환한 경우 아래와 같이 용량의 87% 감량이 이뤄진 것을 볼 수 있다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062533.jpg" alt="0039"></p>
<blockquote>
<p>Parquet 파일 자체가 유리하다기 보다는 압축되지 않는 json파일 vs Snappy 압축이 이뤄진 parquet파일 간 비교이기 때문에 압축의 유무가 좀 더 큰 영향을 미친다.</p>
<p>다만 json파일 각각을 gzip등을 이용해 저장할 경우 이후 수천~수만개의 파일을 읽을때 해당 파일을 list/get하는 비용만으로도 AWS S3 비용이 상당히 올라가게 된다. (S3는 파일 리스팅/파일 GET요청 횟수별로 비용이 매겨진다.)</p>
</blockquote>
<h3 id="4-데이터-분석환경"><a href="#4-데이터-분석환경" class="headerlink" title="4) 데이터 분석환경"></a>4) 데이터 분석환경</h3><p>위와 같이 <code>parquet</code> 파일로 정제한 뒤에는 데이터 분석을 하기가 좀 더 쉬워진다.</p>
<p>그리고 해당 파일을 읽어서 데이터 분석을 할 수 있는 환경은 크게 Pandas를 이용한 로컬 환경과 PySpark를 올린 AWS EMR환경을 이용했다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-06-26-062542.jpg" alt="0042"></p>
<h2 id="이후-어떻게-진행되고-있나"><a href="#이후-어떻게-진행되고-있나" class="headerlink" title="이후 어떻게 진행되고 있나?"></a>이후 어떻게 진행되고 있나?</h2><p>2018년 파이콘 발표를 끝낸 뒤, 데이터 전체를 찾는 방식에서 매일 데이터 분석 모델을 돌려보고 있다.</p>
<p>이에 따라 다음 글에서는 무슨 데이터를 어떻게 모으고 있는지, 그리고 어떻게 데이터를 적재하고 ETL작업을 하는지 등에 대해 알아본다.</p>

        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/06/27/DevGround/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">DevGround 2019, 뭣이 중헌디? and 데이터야 흘러라</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/11/30/using-aws-lambda-layers-on-python3/">
                <span class="level-item">AWS Lambda Layers로 함수 공통용 Python 패키지 재사용하기</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                
                




<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-3 column-right ">
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    카탈로그
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#온라인-뉴스-댓글은-정말-사람들의-목소리일까">
        <span class="has-mr-6">1</span>
        <span>온라인 뉴스 댓글은 정말 사람들의 목소리일까?</span>
        </a></li><li>
        <a class="is-flex" href="#무엇을-했나-데이터-수집편">
        <span class="has-mr-6">2</span>
        <span>무엇을 했나? - 데이터 수집편</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-데이터-수집하기">
        <span class="has-mr-6">2.1</span>
        <span>1) 데이터 수집하기</span>
        </a></li><li>
        <a class="is-flex" href="#2-서버리스-크롤링">
        <span class="has-mr-6">2.2</span>
        <span>2) 서버리스 크롤링</span>
        </a></li><li>
        <a class="is-flex" href="#3-데이터-용량-줄이기">
        <span class="has-mr-6">2.3</span>
        <span>3) 데이터 용량 줄이기</span>
        </a></li><li>
        <a class="is-flex" href="#4-데이터-분석환경">
        <span class="has-mr-6">2.4</span>
        <span>4) 데이터 분석환경</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#이후-어떻게-진행되고-있나">
        <span class="has-mr-6">3</span>
        <span>이후 어떻게 진행되고 있나?</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Beomi&#39;s Tech Blog
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Junbum Lee&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("ko");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://beomi.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>








<script src="/js/main.js" defer></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
</body>
</html>