<!DOCTYPE html>
<html  lang="ko">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>카테고리: python - Beomi&#39;s Tech blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89162642-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-89162642-1');
</script>

    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="is-3-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Beomi&#39;s Tech Blog
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="https://junbuml.ee">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">카테고리</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">python</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/PySpark_n_Hadoop_on_Ubuntu_16.jpg" alt="PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-08T15:00:00.000Z">2017-11-09</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/ubuntu/">ubuntu</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04/">PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>Spark의 Python버전인 PySpark를 사용할 때 서버가 AWS EMR등으로 만들어진 클러스터가 존재하고, 우리가 만든 프로그램과 함수가 해당 클러스터 위에서 돌리기 위해서는 PySpark를 로컬이 아니라 원격 서버에 연결해 동작하도록 만들어야 합니다. </p>
<p>이번 글에서는 PySpark와 Hadoop을 설치하고 설정하는 과정으로 원격 EMR로 함수를 실행시켜봅니다.</p>
<blockquote>
<p>Note: 이번 글은 Ubuntu 16.04 LTS, Python3.5(Ubuntu내장)를 기준으로 진행합니다.</p>
</blockquote>
<p>AWS에서 EC2를 생성해 주세요. VPC는 기본으로 잡아주시면 됩니다. 성능은 <code>t2-micro</code>의 프리티어정도도 괜찮습니다. 무거운 연산은 나중에 다룰 AWS EMR 클러스터에 올려줄 것이기 때문에, 클라이언트 역할을 할 EC2 인스턴스는 저성능이어도 괜찮습니다.</p>
<p>들어가기 전에 우선 apt 업데이트부터 진행해 줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</span><br></pre></td></tr></table></figure>

<h2 id="PySpark-설치하기"><a href="#PySpark-설치하기" class="headerlink" title="PySpark 설치하기"></a>PySpark 설치하기</h2><p>Ubuntu 16 OS에는 기본적으로 Python3이 설치되어있습니다. 하지만 pip는 설치되어있지 않기 때문에 아래 명령어로 먼저 Python3의 pip를 설치해줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip/pip3을 사용가능하게 만듭니다.</span></span><br><span class="line">sudo apt-get install python3-pip -y</span><br></pre></td></tr></table></figure>

<p>설치가 완료되면 이제 Python3의 pip를 사용할 수 있습니다. 아래 명령어로 pip를 통해 PySpark를 설치해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 최신 버전의 PySpark를 설치합니다.</span></span><br><span class="line">pip3 install pyspark -U --no-cache</span><br></pre></td></tr></table></figure>

<p>위 명령어에서 <code>-U</code>는 <code>--upgrade</code>의 약자로, 현재 설치가 되어있어도 최신버전으로 업그레이드 하는 것이고, <code>--no-cache</code>는 로컬에 pip 패키지의 캐싱 파일이 있더라도 pypi서버에서 다시 받아오겠다는 의미입니다.</p>
<blockquote>
<p>현재 PySpark 2.2.0은 버전과 다르게 2.2.0.post0라는 버전으로 pypi에 올라가 있습니다. 이로인해 <code>pip install pyspark</code> 로 진행할 경우 <code>Memeory Error</code>가 발생하고 설치가 실패하므로, 2.2.0버전을 설치한다면 위 명령어로 설치를 진행해주세요.</p>
</blockquote>
<h2 id="Hadoop-설치하기"><a href="#Hadoop-설치하기" class="headerlink" title="Hadoop 설치하기"></a>Hadoop 설치하기</h2><h3 id="JAVA-JDK-설치하기"><a href="#JAVA-JDK-설치하기" class="headerlink" title="JAVA JDK 설치하기"></a>JAVA JDK 설치하기</h3><p>Hadoop을 설치하기 위해서는 JAVA(JDK)가 먼저 설치되어야 합니다. 아래 명령어로 openjdk를 설치해주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Java 8을 설치합니다.</span></span><br><span class="line">sudo apt-get install openjdk-8-jre -y</span><br></pre></td></tr></table></figure>

<h3 id="Hadoop-Binary-설치하기"><a href="#Hadoop-Binary-설치하기" class="headerlink" title="Hadoop Binary 설치하기"></a>Hadoop Binary 설치하기</h3><p>Hadoop은 Apache의 홈페이지에서 <a href="http://hadoop.apache.org/releases.html">최신 릴리즈 링크</a>에서 바이너리 파일의 링크를 가져옵시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.23.26.png" alt=""></p>
<p>원하는 Hadoop 버전의 <code>Binary</code> 링크를 클릭해 바이너리를 받을 수 있는 페이지로 들어갑시다. 글쓰는 시점에는 2.8.2가 최신 버전입니다. 링크를 타고 들어가면 아래와 같이 HTTP로 파일을 받을 수 있는 링크가 나옵니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.25.04.png" alt=""></p>
<p>글을 보는 시점에는 링크 주소는 다를 수 있지만, HTTP 링크 중 하나를 복사하고 진행하면 됩니다. 이 글에서는 네이버 서버의 미러를 이용합니다.</p>
<p>이제 다시 서버로 돌아가봅시다. 아래 명령어를 통해 wget으로 Hadoop Binary를 서버에 받아줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget 여러분이_복사한_URL</span><br><span class="line"><span class="comment"># 예시</span></span><br><span class="line"><span class="comment"># wget http://mirror.navercorp.com/apache/hadoop/common/hadoop-2.8.2/hadoop-2.8.2.tar.gz</span></span><br></pre></td></tr></table></figure>

<p>이제 압축을 풀어줍시다. 아래 명령어로 압축을 <code>/usr/local</code>에 풀어줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar zxvf ./hadoop-* -C /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>압축을 풀면 <code>/usr/local/hadoop-2.8.2</code>라는 폴더가 생기지만 우리가 사용할때 버전이 붙어있으면 사용하기 귀찮으므로 이름을 <code>/usr/local/hadoop</code>으로 바꾸어줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /usr/<span class="built_in">local</span>/hadoop-* /usr/<span class="built_in">local</span>/hadoop</span><br></pre></td></tr></table></figure>

<p>이제 파일을 가져오고 설치는 완료되었지만, 실제로 Hadoop을 PySpark등에 붙여 사용하려면 <code>PATH</code>등록을 해줘야 합니다.</p>
<p>아래 명령어를 전체 복사-붙여넣기로 진행해 주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">export JAVA_HOME=<span class="variable">$(readlink -f /usr/bin/java | sed "s:bin/java::")</span></span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$JAVA_HOME/bin</span></span><br><span class="line"><span class="string">export HADOOP_HOME=/usr/local/hadoop</span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$HADOOP_HOME/bin</span></span><br><span class="line"><span class="string">export HADOOP_CONF_DIR=\$HADOOP_HOME/etc/hadoop</span></span><br><span class="line"><span class="string">export YARN_CONF_DIR=\$HADOOP_HOME/etc/hadoop</span></span><br><span class="line"><span class="string">"</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>이제 ssh를 <code>exit</code>한 뒤 다시 서버에 ssh로 접속하신 후, 아래 명령어를 입력해 보세요. 아래 사진처럼 나오면 설치가 성공적으로 진행된 것이랍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.49.19.png" alt=""></p>
<h2 id="끝이지만-끝이-아닌"><a href="#끝이지만-끝이-아닌" class="headerlink" title="끝이지만 끝이 아닌.."></a>끝이지만 끝이 아닌..</h2><p>사실 PySpark와 Hadoop만을 사용하는 것은 큰 의미가 있는 상황은 아닙니다. AWS EMR와 같은 클러스터를 연결해 막대한 컴퓨팅 파워가 있는 서버에서 돌리는 목적이 Spark를 쓰는 이유입니다. 다음 글에서는 AWS EMR을 구동하고 우리가 방금 설정한 Ubuntu 서버에서 작업을 EMR로 보내는 내용을 다뤄봅니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/10/17/Deploy-Flask-with-Fabric/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/deploy_flask_with_fabric.jpeg" alt="Fabric으로 Flask 자동 배포하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-10-16T15:00:00.000Z">2017-10-17</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/flask/">flask</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/flask/fabric/">fabric</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/10/17/Deploy-Flask-with-Fabric/">Fabric으로 Flask 자동 배포하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>이번 글은 Ubuntu16.04 LTS / Python3 / Apache2.4 서버 환경으로 진행합니다.</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>플라스크를 서버에 배포하는 것은 장고 배포와는 약간 다릅니다. 기본적으로 Apache2를 사용하기 때문에 <code>mod_wsgi</code>를 사용하는 것은 동일하지만, 그 외 다른 점이 조금 있습니다.</p>
<p>우선 간단한 플라스크 앱 하나가 있다고 생각을 해봅시다. 가장 단순한 형태는 아래와 같이 루트로 접속시 <code>Hello world!</code>를 보여주는 것이죠.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__file__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello world!"</span></span><br></pre></td></tr></table></figure>

<p>물론 여러분이 실제로 만들고 썼을 프로젝트는 이것보다 훨씬 복잡하겠지만, 일단은 이걸로 시작은 할 수 있답니다.</p>
<h2 id="wsgi-py-파일-만들기"><a href="#wsgi-py-파일-만들기" class="headerlink" title="wsgi.py 파일 만들기"></a>wsgi.py 파일 만들기</h2><p>로컬에서 <code>app.run()</code> 을 통해 실행했던 테스트서버와는 달리 실 배포 상황에서는 Apache나 NginX와 같은 웹서버를 거쳐 웹을 구동하고, 따라서 <code>app.run()</code>의 방식은 더이상 사용할 수 없습니다. 대신 여러가지 웹서버와 Flask를 연결시켜주는 방법이 있는데, 이번엔 그 중 <code>wsgi</code>를 통해 Apache서버가 Flask 앱을 실행하도록 만들어줄 것이랍니다.</p>
<p>우선 <code>wsgi.py</code>파일을 하나 만들어야 합니다. 이 파일은 나중에 Apache서버가 이 파일을 실행시켜 Flask서버를 구동하게 됩니다. 그리고 이 파일은 위에서 만든 변수인 <code>app = Flask(__file__)</code>, 즉 <code>app</code>변수를 import할 수 있는 위치에 있어야 합니다. (<code>app.py</code>파일과 동일한 위치에 두면 무방합니다.)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wsgi.py # app.py와 같은 위치</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">CURRENT_DIR = os.getcwd()</span><br><span class="line"></span><br><span class="line">sys.stdout = sys.stderr</span><br><span class="line">sys.path.insert(<span class="number">0</span>, CURRENT_DIR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> app <span class="keyword">as</span> application</span><br></pre></td></tr></table></figure>

<p>우리가 <code>wsgi</code>를 통해 실행할 경우 프로그램은 <code>application</code>이라는 변수를 찾아 <code>run()</code>와 비슷한 명령을 실행해 서버를 구동합니다. 따라서 우리는 <code>wsgi.py</code>파일 내 <code>application</code>이라는 변수를 만들어줘야 하는데, 이 변수는 바로 <code>app.py</code>내의 <code>app</code>변수입니다. </p>
<p>위 코드를 보시면 <code>sys</code>모듈과 <code>os</code>모듈을 사용합니다. <code>os</code>모듈의 <code>getcwd()</code>함수를 통해 현재 파일의 위치를 시스템의 <code>PATH</code> 경로에 넣어줍니다. 이 줄을 통해 바로 아래에 있는 <code>from app import app</code>이라는 구문에서 <code>from app</code> 부분이 현재 <code>wsgi.py</code>파일의 경로에서 <code>app.py</code>를 import할 수 있게 되는 것이죠. 만약 이 줄이 빠져있다면 <code>ImportError</code>가 발생하며 <code>app</code>이라는 모듈을 찾을 수 없다는 익셉션이 발생합니다.</p>
<h2 id="Fabric3-설치하기"><a href="#Fabric3-설치하기" class="headerlink" title="Fabric3 설치하기"></a>Fabric3 설치하기</h2><p>Fabric3은 Python2만 지원하던 <code>fabric</code>프로젝트를 포크해 Python3을 지원하도록 업데이트한 패키지입니다. 우선 pip로 패키지를 설치해 줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install fabric3</span><br><span class="line"><span class="comment"># 맥/리눅스라면 pip3 install fabric3</span></span><br></pre></td></tr></table></figure>

<p>이제 우리는 <code>fab</code>이라는 명령어를 사용할 수 있습니다. 이 명령어를 통해 <code>fabfile.py</code> 파일 내의 함수를 실행할 수 있게 됩니다.</p>
<h2 id="fabfile-py-파일-만들기"><a href="#fabfile-py-파일-만들기" class="headerlink" title="fabfile.py 파일 만들기"></a>fabfile.py 파일 만들기</h2><p>Fabric은 그 자체로는 하는 일이 없습니다. 사실 fabric은 우리가 서버에 들어가서 ‘Git으로 소스를 받고’, ‘DB를 업데이트하고’, ‘Static파일을 정리하며’, ‘웹서버 설정을 업데이트’해주는 일들을 하나의 마치 배치파일처럼 자동으로 실행할 수 있도록 도와주는 도구입니다.</p>
<p>하지만 이 도구를 사용하려면 우선 <code>fabfile.py</code>라는 파일이 있어야 fabric이 이 파일을 읽고 파일 속의 함수를 실행할 수 있게 됩니다.</p>
<p><code>fabfile</code>을 만들기 전 <code>deploy.json</code>이라는 이름의 json파일을 만들어 아래와 같이 설정을 담아줍시다.</p>
<p>우선 <code>REPO_URL</code>을 적어줍시다. 이 REPO에서 소스코드를 받아 처리해줄 예정이기 때문이죠. 그리고 <code>PROJECT_NAME</code>을 설정해 주세요. 일반적인 상황이라면 REPO의 이름과 같에 넣어주면 됩니다. 그리고 <code>REMOTE_HOST</code>는 서버의 주소가 됩니다. http등을 제외한 ‘도메인’부분만 넣어주세요. 그리고 서버에 SSH로 접속할 수 있는 IP를 <code>REMOTE_HOST_SSH</code>에 넣어주고, 마지막으로 <code>sudo</code>권한을 가진 유저이름을 <code>REMOTE_USER</code>에 넣어주세요.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"REPO_URL"</span>: <span class="string">"https://github.com/Beomi/our_project"</span>,</span><br><span class="line">  <span class="attr">"PROJECT_NAME"</span>: <span class="string">"our_project"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_HOST"</span>: <span class="string">"our_project.com"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_HOST_SSH"</span>: <span class="string">"123.32.1.4"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_USER"</span>: <span class="string">"sudouser"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>자, 이제 아래 코드를 통해 <code>fabfile.py</code>파일을 만들어 줍시다. (이것도 <code>app.py</code>와 같은 위치에 두면 관리하기가 편합니다.) </p>
<p>이부분은 파일에 설명을 담을 예정이니 코드의 주석을 참고해주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fabfile.py</span></span><br><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 현재 fabfile.py가 있는 폴더의 경로</span></span><br><span class="line">PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy.json이라는 파일을 열어 아래의 변수들에 담아줍니다.</span></span><br><span class="line">envs = json.load(open(os.path.join(PROJECT_DIR, <span class="string">"deploy.json"</span>)))</span><br><span class="line"></span><br><span class="line">REPO_URL = envs[<span class="string">'REPO_URL'</span>]</span><br><span class="line">PROJECT_NAME = envs[<span class="string">'PROJECT_NAME'</span>]</span><br><span class="line">REMOTE_HOST = envs[<span class="string">'REMOTE_HOST'</span>]</span><br><span class="line">REMOTE_HOST_SSH = envs[<span class="string">'REMOTE_HOST_SSH'</span>]</span><br><span class="line">REMOTE_USER = envs[<span class="string">'REMOTE_USER'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSH에 접속할 유저를 지정하고,</span></span><br><span class="line">env.user = REMOTE_USER</span><br><span class="line"><span class="comment"># SSH로 접속할 서버주소를 넣어주고,</span></span><br><span class="line">env.hosts = [</span><br><span class="line">    REMOTE_HOST_SSH,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 원격 서버중 어디에 프로젝트를 저장할지 지정해준 뒤,</span></span><br><span class="line">project_folder = <span class="string">'/home/&#123;&#125;/&#123;&#125;'</span>.format(env.user, PROJECT_NAME)</span><br><span class="line"><span class="comment"># 우리 프로젝트에 필요한 apt 패키지들을 적어줍니다.</span></span><br><span class="line">apt_requirements = [</span><br><span class="line">    <span class="string">'curl'</span>,</span><br><span class="line">    <span class="string">'git'</span>,</span><br><span class="line">    <span class="string">'python3-dev'</span>,</span><br><span class="line">    <span class="string">'python3-pip'</span>,</span><br><span class="line">    <span class="string">'build-essential'</span>,</span><br><span class="line">    <span class="string">'apache2'</span>,</span><br><span class="line">    <span class="string">'libapache2-mod-wsgi-py3'</span>,</span><br><span class="line">    <span class="string">'python3-setuptools'</span>,</span><br><span class="line">    <span class="string">'libssl-dev'</span>,</span><br><span class="line">    <span class="string">'libffi-dev'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># _로 시작하지 않는 함수들은 fab new_server 처럼 명령줄에서 바로 실행이 가능합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_server</span><span class="params">()</span>:</span></span><br><span class="line">    setup()</span><br><span class="line">    deploy()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">()</span>:</span></span><br><span class="line">    _get_latest_apt()</span><br><span class="line">    _install_apt_requirements(apt_requirements)</span><br><span class="line">    _make_virtualenv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deploy</span><span class="params">()</span>:</span></span><br><span class="line">    _get_latest_source()</span><br><span class="line">    _put_envs()</span><br><span class="line">    _update_virtualenv()</span><br><span class="line">    _make_virtualhost()</span><br><span class="line">    _grant_apache2()</span><br><span class="line">    _restart_apache2()</span><br><span class="line"></span><br><span class="line"><span class="comment"># put이라는 방식으로 로컬의 파일을 원격지로 업로드할 수 있습니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_put_envs</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span>  <span class="comment"># activate for envs.json file</span></span><br><span class="line">    <span class="comment"># put('envs.json', '~/&#123;&#125;/envs.json'.format(PROJECT_NAME))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># apt 패키지를 업데이트 할 지 결정합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_latest_apt</span><span class="params">()</span>:</span></span><br><span class="line">    update_or_not = input(<span class="string">'would you update?: [y/n]'</span>)</span><br><span class="line">    <span class="keyword">if</span> update_or_not == <span class="string">'y'</span>:</span><br><span class="line">        sudo(<span class="string">'apt-get update &amp;&amp; apt-get -y upgrade'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 필요한 apt 패키지를 설치합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_install_apt_requirements</span><span class="params">(apt_requirements)</span>:</span></span><br><span class="line">    reqs = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> req <span class="keyword">in</span> apt_requirements:</span><br><span class="line">        reqs += (<span class="string">' '</span> + req)</span><br><span class="line">    sudo(<span class="string">'apt-get -y install &#123;&#125;'</span>.format(reqs))</span><br><span class="line"></span><br><span class="line"><span class="comment"># virtualenv와 virtualenvwrapper를 받아 설정합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_virtualenv</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exists(<span class="string">'~/.virtualenvs'</span>):</span><br><span class="line">        script = <span class="string">'''"# python virtualenv settings</span></span><br><span class="line"><span class="string">                    export WORKON_HOME=~/.virtualenvs</span></span><br><span class="line"><span class="string">                    export VIRTUALENVWRAPPER_PYTHON="$(command \which python3)"  # location of python3</span></span><br><span class="line"><span class="string">                    source /usr/local/bin/virtualenvwrapper.sh"'''</span></span><br><span class="line">        run(<span class="string">'mkdir ~/.virtualenvs'</span>)</span><br><span class="line">        sudo(<span class="string">'pip3 install virtualenv virtualenvwrapper'</span>)</span><br><span class="line">        run(<span class="string">'echo &#123;&#125; &gt;&gt; ~/.bashrc'</span>.format(script))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Git Repo에서 최신 소스를 받아옵니다.</span></span><br><span class="line"><span class="comment"># 깃이 있다면 fetch를, 없다면 clone을 진행합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_latest_source</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> exists(project_folder + <span class="string">'/.git'</span>):</span><br><span class="line">        run(<span class="string">'cd %s &amp;&amp; git fetch'</span> % (project_folder,))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        run(<span class="string">'git clone %s %s'</span> % (REPO_URL, project_folder))</span><br><span class="line">    current_commit = local(<span class="string">"git log -n 1 --format=%H"</span>, capture=<span class="literal">True</span>)</span><br><span class="line">    run(<span class="string">'cd %s &amp;&amp; git reset --hard %s'</span> % (project_folder, current_commit))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Repo에서 받아온 requirements.txt를 통해 pip 패키지를 virtualenv에 설치해줍니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_virtualenv</span><span class="params">()</span>:</span></span><br><span class="line">    virtualenv_folder = project_folder + <span class="string">'/../.virtualenvs/&#123;&#125;'</span>.format(PROJECT_NAME)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exists(virtualenv_folder + <span class="string">'/bin/pip'</span>):</span><br><span class="line">        run(<span class="string">'cd /home/%s/.virtualenvs &amp;&amp; virtualenv %s'</span> % (env.user, PROJECT_NAME))</span><br><span class="line">    run(<span class="string">'%s/bin/pip install -r %s/requirements.txt'</span> % (</span><br><span class="line">        virtualenv_folder, project_folder</span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line"><span class="comment"># (optional) UFW에서 80번/tcp포트를 열어줍니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ufw_allow</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">"ufw allow 'Apache Full'"</span>)</span><br><span class="line">    sudo(<span class="string">"ufw reload"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache2의 Virtualhost를 설정해 줍니다. </span></span><br><span class="line"><span class="comment"># 이 부분에서 wsgi.py와의 통신, 그리고 virtualenv 내의 파이썬 경로를 지정해 줍니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_virtualhost</span><span class="params">()</span>:</span></span><br><span class="line">    script = <span class="string">"""'&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">    ServerName &#123;servername&#125;</span></span><br><span class="line"><span class="string">    &lt;Directory /home/&#123;username&#125;/&#123;project_name&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;Files wsgi.py&gt;</span></span><br><span class="line"><span class="string">            Require all granted</span></span><br><span class="line"><span class="string">        &lt;/Files&gt;</span></span><br><span class="line"><span class="string">    &lt;/Directory&gt;</span></span><br><span class="line"><span class="string">    WSGIDaemonProcess &#123;project_name&#125; python-home=/home/&#123;username&#125;/.virtualenvs/&#123;project_name&#125; python-path=/home/&#123;username&#125;/&#123;project_name&#125;</span></span><br><span class="line"><span class="string">    WSGIProcessGroup &#123;project_name&#125;</span></span><br><span class="line"><span class="string">    WSGIScriptAlias / /home/&#123;username&#125;/&#123;project_name&#125;/wsgi.py</span></span><br><span class="line"><span class="string">    &#123;% raw %&#125;</span></span><br><span class="line"><span class="string">    ErrorLog $&#123;&#123;APACHE_LOG_DIR&#125;&#125;/error.log</span></span><br><span class="line"><span class="string">    CustomLog $&#123;&#123;APACHE_LOG_DIR&#125;&#125;/access.log combined</span></span><br><span class="line"><span class="string">    &#123;% endraw %&#125;</span></span><br><span class="line"><span class="string">    &lt;/VirtualHost&gt;'"""</span>.format(</span><br><span class="line">        username=REMOTE_USER,</span><br><span class="line">        project_name=PROJECT_NAME,</span><br><span class="line">        servername=REMOTE_HOST,</span><br><span class="line">    )</span><br><span class="line">    sudo(<span class="string">'echo &#123;&#125; &gt; /etc/apache2/sites-available/&#123;&#125;.conf'</span>.format(script, PROJECT_NAME))</span><br><span class="line">    sudo(<span class="string">'a2ensite &#123;&#125;.conf'</span>.format(PROJECT_NAME))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache2가 프로젝트 파일을 읽을 수 있도록 권한을 부여합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_grant_apache2</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">'chown -R :www-data ~/&#123;&#125;'</span>.format(PROJECT_NAME))</span><br><span class="line">    sudo(<span class="string">'chmod -R 775 ~/&#123;&#125;'</span>.format(PROJECT_NAME))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 마지막으로 Apache2를 재시작합니다.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_restart_apache2</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">'sudo service apache2 restart'</span>)</span><br></pre></td></tr></table></figure>

<p>위 코드를 <code>fabfile.py</code>에 넣어주고 나서 </p>
<p>첫 실행시에는 <code>fab new_server</code></p>
<p>코드를 수정하고 push한 뒤 서버에 배포시에는 <code>fab deploy</code></p>
<p>명령을 실행해 주면 됩니다.</p>
<blockquote>
<p>NOTE: _ 로 시작하는 함수는 <code>fab 함수이름</code>으로 실행하지 못합니다.</p>
</blockquote>
<p>자, 이제 서버에 올릴 준비가 되었습니다.</p>
<h2 id="서버에-올리기"><a href="#서버에-올리기" class="headerlink" title="서버에 올리기"></a>서버에 올리기</h2><p>우분투 서버를 만들고 첫 배포라면 <code>new_server</code>를, 한번 <code>new_server</code>를 했다면 <code>deploy</code>로 배포를 진행합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fab new_server <span class="comment"># 첫 배포</span></span><br><span class="line">fab deploy <span class="comment"># 첫 배포를 제외한 나머지</span></span><br></pre></td></tr></table></figure>

<h2 id="끝났습니다"><a href="#끝났습니다" class="headerlink" title="끝났습니다!"></a>끝났습니다!</h2><p>여러분의 사이트는 이제 <a href="http://REMOTE_HOST">http://REMOTE_HOST</a> 으로 접속 가능할거에요!</p>
<h2 id="유의할-점"><a href="#유의할-점" class="headerlink" title="유의할 점"></a>유의할 점</h2><p><code>fabfile</code>내의 <code>apt_requirements</code> 리스트에는 프로젝트마다 필요한 다른 패키지들을 적어줘야 합니다.</p>
<p>만약 여러분의 프로젝트에서 <code>mysqlclient</code>패키지등을 사용한다면 <code>libmysqlclient-dev</code>를 <code>apt_requirements</code>리스트에 추가해줘야 합니다. 혹은 PostgreSQL을 사용한다면 <code>libpq-dev</code>가 필요할 수도 있습니다. 그리고 여러분이 이미지 처리를 하는 <code>pillow</code>패키지를 사용한다면 <code>libjpeg62-dev</code>를 <code>apt_requirements</code>에 추가해야 할 수도 있습니다.</p>
<p>이처럼 여러분이 파이썬 패키지에서 어떤 상황이냐에 따라 다른 apt패키지 리스트를 넣어줘야 합니다. </p>
<p>이 부분만 유의해 넣어준다면 Fabric으로 한번에 배포에 성공할 수 있을거랍니다! :)</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/09/28/HowToMakeWebCrawler-Headless-Chrome/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/Crawling-with-HeadlessChrome.png" alt="나만의 웹 크롤러 만들기(7): 창없는 크롬으로 크롤링하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-27T15:00:00.000Z">2017-09-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/28/HowToMakeWebCrawler-Headless-Chrome/">나만의 웹 크롤러 만들기(7): 창없는 크롬으로 크롤링하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이번 가이드는 가이드 3편(<a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">Selenium으로 무적 크롤러 만들기</a>)의 확장편입니다. 아직 <code>selenium</code>을 이용해보지 않은 분이라면 먼저 저 가이드를 보고 오시는걸 추천합니다.</p>
</blockquote>
<h2 id="HeadLess-Chrome-머리없는-크롬"><a href="#HeadLess-Chrome-머리없는-크롬" class="headerlink" title="HeadLess Chrome? 머리없는 크롬?"></a>HeadLess Chrome? 머리없는 크롬?</h2><h3 id="HeadLess란"><a href="#HeadLess란" class="headerlink" title="HeadLess란?"></a>HeadLess란?</h3><p>Headless라는 용어는 ‘창이 없는’과 같다고 이해하시면 됩니다. 여러분이 브라우저(크롬 등)을 이용해 인터넷을 브라우징 할 때 기본적으로 창이 뜨고 HTML파일을 불러오고, CSS파일을 불러와 어떤 내용을 화면에 그러야 할지 계산을 하는 작업을 브라우저가 자동으로 진행해줍니다. </p>
<p>하지만 이와같은 방식을 사용할 경우 사용하는 운영체제에 따라 크롬이 실행이 될 수도, 실행이 되지 않을 수도 있습니다. 예를들어 우분투 서버와 같은 OS에서는 ‘화면’ 자체가 존재하지 않기 때문에 일반적인 방식으로는 크롬을 사용할 수 없습니다. 이를 해결해 주는 방식이 바로 Headless 모드입니다. 브라우저 창을 실제로 운영체제의 ‘창’으로 띄우지 않고 대신 화면을 그려주는 작업(렌더링)을 가상으로 진행해주는 방법으로 실제 브라우저와 동일하게 동작하지만 창은 뜨지 않는 방식으로 동작할 수 있습니다.</p>
<h3 id="그러면-왜-크롬"><a href="#그러면-왜-크롬" class="headerlink" title="그러면 왜 크롬?"></a>그러면 왜 크롬?</h3><p>일전 가이드에서 <code>PhantomJS</code>(팬텀)라는 브라우저를 이용하는 방법에 대해 다룬적이 있습니다. 팬텀은 브라우저와 유사하게 동작하고 Javascript를 동작시켜주지만 성능상의 문제점과 크롬과 완전히 동일하게 동작하지는 않는다는 문제점이 있습니다. 우리가 크롤러를 만드는 상황이 대부분 크롬에서 진행하고, 크롬의 결과물 그대로 가져오기 위해서는 브라우저도 크롬을 사용하는 것이 좋습니다.</p>
<blockquote>
<p>하지만 여전히 팬텀이 가지는 장점이 있습니다. WebDriver Binary만으로 추가적인 설치 없이 환경을 만들 수 있다는 장점이 있습니다.</p>
</blockquote>
<p>윈도우 기준 크롬 59, 맥/리눅스 기준 크롬 60버전부터 크롬에 <code>Headless Mode</code>가 정식으로 추가되어서 만약 여러분의 브라우저가 최신이라면 크롬의 Headless모드를 쉽게 이용할 수 있습니다.</p>
<h2 id="크롬-버전-확인하기"><a href="#크롬-버전-확인하기" class="headerlink" title="크롬 버전 확인하기"></a>크롬 버전 확인하기</h2><p>크롬 버전 확인은 크롬 브라우저에서 <a href="chrome://version/">chrome://version/</a>로 들어가 확인할 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/ScreenShot2017-08-0112.47.57.png" alt=""></p>
<p>이와 같이 크롬 버전이 60버전 이상인 크롬에서는 ‘Headless’모드를 사용할 수 있습니다.</p>
<h2 id="크롬드라이버-chromedriver-업데이트"><a href="#크롬드라이버-chromedriver-업데이트" class="headerlink" title="크롬드라이버(chromedriver) 업데이트"></a>크롬드라이버(chromedriver) 업데이트</h2><p>크롬 버전이 올라감에 따라 크롬을 조작하도록 도와주는 <code>chromedriver</code> 역시 함께 업데이트를 진행해야 합니다.</p>
<p><a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></p>
<p>위 링크에서 Latest Release 옆 크롬드라이버를 선택해 OS별로 알맞은 zip파일을 받아 압축을 풀어줍시다.</p>
<h2 id="기존-코드-수정하기"><a href="#기존-코드-수정하기" class="headerlink" title="기존 코드 수정하기"></a>기존 코드 수정하기</h2><p>크롬의 헤드리스 모드를 사용하는 방식은 기존 selenium을 이용한 코드와 거의 동일합니다만, 몇가지 옵션을 추가해줘야합니다.</p>
<p>기존에 webdriver를 사용해 크롬을 동작한 경우 아래와 같은 코드를 사용할 수 있었습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 유의: chromedriver를 위에서 받아준 </span></span><br><span class="line"><span class="comment"># chromdriver(windows는 chromedriver.exe)의 절대경로로 바꿔주세요!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://naver.com'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'naver_main.png'</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드를 동작시키면 크롬이 켜지고 파이썬 파일 옆에 <code>naver_main.png</code>라는 스크린샷 하나가 생기게 됩니다.<br>이 코드는 지금까지 우리가 만들었던 코드와 큰 차이가 없는걸 확인해 보세요.</p>
<p>하지만 이 코드를 몇가지 옵션만 추가해주면 바로 Headless모드로 동작하게 만들어줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line"><span class="comment"># 혹은 options.add_argument("--disable-gpu")</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://naver.com'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'naver_main_headless.png'</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드를 보시면 <code>ChromeOptions()</code>를 만들어 <code>add_argument</code>를 통해 Headless모드인 것과, 크롬 창의 크기, 그리고 gpu(그래픽카드 가속)를 사용하지 않는 옵션을 넣어준 것을 볼 수 있습니다.</p>
<p>제일 중요한 부분은 바로 <code>options.add_argument(&#39;headless&#39;)</code>라는 부분입니다. 크롬이 Headless모드로 동작하도록 만들어주는 키워드에요. 그리고 크롬 창의 크기를 직접 지정해 준 이유는, 여러분이 일반적으로 노트북이나 데스크탑에서 사용하는 모니터의 해상도가 1920x1080이기 때문입니다. 즉, 여러분이 일상적으로 보는 것 그대로 크롬이 동작할거라는 기대를 해볼수 있습니다!</p>
<p>마지막으로는 <code>disable-gpu</code>인데요, 만약 위 코드를 실행했을때 GPU에러~가 난다면 <code>--disable-gpu</code>로 앞에 dash(-)를 두개 더 붙여보세요. 이 버그는 크롬 자체에 있는 문제점입니다. 브라우저들은 CPU의 부담을 줄이고 좀더 빠른 화면 렌더링을 위해 GPU를 통해 그래픽 가속을 사용하는데, 이 부분이 크롬에서 버그를 일으키는 현상을 보이고 있습니다. (윈도우 크롬 61버전까지는 아직 업데이트 되지 않았습니다. 맥 61버전에는 해결된 이슈입니다.)</p>
<p>그리고 <code>driver</code> 변수를 만들 때 단순하게 chromedriver의 위치만 적어주는 것이 아니라 <code>chrome_options</code>라는 이름의 인자를 함께 넘겨줘야 합니다.</p>
<p>이 <code>chrome_options</code>는 Chrome을 이용할때만 사용하는 인자인데요, 이 인자값을 통해 headless등의 추가적인 인자를 넘겨준답니다.</p>
<p>자, 이제 그러면 한번 실행해 보세요. 크롬 창이 뜨지 않았는데도 <code>naver_main_headless.png</code>파일이 생겼다면 여러분 컴퓨터에서 크롬이 Headless모드로 성공적으로 실행된 것이랍니다!</p>
<h2 id="Headless브라우저임을-숨기기"><a href="#Headless브라우저임을-숨기기" class="headerlink" title="Headless브라우저임을 숨기기"></a>Headless브라우저임을 숨기기</h2><p>Headless모드는 CLI기반의 서버 OS에서도 Selenium을 통한 크롤링/테스트를 가능하게 만드는 멋진 모드지만, 어떤 서버들에서는 이런 Headless모드를 감지하는 여러가지 방법을 쓸 수 있습니다.</p>
<p>아래 글에서는 Headless모드를 탐지하는 방법과 탐지를 ‘막는’방법을 다룹니다.(창과 방패, 또 새로운 창!)</p>
<p>아래 코드의 TEST_URL은 <a href="https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html">https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html</a> 인데요, 이곳에서 Headless모드가 감춰졌는지 아닌지 확인해 볼 수 있습니다.</p>
<h3 id="User-Agent-확인하기"><a href="#User-Agent-확인하기" class="headerlink" title="User Agent 확인하기"></a>User Agent 확인하기</h3><h4 id="Headless-탐지하기"><a href="#Headless-탐지하기" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>가장 쉬운 방법은 <code>User-Agent</code>값을 확인하는 방법입니다.</p>
<p>일반적인 크롬 브라우저는 아래와 같은 <code>User-Agent</code>값을 가지고 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;61.0.3163.100 Safari&#x2F;537.36</span><br></pre></td></tr></table></figure>

<p>하지만 Headless브라우저는 아래와 같은 <code>User-Agent</code>값을 가지고 있습니다.</p>
<p>잘 보시면 ‘HeadlessChrome/~~’와 같이 ‘Headless’라는 단어가 들어가있는걸 확인할 수 있습니다!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mozilla&#x2F;5.0 (X11; Linux x86_64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) HeadlessChrome&#x2F;60.0.3112.50 Safari&#x2F;537.36</span><br></pre></td></tr></table></figure>

<h4 id="Headless-탐지-막기"><a href="#Headless-탐지-막기" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>따라서 기본적으로 갖고있는 <code>User-Agent</code>값을 변경해줘야합니다.</p>
<p>이것도 위에서 사용한 <code>chrome_options</code>에 추가적으로 인자를 전달해주면 됩니다. 위코드를 약간 바꿔 아래와 같이 만들어보세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserAgent값을 바꿔줍시다!</span></span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>이제 여러분의 Headless크롬은 일반적인 크롬으로 보일거랍니다.</p>
<h3 id="플러그인-개수-확인하기"><a href="#플러그인-개수-확인하기" class="headerlink" title="플러그인 개수 확인하기"></a>플러그인 개수 확인하기</h3><h4 id="Headless-탐지하기-1"><a href="#Headless-탐지하기-1" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>크롬에는 여러분이 따로 설치하지 않아도 추가적으로 플러그인 몇개가 설치되어있답니다. PDF 내장 리더기같은 것들이죠.</p>
<p>하지만 Headless모드에서는 플러그인이 하나도 로딩되지 않아 개수가 0개가 됩니다. 이를 통해 Headless모드라고 추측할 수 있답니다.</p>
<p>아래 자바스크립트 코드를 통해 플러그인의 개수를 알아낼 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(navigator.plugins.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Headless 크롬이 아닐까??"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Headless-탐지-막기-1"><a href="#Headless-탐지-막기-1" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>물론 이 탐지를 막는 방법도 있습니다. 바로 브라우저에 ‘가짜 플러그인’ 리스트를 넣어주는 것이죠!</p>
<p>아래 코드와 같이 JavaScript를 실행해 플러그인 리스트를 가짜로 만들어 넣어줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'about:blank'</span>)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5];&#125;,&#125;);"</span>)</span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위와 같이 JS로 navigator 객체의 <code>plugins</code>속성 자체를 오버라이딩 해 임의의 배열을 반환하도록 만들어주면 개수를 속일 수 있습니다.</p>
<blockquote>
<p>단, 출력물에서는 Plugin length가 여전히 0으로 나올거에요. 왜냐하면 사이트가 로딩 될때 이미 저 속성이 들어가있기 때문이죠 :’( 그래서 우리는 좀 더 다른방법을 뒤에서 써볼거에요.</p>
</blockquote>
<h3 id="언어-설정"><a href="#언어-설정" class="headerlink" title="언어 설정"></a>언어 설정</h3><h4 id="Headless-탐지하기-2"><a href="#Headless-탐지하기-2" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>여러분이 인터넷을 사용할때 어떤 사이트를 들어가면 다국어 사이트인데도 여러분의 언어에 맞게 화면에 나오는 경우를 종종 보고, 구글 크롬을 써서 외국 사이트를 돌아다니면 ‘번역해줄까?’ 하는 친절한 질문을 종종 봅니다.</p>
<p>이 설정이 바로 브라우저의 언어 설정이랍니다. 즉, 여러분이 선호하는 언어가 이미 등록되어있는 것이죠.</p>
<p>Headless모드에는 이런 언어 설정이 되어있지 않아서 이를 통해 Headless모드가 아닐까 ‘추측’할 수 있습니다.</p>
<h4 id="Headless-탐지-막기-2"><a href="#Headless-탐지-막기-2" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>Headless모드인 것을 감추기 위해 언어 설정을 넣어줍시다. 바로 <code>add_argument</code>를 통해 크롬에 전달해 줄 수 있답니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5]&#125;&#125;)"</span>)</span><br><span class="line"><span class="comment"># lanuages 속성을 업데이트해주기</span></span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'languages', &#123;get: function() &#123;return ['ko-KR', 'ko']&#125;&#125;)"</span>)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>단, 출력물에서는 language가 빈칸으로 나올거에요. 왜냐하면 사이트가 로딩 될때 이미 저 속성이 들어가있기 때문이죠 :’( 그래서 우리는 좀 더 다른방법을 뒤에서 써볼거에요.</p>
</blockquote>
<h3 id="WebGL-벤더와-렌더러"><a href="#WebGL-벤더와-렌더러" class="headerlink" title="WebGL 벤더와 렌더러"></a>WebGL 벤더와 렌더러</h3><h4 id="Headless-탐지하기-3"><a href="#Headless-탐지하기-3" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>여러분이 브라우저를 사용할때 WebGL이라는 방법으로 그래픽카드를 통해 그려지는 방법을 가속을 한답니다. 즉, 실제로 디바이스에서 돌아간다면 대부분은 그래픽 가속을 사용한다는 가정이 기반인 셈이죠.</p>
<blockquote>
<p>사실 이 방법으로 차단하는 웹사이트는 거의 없을거에요. 혹여나 GPU가속을 꺼둔 브라우저라면 구별할 수 없기 때문이죠.</p>
</blockquote>
<p>위 코드에서 사용해준 <code>disable-gpu</code>옵션은 사실 이 그래픽 가속을 꺼주는 것이에요. 따라서 이부분을 보완해 줄 필요가 있습니다.</p>
<h4 id="Headless-탐지-막기-3"><a href="#Headless-탐지-막기-3" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>가장 쉬운 방법은 크롬이 업데이트되길 기대하고 <code>disable-gpu</code>옵션을 꺼버리는 것이지만, 우선은 이 옵션을 함께 사용하는 방법을 알려드릴게요.</p>
<p>위에서 사용한 script실행방법을 또 써 볼 것이랍니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5]&#125;&#125;)"</span>)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'languages', &#123;get: function() &#123;return ['ko-KR', 'ko']&#125;&#125;)"</span>)</span><br><span class="line">driver.execute_script(<span class="string">"const getParameter = WebGLRenderingContext.getParameter;WebGLRenderingContext.prototype.getParameter = function(parameter) &#123;if (parameter === 37445) &#123;return 'NVIDIA Corporation'&#125; if (parameter === 37446) &#123;return 'NVIDIA GeForce GTX 980 Ti OpenGL Engine';&#125;return getParameter(parameter);&#125;;"</span>)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line">webgl_vendor = driver.find_element_by_css_selector(<span class="string">'#webgl-vendor'</span>).text</span><br><span class="line">webgl_renderer = driver.find_element_by_css_selector(<span class="string">'#webgl-renderer'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line">print(<span class="string">'WebGL Vendor: '</span>, webgl_vendor)</span><br><span class="line">print(<span class="string">'WebGL Renderer: '</span>, webgl_renderer)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드에서는 WebGL렌더러를 Nvidia회사와 GTX980Ti엔진인 ‘척’ 하고 있는 방법입니다.</p>
<blockquote>
<p>하지만 WebGL print 구문에서는 여전히 빈칸일거에요. 이 역시 이미 사이트 로딩시 속성이 들어가있기 때문이에요.</p>
</blockquote>
<h2 id="Headless-브라우저-숨기는-방법-다함께-쓰기"><a href="#Headless-브라우저-숨기는-방법-다함께-쓰기" class="headerlink" title="Headless 브라우저 숨기는 방법 다함께 쓰기"></a>Headless 브라우저 숨기는 방법 다함께 쓰기</h2><p>위에서 사용한 방법 중 <code>User-Agent</code>를 바꾸는 방법 외에는 사실 모두 Javascript를 이용해 값을 추출하고 오버라이딩 하는 방식으로 바꿔보았습니다.</p>
<p>하지만 번번히 결과물이 빈칸으로 나오는 이유는 <code>driver.execute_script</code>라는 함수 자체가 사이트가 로딩이 끝난 후 (<code>onload()</code>이후) 실행되기 때문입니다.</p>
<p>즉, 우리는 우리가 써준 저 JS코드가 사이트가 로딩 되기 전 실행되어야 한다는 것이죠!</p>
<p>사실 기본 크롬이라면 사이트가 로딩 되기전 JS를 실행하는 Extension들을 사용할 수 있어요. 하지만 Headless크롬에서는 아직 Extension을 지원하지 않습니다 :’(</p>
<p>그래서 차선책으로 <a href="http://docs.mitmproxy.org/en/latest/mitmproxy.html">mitmproxy</a>라는 Proxy 프로그램을 사용해볼거에요.</p>
<h3 id="mitmproxy-사용하기"><a href="#mitmproxy-사용하기" class="headerlink" title="mitmproxy 사용하기"></a>mitmproxy 사용하기</h3><p>진행하기 전 앞서 만들었던 모든 JS코드가 들어있는 <code>content.js</code>를 아래처럼 만들어주세요.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CDP = <span class="built_in">require</span>(<span class="string">'chrome-remote-interface'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userAgent = <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.50 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line">CDP(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;Network, Page&#125; = client;</span><br><span class="line">  <span class="keyword">await</span> Page.enable();</span><br><span class="line">  <span class="keyword">await</span> Network.enable();</span><br><span class="line">  <span class="keyword">await</span> Network.setUserAgentOverride(&#123;userAgent&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user-agent is now set</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// overwrite the `languages` property to use a custom getter</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(navigator, <span class="string">'languages'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">'ko-KR'</span>, <span class="string">'ko'</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// overwrite the `plugins` property to use a custom getter</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(navigator, <span class="string">'plugins'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getParameter = WebGLRenderingContext.getParameter;</span><br><span class="line">WebGLRenderingContext.prototype.getParameter = <span class="function"><span class="keyword">function</span>(<span class="params">parameter</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// UNMASKED_VENDOR_WEBGL</span></span><br><span class="line">  <span class="keyword">if</span> (parameter === <span class="number">37445</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Intel Open Source Technology Center'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// UNMASKED_RENDERER_WEBGL</span></span><br><span class="line">  <span class="keyword">if</span> (parameter === <span class="number">37446</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Mesa DRI Intel(R) Ivybridge Mobile '</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getParameter(parameter);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[<span class="string">'height'</span>, <span class="string">'width'</span>].forEach(<span class="function"><span class="params">property</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// store the existing descriptor</span></span><br><span class="line">  <span class="keyword">const</span> imageDescriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(HTMLImageElement.prototype, property);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// redefine the property with a patched descriptor</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(HTMLImageElement.prototype, property, &#123;</span><br><span class="line">    ...imageDescriptor,</span><br><span class="line">    <span class="keyword">get</span>: function() &#123;</span><br><span class="line">      <span class="comment">// return an arbitrary non-zero dimension if the image failed to load</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.complete &amp;&amp; <span class="keyword">this</span>.naturalHeight == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// otherwise, return the actual dimension</span></span><br><span class="line">      <span class="keyword">return</span> imageDescriptor.get.apply(<span class="keyword">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the existing descriptor</span></span><br><span class="line"><span class="keyword">const</span> elementDescriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(HTMLElement.prototype, <span class="string">'offsetHeight'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// redefine the property with a patched descriptor</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(HTMLDivElement.prototype, <span class="string">'offsetHeight'</span>, &#123;</span><br><span class="line">  ...elementDescriptor,</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.id === <span class="string">'modernizr'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementDescriptor.get.apply(<span class="keyword">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>우선 Mitmproxy를 pip로 설치해주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mitmproxy</span><br></pre></td></tr></table></figure>

<p>그리고 proxy 처리를 해 줄 파일인 <code>inject.py</code>파일을 만들어주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inject.py</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"></span><br><span class="line"><span class="comment"># load in the javascript to inject</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'content.js'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content_js = f.read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response</span><span class="params">(flow)</span>:</span></span><br><span class="line">    <span class="comment"># only process 200 responses of html content</span></span><br><span class="line">    <span class="keyword">if</span> flow.response.headers[<span class="string">'Content-Type'</span>] != <span class="string">'text/html'</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flow.response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># inject the script tag</span></span><br><span class="line">    html = BeautifulSoup(flow.response.text, <span class="string">'lxml'</span>)</span><br><span class="line">    container = html.head <span class="keyword">or</span> html.body</span><br><span class="line">    <span class="keyword">if</span> container:</span><br><span class="line">        script = html.new_tag(<span class="string">'script'</span>, type=<span class="string">'text/javascript'</span>)</span><br><span class="line">        script.string = content_js</span><br><span class="line">        container.insert(<span class="number">0</span>, script)</span><br><span class="line">        flow.response.text = str(html)</span><br><span class="line"></span><br><span class="line">        ctx.log.info(<span class="string">'Successfully injected the content.js script.'</span>)</span><br></pre></td></tr></table></figure>

<p>이제 터미널에서 아래 명령어로 mitmproxy 서버를 띄워주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump -p 8080 -s &quot;inject.py&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>이 서버는 크롤링 코드를 실행 할 때 항상 켜져있어야 해요!</p>
</blockquote>
<p>이제 우리 크롤링 코드에 <code>add_argument</code>로 Proxy옵션을 추가해 주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"proxy-server=localhost:8080"</span>)</span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">print(driver.page_source)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line">webgl_vendor = driver.find_element_by_css_selector(<span class="string">'#webgl-vendor'</span>).text</span><br><span class="line">webgl_renderer = driver.find_element_by_css_selector(<span class="string">'#webgl-renderer'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line">print(<span class="string">'WebGL Vendor: '</span>, webgl_vendor)</span><br><span class="line">print(<span class="string">'WebGL Renderer: '</span>, webgl_renderer)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>하지만 사실 이 코드는 정상적으로 동작하지 않을거에요. 헤드리스모드를 끄면 잘 돌아가지만 헤드리스모드를 켜면 정상적으로 동작하지 않아요. 바로 SSL오류 때문입니다.</p>
<p>크롬에서 SSL을 무시하도록 만들수 있고, 로컬의 HTTP를 신뢰 가능하도록 만들 수도 있지만 아직 크롬 Headless모드에서는 지원하지 않습니다.</p>
<p>정확히는 아직 webdriver에서 지원하지 않습니다. </p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>아직까지는 크롬 Headless모드에서 HTTPS 사이트를 ‘완전히 사람처럼’보이게 한뒤 크롤링 하는 것은 어렵습니다. 하지만 곧 업데이트 될 크롬에서는 익스텐션 사용 기능이 추가될 예정이기 때문에 이 기능이 추가되면 복잡한 과정 없이 JS를 바로 추가해 진짜 일반적인 크롬처럼 동작하도록 만들 수 있으리라 생각합니다.</p>
<p>사실 서버 입장에서 위와 같은 요청을 보내는 경우 처리를 할 수 있는 방법은 JS로 헤드리스 유무를 확인하는 방법이 전부입니다. 즉, 서버 입장에서도 ‘식별’은 가능하지만 이로 인해 유의미한 차단은 하기 어렵습니다. 현재로서는 UserAgent 값만 변경해주어도 대부분의 사이트에서는 자연스럽게 크롤링을 진행할 수 있으리라 생각합니다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html">Detecting Chrome Headless</a></li>
<li><a href="https://intoli.com/blog/making-chrome-headless-undetectable/">MAKING CHROME HEADLESS UNDETECTABLE</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/crawling_with_multiprocessing.png" alt="나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-04T15:00:00.000Z">2017-07-05</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/">나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이전 가이드: <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a></p>
</blockquote>
<h2 id="들어가기전"><a href="#들어가기전" class="headerlink" title="들어가기전.."></a>들어가기전..</h2><p>나만의 웹 크롤러 만들기 6번째 가이드는 크롤링을 병렬화를 통해 빠르게 진행하는 방법을 안내합니다.</p>
<p>지금까지 만들어온 크롤러들은 모두 한번에 하나의 요청만을 처리하고 있습니다. 물론 지금까지 따라오셨다면 충분히 크롤러들을 여러분의 의도에 맞게 잘 수정해서 사용해보셨을거라 생각합니다.</p>
<p>하지만 한 페이지만을 여유로운 시간을 갖고 크롤링하는 것이 아니라 여러 사이트 혹은 여러 페이지를 좀더 빠르게 긁어오는 방법에는 역시 N개를 띄우는 방법이 제일 낫다고 볼 수 있습니다.</p>
<p>만약 100만개의 페이지가 있다면 1<del>25만/25만1</del>50만/50만1<del>75만/75만1</del>100만와 같이 4개로 쪼개서 돌린다면 더 빠르게 도는 것은 당연합니다.</p>
<p>하지만 전달해주는 페이지의 목록이나 페이지 숫자에 직접 저 수들을 입력하는 것은 상당히 귀찮은 일이기도 하고, 크롤링이 ‘자동화’를 위한 것이라는 면에 반하는 측면도 있습니다. 따라서 우리는 Python 자체에 내장된 병렬화 모듈을 사용할 예정입니다.</p>
<p>Python을 이용할 때 프로그램을 병렬적으로 처리하는 방법은 여러가지가 있습니다. 하지만 우리가 하는 일은 연산이 아니고 IO와 네트워크가 가장 큰 문제이기 때문에 <code>multiprocessing</code>을 사용합니다.</p>
<blockquote>
<p><code>threading</code> 모듈도 사용 가능합니다. 하지만 <code>multiprocessing</code>모듈을 추천합니다. <code>threading</code>모듈은 싱글 프로세스 안의 스레드에서 동작하지만 이로인해 GIL의 제약에 걸리는 경우가 생기기 때문에 성능 향상에 제약이 있습니다. (물론 우리는 CPU 연산보다 IO/네트워크로 인한 지연이 훨씬 크기 때문에 큰 차이는 없습니다.)</p>
</blockquote>
<h2 id="멀티프로세스란"><a href="#멀티프로세스란" class="headerlink" title="멀티프로세스란?"></a>멀티프로세스란?</h2><p>프로세스란 ‘실행 중인 프로그램’을 의미합니다. 간단하게 말해 멀티프로세스는 프로세스를 여러개 띄우는 것, 즉 프로그램을 여러개 실행시키는 것이라고 볼 수 있습니다.</p>
<p>Python에는 멀티프로세싱 프로그램을 위한 모듈이 <code>multiprocessing</code>이라는 이름으로 내장되어 있습니다. </p>
<p>가장 단순한 예시로, 임의의 숫자 리스트 (ex: <code>[20, 25, 30, 35]</code>)를 받고 그 자리의 피보나치 수를 구해주는 프로그램이 있다고 가정해 봅시다.</p>
<p>만약 for문을 통해 리스트를 순회하며 계산한다면 아래와 같이 코드를 짤 수 있습니다.</p>
<blockquote>
<p>주의: 명백한 코드 실행 시간 차이를 보여주기 위한 느린 코드입니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibo</span><span class="params">(n)</span>:</span> <span class="comment"># 회귀적 피보나치 함수</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibo(n<span class="number">-1</span>) + fibo(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line">num_list = [<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>]</span><br><span class="line">result_list = []</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> num_list:</span><br><span class="line">    result_list.append(fibo(num))</span><br><span class="line"></span><br><span class="line">print(result_list)</span><br><span class="line">print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>실행을 해보면 다음과 같이 약 7s가 걸리는 것을 볼 수 있습니다. 너무 오래걸리네요.</p>
<script type="text/javascript" src="https://asciinema.org/a/c6iRt6q82WDuFruFfcFlmmrjn.js" id="asciicast-c6iRt6q82WDuFruFfcFlmmrjn" async></script>

<p>그렇다면 <code>multiprocessing</code>을 이용하면 어떨까요?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibo</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibo(n<span class="number">-1</span>) + fibo(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_fibo</span><span class="params">(n)</span>:</span> <span class="comment"># 피보나치 결과를 확인합니다.</span></span><br><span class="line">    print(fibo(n))</span><br><span class="line"></span><br><span class="line">num_list = [<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>]</span><br><span class="line">    </span><br><span class="line">pool = Pool(processes=<span class="number">4</span>) <span class="comment"># 4개의 프로세스를 사용합니다.</span></span><br><span class="line">pool.map(print_fibo, num_list) <span class="comment"># pool에 일을 던져줍니다.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>실행을 해 봅시다!</p>
<script type="text/javascript" src="https://asciinema.org/a/gwOTuBQgs11J6ckOlgIERAdF5.js" id="asciicast-gwOTuBQgs11J6ckOlgIERAdF5" async></script>

<p>확실히 빨라진 모습을 볼 수 있습니다. 3s, 즉 절반정도로 줄어든 것을 확인 할 수 있습니다.</p>
<h2 id="크롤링-병렬화-하기"><a href="#크롤링-병렬화-하기" class="headerlink" title="크롤링 병렬화 하기"></a>크롤링 병렬화 하기</h2><p>이번 가이드에서는 위에서 사용한 모듈인 <code>multiprocessing</code>을 이용해 진행합니다. 크롤링은 위에서 사용한 것처럼 연산집중적이지 않습니다. 그래서 크롤링하는 함수를 만들어두었다면 그 함수를 그대로 사용하시면 됩니다.</p>
<p>이번 가이드에서는 첫번째 가이드에서 사용했던 함수를 약간 변형해 사용해 봅니다.</p>
<h3 id="하나씩-크롤링-하기"><a href="#하나씩-크롤링-하기" class="headerlink" title="하나씩 크롤링 하기"></a>하나씩 크롤링 하기</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">()</span>:</span> <span class="comment"># 블로그의 게시글 링크들을 가져옵니다.</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data.append(title.get(<span class="string">'href'</span>))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(link)</span>:</span></span><br><span class="line">    abs_link = <span class="string">'https://beomi.github.io'</span>+link</span><br><span class="line">    req = requests.get(abs_link)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># 가져온 데이터로 뭔가 할 수 있겠죠?</span></span><br><span class="line">    <span class="comment"># 하지만 일단 여기서는 시간만 확인해봅시다.</span></span><br><span class="line">    print(soup.select(<span class="string">'h1'</span>)[<span class="number">0</span>].text) <span class="comment"># 첫 h1 태그를 봅시다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> link <span class="keyword">in</span> get_links():</span><br><span class="line">        get_content(link)</span><br><span class="line">    print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>약 7.3s가 걸리는 것을 아래에서 확인해 볼 수 있습니다.</p>
<script type="text/javascript" src="https://asciinema.org/a/WgPLMFdo60dedeMD7PO53uyNZ.js" id="asciicast-WgPLMFdo60dedeMD7PO53uyNZ" async></script>

<h3 id="Multiprocessing으로-병렬-크롤링하기"><a href="#Multiprocessing으로-병렬-크롤링하기" class="headerlink" title="Multiprocessing으로 병렬 크롤링하기"></a>Multiprocessing으로 병렬 크롤링하기</h3><p>이제 좀더 빠른 크롤링을 위해 병렬화를 도입해 봅시다.</p>
<p><code>multiprocessing</code>에서 <code>Pool</code>을 import 해 줍시다.</p>
<p>그리고 pool에 <code>get_content</code>함수를 넣어 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool <span class="comment"># Pool import하기</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">()</span>:</span> <span class="comment"># 블로그의 게시글 링크들을 가져옵니다.</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data.append(title.get(<span class="string">'href'</span>))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(link)</span>:</span></span><br><span class="line">    abs_link = <span class="string">'https://beomi.github.io'</span>+link</span><br><span class="line">    req = requests.get(abs_link)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># 가져온 데이터로 뭔가 할 수 있겠죠?</span></span><br><span class="line">    <span class="comment"># 하지만 일단 여기서는 시간만 확인해봅시다.</span></span><br><span class="line">    print(soup.select(<span class="string">'h1'</span>)[<span class="number">0</span>].text) <span class="comment"># 첫 h1 태그를 봅시다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    pool = Pool(processes=<span class="number">4</span>) <span class="comment"># 4개의 프로세스를 사용합니다.</span></span><br><span class="line">    pool.map(get_content, get_links()) <span class="comment"># get_contetn 함수를 넣어줍시다.</span></span><br><span class="line">    print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<script type="text/javascript" src="https://asciinema.org/a/yITked7NP4bM7nPaAZM4CcIYF.js" id="asciicast-yITked7NP4bM7nPaAZM4CcIYF" async></script>

<p>약 2.8초로 약 3~4배의 속도 향상이 있었습니다.</p>
<h2 id="마무리-및-팁"><a href="#마무리-및-팁" class="headerlink" title="마무리 및 팁"></a>마무리 및 팁</h2><p>멀티프로세싱으로 크롤링을 할 때 유의할 점은 Pool을 생성시 <code>processes</code>의 개수가 많다고 빠르지는 않다는 점을 유의하셔야 합니다.</p>
<p>두번째 parser.py파일을 실행 시 process를 4개인 경우 2.8s, 8개로 할 때 1.85s, 16개로 할 때 0.96s, 32개로 할 때 0.63s로 속도 향상이 두드러집니다. 하지만 64개로 할 때는 오히려 1.30s로 속도 지연이 발생합니다. 프로세스는 CPU코어(Hyper-Thread인 경우 2배) 개수의 2배(ex: 4코어 i5는 8개, 4코어8스레드인 i7은 16개)로 하면 가장 빠르지는 않지만 적당히 빠른 속도를 가져다줍니다.</p>
<p>다음으로는 웹 사이트에서 이러한 공격적 크롤링을 차단할 수 있다는 문제입니다. 잘 관리되는 사이트의 경우 이와 같은 공격적 크롤링은 사실 시스템 관리자에게 있어서는 공격 시도와 같이 보일 수 있기 때문에 적당한 속도를 유지하며 <code>robots.txt</code>를 존중해주는 것이 중요합니다.</p>
<p>무작정 빠르게 긁는다고 빠르지 않은 점에는 이 코드를 실행하는 컴퓨터의 네트워크 환경 자체가 제약이 되기도 합니다. 만약 핫스팟이나 테더링을 이용하거나 인터넷 속도에 제약을 받는 환경에서 이러한 작업을 돌린다면 오히려 네트워크쪽 문제로 인해 에러나 지연이 발생할 가능성이 높습니다. 이런 경우에는 <code>processes</code>개수를 2~4개로 맞춰서 크롤링을 진행하는 것이 최적의 속도를 이끌어낼 수도 있습니다.</p>
<p>다음 가이드에서는 실제 명령어를 받아 사용자들의 정보를 저장하고 사용자들에게 실제로 유용한 정보(예: 글 제목과 링크)를 보내주는 내용으로 진행할 예정입니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/telegram.png" alt="나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-04-19T15:00:00.000Z">2017-04-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이전게시글: <a href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/">나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기</a></p>
</blockquote>
<blockquote>
<p>이번 가이드에서는 작업하는 컴퓨터가 아닌 원격 우분투16.04 서버(vps)에 올리는 부분까지 다룹니다. 테스트는 <code>crontab -e</code> 명령어를 사용할 수 있는 환경에서 가능하며, VISA/Master카드등 해외결제가 가능한 카드가 있다면 서비스 가입 후 실제로 배포도 가능합니다. 이 가이드에서는 Vultr VPS를 이용합니다.</p>
</blockquote>
<p>앞서 <code>Django</code>를 이용해 크롤링한 데이터를 DB에 저장해 보았습니다.</p>
<p>하지만 크롤링을 할 때마다 동일한(중복된) 데이터를 DB에 저장하는 것은 바람직 하지 않은 일이죠.</p>
<p>또한, 크롤링을 자동으로 해 사이트에 변경사항이 생길 때 마다 내 텔레그램으로 알림을 받을 수 있다면 더 편리하지 않을까요?</p>
<p>이번 가이드에서는 클리앙 중고장터 등을 크롤링해 새 게시글이 올라올 경우 새글 알림을 텔레그램으로 보내는 것까지를 다룹니다.</p>
<p>다루는 내용:</p>
<ul>
<li>Telegram Bot API</li>
<li>requests / BeautifulSoup</li>
<li>Crontab</li>
</ul>
<h2 id="시작하며"><a href="#시작하며" class="headerlink" title="시작하며"></a>시작하며</h2><h2 id="widgets"><a href="#widgets" class="headerlink" title="widgets:"></a>widgets:</h2><p>텔레그램은 REST API를 통해 봇을 제어하도록 안내합니다.</p>
<p>물론 직접 텔레그램 api를 사용할 수도 있지만, 이번 가이드에서는 좀 더 빠른 개발을 위해 <code>python-telegram-bot</code> 패키지를 사용합니다.</p>
<p><code>python-telegram-bot</code>은 Telegram Bot API를 python에서 쉽게 이용하기 위한 wrapper 패키지입니다.</p>
<h2 id="python-telegram-bot-설치하기"><a href="#python-telegram-bot-설치하기" class="headerlink" title="python-telegram-bot 설치하기"></a>python-telegram-bot 설치하기</h2><h2 id="widgets-1"><a href="#widgets-1" class="headerlink" title="widgets:"></a>widgets:</h2><p><code>python-telegram-bot</code>은 pip로 설치 가능합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-telegram-bot</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>requests</code>, <code>bs4</code> 역시 설치되어있어야 합니다!</p>
</blockquote>
<h2 id="텔레그램-봇-만들기-amp-API-Key받기"><a href="#텔레그램-봇-만들기-amp-API-Key받기" class="headerlink" title="텔레그램 봇 만들기 &amp; API Key받기"></a>텔레그램 봇 만들기 &amp; API Key받기</h2><h2 id="widgets-2"><a href="#widgets-2" class="headerlink" title="widgets:"></a>widgets:</h2><p>텔레그램 봇을 만들고 API키를 받아 이용하는 기본적인 방법은 <a href="https://blog.psangwoo.com/coding/2016/12/08/python-telegram-bot-1.html">python에서 telegram bot 사용하기</a>에 차근차근 설명되어있습니다.</p>
<p>위 가이드에서 텔레그램 봇의 토큰을 받아오세요. 토큰은 <code>aaaa:bbbbbbbbbbbbbb</code>와 같이 생긴 문자열입니다.</p>
<blockquote>
<p>이번 가이드는 텔레그램 봇을 다루는 내용보다는 Cron으로 크롤링을 하고 변화 발견시 텔레그램 메시지를 보내는 것에 초점을 맞췄습니다.</p>
</blockquote>
<p>텔레그램 봇 API키를 받아왔다면 아래와 같이 크롤링을 하는 간단한 python파일을 작성해 봅시다. 클리앙에 새로운 글이 올라오면 “새 글이 올라왔어요!”라는 메시지를 보내는 봇을 만들어 보겠습니다.</p>
<h2 id="클리앙-새글-탐지코드-만들기"><a href="#클리앙-새글-탐지코드-만들기" class="headerlink" title="클리앙 새글 탐지코드 만들기"></a>클리앙 새글 탐지코드 만들기</h2><h2 id="widgets-3"><a href="#widgets-3" class="headerlink" title="widgets:"></a>widgets:</h2><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2000.46.01.png" alt="clien marcket web page list"></p>
<p>우선 게시판의 글 제목중 첫번째 제목을 가져오고 txt파일로 저장하는 코드를 만들어 봅시다.</p>
<p>회원 장터 주소는 <code>http://clien.net/cs2/bbs/board.php?bo_table=sold</code>이고, 첫 게시글의 CSS Selector는 <code>#content &gt; div.board_main &gt; table &gt; tbody &gt; tr:nth-child(3) &gt; td.post_subject &gt; a</code>임을 알 수 있습니다. 따라서 아래와 같이 <code>latest</code> 변수에 담아 같은 폴더의 <code>latest.txt</code> 파일에 써 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span> <span class="comment"># Clien에서 encoding 정보를 보내주지 않아 encoding옵션을 추가해줘야합니다.</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text <span class="comment"># 0번은 회원중고장터 규칙입니다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(latest)</span><br></pre></td></tr></table></figure>

<p>위와 같이 코드를 구성하면 <code>latest.txt</code>파일에 가장 최신 글의 제목이 저장됩니다.</p>
<p>크롤링 이후 새로운 글이 생겼는지의 유무를 알아보려면 크롤링한 최신글의 제목과 파일에 저장된 제목이 같은지를 확인하면 됩니다.</p>
<p>만약 같다면 패스, 다르다면 텔레그램으로 메시지를 보내는거죠!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        <span class="comment"># 같은 경우는 에러 없이 넘기고, 다른 경우에만</span></span><br><span class="line">        <span class="comment"># 메시지 보내는 로직을 넣으면 됩니다.</span></span><br><span class="line">    f_read.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">    f_write.write(latest)</span><br><span class="line">    f_write.close()</span><br></pre></td></tr></table></figure>

<h2 id="새글이라면-텔레그램으로-메시지-보내기"><a href="#새글이라면-텔레그램으로-메시지-보내기" class="headerlink" title="새글이라면? 텔레그램으로 메시지 보내기!"></a>새글이라면? 텔레그램으로 메시지 보내기!</h2><h2 id="widgets-4"><a href="#widgets-4" class="headerlink" title="widgets:"></a>widgets:</h2><p>이제 메시지를 보내볼게요. <code>telegram</code>을 import하신 후 <code>bot</code>을 선언해주시면 됩니다. token은 위에서 받은 토큰입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line"><span class="comment"># 토큰을 지정해서 bot을 선언해 줍시다! (물론 이 토큰은 dummy!)</span></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line"><span class="comment"># 우선 테스트 봇이니까 가장 마지막으로 bot에게 말을 건 사람의 id를 지정해줄게요.</span></span><br><span class="line"><span class="comment"># 만약 IndexError 에러가 난다면 봇에게 메시지를 아무거나 보내고 다시 테스트해보세요.</span></span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 원래는 이 메시지를 보낼 필요가 없지만, 테스트 할 때는 봇이 동작하는지 확인차 넣어봤어요.</span></span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 없어요 ㅠㅠ'</span>)</span><br><span class="line">    f_read.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">    f_write.write(latest)</span><br><span class="line">    f_write.close()</span><br></pre></td></tr></table></figure>

<p>이제 <code>clien_market_parser.py</code>파일을 실행할 때 새 글이 올라왔다면 “새 글이 올라왔어요!”라는 알림이, 새 글이 없다면 “새 글이 없어요 ㅠㅠ”라는 알림이 옵니다.</p>
<blockquote>
<p>지금은 자동으로 실행되지 않기 때문에 <code>python clien_market_parser.py</code>명령어로 직접 실행해 주셔야 합니다.</p>
</blockquote>
<h2 id="자동으로-크롤링하고-메시지-보내기"><a href="#자동으로-크롤링하고-메시지-보내기" class="headerlink" title="자동으로 크롤링하고 메시지 보내기"></a>자동으로 크롤링하고 메시지 보내기</h2><h2 id="widgets-5"><a href="#widgets-5" class="headerlink" title="widgets:"></a>widgets:</h2><h3 id="가장-쉬운방법-while-sleep"><a href="#가장-쉬운방법-while-sleep" class="headerlink" title="가장 쉬운방법: while + sleep"></a>가장 쉬운방법: <code>while</code> + <code>sleep</code></h3><p>가장 쉬운 방법은 python의 <code>while</code>문을 쓰는 방법입니다. 물론, 가장 나쁜 방법이에요. 안전하지도 않고 시스템의 메모리를 좀먹을 수도 있어요.</p>
<p>하지만 테스트에서는 가장 쉽게 쓸 수 있어요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">    req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">    latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">        before = f_read.readline()</span><br><span class="line">        <span class="keyword">if</span> before != latest:</span><br><span class="line">            bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 없어요 ㅠㅠ'</span>)</span><br><span class="line">        f_read.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">        f_write.write(latest)</span><br><span class="line">        f_write.close()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">60</span>) <span class="comment"># 60초(1분)을 쉬어줍니다.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>파이썬 동작중에는 CTRL+C로 빠져나올수 있습니다.</p>
</blockquote>
<h3 id="추천-시스템의-cron-스케쥴러를-이용하기"><a href="#추천-시스템의-cron-스케쥴러를-이용하기" class="headerlink" title="추천: 시스템의 cron/스케쥴러를 이용하기"></a>추천: 시스템의 cron/스케쥴러를 이용하기</h3><p>이번 가이드에서 핵심인 부분인데요, 이 부분은 이제 우분투 16.04 기준으로 진행할게요.</p>
<p>우선 Ubuntu 16.04가 설치된 시스템이 필요합니다. 이번 강의에서는 Vultr VPS를 이용합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.31.34.png" alt="add deploy new vps"></p>
<p>Vultr는 가상 서버 회사인데, Tokyo리전의 VPS를 제공해줘 빠르게 이용이 가능합니다. 트래픽도 굉장히 많이주고요.</p>
<p>가이드를 만드는 지금은 월 2.5달러 VPS는 아쉽게도 없어서, 월5달러 VPS로 진행하지만 월2.5달러 VPS로도 충분합니다!</p>
<p>아래의 Deploy Now를 누르면 새 Cloud Instance(VPS)가 생성되는데요, 서버가 생성된 후 들어가 보면 다음과 같이 id와 pw가 나와있습니다. 패스워드는 눈 모양을 누르면 잠시 보입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.43.54.png" alt=""></p>
<p>이 정보로 ssh에 접속해 봅시다. (윈도는 putty이나 Xshell등을 이용해주세요.)</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.46.08.png" alt=""></p>
<p>우분투 16.04버전에는 이미 Python3.5버전이 설치되어있기 때문에 <code>pip3</code>, <code>setuptools</code>을 설치해 주고 Ubuntu의 Locale을 설정해줘야 합니다. 아래 명령어를 한줄씩 순차적으로 치시면 완료됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip python3-setuptools build-essential</span><br><span class="line">sudo locale-gen <span class="string">"ko_KR.UTF-8"</span></span><br><span class="line">pip3 install requests bs4 python-telegram-bot</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.48.11.png" alt=""></p>
<p>설치를 하신 후 코드를 테스트 해보려면 위 파일을 <code>vi</code>등으로 열어 위 코드들을 입력하시면 됩니다.</p>
<p>이제 코드를 약간 바꿔볼게요. 새 글이 올라올때만 파일을 다시 쓰도록 해요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    f_read.close()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">            f_write.write(latest)</span><br><span class="line">            f_write.close()</span><br></pre></td></tr></table></figure>

<p>이제 이 <code>clien_market_parser.py</code> 파일을 <code>python3</code>으로 실행해야 하기 때문에, <code>python3</code>이 어디 설치되어있는지 확인 해 봅시다.(아마 <code>/usr/bin/python3</code>일거에요!)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@vultr:~<span class="comment"># which python3</span></span><br><span class="line">/usr/bin/python3</span><br></pre></td></tr></table></figure>

<p>이제 Crontab에 이 파이썬으로 우리 파일을 매 1분마다 실행하도록 만들어 봅시다.</p>
<blockquote>
<p>crontab 수정은 <code>crontab -e</code>명령어로 사용 가능합니다. 만약 에디터를 선택하라고 한다면 초보자는 Nano를, vi를 쓰실수 있으시다면 vi를 이용하세요.</p>
</blockquote>
<p>이 한줄을 crontab 마지막에 추가해 주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * /usr/bin/python3 /root/clien_market_parser.py</span><br></pre></td></tr></table></figure>

<blockquote>
<p>힌트: 매 12분마다로 하시려면 <code>*/12 * * * * /usr/bin/python3 /root/clien_market_parser.py</code>로 하시면 됩니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2002.03.23.png" alt=""></p>
<p>이제 여러분의 휴대폰으로 새 글이 올라올 때 마다 알람이 올라올 거랍니다 :)</p>
<h2 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h2><h2 id="widgets-6"><a href="#widgets-6" class="headerlink" title="widgets:"></a>widgets:</h2><p>이번편 가이드는 DB를 이용하지 않고 단순하게 새로운 글이 왔다는 사실만을 메시지로 알려주는 봇을 만들어서 뭔가 아쉬움이 있을겁니다. </p>
<p>다음편 가이드는 <code>multiprocessing</code>을 이용한 N배 빠른 크롤러을 만들어 봅니다.</p>
<blockquote>
<p>다음 가이드: <a href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/">나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!</a></p>
</blockquote>
<!--

-->
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/22/Setup-SocialAuth-for-Django-Email-as-User/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-02-08-Setup-SocialAuth-for-Django/social_login.png" alt="Django에 Social Login와 Email유저 함께 이용하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-03-21T15:00:00.000Z">2017-03-22</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/django/">django</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/22/Setup-SocialAuth-for-Django-Email-as-User/">Django에 Social Login와 Email유저 함께 이용하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p><code>django-custom-user</code>와 <code>social-auth-app-django</code>(구 <code>python-social-auth</code>)를 이용해 이메일 기반 유저와 소셜 로그인으로 로그인 한 유저를 하나처럼 사용하는 방법입니다.</p>
</blockquote>
<blockquote>
<p>장고에 소셜 로그인을 붙이는 가이드는 <a href="/2017/02/08/Setup-SocialAuth-for-Django/">Django에 Social Login 붙이기: Django세팅부터 Facebook/Google 개발 설정까지</a> 포스팅에서 찾으실 수 있습니다.</p>
</blockquote>
<h1 id="Django-SocialLogin-Email-as-User"><a href="#Django-SocialLogin-Email-as-User" class="headerlink" title="Django + SocialLogin + Email as User"></a>Django + SocialLogin + Email as User</h1><p>웹 서비스를 제공할 때 여러가지 로그인 방법을 구현할 수 있습니다. 아이디/패스워드 기반의 방식, 페이스북과 구글등의 OAuth를 이용한 소셜 로그인 방식 등이 있습니다.</p>
<p>장고 프로젝트를 만들 때 <code>django-custom-user</code>등의 패키지를 이용하면 이메일 주소를 Unique Key로 사용해 이메일 주소로 로그인을 할 수 있도록 만들어 줍니다.</p>
<blockquote>
<p><code>django-custom-user</code>에 관한 문서는 <a href="https://github.com/jcugat/django-custom-user#django-custom-user">Django Custom User GitHub</a>에서 확인하실 수 있습니다.</p>
</blockquote>
<p>하지만, <code>social-auth-app-django</code>를 통해 유저를 생성 할 경우 OAuth Provider에 따라 다른 User를 생성합니다. 즉, 같은 이메일 주소를 가지고 있는 유저라 하더라도 페이스북을 통해 로그인 한 유저와 구글을 통해 로그인 한 유저는 다르게 다뤄진다는 뜻입니다.</p>
<blockquote>
<p>사실 이메일 주소를 신뢰하지 않고 Provier마다 다른 유저로 생성하는 것이 기본으로 되어있는 이유는 Oauth Provier의 신뢰 문제입니다. 모든 Oauth Provier가 가입한 유저의 Email의 실 소유권을 확인하지는 않기 때문입니다.</p>
</blockquote>
<p>이를 해결하고 같은 이메일을 통해 로그인한 유저는 모두 같은 유저로 취급하기 위해서는 장고 프로젝트 폴더의 <code>settings.py</code>파일 안에서 <code>social-auth-app-django</code>의 Pipeline설정을 변경해 줘야 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SOCIAL_AUTH_PIPELINE = (</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.social_details'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.social_uid'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.auth_allowed'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.social_user'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.user.get_username'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.associate_by_email'</span>,  <span class="comment"># &lt;--- 이 줄이 핵심입니다.</span></span><br><span class="line">    <span class="string">'social_core.pipeline.user.create_user'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.associate_user'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.social_auth.load_extra_data'</span>,</span><br><span class="line">    <span class="string">'social_core.pipeline.user.user_details'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>SOCIAL_AUTH_PIPELINE</code>은 <code>settings.py</code>내에는 기본적으로 지정이 해제되어있습니다. 따라서 변수가 없는 경우 위 코드 전체를 <code>settings.py</code>파일 끝에 덧붙이시면 됩니다.</p>
<blockquote>
<p>참고: <a href="http://python-social-auth.readthedocs.io/en/latest/use_cases.html#associate-users-by-email">Python Social Auth: Associate users by Email</a></p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/20/Deploy-Django-with-Fabric/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/old_post/python-fabric-logo.jpg" alt="Fabric으로 Django 배포하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-03-19T15:00:00.000Z">2017-03-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/fabric/">fabric</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/fabric/django/">django</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/20/Deploy-Django-with-Fabric/">Fabric으로 Django 배포하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>이번 가이드는 완성된 상태의 Django 프로젝트가 있다고 가정합니다. 예제로 <a href="https://github.com/Beomi/irkshop">https://github.com/Beomi/irkshop</a> 을 배포해 봅니다.</p>
</blockquote>
<blockquote>
<p><a href="https://gist.github.com/Beomi/945cd905175c3b21370f8f04abd57404">https://gist.github.com/Beomi/945cd905175c3b21370f8f04abd57404</a>의 예제를 설명합니다.</p>
</blockquote>
<h1 id="Fabric으로-Django-배포하기"><a href="#Fabric으로-Django-배포하기" class="headerlink" title="Fabric으로 Django 배포하기"></a>Fabric으로 Django 배포하기</h1><p>Django는 내장된 <code>runserver</code>라는 개발용 웹 서버가 있습니다. 하지만 개발용 웹 서버를 상용 환경에서 사용하는 것은 여러가지 문제를 가져옵니다. 메모리 문제등의 성능 이슈부터 Static file서빙의 보안 문제까지 다양한데요, 이 때문에 Django는 웹 서버(ex: <code>Apache2</code> <code>NginX</code>등)를 통해 배포하게 됩니다.</p>
<p>하지만 이러한 배포작업은 아마존 EC2등의 VPS나 리얼 서버에서 <code>Apache2</code>를 깔고, <code>python3</code>와 <code>mod_wsgi</code>등을 깔아야만 동작하기 때문에 배포 자체가 어려움을 갖게 됩니다. 또한 SSH에 접속히 직접 명령어를 치는 경우 오타나 실수등으로 인해 정상적으로 작동하지 않는 경우도 부지기수입니다.</p>
<p>따라서 이러한 작업을 자동화해주는 도구가 바로 Fabric이고, 이번 가이드에서는 Django 프로젝트를 Vultr VPS, Ubuntu에 올리는 방법을 다룹니다.</p>
<h2 id="Vultr-VPS-생성하기"><a href="#Vultr-VPS-생성하기" class="headerlink" title="Vultr VPS 생성하기"></a>Vultr VPS 생성하기</h2><p><a href="vultr.com">Vultr</a>는 VPS(가상서버) 제공 회사입니다. 최근 가격 인하로 유사 서비스 대비 절반 가격에 이용할 수 있어 가성비가 좋습니다.</p>
<p>사용자가 많지 않은 (혹은 혼자 사용하는..) 서비스라면 최소 가격인 1cpu 512MB의 월 2.5달러짜리를 이용하시면 됩니다.</p>
<p>Vultr는 일본 Region에 서버가 있어 한국에서 사용하기에도 핑이 25ms정도로 양호합니다.</p>
<p>VPS하나를 만든 후 root로 접속해 장고를 구동할 사용자를 만들어 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-03-19%2023.20.21.png" alt="예제VPS"></p>
<h2 id="django-유저-만들기-sudo권한-가진-유저-만들기"><a href="#django-유저-만들기-sudo권한-가진-유저-만들기" class="headerlink" title="django 유저 만들기(sudo권한 가진 유저 만들기)"></a><code>django</code> 유저 만들기(sudo권한 가진 유저 만들기)</h2><p>Fabric을 사용할 때 초기에 <code>apt</code>를 이용해 패키지를 설치해야 할 필요가 있습니다.</p>
<p>하지만 처음에 제공되는 <code>root</code>계정은 사용하지 않는 것을 보안상 추천합니다. 따라서 우리는 <code>sudo</code>권한을 가진 <code>django</code>라는 유저를 생성하고 Fabric으로 진행해 보겠습니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser django <span class="comment"># `django`라는 유저를 만듭니다.</span></span><br><span class="line">adduser django sudo <span class="comment"># django유저를 `sudo`그룹에 추가합니다.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>비밀번호를 만드는 것을 제외하면 나머지는 빈칸으로 만들어 두어도 무방합니다.</p>
</blockquote>
<h2 id="Fabric-설치하기"><a href="#Fabric-설치하기" class="headerlink" title="Fabric 설치하기"></a>Fabric 설치하기</h2><p><code>Fabric</code>은 기본적으로 서버가 아닌 클라이언트에 설치합니다. 개념상 로컬에서 SSH로 서버에 접속해 명령을 처리하는 것이기 때문에 당연히 SSH 명령을 입려하는 로컬에 설치되어야 합니다.</p>
<p>Fabric은 공식적으로는 Python2.7만을 지원합니다. 하지만 이 프로젝트를 Fork해서 Python3을 지원하는 프로젝트인 <code>Fabric3</code>이 있습니다. 이번 가이드에서는 이 <code>Fabric3</code>을 설치합니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip3 install fabric3</span><br><span class="line"><span class="comment"># 혹은</span></span><br><span class="line">python3 -m pip install fabric3</span><br></pre></td></tr></table></figure>

<h2 id="fabfile-만들기"><a href="#fabfile-만들기" class="headerlink" title="fabfile 만들기"></a>fabfile 만들기</h2><h3 id="Fabric-import하기"><a href="#Fabric-import하기" class="headerlink" title="Fabric import하기"></a>Fabric import하기</h3><p>Fabric을 설치하시면 <code>fab</code>이라는 명령어를 사용할 수 있습니다. 이 명령어는 <code>fab some_func</code>라는 방식을 통해 <code>fabfile.py</code>파일 안의 함수를 실행할 수 있습니다.</p>
<p>fabfile은 기본적으로 <code>manage.py</code>파일와 같은 위치인 프로젝트 폴더에 두시는 것을 권장합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br></pre></td></tr></table></figure>

<p>우선 fabric에서 사용하는 API들을 import해줍니다.</p>
<p><code>fabric.contrib.files</code>에서는 원격(혹은 로컬)의 파일을 관리하는 API입니다. <code>fabric.api</code>는 Fabric에서 사용하는 환경이나, SSH로 연결한 원격 서버에서 명령어를 실행하는 API입니다.</p>
<h3 id="PROJECT-DIR-BASE-DIR-지정하기"><a href="#PROJECT-DIR-BASE-DIR-지정하기" class="headerlink" title="PROJECT_DIR, BASE_DIR 지정하기"></a>PROJECT_DIR, BASE_DIR 지정하기</h3><p>장고의 <code>settings.py</code>파일에 기본적으로 지정된 <code>BASE_DIR</code>와 같은 장고 프로젝트의 폴더 위치를 지정하는 <code>PROJECT_DIR</code>와 <code>BASE_DIR</code>을 지정해 줍니다.</p>
<p><code>PROJECT_DIR</code>은 <code>settings.py</code>가 있는 폴더의 위치이고, <code>BASE_DIR</code>은 <code>manage.py</code>가 있는 폴더입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">BASE_DIR = os.path.dirname(PROJECT_DIR)</span><br></pre></td></tr></table></figure>

<h3 id="배포용-변수-불러오기"><a href="#배포용-변수-불러오기" class="headerlink" title="배포용 변수 불러오기"></a>배포용 변수 불러오기</h3><p>서버에 배포를 하기 위해 <code>git</code>을 이용합니다. 따라서 소스가 올라가 있는 깃헙(혹은 gitlab, bitbucket 등)의 주소(<code>REPO_URL</code>)가 필요합니다.</p>
<p>그리고 원격으로 SSH접속을 하기 때문에 원격 서버에 접속할 수 있는 SSH용 주소(<code>REMOTE_HOST_SSH</code>), 원격 계정 ID(<code>REMOTE_USER</code>), 원격 계정 비밀번호(<code>REMOTE_PASSWORD</code>)가 필요합니다.</p>
<p>또한, 장고 <code>settings.py</code>의 <code>ALLOWED_HOSTS</code>에 추가할 도메인(<code>REMOTE_HOST</code>)이 필요합니다.</p>
<p>이러한 변수들은 보통 json파일에 저장하고 <code>.gitignore</code>에 이 json파일을 지정해 git에 올라가지 않도록 관리합니다. 이번 가이드에서는 <code>deploy.json</code>이라는 파일에 아래 변수들을 저장하고 관리해 보겠습니다.</p>
<p><code>deploy.json</code>파일을 <code>fabfile.py</code>파일이 있는 곳에 아래 내용을 담고 저장해주세요.</p>
<blockquote>
<p><code>REPO_URL</code>와 <code>PROJECT_NAME</code>을 제외한 설정은 위 Vultr에서 만들어준 대로 진행해주세요. 단, REMOTE_USER는 root이면 안됩니다!</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"REPO_URL"</span>:<span class="string">"https://github.com/Beomi/irkshop.git"</span>,</span><br><span class="line">  <span class="attr">"PROJECT_NAME"</span>:<span class="string">"irkshop"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_HOST_SSH"</span>:<span class="string">"45.77.20.73"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_HOST"</span>:<span class="string">"45.77.20.73"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_USER"</span>:<span class="string">"django"</span>,</span><br><span class="line">  <span class="attr">"REMOTE_PASSWORD"</span>:<span class="string">"django_pwd123"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>만약 SSH 포트가 다르다면 <code>REMOTE_HOST_SSH</code> 뒤 포트를 :으로 붙여주면 됩니다. (ex: 45.77.20.73:22)</p>
</blockquote>
<blockquote>
<p>REMOTE_HOST는 도메인 주소(ex: irkshop.testi.kr)일 수 있습니다. 하지만 이번 배포에서는 도메인을 다루지 않으므로 IP주소로 대신합니다.</p>
</blockquote>
<p>json파일을 만들었다면 이 파일을 이제 <code>fabfile.py</code>에서 불러와 사용해 봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy.json파일을 불러와 envs변수에 저장합니다.</span></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(PROJECT_DIR, <span class="string">"deploy.json"</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    envs = json.loads(f.read())</span><br><span class="line"></span><br><span class="line">REPO_URL = envs[<span class="string">'REPO_URL'</span>]</span><br><span class="line">PROJECT_NAME = envs[<span class="string">'PROJECT_NAME'</span>]</span><br><span class="line">REMOTE_HOST_SSH = envs[<span class="string">'REMOTE_HOST_SSH'</span>]</span><br><span class="line">REMOTE_HOST = envs[<span class="string">'REMOTE_HOST'</span>]</span><br><span class="line">REMOTE_USER = envs[<span class="string">'REMOTE_USER'</span>]</span><br><span class="line">REMOTE_PASSWORD = envs[<span class="string">'REMOTE_PASSWORD'</span>]</span><br><span class="line"><span class="comment"># 아래 부분은 Django의 settings.py에서 지정한 STATIC_ROOT 폴더 이름, STATID_URL, MEDIA_ROOT 폴더 이름을 입력해주시면 됩니다.</span></span><br><span class="line">STATIC_ROOT_NAME = <span class="string">'static_deploy'</span></span><br><span class="line">STATIC_URL_NAME = <span class="string">'static'</span></span><br><span class="line">MEDIA_ROOT = <span class="string">'uploads'</span></span><br></pre></td></tr></table></figure>

<h3 id="Fabric-환경-설정하기"><a href="#Fabric-환경-설정하기" class="headerlink" title="Fabric 환경 설정하기"></a>Fabric 환경 설정하기</h3><p>이제 Fabric이 사용할 <code>env</code>를 설정해 줍시다. 대표적으로 <code>env.user</code>와 <code>env.hosts</code>, <code>env.password</code>가 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(PROJECT_DIR, <span class="string">"deploy.json"</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    envs = json.loads(f.read())</span><br><span class="line"></span><br><span class="line">REPO_URL = envs[<span class="string">'REPO_URL'</span>]</span><br><span class="line">PROJECT_NAME = envs[<span class="string">'PROJECT_NAME'</span>]</span><br><span class="line">REMOTE_HOST_SSH = envs[<span class="string">'REMOTE_HOST_SSH'</span>]</span><br><span class="line">REMOTE_HOST = envs[<span class="string">'REMOTE_HOST'</span>]</span><br><span class="line">REMOTE_USER = envs[<span class="string">'REMOTE_USER'</span>]</span><br><span class="line">REMOTE_PASSWORD = envs[<span class="string">'REMOTE_PASSWORD'</span>]</span><br><span class="line">STATIC_ROOT_NAME = <span class="string">'static_deploy'</span></span><br><span class="line">STATIC_URL_NAME = <span class="string">'static'</span></span><br><span class="line">MEDIA_ROOT = <span class="string">'uploads'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fabric이 사용하는 env에 값들을 저장합니다.</span></span><br><span class="line">env.user = REMOTE_USER</span><br><span class="line">username = env.user</span><br><span class="line">env.hosts = [</span><br><span class="line">    REMOTE_HOST_SSH, <span class="comment"># 리스트로 만들어야 합니다.</span></span><br><span class="line">    ]</span><br><span class="line">env.password = REMOTE_PASSWORD</span><br><span class="line"><span class="comment"># 원격 서버에서 장고 프로젝트가 있는 위치를 정해줍니다.</span></span><br><span class="line">project_folder = <span class="string">'/home/&#123;&#125;/&#123;&#125;'</span>.format(env.user, PROJECT_NAME)</span><br></pre></td></tr></table></figure>

<p>이와 같이 설정시 <code>fab</code>명령어를 실행할 경우에 추가적인 값을 입력할 필요가 없어집니다.</p>
<h3 id="APT-설치-목록-지정하기"><a href="#APT-설치-목록-지정하기" class="headerlink" title="APT 설치 목록 지정하기"></a>APT 설치 목록 지정하기</h3><p>VPS에 따라 설치되어있는 리눅스 패키지가 다릅니다. 이번 가이드에서는 <code>Apache2</code>와 <code>mod-wsgi-py3</code>을 사용하기 때문에 이 패키지와 파이썬 의존 패키지들을 설치해 줘야 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fabric.contrib.files <span class="keyword">import</span> append, exists, sed, put</span><br><span class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> env, local, run, sudo</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">PROJECT_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(PROJECT_DIR, <span class="string">"deploy.json"</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    envs = json.loads(f.read())</span><br><span class="line"></span><br><span class="line">REPO_URL = envs[<span class="string">'REPO_URL'</span>]</span><br><span class="line">PROJECT_NAME = envs[<span class="string">'PROJECT_NAME'</span>]</span><br><span class="line">REMOTE_HOST_SSH = envs[<span class="string">'REMOTE_HOST_SSH'</span>]</span><br><span class="line">REMOTE_HOST = envs[<span class="string">'REMOTE_HOST'</span>]</span><br><span class="line">REMOTE_USER = envs[<span class="string">'REMOTE_USER'</span>]</span><br><span class="line">REMOTE_PASSWORD = envs[<span class="string">'REMOTE_PASSWORD'</span>]</span><br><span class="line">STATIC_ROOT_NAME = <span class="string">'static_deploy'</span></span><br><span class="line">STATIC_URL_NAME = <span class="string">'static'</span></span><br><span class="line">MEDIA_ROOT = <span class="string">'uploads'</span></span><br><span class="line"></span><br><span class="line">env.user = REMOTE_USER</span><br><span class="line">username = env.user</span><br><span class="line">env.hosts = [REMOTE_HOST_SSH,]</span><br><span class="line">env.password = REMOTE_PASSWORD</span><br><span class="line">project_folder = <span class="string">'/home/&#123;&#125;/&#123;&#125;'</span>.format(env.user, PROJECT_NAME)</span><br><span class="line"></span><br><span class="line"><span class="comment"># APT로 설치할 목록을 정해줍니다.</span></span><br><span class="line">apt_requirements = [</span><br><span class="line">    <span class="string">'ufw'</span>, <span class="comment"># 방화벽</span></span><br><span class="line">    <span class="string">'curl'</span>,</span><br><span class="line">    <span class="string">'git'</span>, <span class="comment"># 깃</span></span><br><span class="line">    <span class="string">'python3-dev'</span>, <span class="comment"># Python 의존성</span></span><br><span class="line">    <span class="string">'python3-pip'</span>, <span class="comment"># PIP</span></span><br><span class="line">    <span class="string">'build-essential'</span>, <span class="comment"># C컴파일 패키지</span></span><br><span class="line">    <span class="string">'python3-setuptools'</span>, <span class="comment"># PIP</span></span><br><span class="line">    <span class="string">'apache2'</span>, <span class="comment"># 웹서버 Apache2</span></span><br><span class="line">    <span class="string">'libapache2-mod-wsgi-py3'</span>, <span class="comment"># 웹서버~Python3 연결</span></span><br><span class="line">    <span class="comment"># 'libmysqlclient-dev', # MySql</span></span><br><span class="line">    <span class="string">'libssl-dev'</span>, <span class="comment"># SSL</span></span><br><span class="line">    <span class="string">'libxml2-dev'</span>, <span class="comment"># XML</span></span><br><span class="line">    <span class="string">'libjpeg8-dev'</span>, <span class="comment"># Pillow 의존성 패키지(ImageField)</span></span><br><span class="line">    <span class="string">'zlib1g-dev'</span>, <span class="comment"># Pillow 의존성 패키지</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="Fab-함수-만들기"><a href="#Fab-함수-만들기" class="headerlink" title="Fab 함수 만들기"></a>Fab 함수 만들기</h3><p>Fabric은 fabfile있는 곳에서 <code>fab 함수이름</code>의 명령어로 실행 가능합니다. 단, <code>_</code>로 시작하는 함수는 Fabric이 관리하지 않습니다.</p>
<p>이제 서버에서 실행할 SSH를 캡슐화한다고 보면 됩니다. 크게 <code>setup</code>와 <code>deploy</code>로 나눌 수 있다고 봅니다. Setup은 장고 코드와 무관한 OS의 패키지 관리와 VirtualEnv관리, Deploy는 장고 소스가 변화할 경우 업데이트 되어야 하는 코드입니다.</p>
<p>Setup에는 APT 최신 패키지 설치와 <code>apt_requirements</code>설치, 그리고 <code>virtualenv</code>를 만드는 것까지를 다룹니다.</p>
<p>Deploy에서는 Git에서 최신 소스코드를 가져오고, Git에서 관리되지 않는 환경변수 파일을 서버에 업로드하고, 장고 <code>settings.py</code>파일을 상용 환경으로 바꿔주고, virtualenv로 만든 가상환경에 pip 패키지를 설치하고, StaticFile들을 collect하고, DB를 migrate해주고, Apache2의 VirtualHost에 장고 웹 서비스를 등록하고, 폴더 권한을 잡아주고, 마지막으로 Apache2 웹서버를 재부팅하는 과정까지를 다룹니다.</p>
<blockquote>
<p>여기서부터는 코드가 너무 길어지는 관계로 <code>apt_requirements</code> 포함한 윗부분을 생략합니다. </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 앞부분 생략</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_server</span><span class="params">()</span>:</span></span><br><span class="line">    setup()</span><br><span class="line">    deploy()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">()</span>:</span></span><br><span class="line">    _get_latest_apt() <span class="comment"># APT update/upgrade</span></span><br><span class="line">    _install_apt_requirements(apt_requirements) <span class="comment"># APT install</span></span><br><span class="line">    _make_virtualenv() <span class="comment"># Virtualenv</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deploy</span><span class="params">()</span>:</span></span><br><span class="line">    _get_latest_source() <span class="comment"># Git에서 최신 소스 가져오기</span></span><br><span class="line">    _put_envs() <span class="comment"># 환경변수 json파일 업로드</span></span><br><span class="line">    _update_settings() <span class="comment"># settings.py파일 변경</span></span><br><span class="line">    _update_virtualenv() <span class="comment"># pip 설치</span></span><br><span class="line">    _update_static_files() <span class="comment"># collectstatics</span></span><br><span class="line">    _update_database() <span class="comment"># migrate</span></span><br><span class="line">    _make_virtualhost() <span class="comment"># Apache2 VirtualHost</span></span><br><span class="line">    _grant_apache2() <span class="comment"># chmod</span></span><br><span class="line">    _grant_sqlite3() <span class="comment"># chmod</span></span><br><span class="line">    _restart_apache2() <span class="comment"># 웹서버 재시작</span></span><br></pre></td></tr></table></figure>

<p>이와 같이 함수를 등록해주면 <code>fab new_server</code>, <code>fab setup</code>, <code>fab deploy</code>를 통해 바로바로 배포를 할 수 있습니다.</p>
<p>이제 <code>_</code>로 시작하는, 진짜 Fabric함수들을 만들어 보겠습니다.</p>
<blockquote>
<p>_ 로 시작하는 함수들을 설명할 때는 함수만 각각 설명합니다. 모두 모인 코드는 글 상단의 GIST를 참고해주세요.</p>
</blockquote>
<ul>
<li><code>_get_latest_apt</code>: APT 업데이트 &amp; 업그레이드</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_latest_apt</span><span class="params">()</span>:</span></span><br><span class="line">    update_or_not = input(<span class="string">'would you update?: [y/n]'</span>)</span><br><span class="line">    <span class="keyword">if</span> update_or_not==<span class="string">'y'</span>:</span><br><span class="line">        sudo(<span class="string">'sudo apt-get update &amp;&amp; sudo apt-get -y upgrade'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_install_apt_requirements</code>: apt_requirements에 적은 패키지들을 설치합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_install_apt_requirements</span><span class="params">(apt_requirements)</span>:</span></span><br><span class="line">    reqs = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> req <span class="keyword">in</span> apt_requirements:</span><br><span class="line">        reqs += (<span class="string">' '</span> + req)</span><br><span class="line">    sudo(<span class="string">'sudo apt-get -y install &#123;&#125;'</span>.format(reqs))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_make_virtualenv</code>: 원격 서버에 <code>~/.virtualenvs</code>폴더가 없는 경우 virtualenv와 virtualenvwrapper를 설치하고 <code>.bashrc</code>파일에 virtualenvwrapper를 등록해 줍니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_virtualenv</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exists(<span class="string">'~/.virtualenvs'</span>):</span><br><span class="line">        script = <span class="string">'''"# python virtualenv settings</span></span><br><span class="line"><span class="string">                    export WORKON_HOME=~/.virtualenvs</span></span><br><span class="line"><span class="string">                    export VIRTUALENVWRAPPER_PYTHON="$(command \which python3)"  # location of python3</span></span><br><span class="line"><span class="string">                    source /usr/local/bin/virtualenvwrapper.sh"'''</span></span><br><span class="line">        run(<span class="string">'mkdir ~/.virtualenvs'</span>)</span><br><span class="line">        sudo(<span class="string">'sudo pip3 install virtualenv virtualenvwrapper'</span>)</span><br><span class="line">        run(<span class="string">'echo &#123;&#125; &gt;&gt; ~/.bashrc'</span>.format(script))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_get_latest_source</code>: 만약 <code>.git</code>폴더가 없다면 원격 git repo에서 clone해오고, 있다면 fetch해온 후 최신 커밋으로 reset합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_latest_source</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> exists(project_folder + <span class="string">'/.git'</span>):</span><br><span class="line">        run(<span class="string">'cd %s &amp;&amp; git fetch'</span> % (project_folder,))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        run(<span class="string">'git clone %s %s'</span> % (REPO_URL, project_folder))</span><br><span class="line">    current_commit = local(<span class="string">"git log -n 1 --format=%H"</span>, capture=<span class="literal">True</span>)</span><br><span class="line">    run(<span class="string">'cd %s &amp;&amp; git reset --hard %s'</span> % (project_folder, current_commit))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_put_envs</code>: 로컬의 <code>envs.json</code>이름의 환경변수를 서버에 업로드 합니다.</li>
</ul>
<blockquote>
<p>Apache2는 웹서버가 OS의 환경변수를 사용하지 않기 때문에 json와 같은 파일을 통해 환경변수를 관리해 줘야 합니다. 저는 <code>envs.json</code>이라는 파일을 <code>manage.py</code>파일이 있는 프로젝트 폴더에 만든 후 환경변수를 장고의 <code>settings.py</code>에서 불러와 사용합니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_put_envs</span><span class="params">()</span>:</span></span><br><span class="line">    put(os.path.join(PROJECT_DIR, <span class="string">'envs.json'</span>), <span class="string">'~/&#123;&#125;/envs.json'</span>.format(PROJECT_NAME))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_update_settings</code>: <code>settings.py</code>파일을 바꿔줍니다. DEBUG를 False로 바꾸고, ALLOWED_HOSTS에 호스트 이름을 등록하고, 장고에서 만들어준 키 파일이 아니라 서버에서 랜덤으로 만든 Secret KEY를 사용하게 합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_settings</span><span class="params">()</span>:</span></span><br><span class="line">    settings_path = project_folder + <span class="string">'/&#123;&#125;/settings.py'</span>.format(PROJECT_NAME)</span><br><span class="line">    sed(settings_path, <span class="string">"DEBUG = True"</span>, <span class="string">"DEBUG = False"</span>)</span><br><span class="line">    sed(settings_path,</span><br><span class="line">        <span class="string">'ALLOWED_HOSTS = .+$'</span>,</span><br><span class="line">        <span class="string">'ALLOWED_HOSTS = ["%s"]'</span> % (REMOTE_HOST,)</span><br><span class="line">    )</span><br><span class="line">    secret_key_file = project_folder + <span class="string">'/&#123;&#125;/secret_key.py'</span>.format(PROJECT_NAME)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exists(secret_key_file):</span><br><span class="line">        chars = <span class="string">'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*(-_=+)'</span></span><br><span class="line">        key = <span class="string">''</span>.join(random.SystemRandom().choice(chars) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">50</span>))</span><br><span class="line">        append(secret_key_file, <span class="string">"SECRET_KEY = '%s'"</span> % (key,))</span><br><span class="line">    append(settings_path, <span class="string">'\nfrom .secret_key import SECRET_KEY'</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_update_virtualenv</code>: virtualenv에 <code>requirements.txt</code>파일로 지정된 pip 패키지들을 설치합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_virtualenv</span><span class="params">()</span>:</span></span><br><span class="line">    virtualenv_folder = project_folder + <span class="string">'/../.virtualenvs/&#123;&#125;'</span>.format(PROJECT_NAME)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exists(virtualenv_folder + <span class="string">'/bin/pip'</span>):</span><br><span class="line">        run(<span class="string">'cd /home/%s/.virtualenvs &amp;&amp; virtualenv %s'</span> % (env.user, PROJECT_NAME))</span><br><span class="line">    run(<span class="string">'%s/bin/pip install -r %s/requirements.txt'</span> % (</span><br><span class="line">        virtualenv_folder, project_folder</span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_update_static_files</code>: CollectStatic을 해줍니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_static_files</span><span class="params">()</span>:</span></span><br><span class="line">    virtualenv_folder = project_folder + <span class="string">'/../.virtualenvs/&#123;&#125;'</span>.format(PROJECT_NAME)</span><br><span class="line">    run(<span class="string">'cd %s &amp;&amp; %s/bin/python3 manage.py collectstatic --noinput'</span> % (</span><br><span class="line">        project_folder, virtualenv_folder</span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_update_database</code>: DB migrate를 해줍니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_database</span><span class="params">()</span>:</span></span><br><span class="line">    virtualenv_folder = project_folder + <span class="string">'/../.virtualenvs/&#123;&#125;'</span>.format(PROJECT_NAME)</span><br><span class="line">    run(<span class="string">'cd %s &amp;&amp; %s/bin/python3 manage.py migrate --noinput'</span> % (</span><br><span class="line">        project_folder, virtualenv_folder</span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_make_virtualhost</code>: Apache2가 관리하는 VirtualHost를 만들어줍니다. 80포트로 지정하고 Static파일을 Apache2가 서빙합니다.</li>
</ul>
<blockquote>
<p>만약 SSL을 사용하고 싶으시다면 *:443으로 관리되는 파일을 추가적으로 만드셔야 합니다. 이번 가이드에서는 다루지 않습니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_make_virtualhost</span><span class="params">()</span>:</span></span><br><span class="line">    script = <span class="string">"""'&lt;VirtualHost *:80&gt;</span></span><br><span class="line"><span class="string">    ServerName &#123;servername&#125;</span></span><br><span class="line"><span class="string">    Alias /&#123;static_url&#125; /home/&#123;username&#125;/&#123;project_name&#125;/&#123;static_root&#125;</span></span><br><span class="line"><span class="string">    Alias /&#123;media_url&#125; /home/&#123;username&#125;/&#123;project_name&#125;/&#123;media_url&#125;</span></span><br><span class="line"><span class="string">    &lt;Directory /home/&#123;username&#125;/&#123;project_name&#125;/&#123;media_url&#125;&gt;</span></span><br><span class="line"><span class="string">        Require all granted</span></span><br><span class="line"><span class="string">    &lt;/Directory&gt;</span></span><br><span class="line"><span class="string">    &lt;Directory /home/&#123;username&#125;/&#123;project_name&#125;/&#123;static_root&#125;&gt;</span></span><br><span class="line"><span class="string">        Require all granted</span></span><br><span class="line"><span class="string">    &lt;/Directory&gt;</span></span><br><span class="line"><span class="string">    &lt;Directory /home/&#123;username&#125;/&#123;project_name&#125;/&#123;project_name&#125;&gt;</span></span><br><span class="line"><span class="string">        &lt;Files wsgi.py&gt;</span></span><br><span class="line"><span class="string">            Require all granted</span></span><br><span class="line"><span class="string">        &lt;/Files&gt;</span></span><br><span class="line"><span class="string">    &lt;/Directory&gt;</span></span><br><span class="line"><span class="string">    WSGIDaemonProcess &#123;project_name&#125; python-home=/home/&#123;username&#125;/.virtualenvs/&#123;project_name&#125; python-path=/home/&#123;username&#125;/&#123;project_name&#125;</span></span><br><span class="line"><span class="string">    WSGIProcessGroup &#123;project_name&#125;</span></span><br><span class="line"><span class="string">    WSGIScriptAlias / /home/&#123;username&#125;/&#123;project_name&#125;/&#123;project_name&#125;/wsgi.py</span></span><br><span class="line"><span class="string">    &#123;% raw %&#125;</span></span><br><span class="line"><span class="string">    ErrorLog $&#123;&#123;APACHE_LOG_DIR&#125;&#125;/error.log</span></span><br><span class="line"><span class="string">    CustomLog $&#123;&#123;APACHE_LOG_DIR&#125;&#125;/access.log combined</span></span><br><span class="line"><span class="string">    &#123;% endraw %&#125;</span></span><br><span class="line"><span class="string">    &lt;/VirtualHost&gt;'"""</span>.format(</span><br><span class="line">        static_root=STATIC_ROOT_NAME,</span><br><span class="line">        username=env.user,</span><br><span class="line">        project_name=PROJECT_NAME,</span><br><span class="line">        static_url=STATIC_URL_NAME,</span><br><span class="line">        servername=REMOTE_HOST,</span><br><span class="line">        media_url=MEDIA_ROOT</span><br><span class="line">    )</span><br><span class="line">    sudo(<span class="string">'echo &#123;&#125; &gt; /etc/apache2/sites-available/&#123;&#125;.conf'</span>.format(script, PROJECT_NAME))</span><br><span class="line">    sudo(<span class="string">'a2ensite &#123;&#125;.conf'</span>.format(PROJECT_NAME))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_grant_apache2</code>: 프로젝트 폴더내 파일을 <code>www-data</code>그룹(Apache2)이 관리할 수 있도록 소유권을 변경합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_grant_apache2</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">'sudo chown -R :www-data ~/&#123;&#125;'</span>.format(PROJECT_NAME))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_grant_sqlite3</code>: 만약 Sqlite3을 그대로 이용할 경우 <code>www-data</code>가 쓰기 권한을 가져야 합니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_grant_sqlite3</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">'sudo chmod 775 ~/&#123;&#125;/db.sqlite3'</span>.format(PROJECT_NAME))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_restart_apache2</code>: 모든 설정을 마친 후 Apache2 웹서버를 재실행해 설정을 적용해줍니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_restart_apache2</span><span class="params">()</span>:</span></span><br><span class="line">    sudo(<span class="string">'sudo service apache2 restart'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="배포해보기"><a href="#배포해보기" class="headerlink" title="배포해보기"></a>배포해보기</h2><p>이제 <code>manage.py</code>파일이 있는 곳에서 아래 명령어를 입력해 봅시다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fab new_server</span><br></pre></td></tr></table></figure>

<p>이 명령어를 치면 자동으로 모든 과정이 완료되고 서버가 뜹니다.</p>
<p>만약 파일을 수정하고 커밋했다면, Github Repo에 올린 후 <code>deploy</code> 명령어를 통해 새 코드를 서버에 배포할 수 있습니다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fab deploy</span><br></pre></td></tr></table></figure>

<h2 id="짜잔"><a href="#짜잔" class="headerlink" title="짜잔!"></a>짜잔!</h2><p>프로젝트 하나가 배포가 완료되었습니다! 아무것도 없어보이지만, DB에 자료를 추가하면 <a href="http://irkshop.testi.kr">IRKSHOP 예제</a>처럼 예쁘게 생성됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-03-20%2000.28.56.png" alt="Simple IRKSHOP"></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/19/Introduction-to-Celery/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-03-19-Celery-Getting-Started/celery.jpg" alt="[번역]셀러리 입문하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-03-18T15:00:00.000Z">2017-03-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/">celery</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/celerydocs/">celerydocs</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/celerydocs/translation/">translation</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/19/Introduction-to-Celery/">[번역]셀러리 입문하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>글 작성 시점 최신 버전 <code>v4.0.2</code>의 문서입니다.</p>
</blockquote>
<p>원문: <a href="http://docs.celeryproject.org/en/latest/getting-started/introduction.html">http://docs.celeryproject.org/en/latest/getting-started/introduction.html</a></p>
<h1 id="셀러리-입문하기"><a href="#셀러리-입문하기" class="headerlink" title="셀러리 입문하기"></a>셀러리 입문하기</h1><h2 id="widgets"><a href="#widgets" class="headerlink" title="widgets:"></a>widgets:</h2><ul>
<li><p>태스크 큐란 무엇인가? (What’s a Task Queue?)</p>
</li>
<li><p>뭐가 필요한가요? (What do I need?)</p>
</li>
<li><p>시작하기 (Get Started)</p>
</li>
<li><p>셀러리는.. (Celery is..)</p>
</li>
<li><p>셀러리의 기능들 (Features)</p>
</li>
<li><p>프레임워크와 함께 이용하기 (Framework Integration)</p>
</li>
<li><p>셀러리 설치하기 (Installation)</p>
</li>
</ul>
<h2 id="태스크-큐란-무엇인가"><a href="#태스크-큐란-무엇인가" class="headerlink" title="태스크 큐란 무엇인가?"></a>태스크 큐란 무엇인가?</h2><p>태스크 큐는 스레드간 혹은 기계 간 업무를 분산하는 목적으로 만들어진 메커니즘입니다.</p>
<p>태스크 큐에 들어가는 일거리들은 태스크(Task)라고 불리고 각각 독립된 워커(Worker)프로세스들은 새로운 일거리(Task)가 없는지 지속적으로 태스크 큐를 감시합니다.</p>
<p>셀러리는 메시지(message)를 통해 통신하는데요, 보통 브로커(Broker)가 클라이언트와 워커 사이에서 메시지를 중계해줍니다. 브로커는 클라이언트가 큐에 새로 추가한 태스크를 메시지로 워커에 전달해줍니다.</p>
<p>셀러리 시스템에서는 여러개의 워커와 브로커를 함께 사용할 수 있는데요, 이 덕분에 높은 가용성과 Scaling이 가능합니다.</p>
<p>셀러리는 Python으로 짜여져 있습니다. 하지만 어떤 언어를 통해서도 프로토콜을 통해 셀러리를 사용할 수 있습니다. 예를들어, Node나 PHP를 위한 <a href="https://github.com/mher/node-celery">node-celery</a>나 <a href="https://github.com/gjedeer/celery-php">PHP client</a>도 있답니다.</p>
<p>또, HTTP endpoint를 통해 webhook으로 태스크를 요청하는 것도 가능하답니다.</p>
<h2 id="뭐가-필요한가요"><a href="#뭐가-필요한가요" class="headerlink" title="뭐가 필요한가요?"></a>뭐가 필요한가요?</h2><p>셀러리를 사용하려면 메시지를 주고받아주는 브로커 등이 필요합니다. RabbitMQ나 Redis같은 브로커가 가장 좋은 선택이지만, 개발환경에서는 Sqlite와 같이 수많은 실험적인 대안도 있습니다.</p>
<p>셀러리는 단일 머신, 복수 머신, 혹은 데이터센터간에서도 사용 가능합니다.</p>
<h2 id="시작하기"><a href="#시작하기" class="headerlink" title="시작하기"></a>시작하기</h2><p>만약 여러분이 셀러리를 처음 이용하시거나 3.1버전 같은 이전 버전을 이용했다면, <a href="">셀러리 한 발자국 내밀기</a>나 <a href="">더 알아보기</a> 튜토리얼을 먼저 해보세요.</p>
<blockquote>
<p>버전 확인</p>
</blockquote>
<blockquote>
<p>셀러리 4.0은 Python2.7/3.4/3.5 PyPy5.4/5.5에서 정상적으로 동작합니다.</p>
</blockquote>
<h2 id="셀러리는"><a href="#셀러리는" class="headerlink" title="셀러리는.."></a>셀러리는..</h2><ul>
<li><p>단순해요!</p>
<p>셀러리는 사용하기도 쉽고 관리하기도 쉽습니다. 설정 파일도 필요하지 않아요!</p>
<p>가장 단순한 셀러리 앱은 아래와 같이 만들 수 있어요.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line">app = Celery(<span class="string">'hello'</span>, broker=<span class="string">'amqp://guest@localhost//'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.task</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'hello world'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>높은 가용성</p>
<p>워커와 클라이언트는 연결이 끊어지거나 실패하면 자동으로 다시 연결을 시도합니다. 그리고 몇몇 브로커들은 Primary/Primary나 Primary/Replica 의 복제방식을 통해 고가용성을 제공합니다.</p>
</li>
<li><p>빨라요!</p>
<p>하나의 셀러리 프로세스는 1분에 수십만개의 태스크를 처리할 수 있고, ms초 이하의 RTT(왕복지연시간)로 태스크를 처리 가능하답니다. (RabbitMQ, librabbitmq와 최적화된 설정을 할 경우)</p>
</li>
<li><p>유연해요!</p>
<p>셀러리의 대부분 파트는 그 자체로 이용할 수도 있고 원하는 만큼 확장도 가능합니다. Custom pool implementations, serializers, compression schemes, logging, schedulers, consumers, producers, broker transports을 포함해 더 많이요.</p>
</li>
</ul>
<h2 id="셀러리의-기능들"><a href="#셀러리의-기능들" class="headerlink" title="셀러리의 기능들"></a>셀러리의 기능들</h2><ul>
<li><p>모니터링</p>
<p>모니터링 이벤트 스트림은 각 워커에서 나오고, 클러스터에서 수행하는 작업을 실시간으로 알려줍니다.</p>
<p><a href="http://docs.celeryproject.org/en/latest/userguide/monitoring.html#guide-monitoring">더 알아보기..</a></p>
</li>
<li><p>워크 플로우</p>
<p>간단하거나 복잡한 워크플로우를 “캔버스”라는 도구를 통해 그룹핑, 체이닝, 청킹등을 할 수 있습니다.</p>
<p><a href="http://docs.celeryproject.org/en/latest/userguide/canvas.html#guide-canvas">더 알아보기..</a></p>
</li>
<li><p>시간 / 비율 제한</p>
<p>태스크가 시간당 얼마나 실행 될지 제어할 수 있고, 한 태스크가 얼마나 오랫동안 실행될지 허용할 수 있습니다. 각각의 워커마다 다르게 설정하거나 각각의 태스크마다도 다르게 설정할 수 있답니다.</p>
<p><a href="http://docs.celeryproject.org/en/latest/userguide/workers.html#worker-time-limits">더 알아보기..</a></p>
</li>
<li><p>스케쥴링</p>
<p>어떤 태스크를 정해진 시간에 실행할 수 있습니다. 또, 정해진 주기로 태스크를 실행 할 수도 있습니다. Crontab에서 사용하는 방식(분/시간/요일등등)을 이용할 수도 있습니다.</p>
<p><a href="http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html#guide-beat">더 알아보기..</a></p>
</li>
<li><p>사용자 컴포넌트</p>
<p>각각의 워커 컴포넌트들을 커스터마이징해 사용할 수 있습니다. 그리고 추가적인 컴포넌트도 커스터마이징해 사용할 수 있습니다. 워커는 내부 구조를 세밀하게 제어할수있는 종속성 그래프인 “bootsteps”를 사용하여 빌드됩니다.</p>
</li>
</ul>
<h2 id="프레임워크와-함께-이용하기"><a href="#프레임워크와-함께-이용하기" class="headerlink" title="프레임워크와 함께 이용하기"></a>프레임워크와 함께 이용하기</h2><p>셀러리는 웹 프레임 워크와 쉽게 함께 사용할 수 있고, 일부는 합쳐진 패키지도 있습니다.</p>
<ul>
<li>Pyramid: <a href="https://pypi.python.org/pypi/pyramid_celery/">pyramid_celery</a></li>
<li>Pylons: <a href="https://pypi.python.org/pypi/celery-pylons/">celery-pylons</a></li>
<li>Flask: 필요없음</li>
<li>Web2Py: <a href="https://pypi.python.org/pypi/web2py-celery/">web2py-celery</a></li>
<li>Tornado: <a href="https://pypi.python.org/pypi/tornado-celery/">tornado-celery</a></li>
</ul>
<p>Django의 경우에는 <a href="http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html#django-first-steps">장고와 함께하는 셀러리 첫걸음</a>을 참고하세요.</p>
<p>통합 패키지가 굳이 필요하지는 않지만 개발을 더 쉽게 해주고 DB 커넥션 등에서 중요한 hook를 추가하기도 하기때문에 이용하는 편이 낫습니다.</p>
<h2 id="설치하기"><a href="#설치하기" class="headerlink" title="설치하기"></a>설치하기</h2><p>셀러리는 PyPI를 통해 쉽게 설치할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U pip</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/19/Celery-Getting-Started/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-03-19-Celery-Getting-Started/celery.jpg" alt="[번역]셀러리: 시작하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-03-18T15:00:00.000Z">2017-03-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/">celery</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/celerydocs/">celerydocs</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/celery/celerydocs/translation/">translation</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/19/Celery-Getting-Started/">[번역]셀러리: 시작하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>글 작성 시점 최신 버전 <code>v4.0.2</code>의 문서입니다.</p>
</blockquote>
<p>원문: <a href="http://docs.celeryproject.org/en/latest/getting-started/index.html">http://docs.celeryproject.org/en/latest/getting-started/index.html</a></p>
<h1 id="셀러리-시작하기"><a href="#셀러리-시작하기" class="headerlink" title="셀러리: 시작하기"></a>셀러리: 시작하기</h1><p>출시버전: v4.0.2</p>
<p>출시일: 2017. 03. 15.</p>
<p>번역일: 2017. 03. 19. ~</p>
<h2 id="셀러리-입문하기"><a href="#셀러리-입문하기" class="headerlink" title="셀러리 입문하기"></a><a href="/2017/03/19/Introduction-to-Celery/">셀러리 입문하기</a></h2><ul>
<li><p>태스크 큐란 무엇인가? (What’s a Task Queue?)</p>
</li>
<li><p>뭐가 필요한가요? (What do I need?)</p>
</li>
<li><p>시작하기 (Get Started)</p>
</li>
<li><p>셀러리는.. (Celery is..)</p>
</li>
<li><p>셀러리의 기능들 (Features)</p>
</li>
<li><p>프레임워크와 함께 이용하기 (Framework Integration)</p>
</li>
<li><p>빠르게 찾아보기 (Quick Jump)</p>
</li>
<li><p>셀러리 설치하기 (Installation)</p>
</li>
</ul>
<h2 id="브로커-Brokers"><a href="#브로커-Brokers" class="headerlink" title="브로커 (Brokers)"></a>브로커 (Brokers)</h2><ul>
<li><p>브로커 가이드 (Broker Instructions)</p>
<ul>
<li>RabbitMQ 사용하기 (Using RabbitMQ)</li>
<li>Redis 사용하기 (Using Redis)</li>
<li>Amazon SQS 사용하기 (Using Amazon SQS)</li>
</ul>
</li>
<li><p>브로커간 기능 (Broker Overview)</p>
</li>
</ul>
<h2 id="셀러리-한-발자국-내밀기-First-Steps-with-Celery"><a href="#셀러리-한-발자국-내밀기-First-Steps-with-Celery" class="headerlink" title="셀러리 한 발자국 내밀기 (First Steps with Celery)"></a>셀러리 한 발자국 내밀기 (First Steps with Celery)</h2><ul>
<li><p>브로커 선택하기 (Choosing a Broker)</p>
</li>
<li><p>셀러리 설치하기 (Installing Celery)</p>
</li>
<li><p>앱 (Application)</p>
</li>
<li><p>셀러리 워커 서버 띄우기 (Running the Celery worker server)</p>
</li>
<li><p>태스크 호출하기 (Calling the task)</p>
</li>
<li><p>결과 유지하기 (Keeping Results)</p>
</li>
<li><p>설정하기 (Configuration)</p>
</li>
<li><p>더 나아가기 (Where to go from here)</p>
</li>
<li><p>문제 해결하기 (Troubleshooting)</p>
</li>
</ul>
<h2 id="더-알아보기-Next-Steps"><a href="#더-알아보기-Next-Steps" class="headerlink" title="더 알아보기 (Next Steps)"></a>더 알아보기 (Next Steps)</h2><ul>
<li><p>셀러리를 기존 앱에서 사용하기 (Using Celery in your Application)</p>
</li>
<li><p>태스크 호출하기 (Calling Tasks)</p>
</li>
<li><p>Canvas: 워크플로 디자인하기 (Canvas: Designing Work-flows)</p>
</li>
<li><p>라우팅 (Routing)</p>
</li>
<li><p>원격 제어 (Remote Control)</p>
</li>
<li><p>타임존 (Timezone)</p>
</li>
<li><p>최적화 (Optimization)</p>
</li>
<li><p>더, 더, 더. (What to do now?)</p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-02-27-HowToMakeWebCrawler-Save-with-Django/python+django.jpg" alt="나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-02-28T15:00:00.000Z">2017-03-01</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/">나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>(@2017.03.18) 본 블로그 테마가 업데이트되면서 구 블로그의 URL은 <a href="https://beomi.github.io/beomi.github.io_old/로">https://beomi.github.io/beomi.github.io_old/로</a> 변경되었습니다. 예제 코드에서는 변경을 완료하였지만 캡쳐 화면은 변경하지 않았으니 유의 바랍니다.</p>
</blockquote>
<p>이전게시글: <a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">나만의 웹 크롤러 만들기(3): Selenium으로 무적 크롤러 만들기</a></p>
<p>Python을 이용해 <code>requests</code>와 <code>selenium</code>을 이용해 웹 사이트에서 데이터를 크롤링해 보았습니다.</p>
<p>하지만 이러한 데이터를 체계적으로 관리하려면 DB가 필요하고, 이러한 DB를 만들고 관리하는 방법이 여러가지가 있지만 이번 가이드에서는 Python 웹 프레임워크인 <code>django</code>의 Database ORM을 이용해 DB를 만들고 데이터를 저장해 보려 합니다.</p>
<p>이번 가이드에서는 1회차 가이드였던 이 블로그를 크롤링해서 나온 결과물을 Django ORM으로 Sqlite DB에 저장해보는 것까지를 다룹니다.</p>
<blockquote>
<p>이번 가이드는 기본적으로 Django의 <code>Model</code>에 대해 이해하고 있는 분들에게 추천합니다.</p>
</blockquote>
<blockquote>
<p>만약 django가 처음이시라면 <a href="https://djangogirlsseoul.gitbooks.io/django-tube/content/">DjangoGirls Tutorial: DjangoTube</a>를 따라해보시면 기본적인 이해에 도움이 되시리라 생각합니다. 30분 내외로 따라가실 수 있습니다.</p>
</blockquote>
<h1 id="Django-프로젝트-만들기"><a href="#Django-프로젝트-만들기" class="headerlink" title="Django 프로젝트 만들기"></a>Django 프로젝트 만들기</h1><h2 id="widgets"><a href="#widgets" class="headerlink" title="widgets:"></a>widgets:</h2><p>우선 크롤링 한 데이터를 저장할 Django 프로젝트와 앱을 만들고, Model을 통해 DB를 만들어야 합니다.</p>
<h2 id="Django-설치하기"><a href="#Django-설치하기" class="headerlink" title="Django 설치하기"></a>Django 설치하기</h2><p>Django는 pip로 간편하게 설치할 수 있습니다.</p>
<blockquote>
<p>가상환경을 이용해 설치하는 것을 추천합니다. 가상환경은 python3.4이후부터는 <code>python3 -m venv 가상환경이름</code>으로 만드실 수 있습니다.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.14.57.png" alt="django install success"></p>
<blockquote>
<p>글 작성 시점인 2017.02.28 기준 1.10.5 버전이 최신버전입니다.</p>
</blockquote>
<h2 id="Django-Start-Project-프로젝트-만들기"><a href="#Django-Start-Project-프로젝트-만들기" class="headerlink" title="Django Start Project | 프로젝트 만들기"></a>Django Start Project | 프로젝트 만들기</h2><p>django가 성공적으로 설치되면 <code>django-admin</code>이라는 명령어로 장고 프로젝트를 생성할 수 있습니다.</p>
<p>이번 가이드에서는 <code>websaver</code>라는 이름의 프로젝트를 만들어보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject websaver</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.15.47.png" alt="startproject websaver"></p>
<blockquote>
<p>성공적으로 생길 경우 어떠한 반응도 나타나지 않습니다.</p>
</blockquote>
<p>위 명령어를 치면 명령어를 친 위치에 <code>websaver</code>라는 폴더가 생기고, 그 안의 구조는 아래와 같습니다.</p>
<blockquote>
<p><code>cd websaver</code>로 <code>websaver</code>폴더 안으로 진입한 상태입니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.18.06.png" alt="tree websaver"></p>
<blockquote>
<p>tree 명령어는 mac에서 <code>brew install tree</code>로 설치한 명령어입니다. 기본적으로는 깔려있지 않습니다.</p>
</blockquote>
<p>이와 같이 <code>manage.py</code>파일과 프로젝트 이름인 <code>websaver</code>라는 이름의 폴더가 함께 생성됩니다.</p>
<h2 id="Django-Start-App-장고-앱-만들기"><a href="#Django-Start-App-장고-앱-만들기" class="headerlink" title="Django Start App | 장고 앱 만들기"></a>Django Start App | 장고 앱 만들기</h2><p>Django는 프로젝트와 그 안의 <code>앱</code>으로 관리됩니다. 이 <code>앱</code>은 하나의 기능을 담당하는 단위로 보시면 됩니다.</p>
<p>앱은 <code>manage.py</code>파일을 통해 <code>startapp</code>이라는 명령어로 생성 가능합니다. <code>parsed_data</code>라는 이름의 앱을 만들어보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp parsed_data</span><br></pre></td></tr></table></figure>

<blockquote>
<p>manage.py 파일이 있는 곳에서 실행합니다. django가 설치된 가상환경에 진입해 있는지 꼭 확인하세요!</p>
</blockquote>
<p>이제 아래와 같은 구조로 앱이 생겼을 것인데, 이 앱을 Django가 관리하도록 <code>websaver</code>폴더 안의 <code>settings.py</code>파일의 <code>INSTALLED_APPS</code>에 추가해줘야 합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.32.06.png" alt="startapp parsed_data"></p>
<blockquote>
<p>유의: .pyc파일은 python실행시 생기는 캐싱 파일입니다. 없으셔도 전혀 문제는 발생하지 않습니다.</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># websaver/settings.py</span></span><br><span class="line">...</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'parsed_data'</span>, <span class="comment"># 앱을 추가해 줍시다.</span></span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Django-First-Migration-첫-마이그레이션"><a href="#Django-First-Migration-첫-마이그레이션" class="headerlink" title="Django First Migration | 첫 마이그레이션"></a>Django First Migration | 첫 마이그레이션</h2><p>​<br>장고는 <code>python manage.py migrate</code>이라는 명령어로 DB를 migrate합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>위 명령어를 입력하면 아래와 같이 Django에서 사용하는 기본적인 DB가 생성됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.37.23.png" alt="First migrate"></p>
<h2 id="parsed-data-App-Model-parsed-data-앱-모델-만들기"><a href="#parsed-data-App-Model-parsed-data-앱-모델-만들기" class="headerlink" title="parsed_data App Model | parsed_data 앱 모델 만들기"></a>parsed_data App Model | parsed_data 앱 모델 만들기</h2><p>이제 DB구조를 관리해주는 <code>Model</code>을 만들어 줘야 합니다.</p>
<p>Django에서 모델은 앱 단위로 만들어지고 구성됩니다. 따라서 앞서 만들어준 <code>parsed_data</code>앱 안의 <code>models.py</code>파일을 수정해줘야 합니다.</p>
<p>이 모델 파일은 크롤링해온 데이터를 필드별로 저장하는 것이 목적입니다. 따라서 크롤링한 데이터를 파이썬이 관리할 수 있는 객체로 만들어두는 것이 중요합니다.</p>
<p>이번 가이드에서는 <a href="https://beomi.github.io/beomi.github.io_old/python/2017/01/19/HowToMakeWebCrawler.html">나만의 웹 크롤러 만들기 With Requests/BeautifulSoup</a>에서 만든 <code>parser.py</code>파일을 수정해 게시글의 title와 link를 DB에 저장해보겠습니다.</p>
<p>따라서 이번 앱의 모델에서는 title와 link라는 column을 가진 <code>BlogData</code>라는 이름의 Table을 DB에 만들면 됩니다.</p>
<blockquote>
<p>django models의 class는 DB의 Table이 됩니다.</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogData</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    link = models.URLField()</span><br></pre></td></tr></table></figure>

<p>이와 같이 만들어주면 <code>title</code>은 200글자 제한의 CharField로, <code>link</code>는 URLField로 지정됩니다.</p>
<h2 id="parsed-data-App-Makemigrations-amp-Migrate-앱-DB-반영하기"><a href="#parsed-data-App-Makemigrations-amp-Migrate-앱-DB-반영하기" class="headerlink" title="parsed_data App Makemigrations &amp; Migrate | 앱 DB 반영하기"></a>parsed_data App Makemigrations &amp; Migrate | 앱 DB 반영하기</h2><p>이제 해야 할 일은 Django가 모델을 관리하도록 하려면 <code>makemigrations</code>를 통해 DB의 변경 정보를 정리하고, <code>migrate</code>를 통해 실제 DB에 반영하는 과정을 진행해야 합니다.</p>
<blockquote>
<p>django가 설치된 가상환경에서 실행하도록 합시다. 명령어의 실행 위치는 <code>manage.py</code>파일이 있는 곳입니다.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations parsed_data</span><br><span class="line">python manage.py migrate parsed_data</span><br></pre></td></tr></table></figure>

<p>각 명령어 입력시 아래와 같이 결과가 나타난다면 성공적으로 DB에 반영된 것입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.58.01.png" alt="parsed_data app migration"></p>
<h1 id="크롤링-함수-만들기"><a href="#크롤링-함수-만들기" class="headerlink" title="크롤링 함수 만들기"></a>크롤링 함수 만들기</h1><h2 id="widgets-1"><a href="#widgets-1" class="headerlink" title="widgets:"></a>widgets:</h2><p><a href="https://beomi.github.io/beomi.github.io_old/python/2017/01/19/HowToMakeWebCrawler.html">나만의 웹 크롤러 만들기 With Requests/BeautifulSoup</a>에서 만든 <code>parser.py</code>파일을 수정해보겠습니다.</p>
<p>이번 파일은 <code>manage.py</code>가 있는 위치에 <code>parser.py</code>라는 이름으로 저장해보겠습니다.</p>
<blockquote>
<p>만약 <code>requests</code>와 <code>bs4</code>가 설치되어있지 않다면 pip로 설치해주세요!</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># python파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">my_titles = soup.select(</span><br><span class="line">    <span class="string">'h3 &gt; a'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">    data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'result.json'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    json.dump(data, json_file)</span><br></pre></td></tr></table></figure>

<p>이전의 <code>parser.py</code>파일은 위와 같습니다. 이제 이 파일을 <code>parse_blog</code>라는 함수로 만들고, {‘블로그 글 타이틀’: ‘블로그 글 링크’}로 이루어진 딕셔너리를 반환하도록 만들어 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>이제 <code>parse_blog</code>라는 함수를 다른 파일에서 import해 사용할 수 있습니다.</p>
<p>또한, 현재 프로젝트 폴더의 구조는 아래와 같습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.05.30.png" alt="project folder tree"></p>
<p>하지만 현재 <code>parse_blog</code>함수는 Django에 저장하는 기능을 갖고 있지 않습니다. 따라서 약간 더 추가를 해줘야 합니다.</p>
<h2 id="Django-환경-불러오기"><a href="#Django-환경-불러오기" class="headerlink" title="Django 환경 불러오기"></a>Django 환경 불러오기</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment"># 아래 4줄을 추가해 줍니다.</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># Python이 실행될 때 DJANGO_SETTINGS_MODULE이라는 환경 변수에 현재 프로젝트의 settings.py파일 경로를 등록합니다.</span></span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="comment"># 이제 장고를 가져와 장고 프로젝트를 사용할 수 있도록 환경을 만듭니다.</span></span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>위 코드에서 아래 4줄을 추가해 줄 경우, 이 파일을 단독으로 실행하더라도 마치 <code>manage.py</code>을 통해 django를 구동한 것과 같이 django환경을 사용할 수 있게 됩니다.</p>
<h2 id="Django-ORM으로-데이터-저장하기"><a href="#Django-ORM으로-데이터-저장하기" class="headerlink" title="Django ORM으로 데이터 저장하기"></a>Django ORM으로 데이터 저장하기</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>python manage.py shell</code>을 실행하는 것과 비슷한 방법입니다.</p>
</blockquote>
<p>이제 models에서 우리가 만든 <code>BlogData</code>를 import해 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br><span class="line"><span class="comment"># BlogData를 import해옵니다</span></span><br><span class="line"><span class="keyword">from</span> parsed_data.models <span class="keyword">import</span> BlogData</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이 명령어는 이 파일이 import가 아닌 python에서 직접 실행할 경우에만 아래 코드가 동작하도록 합니다.</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    blog_data_dict = parse_blog()</span><br><span class="line">    <span class="keyword">for</span> t, l <span class="keyword">in</span> blog_data_dict.items():</span><br><span class="line">        BlogData(title=t, link=l).save()</span><br></pre></td></tr></table></figure>

<p>위와 같이 <code>parser.py</code>를 수정한 후 터미널에서 <code>parser.py</code>파일을 실행해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python parser.py</span><br></pre></td></tr></table></figure>

<p>아무런 에러가 나지 않는다면 성공적으로 저장된 것입니다.</p>
<h2 id="저장된-데이터-Django-Admin에서-확인하기"><a href="#저장된-데이터-Django-Admin에서-확인하기" class="headerlink" title="저장된 데이터 Django Admin에서 확인하기"></a>저장된 데이터 Django Admin에서 확인하기</h2><h3 id="SuperUser-관리자계정-만들기"><a href="#SuperUser-관리자계정-만들기" class="headerlink" title="SuperUser | 관리자계정 만들기"></a>SuperUser | 관리자계정 만들기</h3><p>Django는 Django Admin이라는 강력한 기능을 제공합니다.</p>
<p>우선 Admin 계정을 만들어야 합니다. <code>createsuperuser</code> 명령어로 만들 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.18.49.png" alt="createsuperuser"></p>
<p>기본적으로 유저이름, 이메일, 비밀번호를 받습니다.</p>
<blockquote>
<p>이메일은 입력하지 않아도 됩니다.</p>
</blockquote>
<h3 id="앱에-Admin-등록하기"><a href="#앱에-Admin-등록하기" class="headerlink" title="앱에 Admin 등록하기"></a>앱에 Admin 등록하기</h3><p>Django가 어떤 앱을 admin에서 관리하도록 하려면 앱 폴더(<code>parsed_data</code>) 안의 <code>admin.py</code>파일을 수정해줘야 합니다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="comment"># models에서 BlogData를 import 해옵니다.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> BlogData</span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래의 코드를 입력하면 BlogData를 admin 페이지에서 관리할 수 있습니다.</span></span><br><span class="line">admin.site.register(BlogData)</span><br></pre></td></tr></table></figure>

<h3 id="Django-Runserver-장고-서버-실행하기"><a href="#Django-Runserver-장고-서버-실행하기" class="headerlink" title="Django Runserver | 장고 서버 실행하기"></a>Django Runserver | 장고 서버 실행하기</h3><p>이제 <code>manage.py</code>가 있는 위치에서 <code>runserver</code>명령어로 장고 개발 서버를 실행해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>아래와 같이 나타난다면 성공적으로 서버가 실행된 것입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.26.07.png" alt="django runserver"></p>
<p>이제 <a href="http://localhost:8000/admin/">http://localhost:8000/admin/</a>로 들어가 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.27.23.png" alt="Django admin login page"></p>
<p>아까 <code>createsuperuser</code>로 만든 계정으로 로그인 해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.28.09.png" alt="django admin page"></p>
<p>우리가 만든 <code>parsed_data</code>앱 안에 <code>BlogData</code>라는 항목이 나와있는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.28.54.png" alt="blogdata admin list"></p>
<p><code>BlogData object</code>라는 이름으로 데이터들이 들어와 있는 것을 확인할 수 있습니다. 하나를 클릭해 들어가 보면 아래와 같이 title와 link가 성공적으로 들어와 있는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.29.43.png" alt="blogdata specific data"></p>
<h1 id="약간-더-나아가기"><a href="#약간-더-나아가기" class="headerlink" title="약간 더 나아가기"></a>약간 더 나아가기</h1><h2 id="widgets-2"><a href="#widgets-2" class="headerlink" title="widgets:"></a>widgets:</h2><p>위에서 Admin페이지에 들어갈 때 모든 데이터들의 이름이 <code>BlogData object</code>로 나와있는 것을 볼 수 있습니다.</p>
<p>우리가 만들어 준 <code>parsed_data/models.py</code>파일의 <code>BlogData</code> Class를 살펴보면 <code>models.Model</code>클래스를 상속받아 만들었고, 이 클래스는 기본적으로 <code>ClassName + object</code>라는 값을 반환하는 <code>__str__</code>함수를 내장하고 있습니다.</p>
<p>따라서 <code>models.Model</code>을 상속받은 <code>BlogData</code>의 <code>__str__</code>함수에서는 <code>BlogData object</code>라는 값을 반환합니다. 이 <code>__str__</code>함수를 오버라이딩해 사용하면 Admin에서 데이터의 이름을 좀 더 직관적으로 알 수 있습니다.</p>
<h2 id="str-함수-오버라이딩하기"><a href="#str-함수-오버라이딩하기" class="headerlink" title="str 함수 오버라이딩하기"></a><strong>str</strong> 함수 오버라이딩하기</h2><p><code>parsed_data</code>앱 폴더 안의 <code>models.py</code>파일을 아래와 같이 수정해 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogData</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    link = models.URLField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> self.title</span><br></pre></td></tr></table></figure>

<p>위 코드는 BlogData 데이터 객체의 <code>title</code> 값을 반환합니다.</p>
<p>이제 장고 서버를 다시 켜주고 <a href="http://localhost:8000/admin/parsed_data/blogdata/">BlogData admin page</a>로 들어가면 타이틀 이름으로 된 데이터들을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.38.11.png" alt="title list admin page"></p>
<blockquote>
<p>현재 <code>models.py</code>파일을 수정했지만 DB에 반영되는 사항이 아니기 때문에 <code>makemigrations</code>나 <code>migrate</code>를 해줄 필요가 없습니다.</p>
</blockquote>
<h1 id="다음-가이드에서는"><a href="#다음-가이드에서는" class="headerlink" title="다음 가이드에서는.."></a>다음 가이드에서는..</h1><h2 id="widgets-3"><a href="#widgets-3" class="headerlink" title="widgets:"></a>widgets:</h2><p>다음 가이드는 <strong>주기적</strong>으로 데이터를 크롤링 해, <strong>새로운</strong> 데이터가 생기는 경우 텔레그램 봇으로 메시지 알림을 보내주는 과정을 다룰 예정입니다.</p>
<p>다음 가이드: <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a></p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/categories/python/">이전</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/categories/python/page/3/">다음</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/python/">1</a></li>
            
            <li><a class="pagination-link is-current" href="/categories/python/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/categories/python/page/3/">3</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/profile_beomi.jpg" alt="Junbum Lee">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Junbum Lee
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Beomi&#39;s tech blog
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Seoul, KR</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/beomi">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                카테고리
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/DataCollection/">
            <span class="level-start">
                <span class="level-item">DataCollection</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DataCollection/Twitter/">
            <span class="level-start">
                <span class="level-item">Twitter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/">
            <span class="level-start">
                <span class="level-item">DevEnv</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DevEnv/DataScience/">
            <span class="level-start">
                <span class="level-item">DataScience</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/DeepLearning/">
            <span class="level-start">
                <span class="level-item">DeepLearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Git/">
            <span class="level-start">
                <span class="level-item">Git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Ubuntu/">
            <span class="level-start">
                <span class="level-item">Ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Django/">
            <span class="level-start">
                <span class="level-item">Django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Django/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/">
            <span class="level-start">
                <span class="level-item">DjangoTDDStudy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/MacOS/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/NLP/">
            <span class="level-start">
                <span class="level-item">NLP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/NLP/LanguageModel/">
            <span class="level-start">
                <span class="level-item">LanguageModel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/NLP/Unsupervised/">
            <span class="level-start">
                <span class="level-item">Unsupervised</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Postmortem/">
            <span class="level-start">
                <span class="level-item">Postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Python/Celery/">
            <span class="level-start">
                <span class="level-item">Celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/Fabric/">
            <span class="level-start">
                <span class="level-item">Fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Tech/">
            <span class="level-start">
                <span class="level-item">Tech</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Translation/">
            <span class="level-start">
                <span class="level-item">Translation</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/aws/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/azure/">
            <span class="level-start">
                <span class="level-item">azure</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/blog/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/django/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/django/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/flask/sqlalchemy/">
            <span class="level-start">
                <span class="level-item">sqlalchemy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/javascript/webpack/">
            <span class="level-start">
                <span class="level-item">webpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/machinelearning/">
            <span class="level-start">
                <span class="level-item">machinelearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/machinelearning/seminar/">
            <span class="level-start">
                <span class="level-item">seminar</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/macos/">
            <span class="level-start">
                <span class="level-item">macos</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/macos/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/nlp/">
            <span class="level-start">
                <span class="level-item">nlp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/nlp/languagemodel/">
            <span class="level-start">
                <span class="level-item">languagemodel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/postmortem/">
            <span class="level-start">
                <span class="level-item">postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">25</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/python/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/celery/">
            <span class="level-start">
                <span class="level-item">celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/dataanalysis/">
            <span class="level-start">
                <span class="level-item">dataanalysis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/pyspark/">
            <span class="level-start">
                <span class="level-item">pyspark</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/react/">
            <span class="level-start">
                <span class="level-item">react</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/react/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/tips/githubpages/">
            <span class="level-start">
                <span class="level-item">githubpages</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ubuntu/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/vlang/">
            <span class="level-start">
                <span class="level-item">vlang</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Beomi&#39;s Tech Blog
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Junbum Lee&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("ko");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://beomi.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>








<script src="/js/main.js" defer></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
</body>
</html>