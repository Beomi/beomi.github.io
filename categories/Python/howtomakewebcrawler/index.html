<!DOCTYPE html>
<html  lang="ko">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>카테고리: howtomakewebcrawler - Beomi&#39;s Tech blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89162642-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-89162642-1');
</script>

    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="is-3-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Beomi&#39;s Tech Blog
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="https://junbuml.ee">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">카테고리</a></li>
            
            <li><a href="/categories/python/">python</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">howtomakewebcrawler</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2019/07/08/Papago-API-with-Python/" class="image is-7by1">
            <img class="thumbnail" src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-07-08-064243.png" alt="pypapago 개발기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-07-07T15:00:00.000Z">2019-07-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/07/08/Papago-API-with-Python/">pypapago 개발기</a>
            
        </h1>
        <div class="content">
            <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>아래 내용을 통해 개발한 <code>pypapago</code> 는 현재 pypi에 올라가 있어 아래 명령어로 설치해 바로 사용할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U pypapago</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2019.07.09일자 기준 최신버전은 <code>0.1.1.1</code> 입니다.</p>
</blockquote>
<p>Github Repo: <a href="https://github.com/Beomi/pypapago">https://github.com/Beomi/pypapago</a></p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2019/07/08/Papago-API-with-Python/#more">자세히 보기</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/09/28/HowToMakeWebCrawler-Headless-Chrome/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/Crawling-with-HeadlessChrome.png" alt="나만의 웹 크롤러 만들기(7): 창없는 크롬으로 크롤링하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-09-27T15:00:00.000Z">2017-09-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/09/28/HowToMakeWebCrawler-Headless-Chrome/">나만의 웹 크롤러 만들기(7): 창없는 크롬으로 크롤링하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이번 가이드는 가이드 3편(<a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">Selenium으로 무적 크롤러 만들기</a>)의 확장편입니다. 아직 <code>selenium</code>을 이용해보지 않은 분이라면 먼저 저 가이드를 보고 오시는걸 추천합니다.</p>
</blockquote>
<h2 id="HeadLess-Chrome-머리없는-크롬"><a href="#HeadLess-Chrome-머리없는-크롬" class="headerlink" title="HeadLess Chrome? 머리없는 크롬?"></a>HeadLess Chrome? 머리없는 크롬?</h2><h3 id="HeadLess란"><a href="#HeadLess란" class="headerlink" title="HeadLess란?"></a>HeadLess란?</h3><p>Headless라는 용어는 ‘창이 없는’과 같다고 이해하시면 됩니다. 여러분이 브라우저(크롬 등)을 이용해 인터넷을 브라우징 할 때 기본적으로 창이 뜨고 HTML파일을 불러오고, CSS파일을 불러와 어떤 내용을 화면에 그러야 할지 계산을 하는 작업을 브라우저가 자동으로 진행해줍니다. </p>
<p>하지만 이와같은 방식을 사용할 경우 사용하는 운영체제에 따라 크롬이 실행이 될 수도, 실행이 되지 않을 수도 있습니다. 예를들어 우분투 서버와 같은 OS에서는 ‘화면’ 자체가 존재하지 않기 때문에 일반적인 방식으로는 크롬을 사용할 수 없습니다. 이를 해결해 주는 방식이 바로 Headless 모드입니다. 브라우저 창을 실제로 운영체제의 ‘창’으로 띄우지 않고 대신 화면을 그려주는 작업(렌더링)을 가상으로 진행해주는 방법으로 실제 브라우저와 동일하게 동작하지만 창은 뜨지 않는 방식으로 동작할 수 있습니다.</p>
<h3 id="그러면-왜-크롬"><a href="#그러면-왜-크롬" class="headerlink" title="그러면 왜 크롬?"></a>그러면 왜 크롬?</h3><p>일전 가이드에서 <code>PhantomJS</code>(팬텀)라는 브라우저를 이용하는 방법에 대해 다룬적이 있습니다. 팬텀은 브라우저와 유사하게 동작하고 Javascript를 동작시켜주지만 성능상의 문제점과 크롬과 완전히 동일하게 동작하지는 않는다는 문제점이 있습니다. 우리가 크롤러를 만드는 상황이 대부분 크롬에서 진행하고, 크롬의 결과물 그대로 가져오기 위해서는 브라우저도 크롬을 사용하는 것이 좋습니다.</p>
<blockquote>
<p>하지만 여전히 팬텀이 가지는 장점이 있습니다. WebDriver Binary만으로 추가적인 설치 없이 환경을 만들 수 있다는 장점이 있습니다.</p>
</blockquote>
<p>윈도우 기준 크롬 59, 맥/리눅스 기준 크롬 60버전부터 크롬에 <code>Headless Mode</code>가 정식으로 추가되어서 만약 여러분의 브라우저가 최신이라면 크롬의 Headless모드를 쉽게 이용할 수 있습니다.</p>
<h2 id="크롬-버전-확인하기"><a href="#크롬-버전-확인하기" class="headerlink" title="크롬 버전 확인하기"></a>크롬 버전 확인하기</h2><p>크롬 버전 확인은 크롬 브라우저에서 <a href="chrome://version/">chrome://version/</a>로 들어가 확인할 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/ScreenShot2017-08-0112.47.57.png" alt=""></p>
<p>이와 같이 크롬 버전이 60버전 이상인 크롬에서는 ‘Headless’모드를 사용할 수 있습니다.</p>
<h2 id="크롬드라이버-chromedriver-업데이트"><a href="#크롬드라이버-chromedriver-업데이트" class="headerlink" title="크롬드라이버(chromedriver) 업데이트"></a>크롬드라이버(chromedriver) 업데이트</h2><p>크롬 버전이 올라감에 따라 크롬을 조작하도록 도와주는 <code>chromedriver</code> 역시 함께 업데이트를 진행해야 합니다.</p>
<p><a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></p>
<p>위 링크에서 Latest Release 옆 크롬드라이버를 선택해 OS별로 알맞은 zip파일을 받아 압축을 풀어줍시다.</p>
<h2 id="기존-코드-수정하기"><a href="#기존-코드-수정하기" class="headerlink" title="기존 코드 수정하기"></a>기존 코드 수정하기</h2><p>크롬의 헤드리스 모드를 사용하는 방식은 기존 selenium을 이용한 코드와 거의 동일합니다만, 몇가지 옵션을 추가해줘야합니다.</p>
<p>기존에 webdriver를 사용해 크롬을 동작한 경우 아래와 같은 코드를 사용할 수 있었습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># 유의: chromedriver를 위에서 받아준 </span></span><br><span class="line"><span class="comment"># chromdriver(windows는 chromedriver.exe)의 절대경로로 바꿔주세요!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://naver.com'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'naver_main.png'</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드를 동작시키면 크롬이 켜지고 파이썬 파일 옆에 <code>naver_main.png</code>라는 스크린샷 하나가 생기게 됩니다.<br>이 코드는 지금까지 우리가 만들었던 코드와 큰 차이가 없는걸 확인해 보세요.</p>
<p>하지만 이 코드를 몇가지 옵션만 추가해주면 바로 Headless모드로 동작하게 만들어줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line"><span class="comment"># 혹은 options.add_argument("--disable-gpu")</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'http://naver.com'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'naver_main_headless.png'</span>)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드를 보시면 <code>ChromeOptions()</code>를 만들어 <code>add_argument</code>를 통해 Headless모드인 것과, 크롬 창의 크기, 그리고 gpu(그래픽카드 가속)를 사용하지 않는 옵션을 넣어준 것을 볼 수 있습니다.</p>
<p>제일 중요한 부분은 바로 <code>options.add_argument(&#39;headless&#39;)</code>라는 부분입니다. 크롬이 Headless모드로 동작하도록 만들어주는 키워드에요. 그리고 크롬 창의 크기를 직접 지정해 준 이유는, 여러분이 일반적으로 노트북이나 데스크탑에서 사용하는 모니터의 해상도가 1920x1080이기 때문입니다. 즉, 여러분이 일상적으로 보는 것 그대로 크롬이 동작할거라는 기대를 해볼수 있습니다!</p>
<p>마지막으로는 <code>disable-gpu</code>인데요, 만약 위 코드를 실행했을때 GPU에러~가 난다면 <code>--disable-gpu</code>로 앞에 dash(-)를 두개 더 붙여보세요. 이 버그는 크롬 자체에 있는 문제점입니다. 브라우저들은 CPU의 부담을 줄이고 좀더 빠른 화면 렌더링을 위해 GPU를 통해 그래픽 가속을 사용하는데, 이 부분이 크롬에서 버그를 일으키는 현상을 보이고 있습니다. (윈도우 크롬 61버전까지는 아직 업데이트 되지 않았습니다. 맥 61버전에는 해결된 이슈입니다.)</p>
<p>그리고 <code>driver</code> 변수를 만들 때 단순하게 chromedriver의 위치만 적어주는 것이 아니라 <code>chrome_options</code>라는 이름의 인자를 함께 넘겨줘야 합니다.</p>
<p>이 <code>chrome_options</code>는 Chrome을 이용할때만 사용하는 인자인데요, 이 인자값을 통해 headless등의 추가적인 인자를 넘겨준답니다.</p>
<p>자, 이제 그러면 한번 실행해 보세요. 크롬 창이 뜨지 않았는데도 <code>naver_main_headless.png</code>파일이 생겼다면 여러분 컴퓨터에서 크롬이 Headless모드로 성공적으로 실행된 것이랍니다!</p>
<h2 id="Headless브라우저임을-숨기기"><a href="#Headless브라우저임을-숨기기" class="headerlink" title="Headless브라우저임을 숨기기"></a>Headless브라우저임을 숨기기</h2><p>Headless모드는 CLI기반의 서버 OS에서도 Selenium을 통한 크롤링/테스트를 가능하게 만드는 멋진 모드지만, 어떤 서버들에서는 이런 Headless모드를 감지하는 여러가지 방법을 쓸 수 있습니다.</p>
<p>아래 글에서는 Headless모드를 탐지하는 방법과 탐지를 ‘막는’방법을 다룹니다.(창과 방패, 또 새로운 창!)</p>
<p>아래 코드의 TEST_URL은 <a href="https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html">https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html</a> 인데요, 이곳에서 Headless모드가 감춰졌는지 아닌지 확인해 볼 수 있습니다.</p>
<h3 id="User-Agent-확인하기"><a href="#User-Agent-확인하기" class="headerlink" title="User Agent 확인하기"></a>User Agent 확인하기</h3><h4 id="Headless-탐지하기"><a href="#Headless-탐지하기" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>가장 쉬운 방법은 <code>User-Agent</code>값을 확인하는 방법입니다.</p>
<p>일반적인 크롬 브라우저는 아래와 같은 <code>User-Agent</code>값을 가지고 있습니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;61.0.3163.100 Safari&#x2F;537.36</span><br></pre></td></tr></table></figure>

<p>하지만 Headless브라우저는 아래와 같은 <code>User-Agent</code>값을 가지고 있습니다.</p>
<p>잘 보시면 ‘HeadlessChrome/~~’와 같이 ‘Headless’라는 단어가 들어가있는걸 확인할 수 있습니다!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mozilla&#x2F;5.0 (X11; Linux x86_64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) HeadlessChrome&#x2F;60.0.3112.50 Safari&#x2F;537.36</span><br></pre></td></tr></table></figure>

<h4 id="Headless-탐지-막기"><a href="#Headless-탐지-막기" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>따라서 기본적으로 갖고있는 <code>User-Agent</code>값을 변경해줘야합니다.</p>
<p>이것도 위에서 사용한 <code>chrome_options</code>에 추가적으로 인자를 전달해주면 됩니다. 위코드를 약간 바꿔 아래와 같이 만들어보세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserAgent값을 바꿔줍시다!</span></span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>이제 여러분의 Headless크롬은 일반적인 크롬으로 보일거랍니다.</p>
<h3 id="플러그인-개수-확인하기"><a href="#플러그인-개수-확인하기" class="headerlink" title="플러그인 개수 확인하기"></a>플러그인 개수 확인하기</h3><h4 id="Headless-탐지하기-1"><a href="#Headless-탐지하기-1" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>크롬에는 여러분이 따로 설치하지 않아도 추가적으로 플러그인 몇개가 설치되어있답니다. PDF 내장 리더기같은 것들이죠.</p>
<p>하지만 Headless모드에서는 플러그인이 하나도 로딩되지 않아 개수가 0개가 됩니다. 이를 통해 Headless모드라고 추측할 수 있답니다.</p>
<p>아래 자바스크립트 코드를 통해 플러그인의 개수를 알아낼 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(navigator.plugins.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Headless 크롬이 아닐까??"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Headless-탐지-막기-1"><a href="#Headless-탐지-막기-1" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>물론 이 탐지를 막는 방법도 있습니다. 바로 브라우저에 ‘가짜 플러그인’ 리스트를 넣어주는 것이죠!</p>
<p>아래 코드와 같이 JavaScript를 실행해 플러그인 리스트를 가짜로 만들어 넣어줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">'about:blank'</span>)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5];&#125;,&#125;);"</span>)</span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위와 같이 JS로 navigator 객체의 <code>plugins</code>속성 자체를 오버라이딩 해 임의의 배열을 반환하도록 만들어주면 개수를 속일 수 있습니다.</p>
<blockquote>
<p>단, 출력물에서는 Plugin length가 여전히 0으로 나올거에요. 왜냐하면 사이트가 로딩 될때 이미 저 속성이 들어가있기 때문이죠 :’( 그래서 우리는 좀 더 다른방법을 뒤에서 써볼거에요.</p>
</blockquote>
<h3 id="언어-설정"><a href="#언어-설정" class="headerlink" title="언어 설정"></a>언어 설정</h3><h4 id="Headless-탐지하기-2"><a href="#Headless-탐지하기-2" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>여러분이 인터넷을 사용할때 어떤 사이트를 들어가면 다국어 사이트인데도 여러분의 언어에 맞게 화면에 나오는 경우를 종종 보고, 구글 크롬을 써서 외국 사이트를 돌아다니면 ‘번역해줄까?’ 하는 친절한 질문을 종종 봅니다.</p>
<p>이 설정이 바로 브라우저의 언어 설정이랍니다. 즉, 여러분이 선호하는 언어가 이미 등록되어있는 것이죠.</p>
<p>Headless모드에는 이런 언어 설정이 되어있지 않아서 이를 통해 Headless모드가 아닐까 ‘추측’할 수 있습니다.</p>
<h4 id="Headless-탐지-막기-2"><a href="#Headless-탐지-막기-2" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>Headless모드인 것을 감추기 위해 언어 설정을 넣어줍시다. 바로 <code>add_argument</code>를 통해 크롬에 전달해 줄 수 있답니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5]&#125;&#125;)"</span>)</span><br><span class="line"><span class="comment"># lanuages 속성을 업데이트해주기</span></span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'languages', &#123;get: function() &#123;return ['ko-KR', 'ko']&#125;&#125;)"</span>)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>단, 출력물에서는 language가 빈칸으로 나올거에요. 왜냐하면 사이트가 로딩 될때 이미 저 속성이 들어가있기 때문이죠 :’( 그래서 우리는 좀 더 다른방법을 뒤에서 써볼거에요.</p>
</blockquote>
<h3 id="WebGL-벤더와-렌더러"><a href="#WebGL-벤더와-렌더러" class="headerlink" title="WebGL 벤더와 렌더러"></a>WebGL 벤더와 렌더러</h3><h4 id="Headless-탐지하기-3"><a href="#Headless-탐지하기-3" class="headerlink" title="Headless 탐지하기"></a>Headless 탐지하기</h4><p>여러분이 브라우저를 사용할때 WebGL이라는 방법으로 그래픽카드를 통해 그려지는 방법을 가속을 한답니다. 즉, 실제로 디바이스에서 돌아간다면 대부분은 그래픽 가속을 사용한다는 가정이 기반인 셈이죠.</p>
<blockquote>
<p>사실 이 방법으로 차단하는 웹사이트는 거의 없을거에요. 혹여나 GPU가속을 꺼둔 브라우저라면 구별할 수 없기 때문이죠.</p>
</blockquote>
<p>위 코드에서 사용해준 <code>disable-gpu</code>옵션은 사실 이 그래픽 가속을 꺼주는 것이에요. 따라서 이부분을 보완해 줄 필요가 있습니다.</p>
<h4 id="Headless-탐지-막기-3"><a href="#Headless-탐지-막기-3" class="headerlink" title="Headless 탐지 막기"></a>Headless 탐지 막기</h4><p>가장 쉬운 방법은 크롬이 업데이트되길 기대하고 <code>disable-gpu</code>옵션을 꺼버리는 것이지만, 우선은 이 옵션을 함께 사용하는 방법을 알려드릴게요.</p>
<p>위에서 사용한 script실행방법을 또 써 볼 것이랍니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"lang=ko_KR"</span>) <span class="comment"># 한국어!</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'plugins', &#123;get: function() &#123;return[1, 2, 3, 4, 5]&#125;&#125;)"</span>)</span><br><span class="line">driver.execute_script(<span class="string">"Object.defineProperty(navigator, 'languages', &#123;get: function() &#123;return ['ko-KR', 'ko']&#125;&#125;)"</span>)</span><br><span class="line">driver.execute_script(<span class="string">"const getParameter = WebGLRenderingContext.getParameter;WebGLRenderingContext.prototype.getParameter = function(parameter) &#123;if (parameter === 37445) &#123;return 'NVIDIA Corporation'&#125; if (parameter === 37446) &#123;return 'NVIDIA GeForce GTX 980 Ti OpenGL Engine';&#125;return getParameter(parameter);&#125;;"</span>)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line">webgl_vendor = driver.find_element_by_css_selector(<span class="string">'#webgl-vendor'</span>).text</span><br><span class="line">webgl_renderer = driver.find_element_by_css_selector(<span class="string">'#webgl-renderer'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line">print(<span class="string">'WebGL Vendor: '</span>, webgl_vendor)</span><br><span class="line">print(<span class="string">'WebGL Renderer: '</span>, webgl_renderer)</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>위 코드에서는 WebGL렌더러를 Nvidia회사와 GTX980Ti엔진인 ‘척’ 하고 있는 방법입니다.</p>
<blockquote>
<p>하지만 WebGL print 구문에서는 여전히 빈칸일거에요. 이 역시 이미 사이트 로딩시 속성이 들어가있기 때문이에요.</p>
</blockquote>
<h2 id="Headless-브라우저-숨기는-방법-다함께-쓰기"><a href="#Headless-브라우저-숨기는-방법-다함께-쓰기" class="headerlink" title="Headless 브라우저 숨기는 방법 다함께 쓰기"></a>Headless 브라우저 숨기는 방법 다함께 쓰기</h2><p>위에서 사용한 방법 중 <code>User-Agent</code>를 바꾸는 방법 외에는 사실 모두 Javascript를 이용해 값을 추출하고 오버라이딩 하는 방식으로 바꿔보았습니다.</p>
<p>하지만 번번히 결과물이 빈칸으로 나오는 이유는 <code>driver.execute_script</code>라는 함수 자체가 사이트가 로딩이 끝난 후 (<code>onload()</code>이후) 실행되기 때문입니다.</p>
<p>즉, 우리는 우리가 써준 저 JS코드가 사이트가 로딩 되기 전 실행되어야 한다는 것이죠!</p>
<p>사실 기본 크롬이라면 사이트가 로딩 되기전 JS를 실행하는 Extension들을 사용할 수 있어요. 하지만 Headless크롬에서는 아직 Extension을 지원하지 않습니다 :’(</p>
<p>그래서 차선책으로 <a href="http://docs.mitmproxy.org/en/latest/mitmproxy.html">mitmproxy</a>라는 Proxy 프로그램을 사용해볼거에요.</p>
<h3 id="mitmproxy-사용하기"><a href="#mitmproxy-사용하기" class="headerlink" title="mitmproxy 사용하기"></a>mitmproxy 사용하기</h3><p>진행하기 전 앞서 만들었던 모든 JS코드가 들어있는 <code>content.js</code>를 아래처럼 만들어주세요.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CDP = <span class="built_in">require</span>(<span class="string">'chrome-remote-interface'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userAgent = <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.50 Safari/537.36'</span></span><br><span class="line"></span><br><span class="line">CDP(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">client</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;Network, Page&#125; = client;</span><br><span class="line">  <span class="keyword">await</span> Page.enable();</span><br><span class="line">  <span class="keyword">await</span> Network.enable();</span><br><span class="line">  <span class="keyword">await</span> Network.setUserAgentOverride(&#123;userAgent&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user-agent is now set</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// overwrite the `languages` property to use a custom getter</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(navigator, <span class="string">'languages'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">'ko-KR'</span>, <span class="string">'ko'</span>];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// overwrite the `plugins` property to use a custom getter</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(navigator, <span class="string">'plugins'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getParameter = WebGLRenderingContext.getParameter;</span><br><span class="line">WebGLRenderingContext.prototype.getParameter = <span class="function"><span class="keyword">function</span>(<span class="params">parameter</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// UNMASKED_VENDOR_WEBGL</span></span><br><span class="line">  <span class="keyword">if</span> (parameter === <span class="number">37445</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Intel Open Source Technology Center'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// UNMASKED_RENDERER_WEBGL</span></span><br><span class="line">  <span class="keyword">if</span> (parameter === <span class="number">37446</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Mesa DRI Intel(R) Ivybridge Mobile '</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getParameter(parameter);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[<span class="string">'height'</span>, <span class="string">'width'</span>].forEach(<span class="function"><span class="params">property</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// store the existing descriptor</span></span><br><span class="line">  <span class="keyword">const</span> imageDescriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(HTMLImageElement.prototype, property);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// redefine the property with a patched descriptor</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(HTMLImageElement.prototype, property, &#123;</span><br><span class="line">    ...imageDescriptor,</span><br><span class="line">    <span class="keyword">get</span>: function() &#123;</span><br><span class="line">      <span class="comment">// return an arbitrary non-zero dimension if the image failed to load</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.complete &amp;&amp; <span class="keyword">this</span>.naturalHeight == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// otherwise, return the actual dimension</span></span><br><span class="line">      <span class="keyword">return</span> imageDescriptor.get.apply(<span class="keyword">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// store the existing descriptor</span></span><br><span class="line"><span class="keyword">const</span> elementDescriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(HTMLElement.prototype, <span class="string">'offsetHeight'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// redefine the property with a patched descriptor</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(HTMLDivElement.prototype, <span class="string">'offsetHeight'</span>, &#123;</span><br><span class="line">  ...elementDescriptor,</span><br><span class="line">  <span class="keyword">get</span>: function() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.id === <span class="string">'modernizr'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementDescriptor.get.apply(<span class="keyword">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>우선 Mitmproxy를 pip로 설치해주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mitmproxy</span><br></pre></td></tr></table></figure>

<p>그리고 proxy 처리를 해 줄 파일인 <code>inject.py</code>파일을 만들어주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># inject.py</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"></span><br><span class="line"><span class="comment"># load in the javascript to inject</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'content.js'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content_js = f.read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response</span><span class="params">(flow)</span>:</span></span><br><span class="line">    <span class="comment"># only process 200 responses of html content</span></span><br><span class="line">    <span class="keyword">if</span> flow.response.headers[<span class="string">'Content-Type'</span>] != <span class="string">'text/html'</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flow.response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># inject the script tag</span></span><br><span class="line">    html = BeautifulSoup(flow.response.text, <span class="string">'lxml'</span>)</span><br><span class="line">    container = html.head <span class="keyword">or</span> html.body</span><br><span class="line">    <span class="keyword">if</span> container:</span><br><span class="line">        script = html.new_tag(<span class="string">'script'</span>, type=<span class="string">'text/javascript'</span>)</span><br><span class="line">        script.string = content_js</span><br><span class="line">        container.insert(<span class="number">0</span>, script)</span><br><span class="line">        flow.response.text = str(html)</span><br><span class="line"></span><br><span class="line">        ctx.log.info(<span class="string">'Successfully injected the content.js script.'</span>)</span><br></pre></td></tr></table></figure>

<p>이제 터미널에서 아래 명령어로 mitmproxy 서버를 띄워주세요.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump -p 8080 -s &quot;inject.py&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>이 서버는 크롤링 코드를 실행 할 때 항상 켜져있어야 해요!</p>
</blockquote>
<p>이제 우리 크롤링 코드에 <code>add_argument</code>로 Proxy옵션을 추가해 주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">TEST_URL = <span class="string">'https://intoli.com/blog/making-chrome-headless-undetectable/chrome-headless-test.html'</span></span><br><span class="line"></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'headless'</span>)</span><br><span class="line">options.add_argument(<span class="string">'window-size=1920x1080'</span>)</span><br><span class="line">options.add_argument(<span class="string">"disable-gpu"</span>)</span><br><span class="line">options.add_argument(<span class="string">"user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36"</span>)</span><br><span class="line">options.add_argument(<span class="string">"proxy-server=localhost:8080"</span>)</span><br><span class="line">driver = webdriver.Chrome(<span class="string">'chromedriver'</span>, chrome_options=options)</span><br><span class="line"></span><br><span class="line">driver.get(TEST_URL)</span><br><span class="line">print(driver.page_source)</span><br><span class="line"></span><br><span class="line">user_agent = driver.find_element_by_css_selector(<span class="string">'#user-agent'</span>).text</span><br><span class="line">plugins_length = driver.find_element_by_css_selector(<span class="string">'#plugins-length'</span>).text</span><br><span class="line">languages = driver.find_element_by_css_selector(<span class="string">'#languages'</span>).text</span><br><span class="line">webgl_vendor = driver.find_element_by_css_selector(<span class="string">'#webgl-vendor'</span>).text</span><br><span class="line">webgl_renderer = driver.find_element_by_css_selector(<span class="string">'#webgl-renderer'</span>).text</span><br><span class="line"></span><br><span class="line">print(<span class="string">'User-Agent: '</span>, user_agent)</span><br><span class="line">print(<span class="string">'Plugin length: '</span>, plugins_length)</span><br><span class="line">print(<span class="string">'languages: '</span>, languages)</span><br><span class="line">print(<span class="string">'WebGL Vendor: '</span>, webgl_vendor)</span><br><span class="line">print(<span class="string">'WebGL Renderer: '</span>, webgl_renderer)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>하지만 사실 이 코드는 정상적으로 동작하지 않을거에요. 헤드리스모드를 끄면 잘 돌아가지만 헤드리스모드를 켜면 정상적으로 동작하지 않아요. 바로 SSL오류 때문입니다.</p>
<p>크롬에서 SSL을 무시하도록 만들수 있고, 로컬의 HTTP를 신뢰 가능하도록 만들 수도 있지만 아직 크롬 Headless모드에서는 지원하지 않습니다.</p>
<p>정확히는 아직 webdriver에서 지원하지 않습니다. </p>
<h2 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h2><p>아직까지는 크롬 Headless모드에서 HTTPS 사이트를 ‘완전히 사람처럼’보이게 한뒤 크롤링 하는 것은 어렵습니다. 하지만 곧 업데이트 될 크롬에서는 익스텐션 사용 기능이 추가될 예정이기 때문에 이 기능이 추가되면 복잡한 과정 없이 JS를 바로 추가해 진짜 일반적인 크롬처럼 동작하도록 만들 수 있으리라 생각합니다.</p>
<p>사실 서버 입장에서 위와 같은 요청을 보내는 경우 처리를 할 수 있는 방법은 JS로 헤드리스 유무를 확인하는 방법이 전부입니다. 즉, 서버 입장에서도 ‘식별’은 가능하지만 이로 인해 유의미한 차단은 하기 어렵습니다. 현재로서는 UserAgent 값만 변경해주어도 대부분의 사이트에서는 자연스럽게 크롤링을 진행할 수 있으리라 생각합니다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://antoinevastel.github.io/bot%20detection/2017/08/05/detect-chrome-headless.html">Detecting Chrome Headless</a></li>
<li><a href="https://intoli.com/blog/making-chrome-headless-undetectable/">MAKING CHROME HEADLESS UNDETECTABLE</a></li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/crawling_with_multiprocessing.png" alt="나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-07-04T15:00:00.000Z">2017-07-05</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/">나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이전 가이드: <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a></p>
</blockquote>
<h2 id="들어가기전"><a href="#들어가기전" class="headerlink" title="들어가기전.."></a>들어가기전..</h2><p>나만의 웹 크롤러 만들기 6번째 가이드는 크롤링을 병렬화를 통해 빠르게 진행하는 방법을 안내합니다.</p>
<p>지금까지 만들어온 크롤러들은 모두 한번에 하나의 요청만을 처리하고 있습니다. 물론 지금까지 따라오셨다면 충분히 크롤러들을 여러분의 의도에 맞게 잘 수정해서 사용해보셨을거라 생각합니다.</p>
<p>하지만 한 페이지만을 여유로운 시간을 갖고 크롤링하는 것이 아니라 여러 사이트 혹은 여러 페이지를 좀더 빠르게 긁어오는 방법에는 역시 N개를 띄우는 방법이 제일 낫다고 볼 수 있습니다.</p>
<p>만약 100만개의 페이지가 있다면 1<del>25만/25만1</del>50만/50만1<del>75만/75만1</del>100만와 같이 4개로 쪼개서 돌린다면 더 빠르게 도는 것은 당연합니다.</p>
<p>하지만 전달해주는 페이지의 목록이나 페이지 숫자에 직접 저 수들을 입력하는 것은 상당히 귀찮은 일이기도 하고, 크롤링이 ‘자동화’를 위한 것이라는 면에 반하는 측면도 있습니다. 따라서 우리는 Python 자체에 내장된 병렬화 모듈을 사용할 예정입니다.</p>
<p>Python을 이용할 때 프로그램을 병렬적으로 처리하는 방법은 여러가지가 있습니다. 하지만 우리가 하는 일은 연산이 아니고 IO와 네트워크가 가장 큰 문제이기 때문에 <code>multiprocessing</code>을 사용합니다.</p>
<blockquote>
<p><code>threading</code> 모듈도 사용 가능합니다. 하지만 <code>multiprocessing</code>모듈을 추천합니다. <code>threading</code>모듈은 싱글 프로세스 안의 스레드에서 동작하지만 이로인해 GIL의 제약에 걸리는 경우가 생기기 때문에 성능 향상에 제약이 있습니다. (물론 우리는 CPU 연산보다 IO/네트워크로 인한 지연이 훨씬 크기 때문에 큰 차이는 없습니다.)</p>
</blockquote>
<h2 id="멀티프로세스란"><a href="#멀티프로세스란" class="headerlink" title="멀티프로세스란?"></a>멀티프로세스란?</h2><p>프로세스란 ‘실행 중인 프로그램’을 의미합니다. 간단하게 말해 멀티프로세스는 프로세스를 여러개 띄우는 것, 즉 프로그램을 여러개 실행시키는 것이라고 볼 수 있습니다.</p>
<p>Python에는 멀티프로세싱 프로그램을 위한 모듈이 <code>multiprocessing</code>이라는 이름으로 내장되어 있습니다. </p>
<p>가장 단순한 예시로, 임의의 숫자 리스트 (ex: <code>[20, 25, 30, 35]</code>)를 받고 그 자리의 피보나치 수를 구해주는 프로그램이 있다고 가정해 봅시다.</p>
<p>만약 for문을 통해 리스트를 순회하며 계산한다면 아래와 같이 코드를 짤 수 있습니다.</p>
<blockquote>
<p>주의: 명백한 코드 실행 시간 차이를 보여주기 위한 느린 코드입니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibo</span><span class="params">(n)</span>:</span> <span class="comment"># 회귀적 피보나치 함수</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibo(n<span class="number">-1</span>) + fibo(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line">num_list = [<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>]</span><br><span class="line">result_list = []</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> num_list:</span><br><span class="line">    result_list.append(fibo(num))</span><br><span class="line"></span><br><span class="line">print(result_list)</span><br><span class="line">print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>실행을 해보면 다음과 같이 약 7s가 걸리는 것을 볼 수 있습니다. 너무 오래걸리네요.</p>
<script type="text/javascript" src="https://asciinema.org/a/c6iRt6q82WDuFruFfcFlmmrjn.js" id="asciicast-c6iRt6q82WDuFruFfcFlmmrjn" async></script>

<p>그렇다면 <code>multiprocessing</code>을 이용하면 어떨까요?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibo</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> fibo(n<span class="number">-1</span>) + fibo(n<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_fibo</span><span class="params">(n)</span>:</span> <span class="comment"># 피보나치 결과를 확인합니다.</span></span><br><span class="line">    print(fibo(n))</span><br><span class="line"></span><br><span class="line">num_list = [<span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>]</span><br><span class="line">    </span><br><span class="line">pool = Pool(processes=<span class="number">4</span>) <span class="comment"># 4개의 프로세스를 사용합니다.</span></span><br><span class="line">pool.map(print_fibo, num_list) <span class="comment"># pool에 일을 던져줍니다.</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>실행을 해 봅시다!</p>
<script type="text/javascript" src="https://asciinema.org/a/gwOTuBQgs11J6ckOlgIERAdF5.js" id="asciicast-gwOTuBQgs11J6ckOlgIERAdF5" async></script>

<p>확실히 빨라진 모습을 볼 수 있습니다. 3s, 즉 절반정도로 줄어든 것을 확인 할 수 있습니다.</p>
<h2 id="크롤링-병렬화-하기"><a href="#크롤링-병렬화-하기" class="headerlink" title="크롤링 병렬화 하기"></a>크롤링 병렬화 하기</h2><p>이번 가이드에서는 위에서 사용한 모듈인 <code>multiprocessing</code>을 이용해 진행합니다. 크롤링은 위에서 사용한 것처럼 연산집중적이지 않습니다. 그래서 크롤링하는 함수를 만들어두었다면 그 함수를 그대로 사용하시면 됩니다.</p>
<p>이번 가이드에서는 첫번째 가이드에서 사용했던 함수를 약간 변형해 사용해 봅니다.</p>
<h3 id="하나씩-크롤링-하기"><a href="#하나씩-크롤링-하기" class="headerlink" title="하나씩 크롤링 하기"></a>하나씩 크롤링 하기</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">()</span>:</span> <span class="comment"># 블로그의 게시글 링크들을 가져옵니다.</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data.append(title.get(<span class="string">'href'</span>))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(link)</span>:</span></span><br><span class="line">    abs_link = <span class="string">'https://beomi.github.io'</span>+link</span><br><span class="line">    req = requests.get(abs_link)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># 가져온 데이터로 뭔가 할 수 있겠죠?</span></span><br><span class="line">    <span class="comment"># 하지만 일단 여기서는 시간만 확인해봅시다.</span></span><br><span class="line">    print(soup.select(<span class="string">'h1'</span>)[<span class="number">0</span>].text) <span class="comment"># 첫 h1 태그를 봅시다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="keyword">for</span> link <span class="keyword">in</span> get_links():</span><br><span class="line">        get_content(link)</span><br><span class="line">    print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<p>약 7.3s가 걸리는 것을 아래에서 확인해 볼 수 있습니다.</p>
<script type="text/javascript" src="https://asciinema.org/a/WgPLMFdo60dedeMD7PO53uyNZ.js" id="asciicast-WgPLMFdo60dedeMD7PO53uyNZ" async></script>

<h3 id="Multiprocessing으로-병렬-크롤링하기"><a href="#Multiprocessing으로-병렬-크롤링하기" class="headerlink" title="Multiprocessing으로 병렬 크롤링하기"></a>Multiprocessing으로 병렬 크롤링하기</h3><p>이제 좀더 빠른 크롤링을 위해 병렬화를 도입해 봅시다.</p>
<p><code>multiprocessing</code>에서 <code>Pool</code>을 import 해 줍시다.</p>
<p>그리고 pool에 <code>get_content</code>함수를 넣어 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool <span class="comment"># Pool import하기</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_links</span><span class="params">()</span>:</span> <span class="comment"># 블로그의 게시글 링크들을 가져옵니다.</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data.append(title.get(<span class="string">'href'</span>))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content</span><span class="params">(link)</span>:</span></span><br><span class="line">    abs_link = <span class="string">'https://beomi.github.io'</span>+link</span><br><span class="line">    req = requests.get(abs_link)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    <span class="comment"># 가져온 데이터로 뭔가 할 수 있겠죠?</span></span><br><span class="line">    <span class="comment"># 하지만 일단 여기서는 시간만 확인해봅시다.</span></span><br><span class="line">    print(soup.select(<span class="string">'h1'</span>)[<span class="number">0</span>].text) <span class="comment"># 첫 h1 태그를 봅시다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    start_time = time.time()</span><br><span class="line">    pool = Pool(processes=<span class="number">4</span>) <span class="comment"># 4개의 프로세스를 사용합니다.</span></span><br><span class="line">    pool.map(get_content, get_links()) <span class="comment"># get_contetn 함수를 넣어줍시다.</span></span><br><span class="line">    print(<span class="string">"--- %s seconds ---"</span> % (time.time() - start_time))</span><br></pre></td></tr></table></figure>

<script type="text/javascript" src="https://asciinema.org/a/yITked7NP4bM7nPaAZM4CcIYF.js" id="asciicast-yITked7NP4bM7nPaAZM4CcIYF" async></script>

<p>약 2.8초로 약 3~4배의 속도 향상이 있었습니다.</p>
<h2 id="마무리-및-팁"><a href="#마무리-및-팁" class="headerlink" title="마무리 및 팁"></a>마무리 및 팁</h2><p>멀티프로세싱으로 크롤링을 할 때 유의할 점은 Pool을 생성시 <code>processes</code>의 개수가 많다고 빠르지는 않다는 점을 유의하셔야 합니다.</p>
<p>두번째 parser.py파일을 실행 시 process를 4개인 경우 2.8s, 8개로 할 때 1.85s, 16개로 할 때 0.96s, 32개로 할 때 0.63s로 속도 향상이 두드러집니다. 하지만 64개로 할 때는 오히려 1.30s로 속도 지연이 발생합니다. 프로세스는 CPU코어(Hyper-Thread인 경우 2배) 개수의 2배(ex: 4코어 i5는 8개, 4코어8스레드인 i7은 16개)로 하면 가장 빠르지는 않지만 적당히 빠른 속도를 가져다줍니다.</p>
<p>다음으로는 웹 사이트에서 이러한 공격적 크롤링을 차단할 수 있다는 문제입니다. 잘 관리되는 사이트의 경우 이와 같은 공격적 크롤링은 사실 시스템 관리자에게 있어서는 공격 시도와 같이 보일 수 있기 때문에 적당한 속도를 유지하며 <code>robots.txt</code>를 존중해주는 것이 중요합니다.</p>
<p>무작정 빠르게 긁는다고 빠르지 않은 점에는 이 코드를 실행하는 컴퓨터의 네트워크 환경 자체가 제약이 되기도 합니다. 만약 핫스팟이나 테더링을 이용하거나 인터넷 속도에 제약을 받는 환경에서 이러한 작업을 돌린다면 오히려 네트워크쪽 문제로 인해 에러나 지연이 발생할 가능성이 높습니다. 이런 경우에는 <code>processes</code>개수를 2~4개로 맞춰서 크롤링을 진행하는 것이 최적의 속도를 이끌어낼 수도 있습니다.</p>
<p>다음 가이드에서는 실제 명령어를 받아 사용자들의 정보를 저장하고 사용자들에게 실제로 유용한 정보(예: 글 제목과 링크)를 보내주는 내용으로 진행할 예정입니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/telegram.png" alt="나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-04-19T15:00:00.000Z">2017-04-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이전게시글: <a href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/">나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기</a></p>
</blockquote>
<blockquote>
<p>이번 가이드에서는 작업하는 컴퓨터가 아닌 원격 우분투16.04 서버(vps)에 올리는 부분까지 다룹니다. 테스트는 <code>crontab -e</code> 명령어를 사용할 수 있는 환경에서 가능하며, VISA/Master카드등 해외결제가 가능한 카드가 있다면 서비스 가입 후 실제로 배포도 가능합니다. 이 가이드에서는 Vultr VPS를 이용합니다.</p>
</blockquote>
<p>앞서 <code>Django</code>를 이용해 크롤링한 데이터를 DB에 저장해 보았습니다.</p>
<p>하지만 크롤링을 할 때마다 동일한(중복된) 데이터를 DB에 저장하는 것은 바람직 하지 않은 일이죠.</p>
<p>또한, 크롤링을 자동으로 해 사이트에 변경사항이 생길 때 마다 내 텔레그램으로 알림을 받을 수 있다면 더 편리하지 않을까요?</p>
<p>이번 가이드에서는 클리앙 중고장터 등을 크롤링해 새 게시글이 올라올 경우 새글 알림을 텔레그램으로 보내는 것까지를 다룹니다.</p>
<p>다루는 내용:</p>
<ul>
<li>Telegram Bot API</li>
<li>requests / BeautifulSoup</li>
<li>Crontab</li>
</ul>
<h2 id="시작하며"><a href="#시작하며" class="headerlink" title="시작하며"></a>시작하며</h2><h2 id="widgets"><a href="#widgets" class="headerlink" title="widgets:"></a>widgets:</h2><p>텔레그램은 REST API를 통해 봇을 제어하도록 안내합니다.</p>
<p>물론 직접 텔레그램 api를 사용할 수도 있지만, 이번 가이드에서는 좀 더 빠른 개발을 위해 <code>python-telegram-bot</code> 패키지를 사용합니다.</p>
<p><code>python-telegram-bot</code>은 Telegram Bot API를 python에서 쉽게 이용하기 위한 wrapper 패키지입니다.</p>
<h2 id="python-telegram-bot-설치하기"><a href="#python-telegram-bot-설치하기" class="headerlink" title="python-telegram-bot 설치하기"></a>python-telegram-bot 설치하기</h2><h2 id="widgets-1"><a href="#widgets-1" class="headerlink" title="widgets:"></a>widgets:</h2><p><code>python-telegram-bot</code>은 pip로 설치 가능합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-telegram-bot</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>requests</code>, <code>bs4</code> 역시 설치되어있어야 합니다!</p>
</blockquote>
<h2 id="텔레그램-봇-만들기-amp-API-Key받기"><a href="#텔레그램-봇-만들기-amp-API-Key받기" class="headerlink" title="텔레그램 봇 만들기 &amp; API Key받기"></a>텔레그램 봇 만들기 &amp; API Key받기</h2><h2 id="widgets-2"><a href="#widgets-2" class="headerlink" title="widgets:"></a>widgets:</h2><p>텔레그램 봇을 만들고 API키를 받아 이용하는 기본적인 방법은 <a href="https://blog.psangwoo.com/coding/2016/12/08/python-telegram-bot-1.html">python에서 telegram bot 사용하기</a>에 차근차근 설명되어있습니다.</p>
<p>위 가이드에서 텔레그램 봇의 토큰을 받아오세요. 토큰은 <code>aaaa:bbbbbbbbbbbbbb</code>와 같이 생긴 문자열입니다.</p>
<blockquote>
<p>이번 가이드는 텔레그램 봇을 다루는 내용보다는 Cron으로 크롤링을 하고 변화 발견시 텔레그램 메시지를 보내는 것에 초점을 맞췄습니다.</p>
</blockquote>
<p>텔레그램 봇 API키를 받아왔다면 아래와 같이 크롤링을 하는 간단한 python파일을 작성해 봅시다. 클리앙에 새로운 글이 올라오면 “새 글이 올라왔어요!”라는 메시지를 보내는 봇을 만들어 보겠습니다.</p>
<h2 id="클리앙-새글-탐지코드-만들기"><a href="#클리앙-새글-탐지코드-만들기" class="headerlink" title="클리앙 새글 탐지코드 만들기"></a>클리앙 새글 탐지코드 만들기</h2><h2 id="widgets-3"><a href="#widgets-3" class="headerlink" title="widgets:"></a>widgets:</h2><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2000.46.01.png" alt="clien marcket web page list"></p>
<p>우선 게시판의 글 제목중 첫번째 제목을 가져오고 txt파일로 저장하는 코드를 만들어 봅시다.</p>
<p>회원 장터 주소는 <code>http://clien.net/cs2/bbs/board.php?bo_table=sold</code>이고, 첫 게시글의 CSS Selector는 <code>#content &gt; div.board_main &gt; table &gt; tbody &gt; tr:nth-child(3) &gt; td.post_subject &gt; a</code>임을 알 수 있습니다. 따라서 아래와 같이 <code>latest</code> 변수에 담아 같은 폴더의 <code>latest.txt</code> 파일에 써 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span> <span class="comment"># Clien에서 encoding 정보를 보내주지 않아 encoding옵션을 추가해줘야합니다.</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text <span class="comment"># 0번은 회원중고장터 규칙입니다.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(latest)</span><br></pre></td></tr></table></figure>

<p>위와 같이 코드를 구성하면 <code>latest.txt</code>파일에 가장 최신 글의 제목이 저장됩니다.</p>
<p>크롤링 이후 새로운 글이 생겼는지의 유무를 알아보려면 크롤링한 최신글의 제목과 파일에 저장된 제목이 같은지를 확인하면 됩니다.</p>
<p>만약 같다면 패스, 다르다면 텔레그램으로 메시지를 보내는거죠!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        <span class="comment"># 같은 경우는 에러 없이 넘기고, 다른 경우에만</span></span><br><span class="line">        <span class="comment"># 메시지 보내는 로직을 넣으면 됩니다.</span></span><br><span class="line">    f_read.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">    f_write.write(latest)</span><br><span class="line">    f_write.close()</span><br></pre></td></tr></table></figure>

<h2 id="새글이라면-텔레그램으로-메시지-보내기"><a href="#새글이라면-텔레그램으로-메시지-보내기" class="headerlink" title="새글이라면? 텔레그램으로 메시지 보내기!"></a>새글이라면? 텔레그램으로 메시지 보내기!</h2><h2 id="widgets-4"><a href="#widgets-4" class="headerlink" title="widgets:"></a>widgets:</h2><p>이제 메시지를 보내볼게요. <code>telegram</code>을 import하신 후 <code>bot</code>을 선언해주시면 됩니다. token은 위에서 받은 토큰입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line"><span class="comment"># 토큰을 지정해서 bot을 선언해 줍시다! (물론 이 토큰은 dummy!)</span></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line"><span class="comment"># 우선 테스트 봇이니까 가장 마지막으로 bot에게 말을 건 사람의 id를 지정해줄게요.</span></span><br><span class="line"><span class="comment"># 만약 IndexError 에러가 난다면 봇에게 메시지를 아무거나 보내고 다시 테스트해보세요.</span></span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># 원래는 이 메시지를 보낼 필요가 없지만, 테스트 할 때는 봇이 동작하는지 확인차 넣어봤어요.</span></span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 없어요 ㅠㅠ'</span>)</span><br><span class="line">    f_read.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">    f_write.write(latest)</span><br><span class="line">    f_write.close()</span><br></pre></td></tr></table></figure>

<p>이제 <code>clien_market_parser.py</code>파일을 실행할 때 새 글이 올라왔다면 “새 글이 올라왔어요!”라는 알림이, 새 글이 없다면 “새 글이 없어요 ㅠㅠ”라는 알림이 옵니다.</p>
<blockquote>
<p>지금은 자동으로 실행되지 않기 때문에 <code>python clien_market_parser.py</code>명령어로 직접 실행해 주셔야 합니다.</p>
</blockquote>
<h2 id="자동으로-크롤링하고-메시지-보내기"><a href="#자동으로-크롤링하고-메시지-보내기" class="headerlink" title="자동으로 크롤링하고 메시지 보내기"></a>자동으로 크롤링하고 메시지 보내기</h2><h2 id="widgets-5"><a href="#widgets-5" class="headerlink" title="widgets:"></a>widgets:</h2><h3 id="가장-쉬운방법-while-sleep"><a href="#가장-쉬운방법-while-sleep" class="headerlink" title="가장 쉬운방법: while + sleep"></a>가장 쉬운방법: <code>while</code> + <code>sleep</code></h3><p>가장 쉬운 방법은 python의 <code>while</code>문을 쓰는 방법입니다. 물론, 가장 나쁜 방법이에요. 안전하지도 않고 시스템의 메모리를 좀먹을 수도 있어요.</p>
<p>하지만 테스트에서는 가장 쉽게 쓸 수 있어요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">    req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">    latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r+'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">        before = f_read.readline()</span><br><span class="line">        <span class="keyword">if</span> before != latest:</span><br><span class="line">            bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 없어요 ㅠㅠ'</span>)</span><br><span class="line">        f_read.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">        f_write.write(latest)</span><br><span class="line">        f_write.close()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">60</span>) <span class="comment"># 60초(1분)을 쉬어줍니다.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>파이썬 동작중에는 CTRL+C로 빠져나올수 있습니다.</p>
</blockquote>
<h3 id="추천-시스템의-cron-스케쥴러를-이용하기"><a href="#추천-시스템의-cron-스케쥴러를-이용하기" class="headerlink" title="추천: 시스템의 cron/스케쥴러를 이용하기"></a>추천: 시스템의 cron/스케쥴러를 이용하기</h3><p>이번 가이드에서 핵심인 부분인데요, 이 부분은 이제 우분투 16.04 기준으로 진행할게요.</p>
<p>우선 Ubuntu 16.04가 설치된 시스템이 필요합니다. 이번 강의에서는 Vultr VPS를 이용합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.31.34.png" alt="add deploy new vps"></p>
<p>Vultr는 가상 서버 회사인데, Tokyo리전의 VPS를 제공해줘 빠르게 이용이 가능합니다. 트래픽도 굉장히 많이주고요.</p>
<p>가이드를 만드는 지금은 월 2.5달러 VPS는 아쉽게도 없어서, 월5달러 VPS로 진행하지만 월2.5달러 VPS로도 충분합니다!</p>
<p>아래의 Deploy Now를 누르면 새 Cloud Instance(VPS)가 생성되는데요, 서버가 생성된 후 들어가 보면 다음과 같이 id와 pw가 나와있습니다. 패스워드는 눈 모양을 누르면 잠시 보입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.43.54.png" alt=""></p>
<p>이 정보로 ssh에 접속해 봅시다. (윈도는 putty이나 Xshell등을 이용해주세요.)</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.46.08.png" alt=""></p>
<p>우분투 16.04버전에는 이미 Python3.5버전이 설치되어있기 때문에 <code>pip3</code>, <code>setuptools</code>을 설치해 주고 Ubuntu의 Locale을 설정해줘야 합니다. 아래 명령어를 한줄씩 순차적으로 치시면 완료됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-pip python3-setuptools build-essential</span><br><span class="line">sudo locale-gen <span class="string">"ko_KR.UTF-8"</span></span><br><span class="line">pip3 install requests bs4 python-telegram-bot</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2001.48.11.png" alt=""></p>
<p>설치를 하신 후 코드를 테스트 해보려면 위 파일을 <code>vi</code>등으로 열어 위 코드들을 입력하시면 됩니다.</p>
<p>이제 코드를 약간 바꿔볼게요. 새 글이 올라올때만 파일을 다시 쓰도록 해요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clien_market_parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> telegram</span><br><span class="line"></span><br><span class="line">bot = telegram.Bot(token=<span class="string">'123412345:ABCDEFgHiJKLmnopqr-0StUvwaBcDef0HI4jk'</span>)</span><br><span class="line">chat_id = bot.getUpdates()[<span class="number">-1</span>].message.chat.id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'http://clien.net/cs2/bbs/board.php?bo_table=sold'</span>)</span><br><span class="line">req.encoding = <span class="string">'utf-8'</span></span><br><span class="line"></span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">posts = soup.select(<span class="string">'td.post_subject'</span>)</span><br><span class="line">latest = posts[<span class="number">1</span>].text</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'r'</span>) <span class="keyword">as</span> f_read:</span><br><span class="line">    before = f_read.readline()</span><br><span class="line">    f_read.close()</span><br><span class="line">    <span class="keyword">if</span> before != latest:</span><br><span class="line">        bot.sendMessage(chat_id=chat_id, text=<span class="string">'새 글이 올라왔어요!'</span>)</span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'latest.txt'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> f_write:</span><br><span class="line">            f_write.write(latest)</span><br><span class="line">            f_write.close()</span><br></pre></td></tr></table></figure>

<p>이제 이 <code>clien_market_parser.py</code> 파일을 <code>python3</code>으로 실행해야 하기 때문에, <code>python3</code>이 어디 설치되어있는지 확인 해 봅시다.(아마 <code>/usr/bin/python3</code>일거에요!)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@vultr:~<span class="comment"># which python3</span></span><br><span class="line">/usr/bin/python3</span><br></pre></td></tr></table></figure>

<p>이제 Crontab에 이 파이썬으로 우리 파일을 매 1분마다 실행하도록 만들어 봅시다.</p>
<blockquote>
<p>crontab 수정은 <code>crontab -e</code>명령어로 사용 가능합니다. 만약 에디터를 선택하라고 한다면 초보자는 Nano를, vi를 쓰실수 있으시다면 vi를 이용하세요.</p>
</blockquote>
<p>이 한줄을 crontab 마지막에 추가해 주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * /usr/bin/python3 /root/clien_market_parser.py</span><br></pre></td></tr></table></figure>

<blockquote>
<p>힌트: 매 12분마다로 하시려면 <code>*/12 * * * * /usr/bin/python3 /root/clien_market_parser.py</code>로 하시면 됩니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-04-21%2002.03.23.png" alt=""></p>
<p>이제 여러분의 휴대폰으로 새 글이 올라올 때 마다 알람이 올라올 거랍니다 :)</p>
<h2 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h2><h2 id="widgets-6"><a href="#widgets-6" class="headerlink" title="widgets:"></a>widgets:</h2><p>이번편 가이드는 DB를 이용하지 않고 단순하게 새로운 글이 왔다는 사실만을 메시지로 알려주는 봇을 만들어서 뭔가 아쉬움이 있을겁니다. </p>
<p>다음편 가이드는 <code>multiprocessing</code>을 이용한 N배 빠른 크롤러을 만들어 봅니다.</p>
<blockquote>
<p>다음 가이드: <a href="/2017/07/05/HowToMakeWebCrawler-with-Multiprocess/">나만의 웹 크롤러 만들기(6): N배빠른 크롤링, multiprocessing!</a></p>
</blockquote>
<!--

-->
        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-02-27-HowToMakeWebCrawler-Save-with-Django/python+django.jpg" alt="나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-02-28T15:00:00.000Z">2017-03-01</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/">나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>(@2017.03.18) 본 블로그 테마가 업데이트되면서 구 블로그의 URL은 <a href="https://beomi.github.io/beomi.github.io_old/로">https://beomi.github.io/beomi.github.io_old/로</a> 변경되었습니다. 예제 코드에서는 변경을 완료하였지만 캡쳐 화면은 변경하지 않았으니 유의 바랍니다.</p>
</blockquote>
<p>이전게시글: <a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">나만의 웹 크롤러 만들기(3): Selenium으로 무적 크롤러 만들기</a></p>
<p>Python을 이용해 <code>requests</code>와 <code>selenium</code>을 이용해 웹 사이트에서 데이터를 크롤링해 보았습니다.</p>
<p>하지만 이러한 데이터를 체계적으로 관리하려면 DB가 필요하고, 이러한 DB를 만들고 관리하는 방법이 여러가지가 있지만 이번 가이드에서는 Python 웹 프레임워크인 <code>django</code>의 Database ORM을 이용해 DB를 만들고 데이터를 저장해 보려 합니다.</p>
<p>이번 가이드에서는 1회차 가이드였던 이 블로그를 크롤링해서 나온 결과물을 Django ORM으로 Sqlite DB에 저장해보는 것까지를 다룹니다.</p>
<blockquote>
<p>이번 가이드는 기본적으로 Django의 <code>Model</code>에 대해 이해하고 있는 분들에게 추천합니다.</p>
</blockquote>
<blockquote>
<p>만약 django가 처음이시라면 <a href="https://djangogirlsseoul.gitbooks.io/django-tube/content/">DjangoGirls Tutorial: DjangoTube</a>를 따라해보시면 기본적인 이해에 도움이 되시리라 생각합니다. 30분 내외로 따라가실 수 있습니다.</p>
</blockquote>
<h1 id="Django-프로젝트-만들기"><a href="#Django-프로젝트-만들기" class="headerlink" title="Django 프로젝트 만들기"></a>Django 프로젝트 만들기</h1><h2 id="widgets"><a href="#widgets" class="headerlink" title="widgets:"></a>widgets:</h2><p>우선 크롤링 한 데이터를 저장할 Django 프로젝트와 앱을 만들고, Model을 통해 DB를 만들어야 합니다.</p>
<h2 id="Django-설치하기"><a href="#Django-설치하기" class="headerlink" title="Django 설치하기"></a>Django 설치하기</h2><p>Django는 pip로 간편하게 설치할 수 있습니다.</p>
<blockquote>
<p>가상환경을 이용해 설치하는 것을 추천합니다. 가상환경은 python3.4이후부터는 <code>python3 -m venv 가상환경이름</code>으로 만드실 수 있습니다.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.14.57.png" alt="django install success"></p>
<blockquote>
<p>글 작성 시점인 2017.02.28 기준 1.10.5 버전이 최신버전입니다.</p>
</blockquote>
<h2 id="Django-Start-Project-프로젝트-만들기"><a href="#Django-Start-Project-프로젝트-만들기" class="headerlink" title="Django Start Project | 프로젝트 만들기"></a>Django Start Project | 프로젝트 만들기</h2><p>django가 성공적으로 설치되면 <code>django-admin</code>이라는 명령어로 장고 프로젝트를 생성할 수 있습니다.</p>
<p>이번 가이드에서는 <code>websaver</code>라는 이름의 프로젝트를 만들어보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject websaver</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.15.47.png" alt="startproject websaver"></p>
<blockquote>
<p>성공적으로 생길 경우 어떠한 반응도 나타나지 않습니다.</p>
</blockquote>
<p>위 명령어를 치면 명령어를 친 위치에 <code>websaver</code>라는 폴더가 생기고, 그 안의 구조는 아래와 같습니다.</p>
<blockquote>
<p><code>cd websaver</code>로 <code>websaver</code>폴더 안으로 진입한 상태입니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.18.06.png" alt="tree websaver"></p>
<blockquote>
<p>tree 명령어는 mac에서 <code>brew install tree</code>로 설치한 명령어입니다. 기본적으로는 깔려있지 않습니다.</p>
</blockquote>
<p>이와 같이 <code>manage.py</code>파일과 프로젝트 이름인 <code>websaver</code>라는 이름의 폴더가 함께 생성됩니다.</p>
<h2 id="Django-Start-App-장고-앱-만들기"><a href="#Django-Start-App-장고-앱-만들기" class="headerlink" title="Django Start App | 장고 앱 만들기"></a>Django Start App | 장고 앱 만들기</h2><p>Django는 프로젝트와 그 안의 <code>앱</code>으로 관리됩니다. 이 <code>앱</code>은 하나의 기능을 담당하는 단위로 보시면 됩니다.</p>
<p>앱은 <code>manage.py</code>파일을 통해 <code>startapp</code>이라는 명령어로 생성 가능합니다. <code>parsed_data</code>라는 이름의 앱을 만들어보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp parsed_data</span><br></pre></td></tr></table></figure>

<blockquote>
<p>manage.py 파일이 있는 곳에서 실행합니다. django가 설치된 가상환경에 진입해 있는지 꼭 확인하세요!</p>
</blockquote>
<p>이제 아래와 같은 구조로 앱이 생겼을 것인데, 이 앱을 Django가 관리하도록 <code>websaver</code>폴더 안의 <code>settings.py</code>파일의 <code>INSTALLED_APPS</code>에 추가해줘야 합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.32.06.png" alt="startapp parsed_data"></p>
<blockquote>
<p>유의: .pyc파일은 python실행시 생기는 캐싱 파일입니다. 없으셔도 전혀 문제는 발생하지 않습니다.</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># websaver/settings.py</span></span><br><span class="line">...</span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'parsed_data'</span>, <span class="comment"># 앱을 추가해 줍시다.</span></span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Django-First-Migration-첫-마이그레이션"><a href="#Django-First-Migration-첫-마이그레이션" class="headerlink" title="Django First Migration | 첫 마이그레이션"></a>Django First Migration | 첫 마이그레이션</h2><p>​<br>장고는 <code>python manage.py migrate</code>이라는 명령어로 DB를 migrate합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<p>위 명령어를 입력하면 아래와 같이 Django에서 사용하는 기본적인 DB가 생성됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.37.23.png" alt="First migrate"></p>
<h2 id="parsed-data-App-Model-parsed-data-앱-모델-만들기"><a href="#parsed-data-App-Model-parsed-data-앱-모델-만들기" class="headerlink" title="parsed_data App Model | parsed_data 앱 모델 만들기"></a>parsed_data App Model | parsed_data 앱 모델 만들기</h2><p>이제 DB구조를 관리해주는 <code>Model</code>을 만들어 줘야 합니다.</p>
<p>Django에서 모델은 앱 단위로 만들어지고 구성됩니다. 따라서 앞서 만들어준 <code>parsed_data</code>앱 안의 <code>models.py</code>파일을 수정해줘야 합니다.</p>
<p>이 모델 파일은 크롤링해온 데이터를 필드별로 저장하는 것이 목적입니다. 따라서 크롤링한 데이터를 파이썬이 관리할 수 있는 객체로 만들어두는 것이 중요합니다.</p>
<p>이번 가이드에서는 <a href="https://beomi.github.io/beomi.github.io_old/python/2017/01/19/HowToMakeWebCrawler.html">나만의 웹 크롤러 만들기 With Requests/BeautifulSoup</a>에서 만든 <code>parser.py</code>파일을 수정해 게시글의 title와 link를 DB에 저장해보겠습니다.</p>
<p>따라서 이번 앱의 모델에서는 title와 link라는 column을 가진 <code>BlogData</code>라는 이름의 Table을 DB에 만들면 됩니다.</p>
<blockquote>
<p>django models의 class는 DB의 Table이 됩니다.</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogData</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    link = models.URLField()</span><br></pre></td></tr></table></figure>

<p>이와 같이 만들어주면 <code>title</code>은 200글자 제한의 CharField로, <code>link</code>는 URLField로 지정됩니다.</p>
<h2 id="parsed-data-App-Makemigrations-amp-Migrate-앱-DB-반영하기"><a href="#parsed-data-App-Makemigrations-amp-Migrate-앱-DB-반영하기" class="headerlink" title="parsed_data App Makemigrations &amp; Migrate | 앱 DB 반영하기"></a>parsed_data App Makemigrations &amp; Migrate | 앱 DB 반영하기</h2><p>이제 해야 할 일은 Django가 모델을 관리하도록 하려면 <code>makemigrations</code>를 통해 DB의 변경 정보를 정리하고, <code>migrate</code>를 통해 실제 DB에 반영하는 과정을 진행해야 합니다.</p>
<blockquote>
<p>django가 설치된 가상환경에서 실행하도록 합시다. 명령어의 실행 위치는 <code>manage.py</code>파일이 있는 곳입니다.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations parsed_data</span><br><span class="line">python manage.py migrate parsed_data</span><br></pre></td></tr></table></figure>

<p>각 명령어 입력시 아래와 같이 결과가 나타난다면 성공적으로 DB에 반영된 것입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2017.58.01.png" alt="parsed_data app migration"></p>
<h1 id="크롤링-함수-만들기"><a href="#크롤링-함수-만들기" class="headerlink" title="크롤링 함수 만들기"></a>크롤링 함수 만들기</h1><h2 id="widgets-1"><a href="#widgets-1" class="headerlink" title="widgets:"></a>widgets:</h2><p><a href="https://beomi.github.io/beomi.github.io_old/python/2017/01/19/HowToMakeWebCrawler.html">나만의 웹 크롤러 만들기 With Requests/BeautifulSoup</a>에서 만든 <code>parser.py</code>파일을 수정해보겠습니다.</p>
<p>이번 파일은 <code>manage.py</code>가 있는 위치에 <code>parser.py</code>라는 이름으로 저장해보겠습니다.</p>
<blockquote>
<p>만약 <code>requests</code>와 <code>bs4</code>가 설치되어있지 않다면 pip로 설치해주세요!</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># python파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">my_titles = soup.select(</span><br><span class="line">    <span class="string">'h3 &gt; a'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">    data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'result.json'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    json.dump(data, json_file)</span><br></pre></td></tr></table></figure>

<p>이전의 <code>parser.py</code>파일은 위와 같습니다. 이제 이 파일을 <code>parse_blog</code>라는 함수로 만들고, {‘블로그 글 타이틀’: ‘블로그 글 링크’}로 이루어진 딕셔너리를 반환하도록 만들어 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>이제 <code>parse_blog</code>라는 함수를 다른 파일에서 import해 사용할 수 있습니다.</p>
<p>또한, 현재 프로젝트 폴더의 구조는 아래와 같습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.05.30.png" alt="project folder tree"></p>
<p>하지만 현재 <code>parse_blog</code>함수는 Django에 저장하는 기능을 갖고 있지 않습니다. 따라서 약간 더 추가를 해줘야 합니다.</p>
<h2 id="Django-환경-불러오기"><a href="#Django-환경-불러오기" class="headerlink" title="Django 환경 불러오기"></a>Django 환경 불러오기</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="comment"># 아래 4줄을 추가해 줍니다.</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># Python이 실행될 때 DJANGO_SETTINGS_MODULE이라는 환경 변수에 현재 프로젝트의 settings.py파일 경로를 등록합니다.</span></span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="comment"># 이제 장고를 가져와 장고 프로젝트를 사용할 수 있도록 환경을 만듭니다.</span></span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>위 코드에서 아래 4줄을 추가해 줄 경우, 이 파일을 단독으로 실행하더라도 마치 <code>manage.py</code>을 통해 django를 구동한 것과 같이 django환경을 사용할 수 있게 됩니다.</p>
<h2 id="Django-ORM으로-데이터-저장하기"><a href="#Django-ORM으로-데이터-저장하기" class="headerlink" title="Django ORM으로 데이터 저장하기"></a>Django ORM으로 데이터 저장하기</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>python manage.py shell</code>을 실행하는 것과 비슷한 방법입니다.</p>
</blockquote>
<p>이제 models에서 우리가 만든 <code>BlogData</code>를 import해 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"websaver.settings"</span>)</span><br><span class="line"><span class="keyword">import</span> django</span><br><span class="line">django.setup()</span><br><span class="line"><span class="comment"># BlogData를 import해옵니다</span></span><br><span class="line"><span class="keyword">from</span> parsed_data.models <span class="keyword">import</span> BlogData</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_blog</span><span class="params">()</span>:</span></span><br><span class="line">    req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">    html = req.text</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    my_titles = soup.select(</span><br><span class="line">        <span class="string">'h3 &gt; a'</span></span><br><span class="line">        )</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">        data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 이 명령어는 이 파일이 import가 아닌 python에서 직접 실행할 경우에만 아래 코드가 동작하도록 합니다.</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    blog_data_dict = parse_blog()</span><br><span class="line">    <span class="keyword">for</span> t, l <span class="keyword">in</span> blog_data_dict.items():</span><br><span class="line">        BlogData(title=t, link=l).save()</span><br></pre></td></tr></table></figure>

<p>위와 같이 <code>parser.py</code>를 수정한 후 터미널에서 <code>parser.py</code>파일을 실행해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python parser.py</span><br></pre></td></tr></table></figure>

<p>아무런 에러가 나지 않는다면 성공적으로 저장된 것입니다.</p>
<h2 id="저장된-데이터-Django-Admin에서-확인하기"><a href="#저장된-데이터-Django-Admin에서-확인하기" class="headerlink" title="저장된 데이터 Django Admin에서 확인하기"></a>저장된 데이터 Django Admin에서 확인하기</h2><h3 id="SuperUser-관리자계정-만들기"><a href="#SuperUser-관리자계정-만들기" class="headerlink" title="SuperUser | 관리자계정 만들기"></a>SuperUser | 관리자계정 만들기</h3><p>Django는 Django Admin이라는 강력한 기능을 제공합니다.</p>
<p>우선 Admin 계정을 만들어야 합니다. <code>createsuperuser</code> 명령어로 만들 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.18.49.png" alt="createsuperuser"></p>
<p>기본적으로 유저이름, 이메일, 비밀번호를 받습니다.</p>
<blockquote>
<p>이메일은 입력하지 않아도 됩니다.</p>
</blockquote>
<h3 id="앱에-Admin-등록하기"><a href="#앱에-Admin-등록하기" class="headerlink" title="앱에 Admin 등록하기"></a>앱에 Admin 등록하기</h3><p>Django가 어떤 앱을 admin에서 관리하도록 하려면 앱 폴더(<code>parsed_data</code>) 안의 <code>admin.py</code>파일을 수정해줘야 합니다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="comment"># models에서 BlogData를 import 해옵니다.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> BlogData</span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래의 코드를 입력하면 BlogData를 admin 페이지에서 관리할 수 있습니다.</span></span><br><span class="line">admin.site.register(BlogData)</span><br></pre></td></tr></table></figure>

<h3 id="Django-Runserver-장고-서버-실행하기"><a href="#Django-Runserver-장고-서버-실행하기" class="headerlink" title="Django Runserver | 장고 서버 실행하기"></a>Django Runserver | 장고 서버 실행하기</h3><p>이제 <code>manage.py</code>가 있는 위치에서 <code>runserver</code>명령어로 장고 개발 서버를 실행해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>아래와 같이 나타난다면 성공적으로 서버가 실행된 것입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.26.07.png" alt="django runserver"></p>
<p>이제 <a href="http://localhost:8000/admin/">http://localhost:8000/admin/</a>로 들어가 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.27.23.png" alt="Django admin login page"></p>
<p>아까 <code>createsuperuser</code>로 만든 계정으로 로그인 해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.28.09.png" alt="django admin page"></p>
<p>우리가 만든 <code>parsed_data</code>앱 안에 <code>BlogData</code>라는 항목이 나와있는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.28.54.png" alt="blogdata admin list"></p>
<p><code>BlogData object</code>라는 이름으로 데이터들이 들어와 있는 것을 확인할 수 있습니다. 하나를 클릭해 들어가 보면 아래와 같이 title와 link가 성공적으로 들어와 있는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.29.43.png" alt="blogdata specific data"></p>
<h1 id="약간-더-나아가기"><a href="#약간-더-나아가기" class="headerlink" title="약간 더 나아가기"></a>약간 더 나아가기</h1><h2 id="widgets-2"><a href="#widgets-2" class="headerlink" title="widgets:"></a>widgets:</h2><p>위에서 Admin페이지에 들어갈 때 모든 데이터들의 이름이 <code>BlogData object</code>로 나와있는 것을 볼 수 있습니다.</p>
<p>우리가 만들어 준 <code>parsed_data/models.py</code>파일의 <code>BlogData</code> Class를 살펴보면 <code>models.Model</code>클래스를 상속받아 만들었고, 이 클래스는 기본적으로 <code>ClassName + object</code>라는 값을 반환하는 <code>__str__</code>함수를 내장하고 있습니다.</p>
<p>따라서 <code>models.Model</code>을 상속받은 <code>BlogData</code>의 <code>__str__</code>함수에서는 <code>BlogData object</code>라는 값을 반환합니다. 이 <code>__str__</code>함수를 오버라이딩해 사용하면 Admin에서 데이터의 이름을 좀 더 직관적으로 알 수 있습니다.</p>
<h2 id="str-함수-오버라이딩하기"><a href="#str-함수-오버라이딩하기" class="headerlink" title="str 함수 오버라이딩하기"></a><strong>str</strong> 함수 오버라이딩하기</h2><p><code>parsed_data</code>앱 폴더 안의 <code>models.py</code>파일을 아래와 같이 수정해 봅시다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parsed_data/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogData</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    link = models.URLField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">    	<span class="keyword">return</span> self.title</span><br></pre></td></tr></table></figure>

<p>위 코드는 BlogData 데이터 객체의 <code>title</code> 값을 반환합니다.</p>
<p>이제 장고 서버를 다시 켜주고 <a href="http://localhost:8000/admin/parsed_data/blogdata/">BlogData admin page</a>로 들어가면 타이틀 이름으로 된 데이터들을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-28%2018.38.11.png" alt="title list admin page"></p>
<blockquote>
<p>현재 <code>models.py</code>파일을 수정했지만 DB에 반영되는 사항이 아니기 때문에 <code>makemigrations</code>나 <code>migrate</code>를 해줄 필요가 없습니다.</p>
</blockquote>
<h1 id="다음-가이드에서는"><a href="#다음-가이드에서는" class="headerlink" title="다음 가이드에서는.."></a>다음 가이드에서는..</h1><h2 id="widgets-3"><a href="#widgets-3" class="headerlink" title="widgets:"></a>widgets:</h2><p>다음 가이드는 <strong>주기적</strong>으로 데이터를 크롤링 해, <strong>새로운</strong> 데이터가 생기는 경우 텔레그램 봇으로 메시지 알림을 보내주는 과정을 다룰 예정입니다.</p>
<p>다음 가이드: <a href="/2017/04/20/HowToMakeWebCrawler-Notice-with-Telegram/">나만의 웹 크롤러 만들기(5): 웹페이지 업데이트를 알려주는 Telegram 봇</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-01-25-HowToMakeWebCrawler-With-Selenium/selenium1.jpg" alt="나만의 웹 크롤러 만들기(3): Selenium으로 무적 크롤러 만들기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-02-26T15:00:00.000Z">2017-02-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">나만의 웹 크롤러 만들기(3): Selenium으로 무적 크롤러 만들기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>Updated @ 2019.10.10. Typo/Layout fix, 네이버 로그인 Captcha관련 수정 추가</p>
</blockquote>
<p>이전게시글: <a href="/2017/01/20/HowToMakeWebCrawler-With-Login/">나만의 웹 크롤러 만들기(2): Login with Session</a></p>
<h2 id="Selenium이란"><a href="#Selenium이란" class="headerlink" title="Selenium이란?"></a>Selenium이란?</h2><p>Selenium은 주로 웹앱을 테스트하는데 이용하는 프레임워크다. <code>webdriver</code>라는 API를 통해 운영체제에 설치된 Chrome등의 브라우저를 제어하게 된다.</p>
<p>브라우저를 직접 동작시킨다는 것은 JavaScript를 이용해 비동기적으로 혹은 뒤늦게 불러와지는 컨텐츠들을 가져올 수 있다는 것이다. 즉, ‘눈에 보이는’ 컨텐츠라면 모두 가져올 수 있다는 뜻이다. 우리가 requests에서 사용했던 <code>.text</code>의 경우 브라우저에서 ‘소스보기’를 한 것과 같이 동작하여, JS등을 통해 동적으로 DOM이 변화한 이후의 HTML을 보여주지 않는다. 반면 Selenium은 실제 웹 브라우저가 동작하기 때문에 JS로 렌더링이 완료된 후의 DOM결과물에 접근이 가능하다.</p>
<h2 id="어떻게-설치하나"><a href="#어떻게-설치하나" class="headerlink" title="어떻게 설치하나?"></a>어떻게 설치하나?</h2><h3 id="pip-selenium-package"><a href="#pip-selenium-package" class="headerlink" title="pip selenium package"></a>pip selenium package</h3><p>Selenium을 설치하는 것은 기본적으로 <code>pip</code>를 이용한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure>

<blockquote>
<p>참고: Selenium의 버전은 자주 업데이트 되고, 브라우저의 업데이트 마다 새로운 Driver를 잡아주기 때문에 항상 최신버전을 깔아 주는 것이 좋다.</p>
</blockquote>
<p>이번 튜토리얼에서는 <code>BeautifulSoup</code>이 설치되어있다고 가정합니다.</p>
<blockquote>
<p>BeautifulSoup은 <code>pip install bs4</code>로 설치 가능합니다.</p>
</blockquote>
<h3 id="webdriver"><a href="#webdriver" class="headerlink" title="webdriver"></a>webdriver</h3><p>Selenium은 <code>webdriver</code>라는 것을 통해 디바이스에 설치된 브라우저들을 제어할 수 있다. 이번 가이드에서는 Chrome을 사용해 볼 예정이다.</p>
<h3 id="Chrome-WebDriver"><a href="#Chrome-WebDriver" class="headerlink" title="Chrome WebDriver"></a>Chrome WebDriver</h3><p>크롬을 사용하려면 로컬에 크롬이 설치되어있어야 한다.</p>
<p>그리고 크롬 드라이버를 다운로드 받아주자.</p>
<p><a href="https://sites.google.com/a/chromium.org/chromedriver/downloads">https://sites.google.com/a/chromium.org/chromedriver/downloads</a></p>
<p>글 수정일자인 2019년 10월 10일에는 크롬 77버전이 최신이며, 해당하는 크롬 드라이버를 받아야 한다.</p>
<blockquote>
<p>Update @ 2019.10.10</p>
<p>크롬에서는 현재 <code>버전별</code> 지정된 chromedriver를 받도록 안내하며, 버전에 일치하지 않는 드라이버를 사용하면 에러가 납니다.</p>
<p>현재 사용하는 크롬의 버전은 크롬 창에 👉 <code>chrome://version</code> 👈 이 URL을 주소창에 그대로 입력하면(http없이) 버전을 확인할 수 있습니다.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-10-10-085013.png" alt="스크린샷 2019-10-10 오후 5.49.07"></p>
</blockquote>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-10-10-085538.png" alt="스크린샷 2019-10-10 오후 5.53.25"></p>
<p>버전을 클릭하면 아래와 같은 OS별 Driver파일이 나열되어있다. 사용하는 OS에 따른 driver를 받아주자.</p>
<p><img src="https://beomi-tech-blog.s3.amazonaws.com/img/2019-10-10-085753.png" alt="스크린샷 2019-10-10 오후 5.56.03"></p>
<p>zip파일을 받고 풀어주면 <code>chromedriver</code>라는 파일이 저장된다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2021.41.17.png" alt=""></p>
<p>위 폴더를 기준으로 할 경우 <code>/Users/beomi/Downloads/chromedriver</code>가 크롬드라이버 파일의 위치가 된다.</p>
<p>이 경로를 나중에 Selenium 객체를 생성할 때 지정해 주어야 한다. (그래야 python이 chromedriver를 통해 크롬 브라우저를 조작할 수 있다!)</p>
<h3 id="PhantomJS-webdriver"><a href="#PhantomJS-webdriver" class="headerlink" title="PhantomJS webdriver"></a>PhantomJS webdriver</h3><blockquote>
<p>단, 2018년+ 기준 PhantomJS는 더이상 개발되지 않고 있기 때문에 앞으로는 크롬의 <code>headless</code>모드를 사용하는 것을 추천합니다.</p>
</blockquote>
<p>PhantomJS는 기본적으로 WebTesting을 위해 나온 Headless Browser다.(즉, 화면이 존재하지 않는다)</p>
<p>하지만 JS등의 처리를 온전하게 해주며 CLI환경에서도 사용이 가능하기 때문에, 만약 CLI서버 환경에서 돌아가는 크롤러라면 PhantomJS를 사용하는 것도 방법이다.</p>
<p>PhantomJS는 공식 프로젝트의 <a href="http://phantomjs.org/download.html">PhantomJS Download Page</a>에서 받을 수 있다.</p>
<p>Binary 자체로 제공되기 때문에, Linux를 제외한 OS에서는 외부 dependency없이 바로 실행할 수 있다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2021.47.01.png" alt="Extracted PhantomJS Zip file"></p>
<p>압축을 풀어주면 아래와 같은 많은 파일들이 있지만, 우리가 사용하는 것은 <code>bin</code>폴더 안의 <code>phantomjs</code>파일이다.</p>
<p>위 폴더 기준으로 할 경우 <code>/Users/beomi/Downloads/phantomjs-2.1.1-macosx/bin/phantomjs</code>가 PhantomJS드라이버의 위치다.</p>
<h2 id="Selenium으로-사이트-브라우징"><a href="#Selenium으로-사이트-브라우징" class="headerlink" title="Selenium으로 사이트 브라우징"></a>Selenium으로 사이트 브라우징</h2><p>Selenium은 <code>webdriver api</code>를 통해 브라우저를 제어한다.</p>
<p>우선 <code>webdriver</code>를 import해주자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br></pre></td></tr></table></figure>

<p>이제 <code>driver</code>라는 이름의 webdriver 객체를 만들어 주자.</p>
<blockquote>
<p>이름이 꼭 <code>driver</code>일 필요는 없다.</p>
<p>이번 가이드에서는 크롬을 기본적으로 이용할 예정이다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line"><span class="comment"># Chrome의 경우 | 아까 받은 chromedriver의 위치를 지정해준다.</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line"><span class="comment"># PhantomJS의 경우 | 아까 받은 PhantomJS의 위치를 지정해준다.</span></span><br><span class="line"><span class="comment"># driver = webdriver.PhantomJS('/Users/beomi/Downloads/phantomjs-2.1.1-macosx/bin/phantomjs')</span></span><br></pre></td></tr></table></figure>

<p>Selenium은 기본적으로 웹 자원들이 모두 로드될때까지 기다려주지만, 암묵적으로 모든 자원이 로드될때 까지 기다리게 하는 시간을 직접 <code>implicitly_wait</code>을 통해 지정할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line"><span class="comment"># 암묵적으로 웹 자원 로드를 위해 3초까지 기다려 준다.</span></span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>이제 특정 url로 브라우저를 켜 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># url에 접근한다.</span></span><br><span class="line">driver.get(<span class="string">'https://google.com'</span>)</span><br></pre></td></tr></table></figure>

<p>만약 chromedriver의 위치가 정확하다면 새 크롬 화면이 뜨고 구글 첫 화면으로 들어가질 것이다.</p>
<p>Selenium은 driver객체를 통해 여러가지 메소드를 제공한다.</p>
<blockquote>
<p>아래의 메소드들은 보통 <code>driver.~~~</code> 방식으로 사용합니다.</p>
</blockquote>
<p>URL에 접근하는 메소드,</p>
<ul>
<li><code>get(&#39;http://url.com&#39;)</code></li>
</ul>
<p>페이지의 단일 element에 접근하는 메소드,</p>
<ul>
<li><code>find_element_by_name(&#39;HTML_name&#39;)</code></li>
<li><code>find_element_by_id(&#39;HTML_id&#39;)</code></li>
<li><code>find_element_by_xpath(&#39;/html/body/some/xpath&#39;)</code></li>
<li><code>find_element_by_css_selector(&#39;#css &gt; div.selector&#39;)</code></li>
<li><code>find_element_by_class_name(&#39;some_class_name&#39;)</code></li>
<li><code>find_element_by_tag_name(&#39;h1&#39;)</code></li>
</ul>
<p>페이지의 여러 elements에 접근하는 메소드 등이 있다. (대부분 <code>element</code> 를 <code>elements</code> 로 바꾸기만 하면 된다.)</p>
<ul>
<li><code>find_elements_by_css_selector(&#39;#css &gt; div.selector&#39;)</code></li>
</ul>
<p>위 메소드들을 활용시 HTML을 브라우저에서 파싱해주기 때문에 굳이 Python와 BeautifulSoup을 사용하지 않아도 된다.</p>
<p>하지만 Selenium에 내장된 함수만 사용가능하기 때문에 좀더 사용이 편리한 soup객체를 이용하려면 <code>driver.page_source</code> API를 이용해 현재 렌더링 된 페이지의 Elements를 모두 가져올 수 있다.</p>
<blockquote>
<p><code>driver.page_source</code>: 브라우저에 보이는 그대로의 HTML, 크롬 개발자 도구의 <code>Element</code> 탭 내용과 동일.</p>
<p><code>requests</code> 통해 가져온 <code>req.text</code>: HTTP요청 결과로 받아온 HTML, 크롬 개발자 도구의 <code>페이지 소스</code> 내용과 동일.</p>
<p>위 2개는 사이트에 따라 같을수도 다를수도 있습니다.</p>
</blockquote>
<h2 id="네이버-로그인-하기"><a href="#네이버-로그인-하기" class="headerlink" title="네이버 로그인 하기"></a>네이버 로그인 하기</h2><p>네이버는 requests를 이용해 로그인하는 것이 어렵다. 프론트 단에서 JS처리를 통해 로그인 처리를 하기 때문인데, Selenium을 이용하면 보다 쉽게 로그인을 할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># url에 접근한다.</span></span><br><span class="line">driver.get(<span class="string">'https://nid.naver.com/nidlogin.login'</span>)</span><br></pre></td></tr></table></figure>

<p>네이버 로그인 화면을 확인 해 보면 아이디를 입력받는 부분의 name이 <code>id</code>, ​비밀번호를 입력받는 부분의 name이 <code>pw</code>인 것을 알 수 있다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2022.19.18.png" alt="Naver Login Page"></p>
<p><code>find_element_by_name</code>을 통해 아이디/비밀번호 input 태그를 잡아주고, 값을 입력해 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get(<span class="string">'https://nid.naver.com/nidlogin.login'</span>)</span><br><span class="line"><span class="comment"># 아이디/비밀번호를 입력해준다.</span></span><br><span class="line">driver.find_element_by_name(<span class="string">'id'</span>).send_keys(<span class="string">'naver_id'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'pw'</span>).send_keys(<span class="string">'mypassword1234'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2022.23.11.png" alt="Naver Login Input"></p>
<p>성공적으로 값이 입력된 것을 확인할 수 있다.</p>
<p>이제 Login버튼을 눌러 실제로 로그인이 되는지 확인해 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get(<span class="string">'https://nid.naver.com/nidlogin.login'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'id'</span>).send_keys(<span class="string">'naver_id'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'pw'</span>).send_keys(<span class="string">'mypassword1234'</span>)</span><br><span class="line"><span class="comment"># 로그인 버튼을 눌러주자.</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="frmNIDLogin"]/fieldset/input'</span>).click()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Update @ 2019.10.10.</p>
</blockquote>
<p>하지만 로그인이 이전처럼 잘 되지 않고 Captcha를 요구하는 창이 뜰 수 있다.</p>
<p>네이버에서 </p>
<p>성공적으로 로그인이 되는 것을 확인할 수 있다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2022.28.00.png" alt="Naver Login Success"></p>
<p>로그인이 필요한 페이지인 네이버 페이의 주문내역 페이지를 가져와보자.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2022.38.43.png" alt="Naver Pay Order"></p>
<p>네이버 페이의 Url은 <code>https://order.pay.naver.com/home</code> 이다. 위 페이지의 알림 텍스트를 가져와 보자.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>)</span><br><span class="line">driver.get(<span class="string">'https://nid.naver.com/nidlogin.login'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'id'</span>).send_keys(<span class="string">'naver_id'</span>)</span><br><span class="line">driver.find_element_by_name(<span class="string">'pw'</span>).send_keys(<span class="string">'mypassword1234'</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">'//*[@id="frmNIDLogin"]/fieldset/input'</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Naver 페이 들어가기</span></span><br><span class="line">driver.get(<span class="string">'https://order.pay.naver.com/home'</span>)</span><br><span class="line">html = driver.page_source</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">notices = soup.select(<span class="string">'div.p_inr &gt; div.p_info &gt; a &gt; span'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> notices:</span><br><span class="line">    print(n.text.strip())</span><br></pre></td></tr></table></figure>

<p>로그인이 잘 되고, 성공적으로 리스트를 받아오는 것을 확인해 볼 수 있다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-02-27%2022.41.46.png" alt="Result"></p>
<h2 id="정리하기"><a href="#정리하기" class="headerlink" title="정리하기"></a>정리하기</h2><p>Selenium은 웹 테스트 자동화 도구이지만, 멋진 크롤링 도구로 사용할 수 있다.</p>
<p>또한, BeautifulSoup와 함께 사용도 가능하기 때문에 크롤링을 하는데 제약도 줄어 훨씬 쉽게 크롤링을 할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># setup Driver|Chrome : 크롬드라이버를 사용하는 driver 생성</span></span><br><span class="line">driver = webdriver.Chrome(<span class="string">'/Users/beomi/Downloads/chromedriver'</span>)</span><br><span class="line">driver.implicitly_wait(<span class="number">3</span>) <span class="comment"># 암묵적으로 웹 자원을 (최대) 3초 기다리기</span></span><br><span class="line"><span class="comment"># Login</span></span><br><span class="line">driver.get(<span class="string">'https://nid.naver.com/nidlogin.login'</span>) <span class="comment"># 네이버 로그인 URL로 이동하기</span></span><br><span class="line">driver.find_element_by_name(<span class="string">'id'</span>).send_keys(<span class="string">'naver_id'</span>) <span class="comment"># 값 입력</span></span><br><span class="line">driver.find_element_by_name(<span class="string">'pw'</span>).send_keys(<span class="string">'mypassword1234'</span>)</span><br><span class="line">driver.find_element_by_xpath(</span><br><span class="line">    <span class="string">'//*[@id="frmNIDLogin"]/fieldset/input'</span></span><br><span class="line">).click() <span class="comment"># 버튼클릭하기</span></span><br><span class="line">driver.get(<span class="string">'https://order.pay.naver.com/home'</span>) <span class="comment"># Naver 페이 들어가기</span></span><br><span class="line">html = driver.page_source <span class="comment"># 페이지의 elements모두 가져오기</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>) <span class="comment"># BeautifulSoup사용하기</span></span><br><span class="line">notices = soup.select(<span class="string">'div.p_inr &gt; div.p_info &gt; a &gt; span'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> notices:</span><br><span class="line">    print(n.text.strip())</span><br></pre></td></tr></table></figure>

<h2 id="다음-가이드"><a href="#다음-가이드" class="headerlink" title="다음 가이드"></a>다음 가이드</h2><p>Selenium으로 많은 사이트에서 여러 정보를 가져와 볼 수 있게 되었습니다. </p>
<p>하지만 가져온 데이터를 DB에 저장하려면 약간의 어려움이 따르게 됩니다.</p>
<p>다음 시간에는 Django의 ORM을 이용해 sqlite3 DB에 데이터를 저장해보는 방법에 대해 알아보겠습니다.</p>
<p>다음 가이드: <a href="/2017/03/01/HowToMakeWebCrawler-Save-with-Django/">나만의 웹 크롤러 만들기(4): Django로 크롤링한 데이터 저장하기</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/01/20/HowToMakeWebCrawler/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-01-19-HowToMakeWebCrawler/crawler.jpg" alt="나만의 웹 크롤러 만들기 with Requests/BeautifulSoup">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-01-19T15:00:00.000Z">2017-01-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/01/20/HowToMakeWebCrawler/">나만의 웹 크롤러 만들기 with Requests/BeautifulSoup</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>(@2017.03.18) 본 블로그 테마가 업데이트되면서 구 블로그의 URL은 <a href="https://beomi.github.io/beomi.github.io_old/로">https://beomi.github.io/beomi.github.io_old/로</a> 변경되었습니다. 예제 코드에서는 변경을 완료하였지만 캡쳐 화면은 변경하지 않았으니 유의 바랍니다.</p>
</blockquote>
<h1 id="웹-크롤러란"><a href="#웹-크롤러란" class="headerlink" title="웹 크롤러란?"></a>웹 크롤러란?</h1><p>우리가 어떤 정보를 브라우저에서만 보는 것 뿐 아니라 그 정보들을 내가 이용하기 편한 방식(ex: json)으로 로컬에 저장하고 싶을 때가 있다.</p>
<p><a href="https://www.httrack.com/">HTTrack</a>의 경우에는 웹을 그대로 자신의 컴퓨터로 복사를 해오지만, 내가 원하는 방식으로의 가공까지는 제공해주지 않는다.</p>
<p>Python을 이용하면 간단한 코드 몇줄 만으로도 쉽게 웹 사이트에서 원하는 정보만을 가져올 수 있다.</p>
<h1 id="웹에서-정보-가져오기"><a href="#웹에서-정보-가져오기" class="headerlink" title="웹에서 정보 가져오기"></a>웹에서 정보 가져오기</h1><h2 id="Requests"><a href="#Requests" class="headerlink" title="Requests"></a>Requests</h2><p>Python에는 <code>requests</code>라는 유명한 http request 라이브러리가 있다.</p>
<h3 id="설치하기"><a href="#설치하기" class="headerlink" title="설치하기"></a>설치하기</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></table></figure>

<p>pip로 간단하게 설치가 가능하다.</p>
<h3 id="이용방법"><a href="#이용방법" class="headerlink" title="이용방법"></a>이용방법</h3><p>Python 파일 하나(ex: parser.py)를 만들어 <code>requests</code>를 import 해준다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP GET Request</span></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTML 소스 가져오기</span></span><br><span class="line">html = req.text</span><br><span class="line"><span class="comment"># HTTP Header 가져오기</span></span><br><span class="line">header = req.headers</span><br><span class="line"><span class="comment"># HTTP Status 가져오기 (200: 정상)</span></span><br><span class="line">status = req.status_code</span><br><span class="line"><span class="comment"># HTTP가 정상적으로 되었는지 (True/False)</span></span><br><span class="line">is_ok = req.ok</span><br></pre></td></tr></table></figure>

<p>위 코드에서 우리가 사용할 것은 HTML 소스를 이용하는 것이다. 따라서 <code>html=req.text</code>를 이용한다.</p>
<h2 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h2><p>Requests는 정말 좋은 라이브러리이지만, html을 ‘의미있는’, 즉 Python이 이해하는 객체 구조로 만들어주지는 못한다. 위에서 req.text는 python의 문자열(str)객체를 반환할 뿐이기 때문에 정보를 추출하기가 어렵다.</p>
<p>따라서 <code>BeautifulSoup</code>을 이용하게 된다. 이 BeautifulSoup은 html 코드를 Python이 이해하는 객체 구조로 변환하는 Parsing을 맡고 있고, 이 라이브러리를 이용해 우리는 제대로 된 ‘의미있는’ 정보를 추출해 낼 수 있다.</p>
<h3 id="설치하기-1"><a href="#설치하기-1" class="headerlink" title="설치하기"></a>설치하기</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install bs4</span><br></pre></td></tr></table></figure>

<p>BeautifulSoup을 직접 쳐서 설치하는 것도 가능하지만, bs4라는 wrapper라이브러리를 통해 설치하는 방법이 더 쉽고 안전하다.</p>
<h3 id="이용방법-1"><a href="#이용방법-1" class="headerlink" title="이용방법"></a>이용방법</h3><p>위에서 이용한 parser.py파일을 좀 더 다듬어 보자.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP GET Request</span></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line"><span class="comment"># HTML 소스 가져오기</span></span><br><span class="line">html = req.text</span><br><span class="line"><span class="comment"># BeautifulSoup으로 html소스를 python객체로 변환하기</span></span><br><span class="line"><span class="comment"># 첫 인자는 html소스코드, 두 번째 인자는 어떤 parser를 이용할지 명시.</span></span><br><span class="line"><span class="comment"># 이 글에서는 Python 내장 html.parser를 이용했다.</span></span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br></pre></td></tr></table></figure>

<p>이제 <code>soup</code> 객체에서 원하는 정보를 찾아낼 수 있다.</p>
<p>BeautifulSoup에서는 여러가지 기능을 제공하는데, 여기서는 <code>select</code>를 이용한다. <code>select</code>는 CSS Selector를 이용해 조건과 일치하는 모든 객체들을 List로 반환해준다.</p>
<p>예시로 이 블로그의 모든 제목을 가져와 보도록 하자.</p>
<p align="center">
<img src="/img/2017-01-19-HowToMakeWebCrawler/blog_page.png"/>
</p>

<p>크롬에 내장된 검사도구(요소 위에서 우측 클릭 후 검사)를 이용해보면 현재 title은 a 태그로 구성되어있다는 것을 알 수 있다. 이 상황에서 모든 a 태그를 가져올 수도 있지만, 보다 정확하게 가져오기 위해 CSS Selector를 확인해 보자.</p>
<p align="center">
<img src="/img/2017-01-19-HowToMakeWebCrawler/blog_css_selector.png"/>
</p>

<p>확인해보니 아래와 같은 코드가 나왔다.</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &gt; <span class="selector-tag">h3</span><span class="selector-pseudo">:nth-child(4)</span> &gt; <span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>

<p>하지만 <code>:nth-child(4)</code> 등이 붙어있는 것으로 보아 현재 요소를 ‘정확하게’ 특정하고 있기 때문에, 좀 더 유연하게 만들어 주기 위해 아래와 같이 selector를 바꿔준다.(위 코드는 단 하나의 링크만을 특정하고, 아래 코드는 css selector에 일치하는 모든 요소를 가리킨다.)</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h3</span> &gt; <span class="selector-tag">a</span></span><br></pre></td></tr></table></figure>

<p>이제 parsing.py파일을 더 다듬어 보자.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line"><span class="comment"># CSS Selector를 통해 html요소들을 찾아낸다.</span></span><br><span class="line">my_titles = soup.select(</span><br><span class="line">    <span class="string">'h3 &gt; a'</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>위 코드에서 my_titles는 string의 list가 아니라 soup객체들의 list이다. 따라서 태그의 속성들도 이용할 수 있는데, a 태그의 경우 href속성이 대표적인 예시다.</p>
<p>soup객체는 &lt;태그&gt;&lt;/태그&gt;로 구성된 요소를 Python이 이해하는 상태로 바꾼 것이라 볼 수 있다. 따라서 여러가지로 조작이 가능하다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">my_titles = soup.select(</span><br><span class="line">    <span class="string">'h3 &gt; a'</span></span><br><span class="line">    )</span><br><span class="line"><span class="comment"># my_titles는 list 객체</span></span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">    <span class="comment"># Tag안의 텍스트</span></span><br><span class="line">    print(title.text)</span><br><span class="line">    <span class="comment"># Tag의 속성을 가져오기(ex: href속성)</span></span><br><span class="line">    print(title.get(<span class="string">'href'</span>))</span><br></pre></td></tr></table></figure>

<p>위와 같이 코드를 처리할 경우 a 태그 안의 텍스트와 a 태그의 href속성의 값을 가져오게 된다. 위 코드에서 title 객체는 python의 dictionary와 같이 태그의 속성들을 저장한다. 따라서 <code>title.get(&#39;속성이름&#39;)</code>나 <code>title[&#39;속성이름&#39;]</code>처럼 이용할 수 있다.</p>
<p><code>select</code>를 통해 요소들을 가져온 이후에는 각자가 생각하는 방식으로 python코드를 이용해 저장하면 된다.</p>
<h2 id="정리-예제"><a href="#정리-예제" class="headerlink" title="정리 예제"></a>정리 예제</h2><p>아래 코드는 크롤링한 데이터를 Python파일와 같은 위치에 <code>result.json</code>을 만들어 저장하는 예제다.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># python파일의 위치</span></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">'https://beomi.github.io/beomi.github.io_old/'</span>)</span><br><span class="line">html = req.text</span><br><span class="line">soup = BeautifulSoup(html, <span class="string">'html.parser'</span>)</span><br><span class="line">my_titles = soup.select(</span><br><span class="line">    <span class="string">'h3 &gt; a'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">data = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> title <span class="keyword">in</span> my_titles:</span><br><span class="line">    data[title.text] = title.get(<span class="string">'href'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(os.path.join(BASE_DIR, <span class="string">'result.json'</span>), <span class="string">'w+'</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    json.dump(data, json_file)</span><br></pre></td></tr></table></figure>

<h1 id="다음-가이드"><a href="#다음-가이드" class="headerlink" title="다음 가이드"></a>다음 가이드</h1><p>다음 가이드에서는 <code>Session</code>을 이용해 어떻게 웹 사이트에 로그인을 하고, 로그인 상태를 유지하며 브라우징을 하는지에 대해 알아보겠습니다.</p>
<p>다음 가이드: <a href="/2017/01/20/HowToMakeWebCrawler-With-Login/">나만의 웹 크롤러 만들기(2): Login With Session</a></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/01/20/HowToMakeWebCrawler-With-Login/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-01-20-HowToMakeWebCrawler-With-Login/httpcookie.jpg" alt="나만의 웹 크롤러 만들기(2): Login with Session">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-01-19T15:00:00.000Z">2017-01-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/howtomakewebcrawler/">howtomakewebcrawler</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/01/20/HowToMakeWebCrawler-With-Login/">나만의 웹 크롤러 만들기(2): Login with Session</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>좀 더 보기 편한 <a href="https://beomi.github.io/gb-crawling/">깃북 버전의 나만의 웹 크롤러 만들기</a>가 나왔습니다!</p>
</blockquote>
<blockquote>
<p>이전게시글: <a href="/2017/01/20/HowToMakeWebCrawler/">나만의 웹 크롤러 만들기 with Requests/BeautifulSoup</a></p>
</blockquote>
<blockquote>
<p>@2017.07.12 Update: 뉴클리앙으로 업데이트 됨에 따라 코드와 스크린샷이 업데이트 되었습니다.</p>
</blockquote>
<p>웹 사이트를 로그인 하는데 있어 쿠키와 세션을 빼놓고 이야기하는 것은 불가능합니다.</p>
<p>이번 포스팅에서는 requests모듈을 이용해 로그인이 필요한 웹 사이트를 크롤링 하는 예제를 다룹니다.</p>
<h2 id="쿠키-Cookie-세션-Session"><a href="#쿠키-Cookie-세션-Session" class="headerlink" title="쿠키(Cookie)? 세션(Session)?"></a>쿠키(Cookie)? 세션(Session)?</h2><p>웹은 대다수가 HTTP기반으로 동작합니다. 하지만 HTTP가 구현된 방식에서 웹 서버와 클라이언트는 지속적으로 연결을 유지한 상태가 아니라 요청(request)-응답(response)의 반복일 뿐이기 때문에, 이전 요청과 새로운 요청이 같은 사용자(같은 브라우저)에서 이루어졌는지를 확인하는 방법이 필요합니다. 이 때 등장하는 것이 ‘쿠키’와 ‘세션’입니다.</p>
<p>쿠키는 유저가 웹 사이트를 방문할 때 사용자의 브라우저에 심겨지는 작은 파일인데, Key - Value 형식으로 로컬 브라우저에 저장됩니다. 서버는 이 쿠키의 정보를 읽어 HTTP 요청에 대해 브라우저를 식별합니다.</p>
<p>그러나, 쿠키는 로컬에 저장된다는 근원적인 문제로 인해 악의적 사용자가 쿠키를 변조하거나 탈취해 정상적이지 않은 쿠키로 서버에 요청을 보낼 수 있습니다. 만약 ‘로그인 하였음’이라는 식별을, 로컬 쿠키만을 신뢰해 로그인을 한 상태로 서버가 인식한다면 쿠키 변조를 통해 마치 관리자나 다른 유저처럼 행동할 수도 있는 것이죠.(굉장히 위험합니다.)</p>
<p>이로 인해 서버측에서 클라이언트를 식별하는 ‘세션’을 주로 이용하게 됩니다.</p>
<p>세션은 브라우저가 웹 서버에 요청을 한 경우 서버 내에 해당 세션 정보를 파일이나 DB에 저장하고 클라이언트의 브라우저에 session-id라는 임의의 긴 문자열을 줍니다. 이때 사용되는 쿠키는 클라이언트와 서버간 연결이 끊어진 경우 삭제되는 메모리 쿠키를 이용합니다.</p>
<h2 id="Requests의-Session"><a href="#Requests의-Session" class="headerlink" title="Requests의 Session"></a>Requests의 Session</h2><p>이전 게시글에서 다룬 requests모듈에는 Session이라는 도구가 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성</span></span><br><span class="line">s = requests.Session()</span><br></pre></td></tr></table></figure>

<p>Session은 위와 같은 방식으로 만들 수 있습니다.</p>
<p>이렇게 만들어진 세션은 이전 게시글에서의 <code>requests</code>위치를 대신하는데, 이전 게시글의 코드를 바꿔본다면 아래와 같습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTP GET Request: requests대신 s 객체를 사용한다.</span></span><br><span class="line">req = s.get(<span class="string">'https://www.clien.net/service/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTML 소스 가져오기</span></span><br><span class="line">html = req.text</span><br><span class="line"><span class="comment"># HTTP Header 가져오기</span></span><br><span class="line">header = req.headers</span><br><span class="line"><span class="comment"># HTTP Status 가져오기 (200: 정상)</span></span><br><span class="line">status = req.status_code</span><br><span class="line"><span class="comment"># HTTP가 정상적으로 되었는지 (True/False)</span></span><br><span class="line">is_ok = req.ok</span><br></pre></td></tr></table></figure>

<p>코드를 with구문을 사용해 좀 더 정리하면 아래와 같습니다. 위 코드와 아래코드는 정확히 동일하게 동작하지만, 위쪽 코드의 경우 Session이 가끔 풀리는 경우가 있어 (5번중 한번 꼴) 아래 코드로 진행하는 것을 추천합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성, with 구문 안에서 유지</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># HTTP GET Request: requests대신 s 객체를 사용한다.</span></span><br><span class="line">    req = s.get(<span class="string">'https://www.clien.net/service/'</span>)</span><br><span class="line">    <span class="comment"># HTML 소스 가져오기</span></span><br><span class="line">    html = req.text</span><br><span class="line">    <span class="comment"># HTTP Header 가져오기</span></span><br><span class="line">    header = req.headers</span><br><span class="line">    <span class="comment"># HTTP Status 가져오기 (200: 정상)</span></span><br><span class="line">    status = req.status_code</span><br><span class="line">    <span class="comment"># HTTP가 정상적으로 되었는지 (True/False)</span></span><br><span class="line">    is_ok = req.ok</span><br></pre></td></tr></table></figure>

<h2 id="로그인하기"><a href="#로그인하기" class="headerlink" title="로그인하기"></a>로그인하기</h2><p>로그인을 구현하기 위한 예시로 클리앙에 로그인 해 클리앙 장터를 크롤링 해 봅시다.</p>
<p align="center">
<img src="/img/dropbox/Screenshot%202017-07-12%2021.18.52.png?dl=1" />
</p>

<p>크롬 개발자 도구 중 Inspect(검사)를 이용해 로그인 폼 필드의 <code>name</code>값들을 알아봅시다.(폼 위에서 마우스 오른쪽 버튼을 클릭하고 <code>검사</code>를 눌러주세요.)</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-07-12%2021.20.53.png" alt=""></p>
<p>아래 스크린샷 우측을 확인해 봅시다. <code>form</code> 태그 안에 <code>input</code>필드가 여러개가 있는 것을 알 수 있습니다.</p>
<p align="center">
<img src="/img/dropbox/Screenshot%202017-07-12%2021.22.33.png?dl=1" />
</p>

<p>조금 더 상세하게 뜯어봅시다. 아래 스크린샷을 보시면 <code>input</code>필드들의 <code>name</code>이 <code>_csrf</code>,<code>userID</code>,<code>userPassword</code>,<code>remember-me</code>가 있는 것을 볼 수 있습니다. 또한, 로그인 버튼을 누르면 <code>auth.login()</code>라는 자바스크립트 함수가 먼저 실행되는 것을 볼 수 있습니다.</p>
<p align="center">
    <img src="/img/dropbox/Screenshot%202017-07-12%2021.26.02.png?dl=1">
</p>

<p>로그인을 구현하기 전, HTML form에 대해 간단하게 알아봅시다.</p>
<p>HTML form Field에서는 <code>name:입력값</code>이라는 Key:Value식으로 데이터를 전달합니다.(주로 POST방식)</p>
<p>클리앙 로그인 폼 필드의 경우 <code>userID:사용자id</code>, <code>userPassword:사용자pw</code>라는 세트로 입력을 받는 것을 볼 수 있습니다.</p>
<p>그리고 약간 특이해 보이는 <code>_csrf</code>이라는 것도 있습니다. 원래 CSRF는 사용자의 요청이 악의적이거나 제 3자에 의해 변조된(해킹된) 요청이 아닌지 확인해주는 보안 도구중 하나입니다. 세션과 연결되어 폼을 전달할때 폼의 안정성을 높여줍니다. 새로고침하시면 매번 달라지는 CSRF값을 보실 수 있습니다. 그리고 CSRF를 사용하는 경우 CSRF값이 없는 폼 전송은 위험한 요청으로 생각하고 폼을 받아들이지 않습니다.(즉, 로그인이 되지 않습니다.) 따라서 우리는 <code>_csrf</code>라는 것도 함께 전송해 줘야 합니다. 따라서 메인 화면을 먼저 가져와 <code>_csrf</code>필드를 가져오고 로그인을 해야 합니다.</p>
<blockquote>
<p>이전 클리앙은 CSRF검증이 없었습니다. 이번 업데이트를 하면서 클리앙의 보안이 전반적으로 올라갔습니다. 좋은 변화입니다!</p>
</blockquote>
<p>다음으로는 <code>auth.login()</code>이라는 함수를 살펴봅시다. 함수를 살펴보면 그냥 입력 유무만 확인하는 심플한 함수입니다. 사실 이것보다 더 길지만, 실제로 <code>login</code>함수에서 사용되는 코드 부분은 이부분이 전부이기 때문에 뒷부분을 잘랐습니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Auth</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>; <span class="comment">// _this에 Auth라는 함수를 넣었습니다.</span></span><br><span class="line">    _this.env = &#123;&#125;;</span><br><span class="line">    _this.env.form = $(<span class="string">'#loginForm'</span>); <span class="comment">// 로그인 폼입니다. id, pw, _csrf 등을 받는다고 위에서 확인했죠?</span></span><br><span class="line">    _this.env.iptUserId = _this.env.form.find(<span class="string">'*[name=userId]'</span>); <span class="comment">// 사용자가 폼에 입력한 ID입니다.</span></span><br><span class="line">    _this.env.iptUserPassWord = _this.env.form.find(<span class="string">'*[name=userPassword]'</span>); <span class="comment">// 사용자가 폼에 입력한 PW입니다.</span></span><br><span class="line"></span><br><span class="line">    _this.loginValidate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> isValid = <span class="literal">true</span>; <span class="comment">// 아무 문제가 없다면(id나 pw가 빈칸이 아니라면) true를 반환하는 함수입니다.</span></span><br><span class="line">        <span class="keyword">if</span> (_this.env.iptUserId.val().trim() == <span class="string">''</span>) &#123; <span class="comment">// 아이디가 빈칸이면 false죠?</span></span><br><span class="line">            alert(<span class="string">'아이디를 입력하세요.'</span>);</span><br><span class="line">            _this.env.iptUserId.focus();</span><br><span class="line">            isValid = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> isValid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (_this.env.iptUserPassWord.val().trim() == <span class="string">''</span>) &#123; <span class="comment">// 비번이 빈칸이어도 false가 됩니다.</span></span><br><span class="line">            alert(<span class="string">'비밀번호를 입력하세요.'</span>);</span><br><span class="line">            _this.env.iptUserPassWord.focus();</span><br><span class="line">            isValid = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> isValid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isValid;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    _this.login = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> isValid = _this.loginValidate(); <span class="comment">// 방금 본 아이디/비번이 빈칸인지 확인하기</span></span><br><span class="line">        <span class="keyword">if</span> (isValid) &#123; <span class="comment">// 빈칸이 아니라면 -&gt;</span></span><br><span class="line">            _this.env.form.attr(&#123; <span class="comment">// 폼 속성을 정의해 줍시다.</span></span><br><span class="line">                method: <span class="string">'POST'</span>, <span class="comment">// 폼 전송 방식은 'POST'이고,</span></span><br><span class="line">                action: BASE_URL + <span class="string">'/login'</span> <span class="comment">// 폼 전송하는 주소는 https://www.clien.net/service/login 이네요!</span></span><br><span class="line">            &#125;);</span><br><span class="line">            _this.env.form.submit(); <span class="comment">// 진짜로 폼을 전송해줍니다.</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 자바스크립트 코드에서 알게된 것은 아이디와 비밀번호 폼에 빈칸이 없다면 <code>POST</code>방식으로 <code>https://www.clien.net/service/login</code>에 폼을 전송해 로그인을 한다는 것입니다.</p>
<p>한번 이 주소에 폼 값들만 넣어서 전송해 봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그인할 유저정보를 넣어주자 (모두 문자열)</span></span><br><span class="line">LOGIN_INFO = &#123;</span><br><span class="line">    <span class="string">'userId'</span>: <span class="string">'사용자이름'</span>,</span><br><span class="line">    <span class="string">'userPassword'</span>: <span class="string">'사용자패스워드'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성, with 구문 안에서 유지</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># HTTP POST request: 로그인을 위해 POST url와 함께 전송될 data를 넣어주자.</span></span><br><span class="line">    login_req = s.post(<span class="string">'https://www.clien.net/service/login'</span>, data=LOGIN_INFO)</span><br><span class="line">    <span class="comment"># 어떤 결과가 나올까요?</span></span><br><span class="line">    print(login_req.status_code)</span><br></pre></td></tr></table></figure>

<p>이런! 404가 나와버렸네요. 제대로 로그인이 되지 않은 것 같아요. 아마 <code>_csrf</code>값이 없어서가 아닐까요?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; python parsing.py</span><br><span class="line">404</span><br></pre></td></tr></table></figure>

<p>그렇다면 코드를 조금 더 수정해 봅시다. 우선 클리앙 공식 홈페이지에 들어가 form에 들어있는 <code>_csrf</code>값을 가져와 봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그인할 유저정보를 넣어줍시다. (모두 문자열입니다!)</span></span><br><span class="line">LOGIN_INFO = &#123;</span><br><span class="line">    <span class="string">'userId'</span>: <span class="string">'myidid'</span>,</span><br><span class="line">    <span class="string">'userPassword'</span>: <span class="string">'mypassword123'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성, with 구문 안에서 유지</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># 우선 클리앙 홈페이지에 들어가 봅시다.</span></span><br><span class="line">    first_page = s.get(<span class="string">'https://www.clien.net/service'</span>)</span><br><span class="line">    html = first_page.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    csrf = soup.find(<span class="string">'input'</span>, &#123;<span class="string">'name'</span>: <span class="string">'_csrf'</span>&#125;) <span class="comment"># input태그 중에서 name이 _csrf인 것을 찾습니다.</span></span><br><span class="line">    print(csrf[<span class="string">'value'</span>]) <span class="comment"># 위에서 찾은 태그의 value를 가져옵니다.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이제 LOGIN_INFO에 csrf값을 넣어줍시다.</span></span><br><span class="line">    <span class="comment"># (p.s.)Python3에서 두 dict를 합치는 방법은 &#123;**dict1, **dict2&#125; 으로 dict들을 unpacking하는 것입니다.</span></span><br><span class="line">    LOGIN_INFO = &#123;**LOGIN_INFO, **&#123;<span class="string">'_csrf'</span>: csrf[<span class="string">'value'</span>]&#125;&#125;</span><br><span class="line">    print(LOGIN_INFO)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이제 다시 로그인을 해봅시다.</span></span><br><span class="line">    login_req = s.post(<span class="string">'https://www.clien.net/service/login'</span>, data=LOGIN_INFO)</span><br><span class="line">    <span class="comment"># 어떤 결과가 나올까요? (200이면 성공!)</span></span><br><span class="line">    print(login_req.status_code)</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-07-12%2022.12.00.png?dl=1" alt=""></p>
<p>와우! 200이 나온걸 보니 성공적으로 로그인이 된 것 같아요.</p>
<h2 id="진짜-데이터를-가져와봅시다"><a href="#진짜-데이터를-가져와봅시다" class="headerlink" title="진짜 데이터를 가져와봅시다"></a>진짜 데이터를 가져와봅시다</h2><p>이제 우리 코드를 좀 더 멋지게 만들어 봅시다. 로그인이 실패한 경우 Exception을 만들고, 성공일 경우에는 회원 장터의 게시글을 가져와봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-07-12%2022.24.12.png?dl=1" alt=""></p>
<p>위 스크린샷처럼 오른쪽 버튼을 누르고 Copy &gt; Copy selector를 눌러주면 <code>#div_content &gt; div.post-title &gt; div.title-subject &gt; div</code>라는 CSS Selector가 나옵니다. 이 HTML문서에서 이 제목만을 콕 하고 찾아줍니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-07-12%2022.30.35.png?dl=1" alt=""></p>
<p>본문도 같은 방식으로 찾아줍시다. 다만 <code>p</code>태그가 아니라 글 전체를 담고있는 <code>#div_content &gt; div.post.box &gt; div.post-content &gt; div.post-article.fr-view</code>을 가져와봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup <span class="keyword">as</span> bs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그인할 유저정보를 넣어줍시다. (모두 문자열입니다!)</span></span><br><span class="line">LOGIN_INFO = &#123;</span><br><span class="line">    <span class="string">'userId'</span>: <span class="string">'myidid'</span>,</span><br><span class="line">    <span class="string">'userPassword'</span>: <span class="string">'mypassword123'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Session 생성, with 구문 안에서 유지</span></span><br><span class="line"><span class="keyword">with</span> requests.Session() <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># 우선 클리앙 홈페이지에 들어가 봅시다.</span></span><br><span class="line">    first_page = s.get(<span class="string">'https://www.clien.net/service'</span>)</span><br><span class="line">    html = first_page.text</span><br><span class="line">    soup = bs(html, <span class="string">'html.parser'</span>)</span><br><span class="line">    csrf = soup.find(<span class="string">'input'</span>, &#123;<span class="string">'name'</span>: <span class="string">'_csrf'</span>&#125;) <span class="comment"># input태그 중에서 name이 _csrf인 것을 찾습니다.</span></span><br><span class="line">    print(csrf[<span class="string">'value'</span>]) <span class="comment"># 위에서 찾은 태그의 value를 가져옵니다.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이제 LOGIN_INFO에 csrf값을 넣어줍시다.</span></span><br><span class="line">    <span class="comment"># (p.s.)Python3에서 두 dict를 합치는 방법은 &#123;**dict1, **dict2&#125; 으로 dict들을 unpacking하는 것입니다.</span></span><br><span class="line">    LOGIN_INFO = &#123;**LOGIN_INFO, **&#123;<span class="string">'_csrf'</span>: csrf[<span class="string">'value'</span>]&#125;&#125;</span><br><span class="line">    print(LOGIN_INFO)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이제 다시 로그인을 해봅시다.</span></span><br><span class="line">    login_req = s.post(<span class="string">'https://www.clien.net/service/login'</span>, data=LOGIN_INFO)</span><br><span class="line">    <span class="comment"># 어떤 결과가 나올까요? (200이면 성공!)</span></span><br><span class="line">    print(login_req.status_code)</span><br><span class="line">    <span class="comment"># 로그인이 되지 않으면 경고를 띄워줍시다.</span></span><br><span class="line">    <span class="keyword">if</span> login_req.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'로그인이 되지 않았어요! 아이디와 비밀번호를 다시한번 확인해 주세요.'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># -- 여기서부터는 로그인이 된 세션이 유지됩니다 --</span></span><br><span class="line">    <span class="comment"># 이제 장터의 게시글 하나를 가져와 봅시다. 아래 예제 링크는 중고장터 공지글입니다.</span></span><br><span class="line">    post_one = s.get(<span class="string">'https://www.clien.net/service/board/rule/10707408'</span>)</span><br><span class="line">    soup = bs(post_one.text, <span class="string">'html.parser'</span>) <span class="comment"># Soup으로 만들어 줍시다.</span></span><br><span class="line">    <span class="comment"># 아래 CSS Selector는 공지글 제목을 콕 하고 집어줍니다.</span></span><br><span class="line">    title = soup.select(<span class="string">'#div_content &gt; div.post-title &gt; div.title-subject &gt; div'</span>)</span><br><span class="line">    contents = soup.select(<span class="string">'#div_content &gt; div.post.box &gt; div.post-content &gt; div.post-article.fr-view'</span>)</span><br><span class="line">    <span class="comment"># HTML을 제대로 파싱한 뒤에는 .text속성을 이용합니다.</span></span><br><span class="line">    print(title[<span class="number">0</span>].text) <span class="comment"># 글제목의 문자만을 가져와봅시다.</span></span><br><span class="line">    <span class="comment"># [0]을 하는 이유는 select로 하나만 가져와도 title자체는 리스트이기 때문입니다.</span></span><br><span class="line">    <span class="comment"># 즉, 제목 글자는 title이라는 리스트의 0번(첫번째)에 들어가 있습니다.</span></span><br><span class="line">    print(contents[<span class="number">0</span>].text) <span class="comment"># 글내용도 마찬가지겠지요?</span></span><br></pre></td></tr></table></figure>

<p>코드를 실행해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-07-12%2022.33.05.png?dl=1" alt=""></p>
<p>잘 가져옵니다 :)</p>
<h2 id="그러나-위-코드가-안먹힌다면"><a href="#그러나-위-코드가-안먹힌다면" class="headerlink" title="그러나, 위 코드가 안먹힌다면?"></a>그러나, 위 코드가 안먹힌다면?</h2><p>일부 사이트의 경우 프론트 브라우저 단에서 ID와 PW를 이용해 암호화된 전송값을 보내는 경우가 있습니다.(대표적으로 네이버가 이렇습니다.) 또한, SPA등으로 인해 PageSource을 가져오는 것이 불충분한 경우가 자주 있습니다.</p>
<p>물론 오늘처럼 JS파일을 분석해 수동으로 data에 넣어주는 방법도 있지만, 브라우저를 직접 다뤄서 사람이 로그인하듯 크롤링을 해보면 어떨까요?</p>
<p>다음 포스팅에서 좀 더 간편히 실제 브라우저(혹은 Headless브라우저)를 이용해 로그인부터 크롤링까지, 간편하게 해보는 방법을 알아봅시다.</p>
<p>다음 가이드: <a href="/2017/02/27/HowToMakeWebCrawler-With-Selenium/">나만의 웹 크롤러 만들기(3): Selenium으로 무적 크롤러 만들기</a></p>
<h3 id="업데이트-후기"><a href="#업데이트-후기" class="headerlink" title="업데이트 후기"></a>업데이트 후기</h3><p>2017년 7월 12일, 올해 초(1월 20일)에 작성한 인기 크롤링글 대상인 클리앙이 바뀌어 업데이트가 필요했습니다. 사실 예전 코드를 업데이트 하는 것도 사실상 새 글을 쓰는 것과 같은 시간과 노력이 듭니다. 하지만 오래된 정보를 두는 것보다 새로운 정보를 두는 것이 낫다고 생각해 업데이트를 했으나..!</p>
<p>클리앙을 이용하는데 덧글 쓰기/글 쓰기 빼고 글을 읽는 것에 제한은 회원장터조차도 제한이 없어졌더군요. (눈물)</p>
<p>그래도 이 가이드를 기반으로 다른 사이트 로그인 하는데 조금 더 쉬워지기를 바랍니다.</p>

        </div>
        
        
        
    </div>
</div>








</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/profile_beomi.jpg" alt="Junbum Lee">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Junbum Lee
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Beomi&#39;s tech blog
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Seoul, KR</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/beomi">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                카테고리
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/DataCollection/">
            <span class="level-start">
                <span class="level-item">DataCollection</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DataCollection/Twitter/">
            <span class="level-start">
                <span class="level-item">Twitter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/">
            <span class="level-start">
                <span class="level-item">DevEnv</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DevEnv/DataScience/">
            <span class="level-start">
                <span class="level-item">DataScience</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/DeepLearning/">
            <span class="level-start">
                <span class="level-item">DeepLearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Git/">
            <span class="level-start">
                <span class="level-item">Git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Ubuntu/">
            <span class="level-start">
                <span class="level-item">Ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Django/">
            <span class="level-start">
                <span class="level-item">Django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Django/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/">
            <span class="level-start">
                <span class="level-item">DjangoTDDStudy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/MacOS/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/NLP/">
            <span class="level-start">
                <span class="level-item">NLP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/NLP/LanguageModel/">
            <span class="level-start">
                <span class="level-item">LanguageModel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/NLP/Unsupervised/">
            <span class="level-start">
                <span class="level-item">Unsupervised</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Postmortem/">
            <span class="level-start">
                <span class="level-item">Postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Python/Celery/">
            <span class="level-start">
                <span class="level-item">Celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/Fabric/">
            <span class="level-start">
                <span class="level-item">Fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Tech/">
            <span class="level-start">
                <span class="level-item">Tech</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Translation/">
            <span class="level-start">
                <span class="level-item">Translation</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/aws/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/azure/">
            <span class="level-start">
                <span class="level-item">azure</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/blog/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/django/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/django/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/flask/sqlalchemy/">
            <span class="level-start">
                <span class="level-item">sqlalchemy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/javascript/webpack/">
            <span class="level-start">
                <span class="level-item">webpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/machinelearning/">
            <span class="level-start">
                <span class="level-item">machinelearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/machinelearning/seminar/">
            <span class="level-start">
                <span class="level-item">seminar</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/macos/">
            <span class="level-start">
                <span class="level-item">macos</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/macos/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/nlp/">
            <span class="level-start">
                <span class="level-item">nlp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/nlp/languagemodel/">
            <span class="level-start">
                <span class="level-item">languagemodel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/postmortem/">
            <span class="level-start">
                <span class="level-item">postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">25</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/python/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/celery/">
            <span class="level-start">
                <span class="level-item">celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/dataanalysis/">
            <span class="level-start">
                <span class="level-item">dataanalysis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/pyspark/">
            <span class="level-start">
                <span class="level-item">pyspark</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/react/">
            <span class="level-start">
                <span class="level-item">react</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/react/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/tips/githubpages/">
            <span class="level-start">
                <span class="level-item">githubpages</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ubuntu/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/vlang/">
            <span class="level-start">
                <span class="level-item">vlang</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Beomi&#39;s Tech Blog
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Junbum Lee&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("ko");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://beomi.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>








<script src="/js/main.js" defer></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
</body>
</html>