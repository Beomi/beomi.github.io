<!DOCTYPE html>
<html  lang="ko">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>카테고리: aws - Beomi&#39;s Tech blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89162642-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-89162642-1');
</script>

    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="is-3-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Beomi&#39;s Tech Blog
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="https://junbuml.ee">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    <div class="card-content">
        <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="/categories">카테고리</a></li>
            
            <li><a href="/categories/python/">python</a></li>
            
            <li class="is-active"><a href="#" aria-current="page">aws</a></li>
        </ul>
        </nav>
    </div>
</div>

    
<div class="card">
    
    <div class="card-image">
        <a href="/2018/03/18/Create_GPU_spot_EC2_for_ML/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/Create_GPU_spot_EC2_for_ML.png" alt="GPU EC2 스팟 인스턴스에 Cuda/cuDNN와 Tensorflow/PyTorch/Jupyter Notebook 세팅하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-03-17T15:00:00.000Z">2018-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/">aws</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/03/18/Create_GPU_spot_EC2_for_ML/">GPU EC2 스팟 인스턴스에 Cuda/cuDNN와 Tensorflow/PyTorch/Jupyter Notebook 세팅하기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>Tensorflow나 PyTorch등을 사용하며 딥러닝 모델을 만들고 학습을 시킬 때 GPU를 사용하면 CPU만 사용하는 것에 비해 몇배~몇십배에 달하는 속도향상을 얻을 수 있다는 것은 누구나 알고 있습니다.</p>
<p>그래서 비싼 GPU를 사용하고 낯선 리눅스 환경을 이용하기도 합니다. 하지만 실제로 GPU, 특히 Cuda를 이용한 GPU가속을 세팅하고 cuDNN등을 통해 각 머신러닝 라이브러리에서 속도를 향상시키려고 할 때는 항상 무언가 문제가 발생합니다. 물론 Floydhub혹은 AWS SageMaker와 같이 이미 GPU 가속 환경이 마련되어있는 경우는 필요가 없지만, GPU 인스턴스의 시간당 요금 자체가 상당히 높습니다. </p>
<blockquote>
<p><code>k80</code> GPU를 제공하는 경우 시간당 약 1~2달러의 비용이 발생합니다.</p>
</blockquote>
<p>조금이라도 저렴하게 GPU를 사용하고, 한번 설정된 GPU 인스턴스를 그대로 유지하기 위해 스팟 인스턴스를 사용해 봅시다. </p>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2018/03/18/Create_GPU_spot_EC2_for_ML/#more">자세히 보기</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/12/15/Direct-upload-to-S3-with-Lambda/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/direct_s3_post_upload.png" alt="Direct S3 Upload with Lambda">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-12-14T15:00:00.000Z">2017-12-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/">aws</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/12/15/Direct-upload-to-S3-with-Lambda/">Direct S3 Upload with Lambda</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>이전 글인 <a href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/">AWS Lambda에 Tensorflow/Keras 배포하기</a>에서 Lambda 함수가 실행되는 트리거는 s3버킷에 파일이 <strong>생성</strong>되는 것이었습니다.</p>
<p>물론 파일을 올릴 수 있는 방법은 여러가지가 있습니다. 아주 단순하게 POST 폼 전송 요청을 받고 <code>boto3</code>등을 이용해 서버에서 s3으로 파일을 전송할 수도 있고, 더 단순하게는 AWS s3 콘솔을 이용해 파일을 올리라고 할 수도 있습니다.</p>
<p>하지만 이런 부분에는 약간의 단점이 함께 있습니다.</p>
<p>첫 번째 방법처럼 파일을 수신해 다시 s3에 올린다면 그 과정에서 서버 한대가 상시로 켜져있어야 하고 전송되는 속도 역시 서버에 의해 제약을 받습니다. 한편 두 번째 방법은 가장 단순하지만 제3자에게서 파일을 받기 위해서 AWS 계정(비록 제한된 권한이 있다 하더라도)을 제공한다는 것 자체가 문제가 됩니다.</p>
<p>따라서 이번 글에서는 사용자의 브라우저에서 바로 s3으로 POST 요청을 전송할 수 있도록 만드는 과정을 다룹니다.</p>
<h2 id="시나리오"><a href="#시나리오" class="headerlink" title="시나리오"></a>시나리오</h2><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-15%2018.15.38.png" alt=""></p>
<p>사용자는 아주 일반적인 Form 하나를 보게 됩니다. 여기에서 드래그-드롭 혹은 파일 선택을 이용해 일반적으로 파일을 올리게 됩니다. 물론 이 때 올라가는 주소는 AWS S3의 주소가 됩니다.</p>
<p>하지만 이게 바로 이뤄진다면 문제가 생길 소지가 많습니다. 아무나 s3 버킷에 파일을 올린다면 악의적인 파일이 올라올 수도 있고, 기존의 파일을 덮어쓰기하게 될 수도 있기 때문입니다.</p>
<p>따라서 중간에 s3에 post 요청을 할 수 있도록 <strong>인증(signing)</strong>해주는 서버가 필요합니다. 다만 이 때 서버는 요청별로 응답을 해주면 되기 때문에 AWS Lambda를 이용해 제공할 수 있습니다.</p>
<p>따라서 다음과 같은 형태로 진행이 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/direct_s3_post_upload.png" alt="전체 처리 과정 모식도"></p>
<p>S3에 POST 요청을 하기 전 Signing 서버에 업로드하는 파일 정보와 위치등을 보낸 뒤, Lambda에서 해당 POST 요청에 대한 인증 정보가 들어간 header를 반환하면 그 헤더 정보를 담아 실제 S3에 POST 요청을 하는 방식입니다.</p>
<p>만약 Signing하는 과정 없이 업로드가 이뤄진다면 s3 버킷을 누구나 쓸 수 있는 Public Bucket으로 만들어야 하는 위험성이 있습니다. 하지만 이와 같이 제한적 권한을 가진 <code>iam</code> 계정을 생성하고 Signing하는 과정을 거친다면 조금 더 안전하게 사용할 수 있습니다.</p>
<blockquote>
<p><strong>Note:</strong> 이번 글에서는 API Gateway + Lambda 조합으로 Signing서버를 구성하기 때문에 만약 추가적인 인증 과정을 붙인다면 API Gateway단에서 이뤄지는 것이 좋습니다.</p>
</blockquote>
<h2 id="버킷-만들기-amp-권한-설정"><a href="#버킷-만들기-amp-권한-설정" class="headerlink" title="버킷 만들기 &amp; 권한 설정"></a>버킷 만들기 &amp; 권한 설정</h2><blockquote>
<p>새로운 버킷은 <a href="https://s3.console.aws.amazon.com/s3/home">https://s3.console.aws.amazon.com/s3/home</a>에서 추가할 수 있습니다.</p>
</blockquote>
<p>새로운 버킷을 하나 만들어주세요. 이번 글에서는 <code>s3-signature-dev-py3</code>라는 이름으로 만들어 진행해 보았습니다.</p>
<p>버킷에 GET/POST 요청을 하기 위해 CORS 설정을 해줘야 합니다.(<code>localhost:8000</code>와 같은 제 3의 URL에서 s3 버킷의 주소로 POST 요청을 날리기 위해서는 CORS 설정이 필수입니다.)</p>
<p>아래 스크린샷과 같이 CORS 설정을 진행해 주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.55.31.png" alt=""></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CORSConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CORSConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이처럼 구성해주면 모든 도메인(<code>*</code>)에서 요청한 GET/POST 요청을 정상적인 크로스-도메인 요청으로 받아들입니다.</p>
<blockquote>
<p><strong>Note:</strong> 만약 여러분이 여러분의 프론트 서비스에서만 이 요청을 허용하려면 <code>AllowedOrigin</code>부분을 여러분이 사용하는 프론트 서비스의 도메인으로 변경해주세요.</p>
</blockquote>
<p>이제 s3을 사용할 준비는 마쳤습니다.</p>
<h2 id="버킷-액세스-iam-계정-만들기"><a href="#버킷-액세스-iam-계정-만들기" class="headerlink" title="버킷 액세스 iam 계정 만들기"></a>버킷 액세스 iam 계정 만들기</h2><blockquote>
<p>새로운 iam 계정은 <a href="https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/users$new?step=details">https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/users$new?step=details</a>에서 만들 수 있습니다.</p>
</blockquote>
<p>다음으로는 앞서 만들어준 버킷에 액세스를 할 수 있는 <code>iam</code> 계정을 만들어야 합니다. 이번에 사용할 유저 이름도 <code>s3-signature-dev-py3</code>로 만들어 줍시다. 아래 스크린샷처럼 <code>Programmatic access</code>를 위한 사용자를 만들어 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.03.31.png" alt=""></p>
<p>우리는 버킷내 <code>uploads</code>폴더에 파일을 ‘업로드만 가능’한, <code>PutObject</code>와 <code>PutObjectAcl</code>이라는 아주 제한적인 권한을 가진 계정을 만들어 줄 것이기 때문에 다음과 같이 Create Policy를 눌러 json 기반으로 계정 정책을 새로 생성해 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.05.01.png" alt=""></p>
<p>새 창이 뜨면 아래와 같이 <code>arn:aws:s3:::s3-signature-dev-py3/uploads/*</code> 리소스에 대해 <code>PutObject</code>와 <code>PutObjectAcl</code>에 대해 Allow를 해 주는 json을 입력하고 저장해줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.16.41.png" alt=""></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Version"</span>: <span class="string">"2012-10-17"</span>,</span><br><span class="line">    <span class="attr">"Statement"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Sid"</span>: <span class="string">"s3UploadsGrant"</span>,</span><br><span class="line">            <span class="attr">"Effect"</span>: <span class="string">"Allow"</span>,</span><br><span class="line">            <span class="attr">"Action"</span>: [</span><br><span class="line">                <span class="string">"s3:PutObject"</span>,</span><br><span class="line">                <span class="string">"s3:PutObjectAcl"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"Resource"</span>: [</span><br><span class="line">                <span class="string">"arn:aws:s3:::s3-signature-dev-py3/uploads/*"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 policy의 name을 입력하고 저장해줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.18.22.png" alt=""></p>
<p>저장해주고 창을 끈 뒤 이전 페이지로 돌아와 Refresh를 누르면 다음과 같이 앞서 만들어준 Policy가 나오는 것을 볼 수 있습니다. 체크박스에 체크를 누른 뒤 다음을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.20.29.png" alt=""></p>
<p>이제 마지막 확인을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.21.35.png" alt=""></p>
<p>확인을 누르면 다음과 같이 Access key ID와 Secret access key가 나옵니다. 이 키는 지금만 볼 수 있으니 csv로 받아두거나 따로 기록해 두세요. 그리고 글 아래부분에서 이 키를 사용하게 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.22.05.png" alt=""></p>
<h2 id="Signing-Lambda-함수-만들기"><a href="#Signing-Lambda-함수-만들기" class="headerlink" title="Signing Lambda 함수 만들기"></a>Signing Lambda 함수 만들기</h2><p>이제 POST 요청을 받아 인증을 해줄 AWS Lambda함수를 만들어 줍시다.</p>
<p>아래 코드를 받아 AWS Lambda 새 함수를 만들어주세요. (역시 <code>s3-signature-dev-py3</code>라는 이름으로 만들었습니다.)</p>
<p><a href="https://gist.github.com/Beomi/ac9d34dbfa9a6bdaf4a0426e8b83b4e3">Github Gist: index.py</a></p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.22.26.png" alt=""></p>
<p>이번 함수는 python3의 내장함수만을 이용하기 때문에 따로 zip으로 만들 필요없이 AWS 콘솔 상에서 인라인 코드 편집으로 함수를 생성하는 것이 가능합니다.</p>
<p>아래 스크린샷처럼 <code>lambda_function.py</code> 파일을 위의 gist 코드로 덮어씌워주세요. 그리고 <code>Handler</code>부분을 <code>lambda_function.index</code>로 바꿔 <code>index</code>함수를 실행하도록 만들어 주세요. 그리고 저장을 눌러야 입력한 코드가 저장됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.25.34.png" alt=""></p>
<p>코드를 조금 뜯어보면 아래와 같이 <code>ACCESS_KEY</code>와 <code>SECRET_KEY</code>를 저장하는 부분이 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ACCESS_KEY = os.environ.get(<span class="string">'ACCESS_KEY'</span>)</span><br><span class="line">SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>)</span><br></pre></td></tr></table></figure>

<p>AWS Lambda에서 함수를 실행할 때 아래 환경변수를 가져와 s3 버킷에 액세스하기 때문에 위 두개 값을 아래 스크린샷처럼 채워줍시다. 입력을 마치고 저장을 눌러주면 환경변수가 저장됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.32.57.png" alt=""></p>
<blockquote>
<p><strong>Note:</strong> 각 키의 값은 앞서 iam 계정 생성시 만든 값을 넣어주세요!</p>
</blockquote>
<h2 id="API-Gateway-연결하기"><a href="#API-Gateway-연결하기" class="headerlink" title="API Gateway 연결하기"></a>API Gateway 연결하기</h2><blockquote>
<p>API Gateway는 <a href="https://ap-northeast-2.console.aws.amazon.com/apigateway/home?region=ap-northeast-2#/apis/create">https://ap-northeast-2.console.aws.amazon.com/apigateway/home?region=ap-northeast-2#/apis/create</a>에서 만들 수 있습니다.</p>
</blockquote>
<p>이렇게 만들어 준 AWS Lambda 함수는 각각은 아직 외부에서 결과값을 받아올 수 있는 형태가 아닙니다. 람다 함수를 트리거해주고 결과값을 받아오기 위해서는 AWS API Gateway를 통해 웹 URL로 오는 요청에 따라서 람다 함수가 실행되도록 구성해야 합니다. 또한, CORS역시 활성화 해줘야 합니다.</p>
<h3 id="API-Gateway-만들고-Lambda와-연결하기"><a href="#API-Gateway-만들고-Lambda와-연결하기" class="headerlink" title="API Gateway 만들고 Lambda와 연결하기"></a>API Gateway 만들고 Lambda와 연결하기</h3><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.01.23.png" alt=""></p>
<p>Resources에서는 Api URL의 하위 URL와 root URL에 대해 각각 메소드들을 정의해 사용할 수 있습니다. 우리는 요청을 받을 때 <code>POST</code> 방식으로 요청을 받아 처리해줄 것이랍니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.15.35.png" alt=""></p>
<p>여기서 새 메소드 중 <code>POST</code>를 선택해 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.16.38.png" alt=""></p>
<p>메소드에 Lambda 함수를 연결해 주기 위해 다음과 같이 <code>Lambda Function</code>을 선택하고 <code>Proxy</code>는 체크 해제한 뒤, <code>Region</code>은 <code>ap-northeast-2</code>(서울)리전을 선택하고, 아까 만들어준 함수 이름을 입력한 뒤 <code>Save</code>를 눌러줍시다.</p>
<blockquote>
<p><strong>Tip:</strong> Lambda Proxy를 활성화 시킬 경우 HTTP 요청이 그대로 들어오는 대신, AWS에서 제공하는 event 객체가 대신 Lambda함수로 넘어가게 됩니다. 우리는 HTTP 요청을 받아 Signing해주는 과정에서 Header와 Body를 유지해야하기 때문에 Proxy를 사용하지 않습니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.24.50.png" alt=""></p>
<p><code>Save</code>를 누르면 다음과 같이 API Gateway에 Lambda함수를 실행할 권한을 연결할지 묻는 창이 뜹니다. 가볍게 OK를 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.28.28.png" alt=""></p>
<p>연결이 완료되면 API Gateway가 아래 사진처럼 Lambda 함수와 연결 된 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.33.11.png" alt=""></p>
<h3 id="CORS-활성화하기"><a href="#CORS-활성화하기" class="headerlink" title="CORS 활성화하기"></a>CORS 활성화하기</h3><p>조금만 더 설정을 해주면 API Gateway를 배포할 수 있게 됩니다. 지금 해줘야 하는 작업이 바로 <code>CORS</code> 설정인데요, 우리가 나중에 만들 프론트 페이지의 URL와 s3의 URL이 다르기 때문에 브라우저에서는 보안의 이유로 <code>origin</code>이 다른 리소스들에 대해 접근을 제한합니다. 따라서 <code>CORS</code>를 활성화 해 타 URL(프론트 URL)에서도 요청을 할 수 있도록 설정해줘야 합니다.</p>
<p><code>Actions</code>에서 <code>Enable CORS</code>를 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.34.06.png" alt=""></p>
<p>다음과 같이 <code>Access-Control-Allow-Headers</code>의 값을 <code>&#39;*&#39;</code>로 설정한 뒤 Enable CORS 버튼을 눌러 저장해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.30.42.png" alt=""></p>
<p>다시한번 Confirm을 눌러주시면…</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.33.45.png" alt=""></p>
<p>CORS가 활성화되고 Options 메소드가 새로 생기게 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.35.30.png" alt=""></p>
<p>이제 API Gateway를 ‘배포’해야 실제로 사용할 수 있습니다.</p>
<h3 id="API-Gateway-배포하기"><a href="#API-Gateway-배포하기" class="headerlink" title="API Gateway 배포하기"></a>API Gateway 배포하기</h3><p>API Gateway의 설정을 모두 마치고나서는 배포를 진행해야 합니다. 아래와 같이 <code>Actions</code>에서 <code>Deploy API</code>를 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.39.46.png" alt=""></p>
<p>API Gateway는 <code>Deployment Stage</code>를 필요로 합니다. <code>Stage name</code>을 <code>live</code>로 설정하고 <code>Deploy</code>를 눌러줍시다.</p>
<blockquote>
<p><strong>Tip:</strong> <code>Deployment Stage</code>는 API Gateway의 URL 뒤 <code>/stagename</code>의 형식으로 추가 URL을 지정해줍니다. 이를 통해 API를 개발 버전과 실 서비스 버전을 분리해 제공할 수 있습니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.43.03.png" alt=""></p>
<p>배포가 완료되면 아래와 같이 API Gateway를 사용할 수 있는 URL을 받을 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.48.42.png" alt=""></p>
<p>이번에는 <code>https://9n2qae2nak.execute-api.ap-northeast-2.amazonaws.com/live</code>가 Signing Lambda 함수를 실행할 수 있는 API Gateway URL이 됩니다.</p>
<h2 id="파일-업로드-프론트-만들기"><a href="#파일-업로드-프론트-만들기" class="headerlink" title="파일 업로드 프론트 만들기"></a>파일 업로드 프론트 만들기</h2><p>이제 파일을 업로드할 form이 있는 Static 웹 사이트를 만들어봅시다.</p>
<p>이번 글에서는 이미 만들어진 파일 업로더인 VanillaJS용 <a href="https://github.com/FineUploader/fine-uploader">Fine Uploader</a>를 이용해 최소한의 업로드만 구현합니다.</p>
<blockquote>
<p>React용 <a href="https://github.com/FineUploader/react-fine-uploader">React Fine Uploader</a>와 Vue용 <a href="https://github.com/FineUploader/vue-fineuploader">Vue Fine Uploader</a>도 있습니다.</p>
</blockquote>
<p><a href="https://github.com/Beomi/s3-direct-uploader-demo">https://github.com/Beomi/s3-direct-uploader-demo</a> 깃헙 레포를 clone받아 <code>app.js</code>를 열어 아래 목록을 수정해주세요.</p>
<ul>
<li>request/endpoint: 여러분이 사용할 s3 버킷 이름 + .s3.amazonaws.com</li>
<li>request/accessKey: 앞서 만든 iam 계정의 Access Key</li>
<li>objectProperties/region: s3 버킷의 리전</li>
<li>objectProperties/key/prefixPath: s3 버킷 내 올릴 폴더 이름(putObject 권한을 부여한 폴더)</li>
<li>signature/endpoint: 앞서 만든 AWS Lambda의 API Gateway URL</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uploader = <span class="keyword">new</span> qq.s3.FineUploader(&#123;</span><br><span class="line">    debug: <span class="literal">false</span>, <span class="comment">// defaults to false</span></span><br><span class="line">    element: <span class="built_in">document</span>.getElementById(<span class="string">'fine-uploader'</span>),</span><br><span class="line">    request: &#123;</span><br><span class="line">        <span class="comment">// S3 Bucket URL</span></span><br><span class="line">        endpoint: <span class="string">'https://s3-signature-dev-py3.s3.amazonaws.com'</span>, </span><br><span class="line">        <span class="comment">// iam ACCESS KEY</span></span><br><span class="line">        accessKey: <span class="string">'AKIAIHUAMKBO27EZQ6RA'</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    objectProperties: &#123;</span><br><span class="line">        region: <span class="string">'ap-northeast-2'</span>,</span><br><span class="line">        key(fileId) &#123;</span><br><span class="line">            <span class="keyword">var</span> prefixPath = <span class="string">'uploads'</span></span><br><span class="line">            <span class="keyword">var</span> filename = <span class="keyword">this</span>.getName(fileId)</span><br><span class="line">            <span class="keyword">return</span> prefixPath + <span class="string">'/'</span> + filename</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    signature: &#123;</span><br><span class="line">        <span class="comment">// version</span></span><br><span class="line">        version: <span class="number">4</span>,</span><br><span class="line">        <span class="comment">// AWS API Gate URL</span></span><br><span class="line">        endpoint: <span class="string">'https://9n2qae2nak.execute-api.ap-northeast-2.amazonaws.com/live'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    retry: &#123;</span><br><span class="line">        enableAuto: <span class="literal">true</span> <span class="comment">// defaults to false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>그리고나서 <code>index.html</code> 파일을 열어보시면 아래 사진과 같은 업로더가 나오게 됩니다.</p>
<blockquote>
<p><strong>DEMO:</strong> <a href="https://beomi.github.io/s3-direct-uploader-demo/">https://beomi.github.io/s3-direct-uploader-demo/</a></p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2017.59.46.png" alt=""></p>
<h2 id="맺으며"><a href="#맺으며" class="headerlink" title="맺으며"></a>맺으며</h2><p>이제 여러분은 Serverless하게 파일을 s3에 업로드 할 수 있게 됩니다. 권한 관리와 같은 부분은 API Gateway에 접근 가능한 부분에 제약을 걸어 업로드에 제한을 걸어 줄 수도 있습니다.</p>
<p>ec2등을 사용하지 않고도 간단한 signing만 갖춰 s3에 파일을 안전하게 업로드 하는 방식으로 전체 프로세스를 조금씩 Serverless한 구조로 바꾸는 예시였습니다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p><a href="http://docs.aws.amazon.com/ko_kr/AmazonS3/latest/API/sigv4-post-example.html">Browser-Based Upload using HTTP POST (Using AWS Signature Version 4)</a></p>
</li>
<li><p><a href="https://kennbrodhagen.net/2015/12/02/how-to-access-http-headers-using-aws-api-gateway-and-lambda/">How to access HTTP headers using AWS API Gateway and Lambda</a></p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/lambda_n_tensorflow_updated.png" alt="AWS Lambda에 Tensorflow/Keras 배포하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-12-06T15:00:00.000Z">2017-12-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/">aws</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/tensorflow/">tensorflow</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/">AWS Lambda에 Tensorflow/Keras 배포하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>Update @ 20190306: <code>amazonlinux:latest</code> 버전이 <code>2</code>버전이 latest로 변경됨에 따라 아래 코드를 <code>amazonlinux:1</code>로 변경</p>
</blockquote>
<blockquote>
<p>이번 글은 macOS을 기반으로 작성되었지만, <code>docker</code> 명령어를 사용할 수 있는 모든 플랫폼(윈도우/맥/리눅스)에서 따라올 수 있습니다.</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>여러분이 이미지를 받아 텐서플로로 분류를 해 준 뒤 결과를 반환해주는 작업을 하는 모델을 만들었다고 가정해봅시다. 이때 가장 빠르고 간단하게 결과를 내는(Inference/추론을 하는)방법은 Cuda가속을 할 수 있는 고급 시스템 위에서 텐서플로 모델을 이용해 결과를 반환하도록 서비스를 구현할 수 있습니다. 혹은 조금 느리더라도 CPU를 사용하는 EC2와 같은 VM위에서 텐서플로 코드를 동작하게 만들 수도 있습니다.</p>
<p>하지만 만약 여러분이 처리해야하는 이미지가 몇장이 아니라 수십, 수백장을 넘어 수천장을 처리해야한다면 어떻게 될까요?</p>
<p>한 EC2 위에서 서비스를 제공하는 상황에서는 이런 경우라면 <code>for</code>문처럼 이미지 하나하나를 돌며 추론을 한다면 전체 이미지의 결과를 내려면 한참 시간이 걸리게 됩니다. 따라서 일종의 병렬 처리를 생각해 보아야 합니다.</p>
<p>즉, 이미지를 순서대로 하나씩 추론하는 대신, 추론하는 코어 함수만을 빼고 결과를 반환하도록 만들어 주면 됩니다.</p>
<p>물론 병렬 처리를 위해서 여러가지 방법들이 있습니다. 여러개의 GPU를 사용하고 있다면 각 GPU별로 작업을 진행하도록 할 수도 있고, 혹은 EC2를 여러개 띄워서 작업을 분산해 진행할 수도 있습니다. 하지만 이 방법보다 조금 더(혹은 상당히 많이) 빠르게 결과를 얻어낼 수 있는 방법이 있습니다.</p>
<p>바로 AWS Lambda를 이용하는 방법입니다.</p>
<p>AWS Lambda는 현재 각 실행별 최대 3GB메모리와 5분의 실행시간 내에서 원하는 코드를 실행해 한 리전에서 동시에 최대 1000개까지 병렬로 실행할 수 있습니다.</p>
<p>즉, 우리가 1만개의 이미지를 처리해야 한다면 한 리전에서만 1000개를 동시에 진행해 10개를 처리하는 시간 내 모든 작업을 마칠 수 있다는 것이죠. 그리고 작업이 끝나고 서버가 자동으로 끝나기 때문에 동작하지 않는 시간에도 돈을 내는 EC2와는 가격차이가 많이 나게됩니다.</p>
<p>이번 가이드는 다음과 같은 시나리오로 작성했습니다.</p>
<ul>
<li>시나리오<ol>
<li>s3의 어떤 버킷의 특정한 폴더에 ‘이미지 파일’을 올린다.</li>
<li>이미지 파일이 ‘생성’될 때 AWS Lambda 함수가 실행이 트리거된다.</li>
<li>(Lambda) 모델을 s3에서 다운받아 Tensorflow로 읽는다.</li>
<li>(Lambda) 함수가 트리거 될때 발생한 <code>event</code> 객체를 받아 s3에 업로드된 파일의 정보(버킷, 버킷내 파일의 경로)를 가져온다.</li>
<li>(Lambda) s3에 업로드된 이미지 파일을 <code>boto3</code>을 통해 가져와 Tensorflow로 Inference를 진행한다.</li>
<li>(Lambda) Inference가 끝난 결과물을 s3에 저장하거나 결과값을 DynamoDB에 저장하거나 혹은 API Gateway를 통해 json으로 반환한다.</li>
</ol>
</li>
</ul>
<p>위와같이 진행할 경우 s3에 파일 업로드를 1개를 하든, 1000개를 하든 업로드 자체에 필요한 시간을 제외하면 실행 시간 자체는 동일하게 유지할 수 있습니다. </p>
<p>(마치 시간복잡도가 O(1)인 척 할 수 있는 것이죠!)</p>
<h2 id="환경-준비하기"><a href="#환경-준비하기" class="headerlink" title="환경 준비하기"></a>환경 준비하기</h2><blockquote>
<p>오늘 사용한 예제는 <a href="https://github.com/Beomi/tf-keras-on-lambda">Github tf-keras-on-lambda Repo</a>에서 확인할 수 있습니다.</p>
</blockquote>
<p>AWS Lambda는 아마존에서 RedHat계열의 OS를 새로 만든 Amazon Linux위에서 동작합니다. 그렇기 때문에 만약 우리가 C의존적인 라이브러리를 사용해야한다면 우선 Amazon Linux에 맞게 pip로 설치를 해줘야 합니다. 그리고 간혹 빌드가 필요한 패키지의 경우 사용하고자 하는 OS에 맞춰 빌드작업 역시 진행해야 합니다. Tensorflow 역시 C의존적인 패키지이기 때문에 OS에 맞는 버전을 받아줘야 합니다. 우리가 사용하는 OS는 macOS혹은 windows이기 때문에 <code>docker</code>를 통해 Amazon Linux를 받아 그 안에서 빌드를 진행합니다.</p>
<p>도커를 사용하고있다면 그대로 진행해주시면 되고, 도커를 설치하지 않으셨다면 우선 도커를 먼저 설치해주세요.</p>
<p>도커는 <a href="https://store.docker.com/search?type=edition&offering=community">Docker Community Edition Download Page</a>에서 받으실 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.31.22.png" alt="도커를 받아주세요"></p>
<p>여러분이 다음부분을 진행하기 전, <code>docker</code>라는 명령어를 터미널 혹은 cmd상에서 입력시 도커가 실행되어야 합니다. 도커가 실행된다면, 우선은 실행할 준비를 마친 것이랍니다.</p>
<blockquote>
<p>물론 여러분 각자의 모델파일이 있어야 합니다. 이번 가이드에서는 Keras 예시 중 Pre-trained squeezenet을 이용한 Image Classification(imagenet)으로 진행합니다.</p>
</blockquote>
<h2 id="결과-저장용-DynamoDB-만들기-Optional"><a href="#결과-저장용-DynamoDB-만들기-Optional" class="headerlink" title="결과 저장용 DynamoDB 만들기(Optional)"></a>결과 저장용 DynamoDB 만들기(Optional)</h2><p>우리가 predict를 진행하고 나서 나온 결과물을 어딘가에 저장해둬야 합니다. AWS에는 DynamoDB라는 간단한 NoSQL DB가 있으니, 이걸 이용해 결과물을 저장해 봅시다.</p>
<p>우선 DynamoDB 메뉴에서 아래와 같이 새 테이블 하나를 만들어 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.10.35.png" alt=""></p>
<p>기본키 정도만 문자열 필드 <code>filename</code>을 만들고 테이블을 생성해 줍시다.</p>
<p>이제 기본키만 지키면 나머지 필드는 자유롭게 올릴 수 있습니다. (물론 기본키와 정렬키만 인덱스가 걸리기 때문에, 빠른 속도가 필요하다면 인덱스를 건 뒤 데이터를 추가해줘야 합니다.)</p>
<h2 id="squeezenet-ImageNet-모델-s3에-올리기"><a href="#squeezenet-ImageNet-모델-s3에-올리기" class="headerlink" title="squeezenet ImageNet 모델 s3에 올리기"></a>squeezenet ImageNet 모델 s3에 올리기</h2><p>이번 글에서는 squeezenet Imagenet 모델을 이용해 predict를 진행합니다. <code>squeezenet_weights_tf_dim_ordering_tf_kernels.h5</code>파일이 필요한데, AWS Lambda에서 비용이 들지 않으며 빠른 속도로 모델을 받아오기 위해서는 같은 리전의 s3에 파일을 올려둬야 합니다. </p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2014.40.38.png" alt="keras-blog 버킷에 올린 모델 파일"></p>
<p>이번 글에서는 <code>keras-blog</code>라는 s3 버킷의 <code>squeezenet</code> 폴더에 파일을 올려두었습니다.</p>
<p>각 파일은 아래 링크에서 받을 수 있습니다. 아래 두 파일을 받아 s3 버킷에 올려주세요.</p>
<ul>
<li><a href="https://github.com/rcmalli/keras-squeezenet/releases/download/v1.0/squeezenet_weights_tf_dim_ordering_tf_kernels.h5">squeezenet_weights_tf_dim_ordering_tf_kernels.h5</a></li>
</ul>
<h2 id="squeezenet-py-만들기"><a href="#squeezenet-py-만들기" class="headerlink" title="squeezenet.py 만들기"></a><code>squeezenet.py</code> 만들기</h2><p>Keras의 squeezenet은 <a href="https://github.com/rcmalli/keras-squeezenet/blob/master/keras_squeezenet/squeezenet.py">squeezenet.py</a>을 참조합니다. 하지만 이 파일에는 Pre-Trained Model의 경로를 바꿔주기 때문에 이 부분을 약간 수정한 커스텀 <code>squeezenet.py</code>를 만들어주었습니다.</p>
<p>이 파일을 다운받아 여러분의 <code>index.py</code> 옆에 놓아두세요.</p>
<ul>
<li><a href="https://github.com/Beomi/tf-keras-on-lambda/blob/master/squeezenet.py">수정된 squeezenet.py</a></li>
</ul>
<h2 id="도커-Amazon-Linux로-빌드-준비하기"><a href="#도커-Amazon-Linux로-빌드-준비하기" class="headerlink" title="도커 + Amazon Linux로 빌드 준비하기"></a>도커 + Amazon Linux로 빌드 준비하기</h2><p>이제 <code>docker</code>라는 명령어로 도커를 사용해봅시다.</p>
<p>우선 여러분이 작업할 폴더 하나를 만들어 주세요. 저는 지금 <code>tf_on_lambda</code>라는 폴더에서 진행하고 있습니다. 이 폴더 안에는 Lambda에서 실행할 python파일이 들어가게 되고, 도커와 이 폴더를 이어줄 것이기 때문에 새 폴더 하나를 만들어서 진행하시는 것을 추천합니다.</p>
<p>폴더를 만들고 들어가셨다면 다음 명령어를 입력해 AmazonLinux 이미지를 받아 도커로 띄워주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v $(<span class="built_in">pwd</span>):/outputs --name lambdapack -d amazonlinux:1 tail -f /dev/null</span><br></pre></td></tr></table></figure>

<p>도커 컨테이너의 이름을 <code>lambdapack</code>으로 지정하고 현재 폴더(<code>$(pwd)</code>)를 도커의 <code>/outputs</code>폴더로 연결해줍니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.48.48.png" alt="도커가 실행된 모습"></p>
<p>성공적으로 받아졌다면 다음과 같이 임의의 난수 id가 생깁니다. 그리고 <code>docker ps</code>라는 명령어로 현재 실행중인 컨테이너들을 확인해보면 다음과 같이 <code>lambdapack</code>라는 이름을 가진 컨테이너가 생성된 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.49.31.png" alt="도커 ps"></p>
<h2 id="람다가-실행할-python-파일-작성하기"><a href="#람다가-실행할-python-파일-작성하기" class="headerlink" title="람다가 실행할 python 파일 작성하기"></a>람다가 실행할 python 파일 작성하기</h2><p>그러면 이제 람다가 실제로 <strong>실행</strong>할 python 파일을 만들어줍시다. 이번 가이드에서는 이 파일의 이름을 <code>index.py</code>라고 지어보았습니다.</p>
<blockquote>
<p><code>index.py</code> 파일은 사실 어떤 이름으로 해도 상관없습니다만, AWS에 람다 함수를 만들 때 <code>handler</code>함수 위치 지정을 <code>파일이름.함수이름</code>, 즉 <code>index.handler</code>와 같이 적어줄 것이기 때문에 대표적인 이름을 가진 파일로 만들어 주시면 됩니다.</p>
</blockquote>
<p><code>index.py</code>안에는 다음과 같은 내용으로 작성해 봅시다. 중요한 부분은 <code>handler</code>함수입니다.</p>
<blockquote>
<p>전체 코드를 바로 이용하시려면 <a href="https://github.com/Beomi/tf-keras-on-lambda/blob/master/index.py">index.py on GIST</a>을 이용하세요.</p>
</blockquote>
<p>제일 먼저 해줘야 하는 부분은 우리가 사용할 라이브러리를 import하는 것이죠.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> boto3 <span class="comment"># AWS S3 접근용</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.python <span class="keyword">import</span> keras <span class="comment"># Keras!</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.applications.resnet50 <span class="keyword">import</span> preprocess_input, decode_predictions</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> io <span class="comment"># File 객체를 메모리상에서만 이용하도록</span></span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># os.path / os.environ</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span>  Image <span class="comment"># Image 객체 </span></span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="comment"># 파일받기 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (.h5경로변경추가, 레포의 squeezenet.py를 확인하세요.)</span></span><br><span class="line"><span class="keyword">from</span> squeezenet <span class="keyword">import</span> Squeezenet <span class="comment"># 커스텀한 squeezenet</span></span><br></pre></td></tr></table></figure>

<p>이 중 <code>boto3</code> 라이브러리는 AWS Lambda의 python3내에 이미 설치되어있기 때문에 <strong>특정 버전</strong>의 <code>boto3</code>을 이용하시려는게 아니라면 도커 컨테이너에 설치하지 않아도 됩니다. (즉, Lambda에 올릴 패키지 zip파일에 boto3이 들어있지 않아도 괜찮습니다.)</p>
<p>import를 끝냈으니 코드를 작성해 봅시다. 우선 S3에서 파일을 다운로드/업로드하는 함수를 만들어줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ACCESS_KEY = os.environ.get(<span class="string">'ACCESS_KEY'</span>)</span><br><span class="line">SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloadFromS3</span><span class="params">(strBucket, s3_path, local_path)</span>:</span></span><br><span class="line">    s3_client = boto3.client(</span><br><span class="line">        <span class="string">'s3'</span>,</span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">    )</span><br><span class="line">    s3_client.download_file(strBucket, s3_path, local_path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploadToS3</span><span class="params">(bucket, s3_path, local_path)</span>:</span></span><br><span class="line">    s3_client = boto3.client(</span><br><span class="line">        <span class="string">'s3'</span>,</span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">    )</span><br><span class="line">    s3_client.upload_file(local_path, bucket, s3_path)</span><br></pre></td></tr></table></figure>

<p>AWS 콘솔에서 람다 함수별로 환경변수를 설정해줄 수 있기 때문에, 위과 같이 <code>os.environ</code>을 통해 설정한 환경변수 값을 가져옵시다.</p>
<p>물론 여기에 설정한 Access Key와 Secret Key의 iam 유저는 당연히 해당 S3 버킷에 R/W권한이 있어야 합니다.</p>
<p>이 두가지 함수를 통해 S3에서 모델을 가져오고, 모델로 추론한 결과물을 S3에 넣어줄 수 있습니다.</p>
<blockquote>
<p>Note: s3 버킷과 람다 함수는 같은 Region에 있어야 데이터 전송 비용이 발생하지 않습니다.</p>
</blockquote>
<p>이제 가장 중요한 부분인 <code>handler</code>함수를 살펴봅시다.</p>
<p><code>handler</code>함수는 기본적으로 <code>event</code>와 <code>context</code>를 인자로 전달받습니다. 이때 우리가 사용하는 인자는 <code>event</code>인자입니다.</p>
<p>우리의 사용 시나리오 중 ‘S3에 이미지 파일을 올린다’, 이 부분이 바로 <code>event</code>의 내용이 됩니다.</p>
<h3 id="S3-Event의-내용"><a href="#S3-Event의-내용" class="headerlink" title="S3 Event의 내용"></a>S3 Event의 내용</h3><p>AWS에서 Lambda 실행이 트리거 될 때 전달되는 <code>event</code>는 파이썬의 딕셔너리 형태로 전달됩니다.</p>
<p>만약 여러분이 <code>s3</code>에 <strong>파일이 추가</strong>되는 이벤트를 Lambda에 연결해두셨다면 파일이 업로드 될 때 마다 아래와 같은 딕셔너리가 전달됩니다.</p>
<p>아래 예시는 <code>csv_icon.png</code>를 <code>keras-blog</code>라는 버킷내 <code>wowwow</code> 폴더에 올렸을때 발생한 <code>event</code> 객체입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># event 객체</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">'Records'</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'eventVersion'</span>: <span class="string">'2.0'</span>,</span><br><span class="line">            <span class="string">'eventSource'</span>: <span class="string">'aws:s3'</span>,</span><br><span class="line">            <span class="string">'awsRegion'</span>: <span class="string">'ap-northeast-2'</span>, <span class="comment"># 버킷 리전</span></span><br><span class="line">            <span class="string">'eventTime'</span>: <span class="string">'2017-12-13T03:28:13.528Z'</span>, <span class="comment"># 업로드 완료 시각 </span></span><br><span class="line">            <span class="string">'eventName'</span>: <span class="string">'ObjectCreated:Put'</span>,</span><br><span class="line">            <span class="string">'userIdentity'</span>: &#123;<span class="string">'principalId'</span>: <span class="string">'AFK2RA1O3ML1F'</span>&#125;,</span><br><span class="line">            <span class="string">'requestParameters'</span>: &#123;<span class="string">'sourceIPAddress'</span>: <span class="string">'123.24.137.5'</span>&#125;,</span><br><span class="line">            <span class="string">'responseElements'</span>: &#123;</span><br><span class="line">                <span class="string">'x-amz-request-id'</span>: <span class="string">'1214K424C14C384D'</span>,</span><br><span class="line">                <span class="string">'x-amz-id-2'</span>: <span class="string">'BOTBfAoB/gKBbn412ITN4t2psTW499iMRKZDK/CQTsjrkeSSzSdsDUMGabcdnvHeYNtbTDHoHKs='</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'s3'</span>: &#123;</span><br><span class="line">                <span class="string">'s3SchemaVersion'</span>: <span class="string">'1.0'</span>, <span class="string">'configurationId'</span>: <span class="string">'b249eeda-3d48-4319-a7e2-853f964c1a25'</span>,</span><br><span class="line">                <span class="string">'bucket'</span>: &#123;</span><br><span class="line">                    <span class="string">'name'</span>: <span class="string">'keras-blog'</span>, <span class="comment"># 버킷 이름 </span></span><br><span class="line">                    <span class="string">'ownerIdentity'</span>: &#123;</span><br><span class="line">                        <span class="string">'principalId'</span>: <span class="string">'AFK2RA1O3ML1F'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">'arn'</span>: <span class="string">'arn:aws:s3:::keras-blog'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">'object'</span>: &#123;</span><br><span class="line">                    <span class="string">'key'</span>: <span class="string">'wowwow/csv_icon.png'</span>, <span class="comment"># 버킷 내 파일의 절대경로</span></span><br><span class="line">                    <span class="string">'size'</span>: <span class="number">11733</span>, <span class="comment"># 파일 크기</span></span><br><span class="line">                    <span class="string">'eTag'</span>: <span class="string">'f2d12d123aebda1cc1fk17479207e838'</span>,</span><br><span class="line">                    <span class="string">'sequencer'</span>: <span class="string">'125B119E4D7B2A0A48'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>여기서 봐야 하는 것은 <code>bucket</code> 내 <code>name</code>와 <code>object</code>내 <code>key</code>입니다. 각각 업로드된 버킷의 이름과 버킷 내 파일이 업로드된 경로를 알려주기 때문에 S3 내 업로드된 파일의 절대경로를 알 수 있습니다.</p>
<p>따라서 <code>handler</code>함수 내 다음과 같이 버킷이름과 버킷 내 파일의 경로를 얻을 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 윗부분 생략</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    <span class="comment"># bucket_name은 'keras-blog' 가 됩니다.</span></span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    <span class="comment"># file_path는 'wowwow/csv_icon.png'가 됩니다.</span></span><br></pre></td></tr></table></figure>

<p>이를 통해 파일 업로드 이벤트 발생시마다 어떤 파일을 처리해야할 지 알 수 있습니다.</p>
<h3 id="s3에서-이미지-파일-받아오기"><a href="#s3에서-이미지-파일-받아오기" class="headerlink" title="s3에서 이미지 파일 받아오기"></a>s3에서 이미지 파일 받아오기</h3><p>이제 어떤 파일을 처리해야 할지 알 수 있게 되었으니 <code>downloadFromS3</code> 함수를 통해 실제로 파일을 가져와봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 윗부분 생략</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>] <span class="comment"># csv_icon.png</span></span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br></pre></td></tr></table></figure>

<p>위 코드를 보면 s3에 올라간 파일을 <code>/tmp</code>안에 받는 것을 볼 수 있습니다. AWS Lambda에서는 ‘쓰기’ 권한을 가진 것은 오직 <code>/tmp</code>폴더뿐이기 때문에 우리가 파일을 받아 사용하려면 <code>/tmp</code>폴더 내에 다운받아야 합니다. (혹은 온메모리에 File 객체로 들고있는 방법도 있습니다.)</p>
<h3 id="Prediction-Model-다운받기-Optional"><a href="#Prediction-Model-다운받기-Optional" class="headerlink" title="Prediction Model 다운받기 (Optional)"></a>Prediction Model 다운받기 (Optional)</h3><blockquote>
<p>만약 여러분이 그냥 사용한다면 Github에서 파일을 다운받게 됩니다. 이때 속도가 굉장히 느려 lambda비용이 많이 발생하기 때문에 여러분의 s3 버킷에 실제 파일을 올리고 s3에서 파일을 받아 사용하시는 것을 추천합니다.</p>
</blockquote>
<p>우리는 위에서 squeezenet모델을 사용했는데, 이때 모델 가중치를 담은 <code>.h5</code>파일을 먼저 받아야 합니다. <code>handler</code> 함수 내 다음 두 파일을 더 받아줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    downloadFromS3(</span><br><span class="line">        <span class="string">'keras-blog'</span>, </span><br><span class="line">        <span class="string">'squeezenet/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span>,</span><br><span class="line">        <span class="string">'/tmp/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span></span><br><span class="line">    ) <span class="comment"># weights용 h5를 s3에서 받아오기</span></span><br></pre></td></tr></table></figure>

<h3 id="squeezenet-모델로-Predict-하기"><a href="#squeezenet-모델로-Predict-하기" class="headerlink" title="squeezenet 모델로 Predict 하기"></a>squeezenet 모델로 Predict 하기</h3><p>이제 s3에 올라간 이미지 파일을 Lambda내 <code>/tmp</code>폴더에 받았으니 Predict를 진행해봅시다. <code>predict</code>라는 함수를 아래와 같이 이미지 경로를 받아 결과를 반환하도록 만들어 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># index.py 파일, handler함수보다 앞에 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img_local_path)</span>:</span></span><br><span class="line">    model = Squeezenet(weights=<span class="string">'imagenet'</span>)</span><br><span class="line">    img = image.load_img(img_local_path, target_size=(<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line">    x = image.img_to_array(img)</span><br><span class="line">    x = np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line">    x = preprocess_input(x)</span><br><span class="line">    preds = model.predict(x)</span><br><span class="line">    res = decode_predictions(preds)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    <span class="comment"># 내용 생략 ...</span></span><br></pre></td></tr></table></figure>

<p><code>predict</code>함수는 <code>squeezenet</code>의 Pre-trained 모델을 이용해 이미지 예측을 진행합니다.</p>
<p>그러면 실제 <code>handler</code>함수에서 <code>predict</code>함수를 실행하도록 수정해줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img_local_path)</span>:</span></span><br><span class="line">    <span class="comment"># 내용 생략 ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    downloadFromS3(</span><br><span class="line">        <span class="string">'keras-blog'</span>, </span><br><span class="line">        <span class="string">'squeezenet/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span>,</span><br><span class="line">        <span class="string">'/tmp/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span></span><br><span class="line">    )</span><br><span class="line">    result = predict(<span class="string">'/tmp/'</span>+file_name) <span class="comment"># 파일 경로 전달 </span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>완성이네요!</p>
<h2 id="DynamoDB에-결과-올리기-Optional"><a href="#DynamoDB에-결과-올리기-Optional" class="headerlink" title="DynamoDB에 결과 올리기(Optional)"></a>DynamoDB에 결과 올리기(Optional)</h2><p>위 predict의 결과는 단순히 결과가 생기기만 하고 결과를 저장하거나 알려주는 부분은 없습니다. 이번 글에서는 간단한 예시로 AWS DynamoDB에 쌓아보는 부분을 추가해보겠습니다.</p>
<p><code>predict</code>함수를 통해 생성된 <code>result</code>는 다음과 같은 모습이 됩니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># result[0]의 내용, tuples in list</span></span><br><span class="line">[(<span class="string">'n02099712'</span>, <span class="string">'Labrador_retriever'</span>, <span class="number">0.68165195</span>), (<span class="string">'n02099601'</span>, <span class="string">'golden_retriever'</span>, <span class="number">0.18365686</span>), (<span class="string">'n02104029'</span>, <span class="string">'kuvasz'</span>, <span class="number">0.12076716</span>), (<span class="string">'n02111500'</span>, <span class="string">'Great_Pyrenees'</span>, <span class="number">0.0042763283</span>), (<span class="string">'n04409515'</span>, <span class="string">'tennis_ball'</span>, <span class="number">0.002152696</span>)]</span><br></pre></td></tr></table></figure>

<p>따라서 <code>map</code>을 이용해 다음과 같이 바꿔줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_tmp_dic = &#123;x[<span class="number">1</span>]:&#123;<span class="string">'N'</span>:str(x[<span class="number">2</span>])&#125; <span class="keyword">for</span> x <span class="keyword">in</span> result[<span class="number">0</span>]&#125;</span><br><span class="line">dic_for_dynamodb = &#123;<span class="string">'M'</span>: _tmp_dic&#125;</span><br></pre></td></tr></table></figure>

<p>그러면 <code>dic_for_dynamodb</code>는 아래와 같은 형태로 나오게 됩니다. </p>
<blockquote>
<p>NOTE: 숫자는 <code>float</code>나 <code>int</code>가 아닌 <code>str</code>로 바꾸어 전달해야 오류가 나지 않습니다. DynamoDB의 제약입니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">'M'</span>:&#123;</span><br><span class="line">            <span class="string">'Labrador_retriever'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.68165195'</span>&#125;, </span><br><span class="line">            <span class="string">'golden_retriever'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.18365686'</span>&#125;, </span><br><span class="line">            <span class="string">'kuvasz'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.12076716'</span>&#125;, </span><br><span class="line">            <span class="string">'Great_Pyrenees'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.0042763283'</span>&#125;, </span><br><span class="line">            <span class="string">'tennis_ball'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.002152696'</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>데이터를 넣기 위해서는 <code>dict</code>타입으로 만든 객체를 <code>put</code>할수 있는데, 이때 각각의 키에 대해 타입을 알려줘야 합니다. <code>M</code>은 이 객체가 <code>dict</code>타입이라는 것을, <code>N</code>은 이 타입이 숫자라는 것을, <code>S</code>는 문자열이라는 것을 의미합니다.</p>
<blockquote>
<p>더 상세한 내용은 <a href="https://boto3.readthedocs.io/en/latest/reference/services/dynamodb.html#DynamoDB.Client.put_item">DynamoDB에 데이터 넣기</a>를 참고하세요.</p>
</blockquote>
<p>이제 이 방식을 이용해 <code>result</code>를 반환하기 전 DynamoDB에 데이터를 넣어줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    <span class="comment"># 중간 생략 ...</span></span><br><span class="line">    result = predict(<span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    _tmp_dic = &#123;x[<span class="number">1</span>]:&#123;<span class="string">'N'</span>:str(x[<span class="number">2</span>])&#125; <span class="keyword">for</span> x <span class="keyword">in</span> result[<span class="number">0</span>]&#125;</span><br><span class="line">    dic_for_dynamodb = &#123;<span class="string">'M'</span>: _tmp_dic&#125;</span><br><span class="line">    dynamo_client = boto3.client(</span><br><span class="line">        <span class="string">'dynamodb'</span>, </span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">        region_name=<span class="string">'ap-northeast-2'</span> <span class="comment"># DynamoDB는 리전 이름이 필요합니다.</span></span><br><span class="line">    )</span><br><span class="line">    dynamo_client.put_item(</span><br><span class="line">        TableName=<span class="string">'keras-blog-result'</span>, <span class="comment"># DynamoDB의 Table이름</span></span><br><span class="line">        Item=&#123;</span><br><span class="line">            <span class="string">'filename'</span>: &#123;</span><br><span class="line">                <span class="string">'S'</span>: file_name,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'predicts'</span>: dic_for_dynamodb,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="도커로-Lambda에-올릴-pack-zip파일-만들기"><a href="#도커로-Lambda에-올릴-pack-zip파일-만들기" class="headerlink" title="도커로 Lambda에 올릴 pack.zip파일 만들기"></a>도커로 Lambda에 올릴 <code>pack.zip</code>파일 만들기</h2><p>AWS Lambda에 함수를 올리려면 AmazonLinux에 맞게 pip패키지들을 <code>index.py</code> 옆에 같이 설치해준 뒤 압축파일(.zip)으로 묶어 업로드해야 합니다.</p>
<p>이때 약간의 제약이 있는데, AWS콘솔에서 Lambda로 바로 업로드를 하려면 .zip파일이 50MB보다 작아야 하고, S3에 .zip파일을 올린 뒤 Lambda에서 가져와 사용하려면 압축을 푼 크기가 250MB보다 작아야 합니다.</p>
<p>문제는 Tensorflow나 기타 라이브러리를 모두 설치하면 용량이 무지막지하게 커진다는 점인데요, 이를 해결하기 위해 사용하지 않는 부분을 strip하는 방법이 들어갑니다.</p>
<p>앞서만든 AmazonLinux 기반 컨테이너인 <code>lambdapack</code>를 이용해 패키지들을 설치하고 하나의 압축파일로 만들어줍시다.</p>
<p>아래 내용의 <code>buildPack.sh</code>파일을 <code>index.py</code> 옆에 만들어 주세요.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buildPack.sh</span></span><br><span class="line"><span class="function"><span class="title">dev_install</span></span> () &#123;</span><br><span class="line">    yum -y update</span><br><span class="line">    yum -y upgrade</span><br><span class="line">    yum install -y \</span><br><span class="line">    wget \</span><br><span class="line">    gcc \</span><br><span class="line">    gcc-c++ \</span><br><span class="line">    python36-devel \</span><br><span class="line">    python36-virtualenv \</span><br><span class="line">    python36-pip \</span><br><span class="line">    findutils \</span><br><span class="line">    zlib-devel \</span><br><span class="line">    zip</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pip_rasterio</span></span> () &#123;</span><br><span class="line">    <span class="built_in">cd</span> /home/</span><br><span class="line">    rm -rf env</span><br><span class="line">    python3 -m virtualenv env --python=python3</span><br><span class="line">    <span class="built_in">source</span> env/bin/activate</span><br><span class="line">    text=<span class="string">"</span></span><br><span class="line"><span class="string">    [global]</span></span><br><span class="line"><span class="string">    index-url=http://ftp.daumkakao.com/pypi/simple</span></span><br><span class="line"><span class="string">    trusted-host=ftp.daumkakao.com</span></span><br><span class="line"><span class="string">    "</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$text</span>"</span> &gt; <span class="variable">$VIRTUAL_ENV</span>/pip.conf</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"UNDER: pip.conf ==="</span></span><br><span class="line">    cat <span class="variable">$VIRTUAL_ENV</span>/pip.conf</span><br><span class="line">    pip install -U pip wheel</span><br><span class="line">    pip install --use-wheel <span class="string">"h5py==2.6.0"</span></span><br><span class="line">    pip install <span class="string">"pillow==4.0.0"</span></span><br><span class="line">    pip install protobuf html5lib bleach --no-deps</span><br><span class="line">    pip install --use-wheel tensorflow --no-deps</span><br><span class="line">    deactivate</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">gather_pack</span></span> () &#123;</span><br><span class="line">    <span class="comment"># packing</span></span><br><span class="line">    <span class="built_in">cd</span> /home/</span><br><span class="line">    <span class="built_in">source</span> env/bin/activate</span><br><span class="line"></span><br><span class="line">    rm -rf lambdapack</span><br><span class="line">    mkdir lambdapack</span><br><span class="line">    <span class="built_in">cd</span> lambdapack</span><br><span class="line"></span><br><span class="line">    cp -R /home/env/lib/python3.6/site-packages/* .</span><br><span class="line">    cp -R /home/env/lib64/python3.6/site-packages/* .</span><br><span class="line">    cp /outputs/squeezenet.py /home/lambdapack/squeezenet.py</span><br><span class="line">    cp /outputs/index.py /home/lambdapack/index.py</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"original size <span class="variable">$(du -sh /home/lambdapack | cut -f1)</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cleaning libs</span></span><br><span class="line">    rm -rf external</span><br><span class="line">    find . -<span class="built_in">type</span> d -name <span class="string">"tests"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; +</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cleaning</span></span><br><span class="line">    find -name <span class="string">"*.so"</span> | xargs strip</span><br><span class="line">    find -name <span class="string">"*.so.*"</span> | xargs strip</span><br><span class="line">    rm -r pip</span><br><span class="line">    rm -r pip-*</span><br><span class="line">    rm -r wheel</span><br><span class="line">    rm -r wheel-*</span><br><span class="line">    rm easy_install.py</span><br><span class="line">    find . -name \*.pyc -delete</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"stripped size <span class="variable">$(du -sh /home/lambdapack | cut -f1)</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># compressing</span></span><br><span class="line">    zip -FS -r1 /outputs/pack.zip * &gt; /dev/null</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"compressed size <span class="variable">$(du -sh /outputs/pack.zip | cut -f1)</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span> () &#123;</span><br><span class="line">    dev_install</span><br><span class="line">    pip_rasterio</span><br><span class="line">    gather_pack</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>

<p><code>dev_install</code> 함수에서는 운영체제에 Python3/pip3등을 설치해 주고, <code>pip_rasterio</code> 함수에서는 가상환경에 들어가 tensorflow등 pip로 패키지들을 설치해 주고, <code>gather_pack</code> 함수에서는 가상환경에 설치된 패키지들과 <code>index.py</code>파일을 한 폴더에 모은 뒤 <code>pack.zip</code>파일로 압축해줍니다.</p>
<blockquote>
<p>중간에 <code>pip.conf</code>를 바꾸는 부분을 통해 느린 pip global cdn대신 kakao의 pip 미러서버로 좀 더 패키지들을 빠르게 받을 수 있습니다. 이 방법은 여러분의 pip에도 바로 적용할 수 있습니다.</p>
</blockquote>
<p>이 sh 파일을 도커 내에서 실행하기 위해서 다음 명령어를 사용해 실행해주세요.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it lambdapack /bin/bash /outputs/buildPack.sh</span><br></pre></td></tr></table></figure>

<p>이 명령어는 <code>lambdapack</code>이라는 컨테이너에서 <code>buildPack.sh</code>파일을 실행하게 됩니다.</p>
<p>실행하고 나면 약 50MB안팎의 <code>pack.zip</code>파일 하나가 생긴것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.27.11.png" alt=""></p>
<p>하지만 앞서 언급한 것처럼, AWS 콘솔에서 ‘ZIP 파일 올리기’로 한번에 올릴수 있는 압축파일의 용량은 50MB로 제한됩니다. 따라서 이 zip 파일을 s3에 올린 뒤 zip파일의 HTTP주소를 넣어줘야 합니다.</p>
<h2 id="zip파일-s3에-올리고-AWS-Lambda-트리거-만들기"><a href="#zip파일-s3에-올리고-AWS-Lambda-트리거-만들기" class="headerlink" title="zip파일 s3에 올리고 AWS Lambda 트리거 만들기"></a>zip파일 s3에 올리고 AWS Lambda 트리거 만들기</h2><p>이제 AWS 콘솔을 볼 때가 되었습니다.</p>
<p>지금까지 작업한 것은 Lambda에 올릴 패키지/코드를 압축한 파일인데요, 이 부분을 약간 수정해 이제 실제로 AWS Lambda의 이벤트를 통해 실행해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.31.32.png" alt="s3에 파일 업로드하기"></p>
<p>S3에 파일을 올린 뒤 파일의 HTTPS주소를 복사해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.32.11.png" alt="s3의 pack.zip HTTP주소"></p>
<p>여기에서는 <code>https://s3.ap-northeast-2.amazonaws.com/keras-blog/pack.zip</code>가 주소가 됩니다.</p>
<p>이제 진짜로 AWS Lambda 함수를 만들어봅시다.</p>
<p><a href="https://ap-northeast-2.console.aws.amazon.com/lambda/home?region=ap-northeast-2#/create">Lambda 콘솔 함수만들기</a>에 들어가 “새로 작성”을 선택 후 아래와 같이 내용을 채운 뒤 함수 생성을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.34.39.png" alt=""></p>
<p>함수가 생성되고 나면 화면 아래쪽 ‘함수 코드’에서 다음과 같이 AWS s3에서 업로드를 선택하고 런타임을 Python3.6으로 잡은 뒤 핸들러를 <code>index.handler</code>로 바꾸고 S3링크를 넣어준 뒤 ‘저장’을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.38.45.png" alt=""></p>
<p>그 뒤, ‘기본 설정’에서 메모리를 1500MB 이상으로, 그리고 제한시간은 30초 이상으로 잡아주세요. 저는 테스트를 위해 3000MB/5분으로 잡아주었습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.22.39.png" alt=""></p>
<p>이제 s3에서 파일이 추가될때 자동으로 실행되도록 만들어 주기 위해 다음과 같이 ‘구성’에서 s3를 선택해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.40.23.png" alt="트리거에서 s3 선택하기"></p>
<p>이제 화면 아래에 ‘트리거 구성’ 메뉴가 나오면 아래 스크린샷처럼, 파일을 올릴 s3, 그리고 어떤 이벤트(파일 업로드/삭제/복사 등)를 탐지할지 선택하고, 접두사에서 폴더 경로를 <code>폴더이름/</code>으로 써 준 뒤, 필요한 경우 접미사(주로 파일 확장자)를 써 주면 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2009.55.57.png" alt="S3 트리거 구성"></p>
<p>이번에는 <code>keras-blog</code>라는 버킷 내 <code>uploads</code>폴더 내에 어떤 파일이든 생성되기만 하면 모두 람다 함수를 실행시키는 것으로 만들어 본 것입니다.</p>
<blockquote>
<p>NOTE: 접두사/접미사에 <code>or</code> 조건은 AWS콘솔에서 지원하지 않습니다.</p>
</blockquote>
<p>추가버튼을 누르고 난 뒤 저장을 눌러주면 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.00.00.png" alt="함수 저장하기"></p>
<p>트리거가 성공적으로 저장 되었다면 다음과 같은 화면을 볼 수 있을거에요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.01.52.png" alt="람다 함수 다 만든 모습"></p>
<h2 id="Lambda-환경변수-추가하기"><a href="#Lambda-환경변수-추가하기" class="headerlink" title="Lambda 환경변수 추가하기"></a>Lambda 환경변수 추가하기</h2><p>우리가 앞서 <code>index.py</code>에서 <code>os.environ</code>을 통해 시스템의 환경변수를 가져왔습니다. 이를 정상적으로 동작하게 하기 위해서는 <code>ACCESS_KEY</code>와 <code>SECRET_KEY</code>을 추가해주어야 합니다. 아래 스크린샷처럼 각각 값을 입력하고 저장해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2011.21.21.png" alt="환경변수 추가하기"></p>
<blockquote>
<p>이 키는 AWS <code>iam</code>을 통해 가져올 수 있습니다. 해당 iam계정은 s3 R/W권한, DynamoDB write 권한이 있어야 합니다.</p>
</blockquote>
<h2 id="Lambda-내-테스트-돌리기-Optional"><a href="#Lambda-내-테스트-돌리기-Optional" class="headerlink" title="Lambda 내 테스트 돌리기(Optional)"></a>Lambda 내 테스트 돌리기(Optional)</h2><p>AWS Lambda 콘솔에서도 테스트를 돌릴 수 있습니다.</p>
<p>아래와 같이 event 객체를 만들어 전달하면 실제 이벤트처럼 동작합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.16.35.png" alt="예제 테스트"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Records"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"s3"</span>: &#123;</span><br><span class="line">                <span class="attr">"bucket"</span>: &#123;<span class="attr">"name"</span>: <span class="string">"keras-blog"</span>&#125;,</span><br><span class="line">               <span class="attr">"object"</span>: &#123;<span class="attr">"key"</span>: <span class="string">"uploads/kitten.png"</span>&#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>유의: 실제로 <code>keras-blog</code>버킷 내 <code>uploads</code>폴더 내 <code>kitten.png</code>파일이 있어야 테스트가 성공합니다! (인터넷의 아무 사진이나 넣어두세요.)</p>
</blockquote>
<p>테스트가 성공하면 다음과 같이 <code>return</code>된 결과가 json으로 보입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.15.44.png" alt="람다콘솔 테스트 성공"></p>
<h2 id="마무리-파일-업로드하고-DB에-쌓이는지-확인하기"><a href="#마무리-파일-업로드하고-DB에-쌓이는지-확인하기" class="headerlink" title="마무리: 파일 업로드하고 DB에 쌓이는지 확인하기"></a>마무리: 파일 업로드하고 DB에 쌓이는지 확인하기</h2><p>이제 s3에 가서 파일을 업로드 해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.19.34.png" alt="s3에 파일 업로드"></p>
<p><code>keras-blog</code> 버킷 내 <code>uploads</code>폴더에 고양이 사진 몇 개를 올려봅시다.</p>
<p>몇초 기다리면 DynamoDB에 다음과 같이 파일 이름과 Predict된 결과가 쌓이는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.20.04.png" alt="DynamoDB에 쌓인 결과"></p>
<p>이제 우리는 파일이 1개가 올라가든 1000개가 올라가든 모두 동일한 속도로 결과를 얻을 수 있습니다.</p>

        </div>
        
        
        
    </div>
</div>








</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/profile_beomi.jpg" alt="Junbum Lee">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Junbum Lee
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Beomi&#39;s tech blog
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Seoul, KR</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/beomi">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                카테고리
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/DataCollection/">
            <span class="level-start">
                <span class="level-item">DataCollection</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DataCollection/Twitter/">
            <span class="level-start">
                <span class="level-item">Twitter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/">
            <span class="level-start">
                <span class="level-item">DevEnv</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DevEnv/DataScience/">
            <span class="level-start">
                <span class="level-item">DataScience</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/DeepLearning/">
            <span class="level-start">
                <span class="level-item">DeepLearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Git/">
            <span class="level-start">
                <span class="level-item">Git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Ubuntu/">
            <span class="level-start">
                <span class="level-item">Ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Django/">
            <span class="level-start">
                <span class="level-item">Django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Django/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/">
            <span class="level-start">
                <span class="level-item">DjangoTDDStudy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/MacOS/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/NLP/">
            <span class="level-start">
                <span class="level-item">NLP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/NLP/LanguageModel/">
            <span class="level-start">
                <span class="level-item">LanguageModel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/NLP/Unsupervised/">
            <span class="level-start">
                <span class="level-item">Unsupervised</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Postmortem/">
            <span class="level-start">
                <span class="level-item">Postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Python/Celery/">
            <span class="level-start">
                <span class="level-item">Celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/Fabric/">
            <span class="level-start">
                <span class="level-item">Fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Tech/">
            <span class="level-start">
                <span class="level-item">Tech</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Translation/">
            <span class="level-start">
                <span class="level-item">Translation</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/aws/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/azure/">
            <span class="level-start">
                <span class="level-item">azure</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/blog/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/django/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/django/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/flask/sqlalchemy/">
            <span class="level-start">
                <span class="level-item">sqlalchemy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/javascript/webpack/">
            <span class="level-start">
                <span class="level-item">webpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/machinelearning/">
            <span class="level-start">
                <span class="level-item">machinelearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/machinelearning/seminar/">
            <span class="level-start">
                <span class="level-item">seminar</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/macos/">
            <span class="level-start">
                <span class="level-item">macos</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/macos/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/nlp/">
            <span class="level-start">
                <span class="level-item">nlp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/nlp/languagemodel/">
            <span class="level-start">
                <span class="level-item">languagemodel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/postmortem/">
            <span class="level-start">
                <span class="level-item">postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">25</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/python/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/celery/">
            <span class="level-start">
                <span class="level-item">celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/dataanalysis/">
            <span class="level-start">
                <span class="level-item">dataanalysis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/pyspark/">
            <span class="level-start">
                <span class="level-item">pyspark</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/react/">
            <span class="level-start">
                <span class="level-item">react</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/react/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/tips/githubpages/">
            <span class="level-start">
                <span class="level-item">githubpages</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ubuntu/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/vlang/">
            <span class="level-start">
                <span class="level-item">vlang</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Beomi&#39;s Tech Blog
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Junbum Lee&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("ko");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://beomi.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Kembali ke atas" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>








<script src="/js/main.js" defer></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
</body>
</html>