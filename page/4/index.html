<!DOCTYPE html>
<html  lang="ko">
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.1" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Beomi&#39;s Tech blog</title>








<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89162642-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-89162642-1');
</script>

    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    


<link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="is-3-column">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                Beomi&#39;s Tech Blog
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="https://junbuml.ee">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/12/30/Blog-1Year-2017/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/Goodbye-2017-Welcome-2018.jpg" alt="2017년 회고 &amp; 블로그 연말정산">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-12-29T15:00:00.000Z">2017-12-30</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/life/">life</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/12/30/Blog-1Year-2017/">2017년 회고 &amp; 블로그 연말정산</a>
            
        </h1>
        <div class="content">
            <h2 id="올해-2017년"><a href="#올해-2017년" class="headerlink" title="올해, 2017년."></a>올해, 2017년.</h2><p>올해는 정말 내게 큰 변화가 있던 한해였다. 특히 개발/프로그래밍쪽으로 다양한 기회를 여러가지 받게 되었고, 정말 많은 성장을 했다고 느낀다.</p>
<p>올해를 월별로 정리해보자면…</p>
<h4 id="1월-DjangoGirls-Seoul"><a href="#1월-DjangoGirls-Seoul" class="headerlink" title="1월, DjangoGirls Seoul"></a>1월, DjangoGirls Seoul</h4><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dgseoul-transparent-orange.png" alt=""></p>
<p>1월, 장고걸스 서울에 운영진으로 함께 시작하고 ‘나만의 웹크롤러 만들기’ 시리즈 연재를 시작했다. 그리고 작년 12월에 시작한 TDD 스터디도 함께 진행했다.</p>
<h4 id="2월-스터디-amp-첫-외주"><a href="#2월-스터디-amp-첫-외주" class="headerlink" title="2월, 스터디 &amp; 첫 외주"></a>2월, 스터디 &amp; 첫 외주</h4><p>2월, 장고를 이용해 교대 학생 대상으로 새로운 서비스를 오픈했다. 토이 프로젝트로 실제 배포까지 이뤄본 케이스. 이때 Vue를 처음 듣고 이용해보았다. 그리고 데이터분석 관련한 스터디도 진행해 데이터분석 분야에도 관심을 갖기 시작했다. 장고걸스 서울에서 장고 스터디를 운영하는 등 스터디를 다양하게 진행했다. 그리고 장고를 사용한 웹 사이트 개발을 하는 외주를 하나 받기도 했다. 처음으로 돈을 받고 개발을 하는 것이라 굉장한 부담이 되었지만 지금 생각해보면, 이때 약간의 자신감을 얻었다. </p>
<h4 id="3월-개강"><a href="#3월-개강" class="headerlink" title="3월, 개강!"></a>3월, 개강!</h4><p>3월, 블로그 테마를 현재 테마로 바꾸고 웹 크롤러 시리즈를 조금씩 더 쌓아갔다. 그리고 React 기초를 조금씩 배워보려고 시작했다가, JS에 대해 이해가 없어(ES6와 Babel이 뭔지도 모르는 상황) 전혀 진도를 내지 못했다. 게다가 개강이 겹쳐 일정을 내기가 상당히 힘들어졌었다. TDD 스터디도 조금씩 사람이 빠져 3월에는 더이상 진행하지 못하고 마무리 되었다.</p>
<h4 id="4월-9XD"><a href="#4월-9XD" class="headerlink" title="4월, 9XD"></a>4월, 9XD</h4><p>4월, 9XD 8회 모임을 DevSisters에서 가지게 되었다. 사람들과 이야기를 나누며 느꼈던 것이 작년 말과 이때 내가 공부한 것과 만든 것의 큰 차이가 없다는 것이어서 약간 아쉬웠지만..(1Q에 대체 뭘했나..하던 생각) 그래도 글을 쓰고있는 지금 돌아보니 한 것이 조금은 있는것 같아보인다. :) 9XD 모임에서 발표하는 사람들을 보고 ‘아, 나도 저렇게 발표할 수 있을만큼 실력이 되면 좋겠다’ 라고 생각도 해보고 GraphQL에 대해 알게 되는 계기가 되기도 했다. 그리고 4월말 장고걸스 서울에서 격월 Meetup을 토즈에서 열었는데 생각보다 반응이 좋았다! 내가 사회를 맡았는데 진행에 사람들의 집중을 모으는 것이 어려워 약간 아쉬웠지만 전체적으로 굉장히 즐거운 모임이었다.</p>
<h4 id="5월-ETH"><a href="#5월-ETH" class="headerlink" title="5월, ETH"></a>5월, ETH</h4><p>5월, 학교 내 오버워치 대회를 마무리 했다. 우리과 친구들이 (나빼고) 다 잘해서 우승! 그리고 베를린 필하모닉 유로파 콘서트를 보고왔다.(메가박스에서 실시간 스트리밍으로 보여준다. 짱짱.) 그리고 3학년 1학기 실습도 다녀왔다. 학교 생활에 바빴던 5월. 이 기간에 비트코인과 이더리움이 급상승하고 주변에서 아는 사람들은 비트코인과 이더리움을 이야기하기 시작했다.(이때 샀어야 했는데) 이때 가격과 지금 가격이 10배 차이(…) 그리고 5월에 있었던 4회 파이썬 격월 세미나에서 “굥대생의 Hello World!”라는 제목으로 발표를 진행했다. 이 발표는 ‘내가 어떻게 개발을 시작하게 되었나’ 였는데, 지금 글을 쓰는 12월에 돌아보면 이 사이에 정말 많은 성장의 기회를 가졌다는 체감이 된다. 7개월이 아니라 마치 1년 7개월 전의 일 같은 기분.</p>
<h4 id="6월-터닝포인트"><a href="#6월-터닝포인트" class="headerlink" title="6월, 터닝포인트"></a>6월, 터닝포인트</h4><p>6월, 아는 분의 추천으로 키움증권에서 Python강의를 몇차례 진행했다. 종강 직후 학교 동아리 친구들과 3일정도 일본에 여행을 다녀왔다. 이때 에어팟을 사려고 재고를 미친듯이 찾아다니다 귀국하는 날 아침에 애플스토어에 재고가 들어온 것을 보고 체크아웃하기 직전에 뛰어가 구매했다.(이 에어팟은 지금도 잘 쓰고 다닌다.) 그리고 6월에는 장고걸스 행사 중 가장 큰 행사인 워크숍을 열었다. 이때 MS에서 장소 제공과 Azure Credit을 제공해줘 이 가이드로 수정 가이드를 만들었는데, 블로그에 올려뒀던 가이드에 약간 문제가 있어서 정신없이 뛰어다녔던 기억이 난다.</p>
<p>그리고 6월에는 정말 큰 이벤트가 있었다. 바로 우아한형제들에서 <strong>우아한테크캠프 인턴</strong>을 모집했던 것. 이때 지원하면서 내가 얻고싶었던 것은 바로 ‘내가 개발을 해도 될까?’라는 질문에 대한 답이었다. 사실 이 질문은 아직도 내가 품고있는 질문이다. <strong>‘나는 과연 개발자로 살아갈 수 있는 사람일까?’</strong> 그래도 굉장히 멋진 기회(코드스쿼드에서 교육을 진행했다!)라고 생각해 떨어질 때 떨어지더라도 지원을 하자! 라는 생각으로 지원서를 넣었고 운좋게 서류와 코딩테스트를 통과했지만 마지막 면접에서 제대로 대답을 하지 못했는지 최종적으로는 불합격 메일을 받았다. 사실 이때 나는 ‘아, 그냥 이길이 내 길이 아닌 것을 빨리 알게 되어서 다행이다.’ 라는 생각을 했다. 말 그대로 취미로 개발을 하더라도 직업으로 삼지는 못하겠구나, 라고 생각하던 중…. 전화가 왔다. 자리가 났는데 혹시 아직 올 생각이 있냐는 전화. 바로 네 라고 대답하고 아, 그래도 문 닫고 들어왔구나.. 하고 생각했다. 그리고 이때 참여하기로 결정한 것은 정말 <strong>최고의 선택</strong>이었다.</p>
<h4 id="7월-우아한테크캠프"><a href="#7월-우아한테크캠프" class="headerlink" title="7월, 우아한테크캠프"></a>7월, 우아한테크캠프</h4><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/woowa_techcamp_01.jpg" alt=""></p>
<p>7월, 우아한테크캠프에서 웹 프론트 트랙에 들어가 JS에 대해 정말 친숙하게 되었다. 그전까지는 잘 쓰지도 못하면서 투덜댔다면 지금은 잘 쓰지는 못하더라도 조금은 알고 투털대는 수준이 되었다. 코드스쿼드 윤지수마스터님이 메인으로 진행해주시고 김정마스터님과 정호영마스터님이 진행하신 트랙도 정말 재미있게 들었다. 그리고 알고리즘의 ㅇ 도 모르던 내가 4차례 정도 진행한 김범준CTO님의 수업을 통해 <code>nlogn</code>이 뭔지, 그리고 문제 해결 능력에 대해 다시한번 생각해보게 되었다.</p>
<p>그뿐만 아니라 7월에는 정말 다양한 제의가 들어왔다. 인프런에서 크롤링 온라인 강의 제안과 패스트캠퍼스에서 크롤링 강의제안을 받았다. 어디서 보셨나 물으니 블로그 글을 보고 연락을 주셨다고 했다. 게다가 출판사에서 집필 제의까지 들어왔다. 정말 믿기지 않을 정도로 좋은 제의를 해주셔서 정말 감사한 마음으로 받았다. (지금 생각해도 놀라운 기회들이다.) </p>
<blockquote>
<p>여러분 블로깅하세요, 꼭 하세요!! </p>
</blockquote>
<h4 id="8월-파이콘"><a href="#8월-파이콘" class="headerlink" title="8월, 파이콘"></a>8월, 파이콘</h4><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/pyconkr-2017-cover.png" alt=""></p>
<p>8월, 우아한테크캠프에서 팀별로 프로젝트를 진행했다. 웹 프론트에서 CSS가..(한숨) 정말로 까다롭다는 것을 다시한번 느끼게 되었다. 그리고 혼자 개발하는 것이 아니라 여럿이서 팀으로 개발을 한다는 것에서 협업에 대해 많은 경험을 하고 여러가지 생각을 하는 기회가 되었다. </p>
<p>그리고 파이콘 튜토리얼을 신청한 것을 진행하기 위한 사전 준비모임을 갔다가, 발표할 기회까지 얻게 되었다.(원래는 파이콘 발표 신청을 했다가 떨어졌었다.) 준비할 시간이 몇주 없었지만 작년 파이콘을 보며 올해 이루고 싶었던 목표 중 하나였던 <strong>파이콘 발표하기</strong>를 할 수 있게 된 것이 굉장히 기뻤다. 파이콘 전날 리허설을 하니 딱 45분이 맞았는데, 행사 당일에도 시간이 잘 맞아 다행이었다. 사실 행사장이 2층이라 사람들이 많이 안올까 걱정했는데 사람들이 의자를 다 채우는 것도 모자라 바닥에 앉고 뒤에 가득가득 서있는 모습을 보고 ‘세상에…’ 라는 생각을 했다. 그리고 이 발표는 또다른 기회들을 불러왔다.</p>
<blockquote>
<p>여러분 커뮤니티하세요, 꼭 하세요!!</p>
</blockquote>
<h4 id="9월-휴학"><a href="#9월-휴학" class="headerlink" title="9월, 휴학!!"></a>9월, 휴학!!</h4><p>9월, <strong>휴학하기로 마음먹었다.</strong> 사실 이 결정을 하기까지 굉장히 많은 고민을 거쳤다. 교대에서는 휴학을 웬만하면 하지 않고 4년을 쭉 다니다 임용고시를 치른 뒤 졸업하는 것이 일반적이기 때문. 하지만 나에게 주어진 수많은 기회들을 손끝사이로 흘려보내고 싶지 않았다. 욕심이라고 말할 수 있지만, 이 멋진 기회들을 모두 잡고 싶었다. 그래서 휴학을 하기로 결정했다.</p>
<blockquote>
<p>휴학하면 여유로울 줄 알았더니…</p>
</blockquote>
<p>사실 휴학하고 나서 잠시 여유로웠지만 여유로울 새도 없이 금새 바빠졌다. 크롤링 강의를 진행할 때 만약 이때 학교를 다니고 있었다면 패캠에서 첫기 강의를 망칠 뻔 했다. 강의자료가 모두 준비된 상태가 아니라 매주 2회차씩 강의자료를 준비했더니.. 매주 두번 마감에 쫓기는 기분으로 4주를 보냈던 것 같다. 그러다가 파이콘에서 받은 제의가 하나가 나왔다. 넥슨에서 아르바이트 형식으로 웹 개발 하기.</p>
<h4 id="10월-넥슨"><a href="#10월-넥슨" class="headerlink" title="10월, 넥슨"></a>10월, 넥슨</h4><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/nexon-kr.jpg" alt=""></p>
<p>넥슨 인텔리전스랩스 어뷰징탐지TF 팀장님이 파이콘에서 10월~12월에 짧게라도 웹 개발(주로 프론트)을 해보지 않겠냐는 제의를 해 주셨다. 내가 과연 회사에서 개발을 할 수 있는 실력이 될까-하는 약간의 두려움이 있었지만 제의를 받기로 결정했다. 우아한형제들에서 인턴을 진행했지만 실무에 대한 경험은 아니었기 때문에 <strong>‘나는 과연 개발자로 살아갈 수 있는 사람일까?’</strong>에 대한 답을 명확히 얻지는 못했기 때문이다. 우아한테크캠프에서 배운 프론트와 기존에 하던 백엔드 지식을 기반으로 개발을 나름 열심히 진행했다. 작지만 조금씩 서비스를 만들어가며 기존에 사용하지 않던 스택(<code>PySpark</code>, <code>Hadoop</code>,<code>EMR</code>와 같은 분산처리 등)도 알게 되고 딥러닝 등을 이용한 데이터 분석을 하는 모습을 바로 옆에서 지켜보니 자연스럽에 데이터분석 분야에도 관심을 갖게 되었다. </p>
<p>그리고 10월에는 메이커페어 이벤트가 있었다. <strong>GEEKHUB</strong>이라는 이름을 가진 모임에서 ‘공대탈출’이라는 이름으로 부스를 열고 운영도 해보며 친구들과 함께 무언가를 진행했다는 것에 뿌듯함을 느끼기도 했다.</p>
<h4 id="11월-다시-Django"><a href="#11월-다시-Django" class="headerlink" title="11월, 다시:Django"></a>11월, 다시:Django</h4><p>11월 초에는 장고걸스 서울에서 세미나를 열었다. AskDjango의 진석님이 Azure+크롤링을, Hannal님이 장고Admin을, 허신영님이 Kaggle에 대한 강의를 해주셔서 굉장히 높은 퀄리티의 세미나가 되었다. 그리고 처음으로 100명을 염두에 둔 행사이기도 했다. (보통 장고걸스 서울에서 연 행사는 워크숍을 제외하고는 30명 내 규모로 이뤄졌다.) 이때 장고걸스 서울이라는 커뮤니티가 굉장히 많이 성장했다는 생각이 들었다.</p>
<h4 id="12월-개발자로의-삶을-고민하다"><a href="#12월-개발자로의-삶을-고민하다" class="headerlink" title="12월, 개발자로의 삶을 고민하다"></a>12월, 개발자로의 삶을 고민하다</h4><p>12월 첫날부터 Vuetiful Korea 세미나가 있었다. Vue를 많이 사용하지는 않지만 그래도 관심은 지속적으로 가지고 있기 때문에 이번에도 참석. 그리고 바로 다음주에 파이썬 연말 세미나가 있었다. ‘헛된꿈’이라는 간단한 투표 웹 사이트가 있었는데 재미로 ‘좋아요’수를 눌리는 코드를 짜보기도 했다.(재미있다)</p>
<p>그러다 굉장히 멋진 제의가 들어왔다. 넥슨에 계속 다니지 않겠냐는 제의로, 내년부터 <strong>정직원</strong>으로 다니지 않겠냐는 것. 사실 이 제의를 받고 <strong>‘나는 과연 개발자로 살아갈 수 있는 사람일까?’</strong>에 대한 답을 조금은 찾은 듯한 느낌이 들었다. 어쩌면, 나는 개발자로 살아가도 괜찮지 않을까 하는 그런 작은 자신감. 코딩 테스트와 면접을 거쳐 내년에도 지금 있는 팀에 계속 다니기로 이야기가 되었다.</p>
<blockquote>
<p>정말 좋은 기회들이 다가왔다.</p>
</blockquote>
<p>나는 운이 좋다. 정말로 좋은 편이다. 지금까지 한 선택, 멀게는 교대 진학을 선택한 것부터 올해의 중요한 선택들에서 굉장히 좋은 선택지들을 골라왔다고 생각한다. 물론 아직 모르는 것이 한참 많은 늅늅이지만, 그래도 이제 어디 가서 ‘개발해요’라고 말은 하고 다닐 수 있을 것 같다.</p>
<p>올 한해는 정말 1년이 아니라 3년을 보낸 것 같은 기분이다. 수많은 멋진 기회들이 주어지고 그 기회들을 통해 성장했다. 작년보다 성장한 올해, 올 한해는 지금까지 내 삶에서 최고점을 주고싶다. 내년에도 올해와 같이 즐기며 성장할 수 있길 꿈꾼다.</p>
<blockquote>
<p>어제보다 나은 오늘의 내가 되기를.</p>
</blockquote>
<p>올해의 후기를 마무리짓고 이제 블로그 이야기를 조금 더 해보려 한다.</p>
<h2 id="블로그-이야기"><a href="#블로그-이야기" class="headerlink" title="블로그 이야기"></a>블로그 이야기</h2><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/blog_2017.png" alt=""></p>
<h3 id="어떻게-블로그를-시작하게-되었나"><a href="#어떻게-블로그를-시작하게-되었나" class="headerlink" title="어떻게 블로그를 시작하게 되었나?"></a>어떻게 블로그를 시작하게 되었나?</h3><p>기술과 관련된 블로그를 시작한 것은 <code>wordpress.com</code>에서 만든 블로그였다. 2014년 7월부터 사용했고, 이때가 Pogoplug에 ArchLinux/Debian을 설치해가며 커스텀 NAS를 만들고 사용했던 시기였다. 그래서 Nginx가 무엇이고, 웹서버가 무엇이며 FTP가 뭔지, 그리고 웹 상에서 동작하는게 무엇인지 보고 php라는것도 설치해 사용하고 뭔지 모르겠지만 Wordpress도 받아 설치해보고 MySql와 phpMyAdmin등도 사용해보았다. 이때도 “블로그를 쓰면 좋다더라..”라는 막연히 ‘카더라’ 식의 블로그 찬양설을 듣다 그냥 하나씩 해본 것을 정리해보는 식으로 블로그를 작성했다. 윈도에서 RDP를 어떻게 쓰는게 좋나, iptime NAS에 커스텀 리눅스를 어떻게 까나 등등… 이런 개발적인데 비개발적인, 마치 “코딩이랑 무관합니다만,”에 올라올 것 같은 글들을 하나씩 정리해갔다.</p>
<h3 id="왜-Github-Pages에-블로그를-옮겼나"><a href="#왜-Github-Pages에-블로그를-옮겼나" class="headerlink" title="왜 Github Pages에 블로그를 옮겼나?"></a>왜 Github Pages에 블로그를 옮겼나?</h3><p>그러다가 2016년 6월 즈음 구글 검색을 하다가 보게 된 것이 바로 아래 사진의 <code>Syntax Highlighter</code>였다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-25%2020.49.35.png" alt="Syntax Highlighting"></p>
<p>블로그에 코드를 적을 때 단순하게 흰색에 고정폭 글씨만 쓰는 것이 아니라 더 다양하고 보기 좋은(개발할 맛이 나는) 코드 하이라이팅을 적용하는 것을 보았던 것!</p>
<!-- ![이건 꼭 사야해](http://upload2.inven.co.kr/upload/2017/04/06/bbs/i15270847522.jpg) -->

<p>이걸 보고 바로 뽐뿌가 와버려 내 블로그에 적용하려 했지만…</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-25%2020.55.38.png" alt="CSS수정은 유료랍니다 호갱님"></p>
<p>CSS 수정은 유료 플랜에서만 사용할 수 있었다. 그래서 어떤 것을 사용해야하나, 티스토리를 사용해야하나 등 고민을 했다.</p>
<p>그러다가 Jekyll + Github Pages의 조합으로 블로그를 만들 수 있다는 사실을 보고, 마크다운 문법만 조금 공부하면 되겠다는 생각으로 <a href="http://jekyllthemes.org/">jekyllthemes.org</a>라는 Jekyll 테마 모음 사이트에서 적당히 예뻐보이는 사이트 하나를 골라 zip파일을 받은 뒤 기초적인 사이트 정보 수정만 하고 <code>beomi.github.io</code> 레포에 커밋을 하고 올렸더니 블로그가 완성이 되었다!</p>
<blockquote>
<p>이때 내가 뭔가를 많이 하지 않았는데도(심지어 Jekyll을 설치도 하지 않았음) 블로그를 수정하고 올릴 수 있어서 Jekyll에 거부감 없이 시작할 수 있었다. 만세! 참고로 예전에 사용한 테마는 <a href="http://jekyllthemes.org/themes/hagura/">hagura</a>라는 테마.</p>
</blockquote>
<p>이때 단순히 글 목록만 보이는 테마였지만 그래도 꽤 예뻐 보여서 글쓰는 맛을 즐겼다.</p>
<h3 id="왜-테마를-바꿨나"><a href="#왜-테마를-바꿨나" class="headerlink" title="왜 테마를 바꿨나?"></a>왜 테마를 바꿨나?</h3><p>지금 사용하고 있는 테마인 <a href="https://github.com/thomasvaeth/trophy-jekyll">trophy</a>라는 테마를 선택하게 된 것은 구글링을 하다 이 테마가 ‘카테고리’를 지원한다는 사실에 선택을 한 것이 컸다. ‘나만의 웹 크롤러 만들기’ 시리즈를 연재하다가 연재본이 하나로 엮여있는 공간을 마련하기 귀찮아 그냥 테마가 카테고리를 지원하면 좋겠다는 생각에 이것을 선택하게 되었고, 이 테마는 지금도 만족도가 매우 높은 상태다.</p>
<p>물론 테마 색깔이나 레이아웃 등등 일부 CSS/SCSS파일을 수정해 사용하고 있고, 이 테마를 쓰면서 가장 큰 문제는 글 쓰기 전에 글의 메인 이미지인 고해상도이미지를 만드는 것이다. (지금은 보통 1920x1080px로 만들고, 100kb내외로 만든다.)</p>
<blockquote>
<p>사실 이 작업이 생각보다 귀찮아서 이 블로그를 보는 분들이 무작정 예쁘다고 이 테마를 선택하지는 않기를 바라는 사소한 마음… 만들다 보면 ‘아 내가 메인 이미지를 만드는 센스가 없구나’ 라는걸 깨닫게 됩니다.</p>
</blockquote>
<h3 id="올해-블로그-성과는-어땠나"><a href="#올해-블로그-성과는-어땠나" class="headerlink" title="올해 블로그 성과는 어땠나?"></a>올해 블로그 성과는 어땠나?</h3><p>사실 깃헙에 블로그를 만들고 시작한 것이 2016년 5월이고 본격적으로 방문자 유입이 된 것은 올해라고 볼 수 있다.(구글이 그렇다고 한다.)</p>
<p>우선 올해 사용자부터 보면.. 약 6만명이 이용한 것으로 보인다. Adblock등을 이용해 GA를 차단한 경우는 수집하지 못하기 때문에 GA가 차단된 경우는 제외된 수치니 이것보다는 약간 더 많지 않을까 싶다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.10.23.png" alt="올해사용자"></p>
<p>그리고 올해 페이지 뷰는 약 17만 8천뷰정도가 나온 것으로 보인다.(사용자 수가 많을 수록 당연히 페이지 뷰수도 높다.)</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.13.18.png" alt="올해페이지뷰"></p>
<p>방문자 유입은 주로 Google 검색을 통해 들어오는 것으로 보인다. 혹은 어딘가에서 링크로 들어오거나, 페이스북에 글을 올린 날은 페이스북에서 유입이 급격히 늘어나기도 한다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.15.49.png" alt="방문자유입소스"></p>
<p>소스별 이탈율과 평균 세션 시간을 살펴보면 구글 검색등으로 들어온 경우가 가장 긴 세션시간(글 읽는 시간)을 유지하고 있다는 것을 볼 수 있다. 소셜공유, 즉 페이스북을 통해 들어온 경우에는 1분내외의 짧은 시간에 글을 훑어보고 바로 나가버리는 형태의 사용 패턴이 나타나는 것을 볼 수 있다. </p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.18.50.png" alt="소스별이탈률"></p>
<p>전체적으로 고정 방문자수/페이지 뷰수에 큰 영향을 미치는 것은 검색엔진을 통해서 유입된 것임을 확인할 수 있다.</p>
<h3 id="그렇다면-구글-검색결과에는-얼마나-많이-떴을까"><a href="#그렇다면-구글-검색결과에는-얼마나-많이-떴을까" class="headerlink" title="그렇다면 구글 검색결과에는 얼마나 많이 떴을까?"></a>그렇다면 구글 검색결과에는 얼마나 많이 떴을까?</h3><p>구글에는 Search Console을 통해 웹 사이트에 구글 검색을 통해 얼마나 유입이 이뤄졌는지 볼 수 있다. 다만 1년치를 보지는 못하고 최근 90일만 조회 가능하기 때문에 최근 90일을 조회해보면 검색 화면에 노출된 수는 약 20만회, 그리고 클릭으로 이어진 경우는 약 2만9천회임을 볼 수 있다. 당연히 노출이 많이 될수록 클릭 수도 올라간다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.23.22.png" alt="Search Console 그래프"></p>
<p>그렇다면 사람들이 어떤 키워드로 검색해 들어왔을까?</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-30%2002.24.52.png" alt="검색한 단어"></p>
<p>역시 크롤링에 관련한 단어가 최상위권을 모두 차지하고 있다. 평균 게재 순위가 높을수록 상위에 노출되고 5위 안으로 들어갈 경우 해당 검색 결과에서 유의미한 유입이 이뤄지는 것을 알 수 있다.</p>
<h2 id="맺으며"><a href="#맺으며" class="headerlink" title="맺으며.."></a>맺으며..</h2><p>2017년은 본격적으로 블로그를 페이스북에 올리는 등의 방법으로 홍보를 시작했습니다.</p>
<p>사실 블로그를 작성하며 가장 많이 드는 고민이 “세상에 이미 이 자료들이 있고, 검색하면 나오는데 굳이 내가 작성할 필요가 있을까?” 라는 고민입니다.</p>
<p>하지만 저는 블로그를 단순한 코드 조각이 아니라 내가 아는 지식들을 꿰어진 구슬처럼 유의미한 가이드로 사용할 수 있도록 재가공해 제공한다는 측면에서 의미가 있다고 생각하고 지속적으로 글을 작성합니다. 지식이 많은 것도 중요하지만, 누군가에게 내 글이 답답한 부분을 뚫어주는 글이 될 수 있기를 바라며 글을 씁니다. 블로그 글에서 이번 <strong>가이드</strong>는 이라고 표현하는 이유가 단순히 ‘글’ 이 아니라 ‘가이드’의 역할을 할 수 있기를 바라며 작성하기 때문입니다.</p>
<p>이 글을 읽으신 분들도 블로그를 시작하시고, 커뮤니티를 시작하시면 좋겠습니다. </p>
<p>앞으로도 커뮤니티에서 많은 분들을 뵙고 더 성장할 수 있으면 좋겠습니다.</p>
<p>긴 글 읽어주셔서 감사합니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/12/15/Direct-upload-to-S3-with-Lambda/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/direct_s3_post_upload.png" alt="Direct S3 Upload with Lambda">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-12-14T15:00:00.000Z">2017-12-15</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/">aws</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/12/15/Direct-upload-to-S3-with-Lambda/">Direct S3 Upload with Lambda</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>이전 글인 <a href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/">AWS Lambda에 Tensorflow/Keras 배포하기</a>에서 Lambda 함수가 실행되는 트리거는 s3버킷에 파일이 <strong>생성</strong>되는 것이었습니다.</p>
<p>물론 파일을 올릴 수 있는 방법은 여러가지가 있습니다. 아주 단순하게 POST 폼 전송 요청을 받고 <code>boto3</code>등을 이용해 서버에서 s3으로 파일을 전송할 수도 있고, 더 단순하게는 AWS s3 콘솔을 이용해 파일을 올리라고 할 수도 있습니다.</p>
<p>하지만 이런 부분에는 약간의 단점이 함께 있습니다.</p>
<p>첫 번째 방법처럼 파일을 수신해 다시 s3에 올린다면 그 과정에서 서버 한대가 상시로 켜져있어야 하고 전송되는 속도 역시 서버에 의해 제약을 받습니다. 한편 두 번째 방법은 가장 단순하지만 제3자에게서 파일을 받기 위해서 AWS 계정(비록 제한된 권한이 있다 하더라도)을 제공한다는 것 자체가 문제가 됩니다.</p>
<p>따라서 이번 글에서는 사용자의 브라우저에서 바로 s3으로 POST 요청을 전송할 수 있도록 만드는 과정을 다룹니다.</p>
<h2 id="시나리오"><a href="#시나리오" class="headerlink" title="시나리오"></a>시나리오</h2><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-15%2018.15.38.png" alt=""></p>
<p>사용자는 아주 일반적인 Form 하나를 보게 됩니다. 여기에서 드래그-드롭 혹은 파일 선택을 이용해 일반적으로 파일을 올리게 됩니다. 물론 이 때 올라가는 주소는 AWS S3의 주소가 됩니다.</p>
<p>하지만 이게 바로 이뤄진다면 문제가 생길 소지가 많습니다. 아무나 s3 버킷에 파일을 올린다면 악의적인 파일이 올라올 수도 있고, 기존의 파일을 덮어쓰기하게 될 수도 있기 때문입니다.</p>
<p>따라서 중간에 s3에 post 요청을 할 수 있도록 <strong>인증(signing)</strong>해주는 서버가 필요합니다. 다만 이 때 서버는 요청별로 응답을 해주면 되기 때문에 AWS Lambda를 이용해 제공할 수 있습니다.</p>
<p>따라서 다음과 같은 형태로 진행이 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/direct_s3_post_upload.png" alt="전체 처리 과정 모식도"></p>
<p>S3에 POST 요청을 하기 전 Signing 서버에 업로드하는 파일 정보와 위치등을 보낸 뒤, Lambda에서 해당 POST 요청에 대한 인증 정보가 들어간 header를 반환하면 그 헤더 정보를 담아 실제 S3에 POST 요청을 하는 방식입니다.</p>
<p>만약 Signing하는 과정 없이 업로드가 이뤄진다면 s3 버킷을 누구나 쓸 수 있는 Public Bucket으로 만들어야 하는 위험성이 있습니다. 하지만 이와 같이 제한적 권한을 가진 <code>iam</code> 계정을 생성하고 Signing하는 과정을 거친다면 조금 더 안전하게 사용할 수 있습니다.</p>
<blockquote>
<p><strong>Note:</strong> 이번 글에서는 API Gateway + Lambda 조합으로 Signing서버를 구성하기 때문에 만약 추가적인 인증 과정을 붙인다면 API Gateway단에서 이뤄지는 것이 좋습니다.</p>
</blockquote>
<h2 id="버킷-만들기-amp-권한-설정"><a href="#버킷-만들기-amp-권한-설정" class="headerlink" title="버킷 만들기 &amp; 권한 설정"></a>버킷 만들기 &amp; 권한 설정</h2><blockquote>
<p>새로운 버킷은 <a href="https://s3.console.aws.amazon.com/s3/home">https://s3.console.aws.amazon.com/s3/home</a>에서 추가할 수 있습니다.</p>
</blockquote>
<p>새로운 버킷을 하나 만들어주세요. 이번 글에서는 <code>s3-signature-dev-py3</code>라는 이름으로 만들어 진행해 보았습니다.</p>
<p>버킷에 GET/POST 요청을 하기 위해 CORS 설정을 해줘야 합니다.(<code>localhost:8000</code>와 같은 제 3의 URL에서 s3 버킷의 주소로 POST 요청을 날리기 위해서는 CORS 설정이 필수입니다.)</p>
<p>아래 스크린샷과 같이 CORS 설정을 진행해 주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.55.31.png" alt=""></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CORSConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>GET<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>POST<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MaxAgeSeconds</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">MaxAgeSeconds</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Authorization<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CORSConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이처럼 구성해주면 모든 도메인(<code>*</code>)에서 요청한 GET/POST 요청을 정상적인 크로스-도메인 요청으로 받아들입니다.</p>
<blockquote>
<p><strong>Note:</strong> 만약 여러분이 여러분의 프론트 서비스에서만 이 요청을 허용하려면 <code>AllowedOrigin</code>부분을 여러분이 사용하는 프론트 서비스의 도메인으로 변경해주세요.</p>
</blockquote>
<p>이제 s3을 사용할 준비는 마쳤습니다.</p>
<h2 id="버킷-액세스-iam-계정-만들기"><a href="#버킷-액세스-iam-계정-만들기" class="headerlink" title="버킷 액세스 iam 계정 만들기"></a>버킷 액세스 iam 계정 만들기</h2><blockquote>
<p>새로운 iam 계정은 <a href="https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/users$new?step=details">https://console.aws.amazon.com/iam/home?region=ap-northeast-2#/users$new?step=details</a>에서 만들 수 있습니다.</p>
</blockquote>
<p>다음으로는 앞서 만들어준 버킷에 액세스를 할 수 있는 <code>iam</code> 계정을 만들어야 합니다. 이번에 사용할 유저 이름도 <code>s3-signature-dev-py3</code>로 만들어 줍시다. 아래 스크린샷처럼 <code>Programmatic access</code>를 위한 사용자를 만들어 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.03.31.png" alt=""></p>
<p>우리는 버킷내 <code>uploads</code>폴더에 파일을 ‘업로드만 가능’한, <code>PutObject</code>와 <code>PutObjectAcl</code>이라는 아주 제한적인 권한을 가진 계정을 만들어 줄 것이기 때문에 다음과 같이 Create Policy를 눌러 json 기반으로 계정 정책을 새로 생성해 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.05.01.png" alt=""></p>
<p>새 창이 뜨면 아래와 같이 <code>arn:aws:s3:::s3-signature-dev-py3/uploads/*</code> 리소스에 대해 <code>PutObject</code>와 <code>PutObjectAcl</code>에 대해 Allow를 해 주는 json을 입력하고 저장해줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.16.41.png" alt=""></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Version"</span>: <span class="string">"2012-10-17"</span>,</span><br><span class="line">    <span class="attr">"Statement"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Sid"</span>: <span class="string">"s3UploadsGrant"</span>,</span><br><span class="line">            <span class="attr">"Effect"</span>: <span class="string">"Allow"</span>,</span><br><span class="line">            <span class="attr">"Action"</span>: [</span><br><span class="line">                <span class="string">"s3:PutObject"</span>,</span><br><span class="line">                <span class="string">"s3:PutObjectAcl"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"Resource"</span>: [</span><br><span class="line">                <span class="string">"arn:aws:s3:::s3-signature-dev-py3/uploads/*"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 policy의 name을 입력하고 저장해줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.18.22.png" alt=""></p>
<p>저장해주고 창을 끈 뒤 이전 페이지로 돌아와 Refresh를 누르면 다음과 같이 앞서 만들어준 Policy가 나오는 것을 볼 수 있습니다. 체크박스에 체크를 누른 뒤 다음을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.20.29.png" alt=""></p>
<p>이제 마지막 확인을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.21.35.png" alt=""></p>
<p>확인을 누르면 다음과 같이 Access key ID와 Secret access key가 나옵니다. 이 키는 지금만 볼 수 있으니 csv로 받아두거나 따로 기록해 두세요. 그리고 글 아래부분에서 이 키를 사용하게 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2021.22.05.png" alt=""></p>
<h2 id="Signing-Lambda-함수-만들기"><a href="#Signing-Lambda-함수-만들기" class="headerlink" title="Signing Lambda 함수 만들기"></a>Signing Lambda 함수 만들기</h2><p>이제 POST 요청을 받아 인증을 해줄 AWS Lambda함수를 만들어 줍시다.</p>
<p>아래 코드를 받아 AWS Lambda 새 함수를 만들어주세요. (역시 <code>s3-signature-dev-py3</code>라는 이름으로 만들었습니다.)</p>
<p><a href="https://gist.github.com/Beomi/ac9d34dbfa9a6bdaf4a0426e8b83b4e3">Github Gist: index.py</a></p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.22.26.png" alt=""></p>
<p>이번 함수는 python3의 내장함수만을 이용하기 때문에 따로 zip으로 만들 필요없이 AWS 콘솔 상에서 인라인 코드 편집으로 함수를 생성하는 것이 가능합니다.</p>
<p>아래 스크린샷처럼 <code>lambda_function.py</code> 파일을 위의 gist 코드로 덮어씌워주세요. 그리고 <code>Handler</code>부분을 <code>lambda_function.index</code>로 바꿔 <code>index</code>함수를 실행하도록 만들어 주세요. 그리고 저장을 눌러야 입력한 코드가 저장됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.25.34.png" alt=""></p>
<p>코드를 조금 뜯어보면 아래와 같이 <code>ACCESS_KEY</code>와 <code>SECRET_KEY</code>를 저장하는 부분이 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ACCESS_KEY = os.environ.get(<span class="string">'ACCESS_KEY'</span>)</span><br><span class="line">SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>)</span><br></pre></td></tr></table></figure>

<p>AWS Lambda에서 함수를 실행할 때 아래 환경변수를 가져와 s3 버킷에 액세스하기 때문에 위 두개 값을 아래 스크린샷처럼 채워줍시다. 입력을 마치고 저장을 눌러주면 환경변수가 저장됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2020.32.57.png" alt=""></p>
<blockquote>
<p><strong>Note:</strong> 각 키의 값은 앞서 iam 계정 생성시 만든 값을 넣어주세요!</p>
</blockquote>
<h2 id="API-Gateway-연결하기"><a href="#API-Gateway-연결하기" class="headerlink" title="API Gateway 연결하기"></a>API Gateway 연결하기</h2><blockquote>
<p>API Gateway는 <a href="https://ap-northeast-2.console.aws.amazon.com/apigateway/home?region=ap-northeast-2#/apis/create">https://ap-northeast-2.console.aws.amazon.com/apigateway/home?region=ap-northeast-2#/apis/create</a>에서 만들 수 있습니다.</p>
</blockquote>
<p>이렇게 만들어 준 AWS Lambda 함수는 각각은 아직 외부에서 결과값을 받아올 수 있는 형태가 아닙니다. 람다 함수를 트리거해주고 결과값을 받아오기 위해서는 AWS API Gateway를 통해 웹 URL로 오는 요청에 따라서 람다 함수가 실행되도록 구성해야 합니다. 또한, CORS역시 활성화 해줘야 합니다.</p>
<h3 id="API-Gateway-만들고-Lambda와-연결하기"><a href="#API-Gateway-만들고-Lambda와-연결하기" class="headerlink" title="API Gateway 만들고 Lambda와 연결하기"></a>API Gateway 만들고 Lambda와 연결하기</h3><p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.01.23.png" alt=""></p>
<p>Resources에서는 Api URL의 하위 URL와 root URL에 대해 각각 메소드들을 정의해 사용할 수 있습니다. 우리는 요청을 받을 때 <code>POST</code> 방식으로 요청을 받아 처리해줄 것이랍니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.15.35.png" alt=""></p>
<p>여기서 새 메소드 중 <code>POST</code>를 선택해 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-18%2022.16.38.png" alt=""></p>
<p>메소드에 Lambda 함수를 연결해 주기 위해 다음과 같이 <code>Lambda Function</code>을 선택하고 <code>Proxy</code>는 체크 해제한 뒤, <code>Region</code>은 <code>ap-northeast-2</code>(서울)리전을 선택하고, 아까 만들어준 함수 이름을 입력한 뒤 <code>Save</code>를 눌러줍시다.</p>
<blockquote>
<p><strong>Tip:</strong> Lambda Proxy를 활성화 시킬 경우 HTTP 요청이 그대로 들어오는 대신, AWS에서 제공하는 event 객체가 대신 Lambda함수로 넘어가게 됩니다. 우리는 HTTP 요청을 받아 Signing해주는 과정에서 Header와 Body를 유지해야하기 때문에 Proxy를 사용하지 않습니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.24.50.png" alt=""></p>
<p><code>Save</code>를 누르면 다음과 같이 API Gateway에 Lambda함수를 실행할 권한을 연결할지 묻는 창이 뜹니다. 가볍게 OK를 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.28.28.png" alt=""></p>
<p>연결이 완료되면 API Gateway가 아래 사진처럼 Lambda 함수와 연결 된 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.33.11.png" alt=""></p>
<h3 id="CORS-활성화하기"><a href="#CORS-활성화하기" class="headerlink" title="CORS 활성화하기"></a>CORS 활성화하기</h3><p>조금만 더 설정을 해주면 API Gateway를 배포할 수 있게 됩니다. 지금 해줘야 하는 작업이 바로 <code>CORS</code> 설정인데요, 우리가 나중에 만들 프론트 페이지의 URL와 s3의 URL이 다르기 때문에 브라우저에서는 보안의 이유로 <code>origin</code>이 다른 리소스들에 대해 접근을 제한합니다. 따라서 <code>CORS</code>를 활성화 해 타 URL(프론트 URL)에서도 요청을 할 수 있도록 설정해줘야 합니다.</p>
<p><code>Actions</code>에서 <code>Enable CORS</code>를 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2013.34.06.png" alt=""></p>
<p>다음과 같이 <code>Access-Control-Allow-Headers</code>의 값을 <code>&#39;*&#39;</code>로 설정한 뒤 Enable CORS 버튼을 눌러 저장해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.30.42.png" alt=""></p>
<p>다시한번 Confirm을 눌러주시면…</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.33.45.png" alt=""></p>
<p>CORS가 활성화되고 Options 메소드가 새로 생기게 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.35.30.png" alt=""></p>
<p>이제 API Gateway를 ‘배포’해야 실제로 사용할 수 있습니다.</p>
<h3 id="API-Gateway-배포하기"><a href="#API-Gateway-배포하기" class="headerlink" title="API Gateway 배포하기"></a>API Gateway 배포하기</h3><p>API Gateway의 설정을 모두 마치고나서는 배포를 진행해야 합니다. 아래와 같이 <code>Actions</code>에서 <code>Deploy API</code>를 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.39.46.png" alt=""></p>
<p>API Gateway는 <code>Deployment Stage</code>를 필요로 합니다. <code>Stage name</code>을 <code>live</code>로 설정하고 <code>Deploy</code>를 눌러줍시다.</p>
<blockquote>
<p><strong>Tip:</strong> <code>Deployment Stage</code>는 API Gateway의 URL 뒤 <code>/stagename</code>의 형식으로 추가 URL을 지정해줍니다. 이를 통해 API를 개발 버전과 실 서비스 버전을 분리해 제공할 수 있습니다.</p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.43.03.png" alt=""></p>
<p>배포가 완료되면 아래와 같이 API Gateway를 사용할 수 있는 URL을 받을 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2015.48.42.png" alt=""></p>
<p>이번에는 <code>https://9n2qae2nak.execute-api.ap-northeast-2.amazonaws.com/live</code>가 Signing Lambda 함수를 실행할 수 있는 API Gateway URL이 됩니다.</p>
<h2 id="파일-업로드-프론트-만들기"><a href="#파일-업로드-프론트-만들기" class="headerlink" title="파일 업로드 프론트 만들기"></a>파일 업로드 프론트 만들기</h2><p>이제 파일을 업로드할 form이 있는 Static 웹 사이트를 만들어봅시다.</p>
<p>이번 글에서는 이미 만들어진 파일 업로더인 VanillaJS용 <a href="https://github.com/FineUploader/fine-uploader">Fine Uploader</a>를 이용해 최소한의 업로드만 구현합니다.</p>
<blockquote>
<p>React용 <a href="https://github.com/FineUploader/react-fine-uploader">React Fine Uploader</a>와 Vue용 <a href="https://github.com/FineUploader/vue-fineuploader">Vue Fine Uploader</a>도 있습니다.</p>
</blockquote>
<p><a href="https://github.com/Beomi/s3-direct-uploader-demo">https://github.com/Beomi/s3-direct-uploader-demo</a> 깃헙 레포를 clone받아 <code>app.js</code>를 열어 아래 목록을 수정해주세요.</p>
<ul>
<li>request/endpoint: 여러분이 사용할 s3 버킷 이름 + .s3.amazonaws.com</li>
<li>request/accessKey: 앞서 만든 iam 계정의 Access Key</li>
<li>objectProperties/region: s3 버킷의 리전</li>
<li>objectProperties/key/prefixPath: s3 버킷 내 올릴 폴더 이름(putObject 권한을 부여한 폴더)</li>
<li>signature/endpoint: 앞서 만든 AWS Lambda의 API Gateway URL</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uploader = <span class="keyword">new</span> qq.s3.FineUploader(&#123;</span><br><span class="line">    debug: <span class="literal">false</span>, <span class="comment">// defaults to false</span></span><br><span class="line">    element: <span class="built_in">document</span>.getElementById(<span class="string">'fine-uploader'</span>),</span><br><span class="line">    request: &#123;</span><br><span class="line">        <span class="comment">// S3 Bucket URL</span></span><br><span class="line">        endpoint: <span class="string">'https://s3-signature-dev-py3.s3.amazonaws.com'</span>, </span><br><span class="line">        <span class="comment">// iam ACCESS KEY</span></span><br><span class="line">        accessKey: <span class="string">'AKIAIHUAMKBO27EZQ6RA'</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    objectProperties: &#123;</span><br><span class="line">        region: <span class="string">'ap-northeast-2'</span>,</span><br><span class="line">        key(fileId) &#123;</span><br><span class="line">            <span class="keyword">var</span> prefixPath = <span class="string">'uploads'</span></span><br><span class="line">            <span class="keyword">var</span> filename = <span class="keyword">this</span>.getName(fileId)</span><br><span class="line">            <span class="keyword">return</span> prefixPath + <span class="string">'/'</span> + filename</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    signature: &#123;</span><br><span class="line">        <span class="comment">// version</span></span><br><span class="line">        version: <span class="number">4</span>,</span><br><span class="line">        <span class="comment">// AWS API Gate URL</span></span><br><span class="line">        endpoint: <span class="string">'https://9n2qae2nak.execute-api.ap-northeast-2.amazonaws.com/live'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    retry: &#123;</span><br><span class="line">        enableAuto: <span class="literal">true</span> <span class="comment">// defaults to false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>그리고나서 <code>index.html</code> 파일을 열어보시면 아래 사진과 같은 업로더가 나오게 됩니다.</p>
<blockquote>
<p><strong>DEMO:</strong> <a href="https://beomi.github.io/s3-direct-uploader-demo/">https://beomi.github.io/s3-direct-uploader-demo/</a></p>
</blockquote>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-28%2017.59.46.png" alt=""></p>
<h2 id="맺으며"><a href="#맺으며" class="headerlink" title="맺으며"></a>맺으며</h2><p>이제 여러분은 Serverless하게 파일을 s3에 업로드 할 수 있게 됩니다. 권한 관리와 같은 부분은 API Gateway에 접근 가능한 부분에 제약을 걸어 업로드에 제한을 걸어 줄 수도 있습니다.</p>
<p>ec2등을 사용하지 않고도 간단한 signing만 갖춰 s3에 파일을 안전하게 업로드 하는 방식으로 전체 프로세스를 조금씩 Serverless한 구조로 바꾸는 예시였습니다.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p><a href="http://docs.aws.amazon.com/ko_kr/AmazonS3/latest/API/sigv4-post-example.html">Browser-Based Upload using HTTP POST (Using AWS Signature Version 4)</a></p>
</li>
<li><p><a href="https://kennbrodhagen.net/2015/12/02/how-to-access-http-headers-using-aws-api-gateway-and-lambda/">How to access HTTP headers using AWS API Gateway and Lambda</a></p>
</li>
</ul>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/lambda_n_tensorflow_updated.png" alt="AWS Lambda에 Tensorflow/Keras 배포하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-12-06T15:00:00.000Z">2017-12-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/">aws</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/aws/tensorflow/">tensorflow</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/12/07/Deploy-Tensorflow-Keras-on-AWS-Lambda/">AWS Lambda에 Tensorflow/Keras 배포하기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>Update @ 20190306: <code>amazonlinux:latest</code> 버전이 <code>2</code>버전이 latest로 변경됨에 따라 아래 코드를 <code>amazonlinux:1</code>로 변경</p>
</blockquote>
<blockquote>
<p>이번 글은 macOS을 기반으로 작성되었지만, <code>docker</code> 명령어를 사용할 수 있는 모든 플랫폼(윈도우/맥/리눅스)에서 따라올 수 있습니다.</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>여러분이 이미지를 받아 텐서플로로 분류를 해 준 뒤 결과를 반환해주는 작업을 하는 모델을 만들었다고 가정해봅시다. 이때 가장 빠르고 간단하게 결과를 내는(Inference/추론을 하는)방법은 Cuda가속을 할 수 있는 고급 시스템 위에서 텐서플로 모델을 이용해 결과를 반환하도록 서비스를 구현할 수 있습니다. 혹은 조금 느리더라도 CPU를 사용하는 EC2와 같은 VM위에서 텐서플로 코드를 동작하게 만들 수도 있습니다.</p>
<p>하지만 만약 여러분이 처리해야하는 이미지가 몇장이 아니라 수십, 수백장을 넘어 수천장을 처리해야한다면 어떻게 될까요?</p>
<p>한 EC2 위에서 서비스를 제공하는 상황에서는 이런 경우라면 <code>for</code>문처럼 이미지 하나하나를 돌며 추론을 한다면 전체 이미지의 결과를 내려면 한참 시간이 걸리게 됩니다. 따라서 일종의 병렬 처리를 생각해 보아야 합니다.</p>
<p>즉, 이미지를 순서대로 하나씩 추론하는 대신, 추론하는 코어 함수만을 빼고 결과를 반환하도록 만들어 주면 됩니다.</p>
<p>물론 병렬 처리를 위해서 여러가지 방법들이 있습니다. 여러개의 GPU를 사용하고 있다면 각 GPU별로 작업을 진행하도록 할 수도 있고, 혹은 EC2를 여러개 띄워서 작업을 분산해 진행할 수도 있습니다. 하지만 이 방법보다 조금 더(혹은 상당히 많이) 빠르게 결과를 얻어낼 수 있는 방법이 있습니다.</p>
<p>바로 AWS Lambda를 이용하는 방법입니다.</p>
<p>AWS Lambda는 현재 각 실행별 최대 3GB메모리와 5분의 실행시간 내에서 원하는 코드를 실행해 한 리전에서 동시에 최대 1000개까지 병렬로 실행할 수 있습니다.</p>
<p>즉, 우리가 1만개의 이미지를 처리해야 한다면 한 리전에서만 1000개를 동시에 진행해 10개를 처리하는 시간 내 모든 작업을 마칠 수 있다는 것이죠. 그리고 작업이 끝나고 서버가 자동으로 끝나기 때문에 동작하지 않는 시간에도 돈을 내는 EC2와는 가격차이가 많이 나게됩니다.</p>
<p>이번 가이드는 다음과 같은 시나리오로 작성했습니다.</p>
<ul>
<li>시나리오<ol>
<li>s3의 어떤 버킷의 특정한 폴더에 ‘이미지 파일’을 올린다.</li>
<li>이미지 파일이 ‘생성’될 때 AWS Lambda 함수가 실행이 트리거된다.</li>
<li>(Lambda) 모델을 s3에서 다운받아 Tensorflow로 읽는다.</li>
<li>(Lambda) 함수가 트리거 될때 발생한 <code>event</code> 객체를 받아 s3에 업로드된 파일의 정보(버킷, 버킷내 파일의 경로)를 가져온다.</li>
<li>(Lambda) s3에 업로드된 이미지 파일을 <code>boto3</code>을 통해 가져와 Tensorflow로 Inference를 진행한다.</li>
<li>(Lambda) Inference가 끝난 결과물을 s3에 저장하거나 결과값을 DynamoDB에 저장하거나 혹은 API Gateway를 통해 json으로 반환한다.</li>
</ol>
</li>
</ul>
<p>위와같이 진행할 경우 s3에 파일 업로드를 1개를 하든, 1000개를 하든 업로드 자체에 필요한 시간을 제외하면 실행 시간 자체는 동일하게 유지할 수 있습니다. </p>
<p>(마치 시간복잡도가 O(1)인 척 할 수 있는 것이죠!)</p>
<h2 id="환경-준비하기"><a href="#환경-준비하기" class="headerlink" title="환경 준비하기"></a>환경 준비하기</h2><blockquote>
<p>오늘 사용한 예제는 <a href="https://github.com/Beomi/tf-keras-on-lambda">Github tf-keras-on-lambda Repo</a>에서 확인할 수 있습니다.</p>
</blockquote>
<p>AWS Lambda는 아마존에서 RedHat계열의 OS를 새로 만든 Amazon Linux위에서 동작합니다. 그렇기 때문에 만약 우리가 C의존적인 라이브러리를 사용해야한다면 우선 Amazon Linux에 맞게 pip로 설치를 해줘야 합니다. 그리고 간혹 빌드가 필요한 패키지의 경우 사용하고자 하는 OS에 맞춰 빌드작업 역시 진행해야 합니다. Tensorflow 역시 C의존적인 패키지이기 때문에 OS에 맞는 버전을 받아줘야 합니다. 우리가 사용하는 OS는 macOS혹은 windows이기 때문에 <code>docker</code>를 통해 Amazon Linux를 받아 그 안에서 빌드를 진행합니다.</p>
<p>도커를 사용하고있다면 그대로 진행해주시면 되고, 도커를 설치하지 않으셨다면 우선 도커를 먼저 설치해주세요.</p>
<p>도커는 <a href="https://store.docker.com/search?type=edition&offering=community">Docker Community Edition Download Page</a>에서 받으실 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.31.22.png" alt="도커를 받아주세요"></p>
<p>여러분이 다음부분을 진행하기 전, <code>docker</code>라는 명령어를 터미널 혹은 cmd상에서 입력시 도커가 실행되어야 합니다. 도커가 실행된다면, 우선은 실행할 준비를 마친 것이랍니다.</p>
<blockquote>
<p>물론 여러분 각자의 모델파일이 있어야 합니다. 이번 가이드에서는 Keras 예시 중 Pre-trained squeezenet을 이용한 Image Classification(imagenet)으로 진행합니다.</p>
</blockquote>
<h2 id="결과-저장용-DynamoDB-만들기-Optional"><a href="#결과-저장용-DynamoDB-만들기-Optional" class="headerlink" title="결과 저장용 DynamoDB 만들기(Optional)"></a>결과 저장용 DynamoDB 만들기(Optional)</h2><p>우리가 predict를 진행하고 나서 나온 결과물을 어딘가에 저장해둬야 합니다. AWS에는 DynamoDB라는 간단한 NoSQL DB가 있으니, 이걸 이용해 결과물을 저장해 봅시다.</p>
<p>우선 DynamoDB 메뉴에서 아래와 같이 새 테이블 하나를 만들어 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.10.35.png" alt=""></p>
<p>기본키 정도만 문자열 필드 <code>filename</code>을 만들고 테이블을 생성해 줍시다.</p>
<p>이제 기본키만 지키면 나머지 필드는 자유롭게 올릴 수 있습니다. (물론 기본키와 정렬키만 인덱스가 걸리기 때문에, 빠른 속도가 필요하다면 인덱스를 건 뒤 데이터를 추가해줘야 합니다.)</p>
<h2 id="squeezenet-ImageNet-모델-s3에-올리기"><a href="#squeezenet-ImageNet-모델-s3에-올리기" class="headerlink" title="squeezenet ImageNet 모델 s3에 올리기"></a>squeezenet ImageNet 모델 s3에 올리기</h2><p>이번 글에서는 squeezenet Imagenet 모델을 이용해 predict를 진행합니다. <code>squeezenet_weights_tf_dim_ordering_tf_kernels.h5</code>파일이 필요한데, AWS Lambda에서 비용이 들지 않으며 빠른 속도로 모델을 받아오기 위해서는 같은 리전의 s3에 파일을 올려둬야 합니다. </p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2014.40.38.png" alt="keras-blog 버킷에 올린 모델 파일"></p>
<p>이번 글에서는 <code>keras-blog</code>라는 s3 버킷의 <code>squeezenet</code> 폴더에 파일을 올려두었습니다.</p>
<p>각 파일은 아래 링크에서 받을 수 있습니다. 아래 두 파일을 받아 s3 버킷에 올려주세요.</p>
<ul>
<li><a href="https://github.com/rcmalli/keras-squeezenet/releases/download/v1.0/squeezenet_weights_tf_dim_ordering_tf_kernels.h5">squeezenet_weights_tf_dim_ordering_tf_kernels.h5</a></li>
</ul>
<h2 id="squeezenet-py-만들기"><a href="#squeezenet-py-만들기" class="headerlink" title="squeezenet.py 만들기"></a><code>squeezenet.py</code> 만들기</h2><p>Keras의 squeezenet은 <a href="https://github.com/rcmalli/keras-squeezenet/blob/master/keras_squeezenet/squeezenet.py">squeezenet.py</a>을 참조합니다. 하지만 이 파일에는 Pre-Trained Model의 경로를 바꿔주기 때문에 이 부분을 약간 수정한 커스텀 <code>squeezenet.py</code>를 만들어주었습니다.</p>
<p>이 파일을 다운받아 여러분의 <code>index.py</code> 옆에 놓아두세요.</p>
<ul>
<li><a href="https://github.com/Beomi/tf-keras-on-lambda/blob/master/squeezenet.py">수정된 squeezenet.py</a></li>
</ul>
<h2 id="도커-Amazon-Linux로-빌드-준비하기"><a href="#도커-Amazon-Linux로-빌드-준비하기" class="headerlink" title="도커 + Amazon Linux로 빌드 준비하기"></a>도커 + Amazon Linux로 빌드 준비하기</h2><p>이제 <code>docker</code>라는 명령어로 도커를 사용해봅시다.</p>
<p>우선 여러분이 작업할 폴더 하나를 만들어 주세요. 저는 지금 <code>tf_on_lambda</code>라는 폴더에서 진행하고 있습니다. 이 폴더 안에는 Lambda에서 실행할 python파일이 들어가게 되고, 도커와 이 폴더를 이어줄 것이기 때문에 새 폴더 하나를 만들어서 진행하시는 것을 추천합니다.</p>
<p>폴더를 만들고 들어가셨다면 다음 명령어를 입력해 AmazonLinux 이미지를 받아 도커로 띄워주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v $(<span class="built_in">pwd</span>):/outputs --name lambdapack -d amazonlinux:1 tail -f /dev/null</span><br></pre></td></tr></table></figure>

<p>도커 컨테이너의 이름을 <code>lambdapack</code>으로 지정하고 현재 폴더(<code>$(pwd)</code>)를 도커의 <code>/outputs</code>폴더로 연결해줍니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.48.48.png" alt="도커가 실행된 모습"></p>
<p>성공적으로 받아졌다면 다음과 같이 임의의 난수 id가 생깁니다. 그리고 <code>docker ps</code>라는 명령어로 현재 실행중인 컨테이너들을 확인해보면 다음과 같이 <code>lambdapack</code>라는 이름을 가진 컨테이너가 생성된 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/2017-12-07%2022.49.31.png" alt="도커 ps"></p>
<h2 id="람다가-실행할-python-파일-작성하기"><a href="#람다가-실행할-python-파일-작성하기" class="headerlink" title="람다가 실행할 python 파일 작성하기"></a>람다가 실행할 python 파일 작성하기</h2><p>그러면 이제 람다가 실제로 <strong>실행</strong>할 python 파일을 만들어줍시다. 이번 가이드에서는 이 파일의 이름을 <code>index.py</code>라고 지어보았습니다.</p>
<blockquote>
<p><code>index.py</code> 파일은 사실 어떤 이름으로 해도 상관없습니다만, AWS에 람다 함수를 만들 때 <code>handler</code>함수 위치 지정을 <code>파일이름.함수이름</code>, 즉 <code>index.handler</code>와 같이 적어줄 것이기 때문에 대표적인 이름을 가진 파일로 만들어 주시면 됩니다.</p>
</blockquote>
<p><code>index.py</code>안에는 다음과 같은 내용으로 작성해 봅시다. 중요한 부분은 <code>handler</code>함수입니다.</p>
<blockquote>
<p>전체 코드를 바로 이용하시려면 <a href="https://github.com/Beomi/tf-keras-on-lambda/blob/master/index.py">index.py on GIST</a>을 이용하세요.</p>
</blockquote>
<p>제일 먼저 해줘야 하는 부분은 우리가 사용할 라이브러리를 import하는 것이죠.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> boto3 <span class="comment"># AWS S3 접근용</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.python <span class="keyword">import</span> keras <span class="comment"># Keras!</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.applications.resnet50 <span class="keyword">import</span> preprocess_input, decode_predictions</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> io <span class="comment"># File 객체를 메모리상에서만 이용하도록</span></span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># os.path / os.environ</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span>  Image <span class="comment"># Image 객체 </span></span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="comment"># 파일받기 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (.h5경로변경추가, 레포의 squeezenet.py를 확인하세요.)</span></span><br><span class="line"><span class="keyword">from</span> squeezenet <span class="keyword">import</span> Squeezenet <span class="comment"># 커스텀한 squeezenet</span></span><br></pre></td></tr></table></figure>

<p>이 중 <code>boto3</code> 라이브러리는 AWS Lambda의 python3내에 이미 설치되어있기 때문에 <strong>특정 버전</strong>의 <code>boto3</code>을 이용하시려는게 아니라면 도커 컨테이너에 설치하지 않아도 됩니다. (즉, Lambda에 올릴 패키지 zip파일에 boto3이 들어있지 않아도 괜찮습니다.)</p>
<p>import를 끝냈으니 코드를 작성해 봅시다. 우선 S3에서 파일을 다운로드/업로드하는 함수를 만들어줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ACCESS_KEY = os.environ.get(<span class="string">'ACCESS_KEY'</span>)</span><br><span class="line">SECRET_KEY = os.environ.get(<span class="string">'SECRET_KEY'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloadFromS3</span><span class="params">(strBucket, s3_path, local_path)</span>:</span></span><br><span class="line">    s3_client = boto3.client(</span><br><span class="line">        <span class="string">'s3'</span>,</span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">    )</span><br><span class="line">    s3_client.download_file(strBucket, s3_path, local_path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploadToS3</span><span class="params">(bucket, s3_path, local_path)</span>:</span></span><br><span class="line">    s3_client = boto3.client(</span><br><span class="line">        <span class="string">'s3'</span>,</span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">    )</span><br><span class="line">    s3_client.upload_file(local_path, bucket, s3_path)</span><br></pre></td></tr></table></figure>

<p>AWS 콘솔에서 람다 함수별로 환경변수를 설정해줄 수 있기 때문에, 위과 같이 <code>os.environ</code>을 통해 설정한 환경변수 값을 가져옵시다.</p>
<p>물론 여기에 설정한 Access Key와 Secret Key의 iam 유저는 당연히 해당 S3 버킷에 R/W권한이 있어야 합니다.</p>
<p>이 두가지 함수를 통해 S3에서 모델을 가져오고, 모델로 추론한 결과물을 S3에 넣어줄 수 있습니다.</p>
<blockquote>
<p>Note: s3 버킷과 람다 함수는 같은 Region에 있어야 데이터 전송 비용이 발생하지 않습니다.</p>
</blockquote>
<p>이제 가장 중요한 부분인 <code>handler</code>함수를 살펴봅시다.</p>
<p><code>handler</code>함수는 기본적으로 <code>event</code>와 <code>context</code>를 인자로 전달받습니다. 이때 우리가 사용하는 인자는 <code>event</code>인자입니다.</p>
<p>우리의 사용 시나리오 중 ‘S3에 이미지 파일을 올린다’, 이 부분이 바로 <code>event</code>의 내용이 됩니다.</p>
<h3 id="S3-Event의-내용"><a href="#S3-Event의-내용" class="headerlink" title="S3 Event의 내용"></a>S3 Event의 내용</h3><p>AWS에서 Lambda 실행이 트리거 될 때 전달되는 <code>event</code>는 파이썬의 딕셔너리 형태로 전달됩니다.</p>
<p>만약 여러분이 <code>s3</code>에 <strong>파일이 추가</strong>되는 이벤트를 Lambda에 연결해두셨다면 파일이 업로드 될 때 마다 아래와 같은 딕셔너리가 전달됩니다.</p>
<p>아래 예시는 <code>csv_icon.png</code>를 <code>keras-blog</code>라는 버킷내 <code>wowwow</code> 폴더에 올렸을때 발생한 <code>event</code> 객체입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># event 객체</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">'Records'</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'eventVersion'</span>: <span class="string">'2.0'</span>,</span><br><span class="line">            <span class="string">'eventSource'</span>: <span class="string">'aws:s3'</span>,</span><br><span class="line">            <span class="string">'awsRegion'</span>: <span class="string">'ap-northeast-2'</span>, <span class="comment"># 버킷 리전</span></span><br><span class="line">            <span class="string">'eventTime'</span>: <span class="string">'2017-12-13T03:28:13.528Z'</span>, <span class="comment"># 업로드 완료 시각 </span></span><br><span class="line">            <span class="string">'eventName'</span>: <span class="string">'ObjectCreated:Put'</span>,</span><br><span class="line">            <span class="string">'userIdentity'</span>: &#123;<span class="string">'principalId'</span>: <span class="string">'AFK2RA1O3ML1F'</span>&#125;,</span><br><span class="line">            <span class="string">'requestParameters'</span>: &#123;<span class="string">'sourceIPAddress'</span>: <span class="string">'123.24.137.5'</span>&#125;,</span><br><span class="line">            <span class="string">'responseElements'</span>: &#123;</span><br><span class="line">                <span class="string">'x-amz-request-id'</span>: <span class="string">'1214K424C14C384D'</span>,</span><br><span class="line">                <span class="string">'x-amz-id-2'</span>: <span class="string">'BOTBfAoB/gKBbn412ITN4t2psTW499iMRKZDK/CQTsjrkeSSzSdsDUMGabcdnvHeYNtbTDHoHKs='</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'s3'</span>: &#123;</span><br><span class="line">                <span class="string">'s3SchemaVersion'</span>: <span class="string">'1.0'</span>, <span class="string">'configurationId'</span>: <span class="string">'b249eeda-3d48-4319-a7e2-853f964c1a25'</span>,</span><br><span class="line">                <span class="string">'bucket'</span>: &#123;</span><br><span class="line">                    <span class="string">'name'</span>: <span class="string">'keras-blog'</span>, <span class="comment"># 버킷 이름 </span></span><br><span class="line">                    <span class="string">'ownerIdentity'</span>: &#123;</span><br><span class="line">                        <span class="string">'principalId'</span>: <span class="string">'AFK2RA1O3ML1F'</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">'arn'</span>: <span class="string">'arn:aws:s3:::keras-blog'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">'object'</span>: &#123;</span><br><span class="line">                    <span class="string">'key'</span>: <span class="string">'wowwow/csv_icon.png'</span>, <span class="comment"># 버킷 내 파일의 절대경로</span></span><br><span class="line">                    <span class="string">'size'</span>: <span class="number">11733</span>, <span class="comment"># 파일 크기</span></span><br><span class="line">                    <span class="string">'eTag'</span>: <span class="string">'f2d12d123aebda1cc1fk17479207e838'</span>,</span><br><span class="line">                    <span class="string">'sequencer'</span>: <span class="string">'125B119E4D7B2A0A48'</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>여기서 봐야 하는 것은 <code>bucket</code> 내 <code>name</code>와 <code>object</code>내 <code>key</code>입니다. 각각 업로드된 버킷의 이름과 버킷 내 파일이 업로드된 경로를 알려주기 때문에 S3 내 업로드된 파일의 절대경로를 알 수 있습니다.</p>
<p>따라서 <code>handler</code>함수 내 다음과 같이 버킷이름과 버킷 내 파일의 경로를 얻을 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 윗부분 생략</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    <span class="comment"># bucket_name은 'keras-blog' 가 됩니다.</span></span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    <span class="comment"># file_path는 'wowwow/csv_icon.png'가 됩니다.</span></span><br></pre></td></tr></table></figure>

<p>이를 통해 파일 업로드 이벤트 발생시마다 어떤 파일을 처리해야할 지 알 수 있습니다.</p>
<h3 id="s3에서-이미지-파일-받아오기"><a href="#s3에서-이미지-파일-받아오기" class="headerlink" title="s3에서 이미지 파일 받아오기"></a>s3에서 이미지 파일 받아오기</h3><p>이제 어떤 파일을 처리해야 할지 알 수 있게 되었으니 <code>downloadFromS3</code> 함수를 통해 실제로 파일을 가져와봅시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 윗부분 생략</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>] <span class="comment"># csv_icon.png</span></span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br></pre></td></tr></table></figure>

<p>위 코드를 보면 s3에 올라간 파일을 <code>/tmp</code>안에 받는 것을 볼 수 있습니다. AWS Lambda에서는 ‘쓰기’ 권한을 가진 것은 오직 <code>/tmp</code>폴더뿐이기 때문에 우리가 파일을 받아 사용하려면 <code>/tmp</code>폴더 내에 다운받아야 합니다. (혹은 온메모리에 File 객체로 들고있는 방법도 있습니다.)</p>
<h3 id="Prediction-Model-다운받기-Optional"><a href="#Prediction-Model-다운받기-Optional" class="headerlink" title="Prediction Model 다운받기 (Optional)"></a>Prediction Model 다운받기 (Optional)</h3><blockquote>
<p>만약 여러분이 그냥 사용한다면 Github에서 파일을 다운받게 됩니다. 이때 속도가 굉장히 느려 lambda비용이 많이 발생하기 때문에 여러분의 s3 버킷에 실제 파일을 올리고 s3에서 파일을 받아 사용하시는 것을 추천합니다.</p>
</blockquote>
<p>우리는 위에서 squeezenet모델을 사용했는데, 이때 모델 가중치를 담은 <code>.h5</code>파일을 먼저 받아야 합니다. <code>handler</code> 함수 내 다음 두 파일을 더 받아줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    downloadFromS3(</span><br><span class="line">        <span class="string">'keras-blog'</span>, </span><br><span class="line">        <span class="string">'squeezenet/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span>,</span><br><span class="line">        <span class="string">'/tmp/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span></span><br><span class="line">    ) <span class="comment"># weights용 h5를 s3에서 받아오기</span></span><br></pre></td></tr></table></figure>

<h3 id="squeezenet-모델로-Predict-하기"><a href="#squeezenet-모델로-Predict-하기" class="headerlink" title="squeezenet 모델로 Predict 하기"></a>squeezenet 모델로 Predict 하기</h3><p>이제 s3에 올라간 이미지 파일을 Lambda내 <code>/tmp</code>폴더에 받았으니 Predict를 진행해봅시다. <code>predict</code>라는 함수를 아래와 같이 이미지 경로를 받아 결과를 반환하도록 만들어 줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># index.py 파일, handler함수보다 앞에 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img_local_path)</span>:</span></span><br><span class="line">    model = Squeezenet(weights=<span class="string">'imagenet'</span>)</span><br><span class="line">    img = image.load_img(img_local_path, target_size=(<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line">    x = image.img_to_array(img)</span><br><span class="line">    x = np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line">    x = preprocess_input(x)</span><br><span class="line">    preds = model.predict(x)</span><br><span class="line">    res = decode_predictions(preds)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    <span class="comment"># 내용 생략 ...</span></span><br></pre></td></tr></table></figure>

<p><code>predict</code>함수는 <code>squeezenet</code>의 Pre-trained 모델을 이용해 이미지 예측을 진행합니다.</p>
<p>그러면 실제 <code>handler</code>함수에서 <code>predict</code>함수를 실행하도록 수정해줍시다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(img_local_path)</span>:</span></span><br><span class="line">    <span class="comment"># 내용 생략 ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    bucket_name = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'bucket'</span>][<span class="string">'name'</span>]</span><br><span class="line">    file_path = event[<span class="string">'Records'</span>][<span class="number">0</span>][<span class="string">'s3'</span>][<span class="string">'object'</span>][<span class="string">'key'</span>]</span><br><span class="line">    file_name = file_path.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">    downloadFromS3(bucket_name, file_path, <span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    downloadFromS3(</span><br><span class="line">        <span class="string">'keras-blog'</span>, </span><br><span class="line">        <span class="string">'squeezenet/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span>,</span><br><span class="line">        <span class="string">'/tmp/squeezenet_weights_tf_dim_ordering_tf_kernels.h5'</span></span><br><span class="line">    )</span><br><span class="line">    result = predict(<span class="string">'/tmp/'</span>+file_name) <span class="comment"># 파일 경로 전달 </span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>완성이네요!</p>
<h2 id="DynamoDB에-결과-올리기-Optional"><a href="#DynamoDB에-결과-올리기-Optional" class="headerlink" title="DynamoDB에 결과 올리기(Optional)"></a>DynamoDB에 결과 올리기(Optional)</h2><p>위 predict의 결과는 단순히 결과가 생기기만 하고 결과를 저장하거나 알려주는 부분은 없습니다. 이번 글에서는 간단한 예시로 AWS DynamoDB에 쌓아보는 부분을 추가해보겠습니다.</p>
<p><code>predict</code>함수를 통해 생성된 <code>result</code>는 다음과 같은 모습이 됩니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># result[0]의 내용, tuples in list</span></span><br><span class="line">[(<span class="string">'n02099712'</span>, <span class="string">'Labrador_retriever'</span>, <span class="number">0.68165195</span>), (<span class="string">'n02099601'</span>, <span class="string">'golden_retriever'</span>, <span class="number">0.18365686</span>), (<span class="string">'n02104029'</span>, <span class="string">'kuvasz'</span>, <span class="number">0.12076716</span>), (<span class="string">'n02111500'</span>, <span class="string">'Great_Pyrenees'</span>, <span class="number">0.0042763283</span>), (<span class="string">'n04409515'</span>, <span class="string">'tennis_ball'</span>, <span class="number">0.002152696</span>)]</span><br></pre></td></tr></table></figure>

<p>따라서 <code>map</code>을 이용해 다음과 같이 바꿔줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_tmp_dic = &#123;x[<span class="number">1</span>]:&#123;<span class="string">'N'</span>:str(x[<span class="number">2</span>])&#125; <span class="keyword">for</span> x <span class="keyword">in</span> result[<span class="number">0</span>]&#125;</span><br><span class="line">dic_for_dynamodb = &#123;<span class="string">'M'</span>: _tmp_dic&#125;</span><br></pre></td></tr></table></figure>

<p>그러면 <code>dic_for_dynamodb</code>는 아래와 같은 형태로 나오게 됩니다. </p>
<blockquote>
<p>NOTE: 숫자는 <code>float</code>나 <code>int</code>가 아닌 <code>str</code>로 바꾸어 전달해야 오류가 나지 않습니다. DynamoDB의 제약입니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">'M'</span>:&#123;</span><br><span class="line">            <span class="string">'Labrador_retriever'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.68165195'</span>&#125;, </span><br><span class="line">            <span class="string">'golden_retriever'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.18365686'</span>&#125;, </span><br><span class="line">            <span class="string">'kuvasz'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.12076716'</span>&#125;, </span><br><span class="line">            <span class="string">'Great_Pyrenees'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.0042763283'</span>&#125;, </span><br><span class="line">            <span class="string">'tennis_ball'</span>: &#123;<span class="string">'N'</span>: <span class="string">'0.002152696'</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>데이터를 넣기 위해서는 <code>dict</code>타입으로 만든 객체를 <code>put</code>할수 있는데, 이때 각각의 키에 대해 타입을 알려줘야 합니다. <code>M</code>은 이 객체가 <code>dict</code>타입이라는 것을, <code>N</code>은 이 타입이 숫자라는 것을, <code>S</code>는 문자열이라는 것을 의미합니다.</p>
<blockquote>
<p>더 상세한 내용은 <a href="https://boto3.readthedocs.io/en/latest/reference/services/dynamodb.html#DynamoDB.Client.put_item">DynamoDB에 데이터 넣기</a>를 참고하세요.</p>
</blockquote>
<p>이제 이 방식을 이용해 <code>result</code>를 반환하기 전 DynamoDB에 데이터를 넣어줄 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(event, context)</span>:</span></span><br><span class="line">    <span class="comment"># 중간 생략 ...</span></span><br><span class="line">    result = predict(<span class="string">'/tmp/'</span>+file_name)</span><br><span class="line">    _tmp_dic = &#123;x[<span class="number">1</span>]:&#123;<span class="string">'N'</span>:str(x[<span class="number">2</span>])&#125; <span class="keyword">for</span> x <span class="keyword">in</span> result[<span class="number">0</span>]&#125;</span><br><span class="line">    dic_for_dynamodb = &#123;<span class="string">'M'</span>: _tmp_dic&#125;</span><br><span class="line">    dynamo_client = boto3.client(</span><br><span class="line">        <span class="string">'dynamodb'</span>, </span><br><span class="line">        aws_access_key_id=ACCESS_KEY,</span><br><span class="line">        aws_secret_access_key=SECRET_KEY,</span><br><span class="line">        region_name=<span class="string">'ap-northeast-2'</span> <span class="comment"># DynamoDB는 리전 이름이 필요합니다.</span></span><br><span class="line">    )</span><br><span class="line">    dynamo_client.put_item(</span><br><span class="line">        TableName=<span class="string">'keras-blog-result'</span>, <span class="comment"># DynamoDB의 Table이름</span></span><br><span class="line">        Item=&#123;</span><br><span class="line">            <span class="string">'filename'</span>: &#123;</span><br><span class="line">                <span class="string">'S'</span>: file_name,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">'predicts'</span>: dic_for_dynamodb,</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="도커로-Lambda에-올릴-pack-zip파일-만들기"><a href="#도커로-Lambda에-올릴-pack-zip파일-만들기" class="headerlink" title="도커로 Lambda에 올릴 pack.zip파일 만들기"></a>도커로 Lambda에 올릴 <code>pack.zip</code>파일 만들기</h2><p>AWS Lambda에 함수를 올리려면 AmazonLinux에 맞게 pip패키지들을 <code>index.py</code> 옆에 같이 설치해준 뒤 압축파일(.zip)으로 묶어 업로드해야 합니다.</p>
<p>이때 약간의 제약이 있는데, AWS콘솔에서 Lambda로 바로 업로드를 하려면 .zip파일이 50MB보다 작아야 하고, S3에 .zip파일을 올린 뒤 Lambda에서 가져와 사용하려면 압축을 푼 크기가 250MB보다 작아야 합니다.</p>
<p>문제는 Tensorflow나 기타 라이브러리를 모두 설치하면 용량이 무지막지하게 커진다는 점인데요, 이를 해결하기 위해 사용하지 않는 부분을 strip하는 방법이 들어갑니다.</p>
<p>앞서만든 AmazonLinux 기반 컨테이너인 <code>lambdapack</code>를 이용해 패키지들을 설치하고 하나의 압축파일로 만들어줍시다.</p>
<p>아래 내용의 <code>buildPack.sh</code>파일을 <code>index.py</code> 옆에 만들어 주세요.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buildPack.sh</span></span><br><span class="line"><span class="function"><span class="title">dev_install</span></span> () &#123;</span><br><span class="line">    yum -y update</span><br><span class="line">    yum -y upgrade</span><br><span class="line">    yum install -y \</span><br><span class="line">    wget \</span><br><span class="line">    gcc \</span><br><span class="line">    gcc-c++ \</span><br><span class="line">    python36-devel \</span><br><span class="line">    python36-virtualenv \</span><br><span class="line">    python36-pip \</span><br><span class="line">    findutils \</span><br><span class="line">    zlib-devel \</span><br><span class="line">    zip</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">pip_rasterio</span></span> () &#123;</span><br><span class="line">    <span class="built_in">cd</span> /home/</span><br><span class="line">    rm -rf env</span><br><span class="line">    python3 -m virtualenv env --python=python3</span><br><span class="line">    <span class="built_in">source</span> env/bin/activate</span><br><span class="line">    text=<span class="string">"</span></span><br><span class="line"><span class="string">    [global]</span></span><br><span class="line"><span class="string">    index-url=http://ftp.daumkakao.com/pypi/simple</span></span><br><span class="line"><span class="string">    trusted-host=ftp.daumkakao.com</span></span><br><span class="line"><span class="string">    "</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$text</span>"</span> &gt; <span class="variable">$VIRTUAL_ENV</span>/pip.conf</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"UNDER: pip.conf ==="</span></span><br><span class="line">    cat <span class="variable">$VIRTUAL_ENV</span>/pip.conf</span><br><span class="line">    pip install -U pip wheel</span><br><span class="line">    pip install --use-wheel <span class="string">"h5py==2.6.0"</span></span><br><span class="line">    pip install <span class="string">"pillow==4.0.0"</span></span><br><span class="line">    pip install protobuf html5lib bleach --no-deps</span><br><span class="line">    pip install --use-wheel tensorflow --no-deps</span><br><span class="line">    deactivate</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">gather_pack</span></span> () &#123;</span><br><span class="line">    <span class="comment"># packing</span></span><br><span class="line">    <span class="built_in">cd</span> /home/</span><br><span class="line">    <span class="built_in">source</span> env/bin/activate</span><br><span class="line"></span><br><span class="line">    rm -rf lambdapack</span><br><span class="line">    mkdir lambdapack</span><br><span class="line">    <span class="built_in">cd</span> lambdapack</span><br><span class="line"></span><br><span class="line">    cp -R /home/env/lib/python3.6/site-packages/* .</span><br><span class="line">    cp -R /home/env/lib64/python3.6/site-packages/* .</span><br><span class="line">    cp /outputs/squeezenet.py /home/lambdapack/squeezenet.py</span><br><span class="line">    cp /outputs/index.py /home/lambdapack/index.py</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"original size <span class="variable">$(du -sh /home/lambdapack | cut -f1)</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># cleaning libs</span></span><br><span class="line">    rm -rf external</span><br><span class="line">    find . -<span class="built_in">type</span> d -name <span class="string">"tests"</span> -<span class="built_in">exec</span> rm -rf &#123;&#125; +</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cleaning</span></span><br><span class="line">    find -name <span class="string">"*.so"</span> | xargs strip</span><br><span class="line">    find -name <span class="string">"*.so.*"</span> | xargs strip</span><br><span class="line">    rm -r pip</span><br><span class="line">    rm -r pip-*</span><br><span class="line">    rm -r wheel</span><br><span class="line">    rm -r wheel-*</span><br><span class="line">    rm easy_install.py</span><br><span class="line">    find . -name \*.pyc -delete</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"stripped size <span class="variable">$(du -sh /home/lambdapack | cut -f1)</span>"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># compressing</span></span><br><span class="line">    zip -FS -r1 /outputs/pack.zip * &gt; /dev/null</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"compressed size <span class="variable">$(du -sh /outputs/pack.zip | cut -f1)</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span> () &#123;</span><br><span class="line">    dev_install</span><br><span class="line">    pip_rasterio</span><br><span class="line">    gather_pack</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure>

<p><code>dev_install</code> 함수에서는 운영체제에 Python3/pip3등을 설치해 주고, <code>pip_rasterio</code> 함수에서는 가상환경에 들어가 tensorflow등 pip로 패키지들을 설치해 주고, <code>gather_pack</code> 함수에서는 가상환경에 설치된 패키지들과 <code>index.py</code>파일을 한 폴더에 모은 뒤 <code>pack.zip</code>파일로 압축해줍니다.</p>
<blockquote>
<p>중간에 <code>pip.conf</code>를 바꾸는 부분을 통해 느린 pip global cdn대신 kakao의 pip 미러서버로 좀 더 패키지들을 빠르게 받을 수 있습니다. 이 방법은 여러분의 pip에도 바로 적용할 수 있습니다.</p>
</blockquote>
<p>이 sh 파일을 도커 내에서 실행하기 위해서 다음 명령어를 사용해 실행해주세요.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it lambdapack /bin/bash /outputs/buildPack.sh</span><br></pre></td></tr></table></figure>

<p>이 명령어는 <code>lambdapack</code>이라는 컨테이너에서 <code>buildPack.sh</code>파일을 실행하게 됩니다.</p>
<p>실행하고 나면 약 50MB안팎의 <code>pack.zip</code>파일 하나가 생긴것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.27.11.png" alt=""></p>
<p>하지만 앞서 언급한 것처럼, AWS 콘솔에서 ‘ZIP 파일 올리기’로 한번에 올릴수 있는 압축파일의 용량은 50MB로 제한됩니다. 따라서 이 zip 파일을 s3에 올린 뒤 zip파일의 HTTP주소를 넣어줘야 합니다.</p>
<h2 id="zip파일-s3에-올리고-AWS-Lambda-트리거-만들기"><a href="#zip파일-s3에-올리고-AWS-Lambda-트리거-만들기" class="headerlink" title="zip파일 s3에 올리고 AWS Lambda 트리거 만들기"></a>zip파일 s3에 올리고 AWS Lambda 트리거 만들기</h2><p>이제 AWS 콘솔을 볼 때가 되었습니다.</p>
<p>지금까지 작업한 것은 Lambda에 올릴 패키지/코드를 압축한 파일인데요, 이 부분을 약간 수정해 이제 실제로 AWS Lambda의 이벤트를 통해 실행해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.31.32.png" alt="s3에 파일 업로드하기"></p>
<p>S3에 파일을 올린 뒤 파일의 HTTPS주소를 복사해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.32.11.png" alt="s3의 pack.zip HTTP주소"></p>
<p>여기에서는 <code>https://s3.ap-northeast-2.amazonaws.com/keras-blog/pack.zip</code>가 주소가 됩니다.</p>
<p>이제 진짜로 AWS Lambda 함수를 만들어봅시다.</p>
<p><a href="https://ap-northeast-2.console.aws.amazon.com/lambda/home?region=ap-northeast-2#/create">Lambda 콘솔 함수만들기</a>에 들어가 “새로 작성”을 선택 후 아래와 같이 내용을 채운 뒤 함수 생성을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.34.39.png" alt=""></p>
<p>함수가 생성되고 나면 화면 아래쪽 ‘함수 코드’에서 다음과 같이 AWS s3에서 업로드를 선택하고 런타임을 Python3.6으로 잡은 뒤 핸들러를 <code>index.handler</code>로 바꾸고 S3링크를 넣어준 뒤 ‘저장’을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.38.45.png" alt=""></p>
<p>그 뒤, ‘기본 설정’에서 메모리를 1500MB 이상으로, 그리고 제한시간은 30초 이상으로 잡아주세요. 저는 테스트를 위해 3000MB/5분으로 잡아주었습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.22.39.png" alt=""></p>
<p>이제 s3에서 파일이 추가될때 자동으로 실행되도록 만들어 주기 위해 다음과 같이 ‘구성’에서 s3를 선택해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-13%2017.40.23.png" alt="트리거에서 s3 선택하기"></p>
<p>이제 화면 아래에 ‘트리거 구성’ 메뉴가 나오면 아래 스크린샷처럼, 파일을 올릴 s3, 그리고 어떤 이벤트(파일 업로드/삭제/복사 등)를 탐지할지 선택하고, 접두사에서 폴더 경로를 <code>폴더이름/</code>으로 써 준 뒤, 필요한 경우 접미사(주로 파일 확장자)를 써 주면 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2009.55.57.png" alt="S3 트리거 구성"></p>
<p>이번에는 <code>keras-blog</code>라는 버킷 내 <code>uploads</code>폴더 내에 어떤 파일이든 생성되기만 하면 모두 람다 함수를 실행시키는 것으로 만들어 본 것입니다.</p>
<blockquote>
<p>NOTE: 접두사/접미사에 <code>or</code> 조건은 AWS콘솔에서 지원하지 않습니다.</p>
</blockquote>
<p>추가버튼을 누르고 난 뒤 저장을 눌러주면 됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.00.00.png" alt="함수 저장하기"></p>
<p>트리거가 성공적으로 저장 되었다면 다음과 같은 화면을 볼 수 있을거에요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2010.01.52.png" alt="람다 함수 다 만든 모습"></p>
<h2 id="Lambda-환경변수-추가하기"><a href="#Lambda-환경변수-추가하기" class="headerlink" title="Lambda 환경변수 추가하기"></a>Lambda 환경변수 추가하기</h2><p>우리가 앞서 <code>index.py</code>에서 <code>os.environ</code>을 통해 시스템의 환경변수를 가져왔습니다. 이를 정상적으로 동작하게 하기 위해서는 <code>ACCESS_KEY</code>와 <code>SECRET_KEY</code>을 추가해주어야 합니다. 아래 스크린샷처럼 각각 값을 입력하고 저장해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2011.21.21.png" alt="환경변수 추가하기"></p>
<blockquote>
<p>이 키는 AWS <code>iam</code>을 통해 가져올 수 있습니다. 해당 iam계정은 s3 R/W권한, DynamoDB write 권한이 있어야 합니다.</p>
</blockquote>
<h2 id="Lambda-내-테스트-돌리기-Optional"><a href="#Lambda-내-테스트-돌리기-Optional" class="headerlink" title="Lambda 내 테스트 돌리기(Optional)"></a>Lambda 내 테스트 돌리기(Optional)</h2><p>AWS Lambda 콘솔에서도 테스트를 돌릴 수 있습니다.</p>
<p>아래와 같이 event 객체를 만들어 전달하면 실제 이벤트처럼 동작합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.16.35.png" alt="예제 테스트"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Records"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"s3"</span>: &#123;</span><br><span class="line">                <span class="attr">"bucket"</span>: &#123;<span class="attr">"name"</span>: <span class="string">"keras-blog"</span>&#125;,</span><br><span class="line">               <span class="attr">"object"</span>: &#123;<span class="attr">"key"</span>: <span class="string">"uploads/kitten.png"</span>&#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>유의: 실제로 <code>keras-blog</code>버킷 내 <code>uploads</code>폴더 내 <code>kitten.png</code>파일이 있어야 테스트가 성공합니다! (인터넷의 아무 사진이나 넣어두세요.)</p>
</blockquote>
<p>테스트가 성공하면 다음과 같이 <code>return</code>된 결과가 json으로 보입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.15.44.png" alt="람다콘솔 테스트 성공"></p>
<h2 id="마무리-파일-업로드하고-DB에-쌓이는지-확인하기"><a href="#마무리-파일-업로드하고-DB에-쌓이는지-확인하기" class="headerlink" title="마무리: 파일 업로드하고 DB에 쌓이는지 확인하기"></a>마무리: 파일 업로드하고 DB에 쌓이는지 확인하기</h2><p>이제 s3에 가서 파일을 업로드 해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.19.34.png" alt="s3에 파일 업로드"></p>
<p><code>keras-blog</code> 버킷 내 <code>uploads</code>폴더에 고양이 사진 몇 개를 올려봅시다.</p>
<p>몇초 기다리면 DynamoDB에 다음과 같이 파일 이름과 Predict된 결과가 쌓이는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-12-14%2015.20.04.png" alt="DynamoDB에 쌓인 결과"></p>
<p>이제 우리는 파일이 1개가 올라가든 1000개가 올라가든 모두 동일한 속도로 결과를 얻을 수 있습니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/29/JS-TreeShaking-with-Webpack/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/treeshaking.png" alt="TreeShaking으로 webpack 번들 결과 용량 줄이기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-28T15:00:00.000Z">2017-11-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/javascript/">javascript</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/29/JS-TreeShaking-with-Webpack/">TreeShaking으로 webpack 번들 결과 용량 줄이기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>이번 글은 webpack을 사용하고 있다고 가정합니다. 만약 webpack이 뭔지 아직 모르시거나 설치하지 않으셨다면 <a href="/2017/10/18/Setup-Babel-with-webpack/">Webpack과 Babel로 최신 JavaScript 웹프론트 개발환경 만들기</a>를 먼저 읽고 따라가보세요.</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>웹 프론트 개발을 할 때 npm과 webpack을 통해 <code>bundle.js</code>와 같은 번들링된 js파일 하나로 만들어 싱글 페이지 앱을 만드는 경우가 많습니다.</p>
<p>우리가 사용하는 패키지들을 찾아 간단하게 묶고 babel을 통해 하위버전 브라우저에서도 돌아가도록 만들어주는 작업은 마치 마법과 같이 편리합니다.</p>
<p>하지만 이 마법같은 번들링에도 심각한 문제점이 있습니다. 바로 용량이 어마어마해진다는 것이죠.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/tree-shaking-before.png" alt=""></p>
<p>아무런 처리를 하지 않고 webpack으로 빌드를 할 때의 용량은 스크린샷에 나온 것처럼 무려 1.61MB됩니다.</p>
<p>사실 아직 <code>lodash</code>, <code>bootstrap3</code>, <code>axios</code>와 같은 아주 기본적인 라이브러리들만 넣었음에도 다음과 같이 어마어마하게 무거운 js파일이 생성됩니다.</p>
<p>이제 이 파일을 1/3 크기로 줄여봅시다.</p>
<h2 id="uglifyjs-webpack-plugin"><a href="#uglifyjs-webpack-plugin" class="headerlink" title="uglifyjs-webpack-plugin"></a>uglifyjs-webpack-plugin</h2><p>webpack과 함께 파일의 용량을 줄여주는 도구인 <code>uglifyjs</code>를 사용해봅시다.</p>
<p>우선 다음 명령어로 <code>uglifyjs-webpack-plugin</code>를 설치해주세요.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev uglifyjs-webpack-plugin</span><br></pre></td></tr></table></figure>

<h2 id="webpack-실행시-자동으로-용량줄이기"><a href="#webpack-실행시-자동으로-용량줄이기" class="headerlink" title="webpack 실행시 자동으로 용량줄이기"></a>webpack 실행시 자동으로 용량줄이기</h2><p>여러분이 webpack을 사용하고 있다면 아마 다음과 같은 <code>webpack.config.js</code>파일을 만들어 사용하고 있을거에요. (세부적인 설정은 다를 수 있어요.)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                include: path.join(__dirname, <span class="string">'src'</span>),</span><br><span class="line">                exclude: <span class="regexp">/(node_modules)|(dist)/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [</span><br><span class="line">                            [<span class="string">"env"</span>]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 설정은 단순히 <code>src</code>파일 안의 js들을 <code>dist</code>폴더 안의 <code>bundle.js</code>파일로 묶어주고 있습니다.</p>
<p>이제 여기에서 몇줄만 추가해 주면 됩니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="comment">// 1. UglifyJSPlugin을 가져오세요.</span></span><br><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                include: path.join(__dirname, <span class="string">'src'</span>),</span><br><span class="line">                exclude: <span class="regexp">/(node_modules)|(dist)/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [</span><br><span class="line">                            [<span class="string">"env"</span>, &#123;</span><br><span class="line">                                <span class="string">"targets"</span>: &#123;</span><br><span class="line">                                    <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"safari &gt;= 7"</span>]</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. plugins를 새로 만들고, new UglifyJsPlugin() 을 통해</span></span><br><span class="line">    <span class="comment">// UglifyJS를 빌드 과정에 합쳐주세요.</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> UglifyJsPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이제 빌드를 실행해보면 아래 스크린샷과 같이 <code>bundle.js</code>파일의 용량이 획기적으로 줄어든 것을 볼 수 있습니다. 용량이 1.6MB에서 667KB로 1/3정도로 줄어든 것을 볼 수 있습니다. 간단하죠?</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/tree-shaking-after.png" alt=""></p>
<p>하지만 여기에는 작은 함정이 있습니다. 바로 <code>time</code>, 즉 빌드시마다 걸리는 시간도 그에따라 늘어난 것인데요, 만약 여러분이 <code>webpack-dev-server</code>와 같이 실시간으로 파일을 감시하며 변화 발생시마다 빌드하는 방식을 사용하고 있다면 코드 한줄, 띄어쓰기 하나 수정한 정도로 무려 12초에 달하는 빌드 시간을 기다려야 합니다. (treeshaking 하기 전에는 3초정도밖에 걸리지 않았습니다.)</p>
<p>그래서 항상 treeshaking을 해주는 대신 빌드작업, 즉 서버에 실제로 배포하기 위해 <code>bundle.js</code>파일을 생성할 때만 treeshaking을 해주면 개발도 빠르고 실제 배포시에도 빠르게 작업이 가능합니다.</p>
<h2 id="빌드할때만-사용하기"><a href="#빌드할때만-사용하기" class="headerlink" title="빌드할때만 사용하기"></a>빌드할때만 사용하기</h2><p>앞서 다뤘던 <code>package.json</code>파일 중 <code>script</code>부분 아래 <code>build</code>를 다음과 같이 수정해주세요. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        <span class="string">"build"</span>: <span class="string">"webpack --optimize-minimize"</span>,</span><br><span class="line">    &#125;,    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>그리고 <code>webpack.config.js</code> 파일 중 위에서 넣어주었던 <code>plugins</code>를 통채로 지워주세요.(더이상 필요하지 않아요!)</p>
<p>만약 여러분이 <code>webpack.config.js</code>파일을 정확히 설정해 <code>webpack</code>이라는 명령어가 성공적으로 실행되고있던 상태라면 <code>--optimize-minimize</code>라는 명령어만 뒤에 붙여주면 곧바로 실행됩니다.</p>
<p>이제 여러분이 개발할 때 <code>webpack-dev-server</code>를 통해 빌드가 실행될때는 treeshaking이 되지 않고, 대신 배포를 위해 빌드를 할 때는 최소화된 작은 번들된 js파일을 가질 수 있게 됩니다.</p>
<h2 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h2><p>여러분이 위 과정을 모두 따라왔다면 아마 <code>package.json</code>과 <code>webpack.config.js</code>파일은 이와 유사하게 생겼을거에요.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 앞뒤생략한 package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        <span class="string">"build"</span>: <span class="string">"webpack --optimize-minimize"</span>,</span><br><span class="line">        <span class="string">"devserver"</span>: <span class="string">"webpack-dev-server --open"</span></span><br><span class="line">    &#125;,    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js 파일</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/js/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                include: path.join(__dirname, <span class="string">'src'</span>),</span><br><span class="line">                exclude: <span class="regexp">/(node_modules)|(dist)/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [</span><br><span class="line">                            [<span class="string">"env"</span>, &#123;</span><br><span class="line">                                <span class="string">"targets"</span>: &#123;</span><br><span class="line">                                    <span class="string">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"safari &gt;= 7"</span>]</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Plugin은 필요한 것만 넣어주세요. UglifyJSPlugin은 필요없어요!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/29/HTML-Table-to-CSV/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/table_to_csv.jpg" alt="HTML Table을 CSV로 다운로드하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-28T15:00:00.000Z">2017-11-29</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/javascript/">javascript</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/29/HTML-Table-to-CSV/">HTML Table을 CSV로 다운로드하기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>웹 개발을 하다보면 <code>&lt;table&gt;</code>의 내용물을 모두 csv 파일로 받게 해달라는 요구사항이 종종 생깁니다.</p>
<p>가장 일반적인 방법은 csv 형태로 파일을 받을 수 있는 API를 서버가 제공해주는 방법입니다. (백엔드 개발자에게 일을 시킵시다.)</p>
<p>하지만 csv를 던져주는 API 서버가 없다면 프론트에서 보여지는 <code>&lt;table&gt;</code>만이라도 csv로 만들어줘야 합니다.</p>
<p>이번 글은 이럴때 쓰는 방법입니다.</p>
<h2 id="소스코드"><a href="#소스코드" class="headerlink" title="소스코드"></a>소스코드</h2><p>우선 이렇게 생긴 HTML이 있다고 생각해 봅시다.</p>
<p>본문이라고는 <code>#</code>, <code>title</code>, <code>content</code>가 들어있는 자그마한 <code>&lt;table&gt;</code> 하나가 있습니다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"ko"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>빈 HTML<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"mytable"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>content<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Lorem Ipsum<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>로렘 입섬은 빈칸을 채우기 위한 문구입니다.<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>헬로 월드는 언어를 배우기 시작할때 화면에 표준 출력을 할때 주로 사용하는 문구입니다.<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"csvDownloadButton"</span>&gt;</span>CSV 다운로드 받기<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>테이블 엘리먼트의 id는 <code>mytable</code>이고, CSV 다운로드 버튼의 id는 <code>csvDownloadButton</code> 입니다.</p>
<p>이제 JS를 조금 추가해봅시다. ES6/ES5에 따라 선택해 사용해주세요.</p>
<p>아래 코드를 <code>&lt;script&gt;&lt;/script&gt;</code> 태그 사이에 넣어 <code>&lt;/body&gt;</code> 바로 앞에 넣어주세요.</p>
<h3 id="ES6을-사용할-경우"><a href="#ES6을-사용할-경우" class="headerlink" title="ES6을 사용할 경우"></a>ES6을 사용할 경우</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToCSV</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// CSV 버튼에 이벤트 등록</span></span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'#csvDownloadButton'</span>).addEventListener(<span class="string">'click'</span>, e =&gt; &#123;</span><br><span class="line">            e.preventDefault()</span><br><span class="line">            <span class="keyword">this</span>.getCSV(<span class="string">'mycsv.csv'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    downloadCSV(csv, filename) &#123;</span><br><span class="line">        <span class="keyword">let</span> csvFile;</span><br><span class="line">        <span class="keyword">let</span> downloadLink;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// CSV 파일을 위한 Blob 만들기</span></span><br><span class="line">        csvFile = <span class="keyword">new</span> Blob([csv], &#123;<span class="attr">type</span>: <span class="string">"text/csv"</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Download link를 위한 a 엘리먼스 생성</span></span><br><span class="line">        downloadLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 다운받을 csv 파일 이름 지정하기</span></span><br><span class="line">        downloadLink.download = filename;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 위에서 만든 blob과 링크를 연결</span></span><br><span class="line">        downloadLink.href = <span class="built_in">window</span>.URL.createObjectURL(csvFile)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 링크가 눈에 보일 필요는 없으니 숨겨줍시다.</span></span><br><span class="line">        downloadLink.style.display = <span class="string">"none"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// HTML 가장 아래 부분에 링크를 붙여줍시다.</span></span><br><span class="line">        <span class="built_in">document</span>.body.appendChild(downloadLink)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 클릭 이벤트를 발생시켜 실제로 브라우저가 '다운로드'하도록 만들어줍시다.</span></span><br><span class="line">        downloadLink.click()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getCSV(filename) &#123;</span><br><span class="line">        <span class="comment">// csv를 담기 위한 빈 Array를 만듭시다.</span></span><br><span class="line">        <span class="keyword">const</span> csv = []</span><br><span class="line">        <span class="keyword">const</span> rows = <span class="built_in">document</span>.querySelectorAll(<span class="string">"#mytable table tr"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rows.length; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> row = [], cols = rows[i].querySelectorAll(<span class="string">"td, th"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; cols.length; j++)</span><br><span class="line">                row.push(cols[j].innerText)</span><br><span class="line"></span><br><span class="line">            csv.push(row.join(<span class="string">","</span>))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Download CSV</span></span><br><span class="line">        <span class="keyword">this</span>.downloadCSV(csv.join(<span class="string">"\n"</span>), filename)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, e =&gt; &#123;</span><br><span class="line">    <span class="keyword">new</span> ToCSV()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="ES5를-사용하실-경우"><a href="#ES5를-사용하실-경우" class="headerlink" title="ES5를 사용하실 경우"></a>ES5를 사용하실 경우</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadCSV</span>(<span class="params">csv, filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> csvFile;</span><br><span class="line">    <span class="keyword">var</span> downloadLink;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CSV 파일을 위한 Blob 만들기</span></span><br><span class="line">    csvFile = <span class="keyword">new</span> Blob([csv], &#123;<span class="attr">type</span>: <span class="string">"text/csv"</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Download link를 위한 a 엘리먼스 생성</span></span><br><span class="line">    downloadLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 다운받을 csv 파일 이름 지정하기</span></span><br><span class="line">    downloadLink.download = filename;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 위에서 만든 blob과 링크를 연결</span></span><br><span class="line">    downloadLink.href = <span class="built_in">window</span>.URL.createObjectURL(csvFile)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 링크가 눈에 보일 필요는 없으니 숨겨줍시다.</span></span><br><span class="line">    downloadLink.style.display = <span class="string">"none"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// HTML 가장 아래 부분에 링크를 붙여줍시다.</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(downloadLink)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 클릭 이벤트를 발생시켜 실제로 브라우저가 '다운로드'하도록 만들어줍시다.</span></span><br><span class="line">    downloadLink.click()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCSV</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// csv를 담기 위한 빈 Array를 만듭시다.</span></span><br><span class="line">    <span class="keyword">var</span> csv = []</span><br><span class="line">    <span class="keyword">var</span> rows = <span class="built_in">document</span>.querySelectorAll(<span class="string">"#mytable table tr"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; rows.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> row = [], cols = rows[i].querySelectorAll(<span class="string">"td, th"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; cols.length; j++)</span><br><span class="line">            row.push(cols[j].innerText)</span><br><span class="line"></span><br><span class="line">        csv.push(row.join(<span class="string">","</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Download CSV</span></span><br><span class="line">    downloadCSV(csv.join(<span class="string">"\n"</span>), filename)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, e =&gt; &#123;</span><br><span class="line">    <span class="comment">// CSV 버튼에 이벤트 등록</span></span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">'#csvDownloadButton'</span>).addEventListener(<span class="string">'click'</span>, e =&gt; &#123;</span><br><span class="line">        e.preventDefault()</span><br><span class="line">        getCSV(<span class="string">'mycsv.csv'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="전체-예시"><a href="#전체-예시" class="headerlink" title="전체 예시"></a>전체 예시</h3><blockquote>
<p><a href="/others/html_to_csv.html">예제 html_to_csv.html</a>에서 직접 동작하는 것을 확인해 보세요!</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"ko"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>빈 HTML<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"mytable"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>title<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span>&gt;</span>content<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Lorem Ipsum<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>로렘 입섬은 빈칸을 채우기 위한 문구입니다.<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>2<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>헬로 월드는 언어를 배우기 시작할때 화면에 표준 출력을 할때 주로 사용하는 문구입니다.<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"csvDownloadButton"</span>&gt;</span>CSV 다운로드 받기<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="class"><span class="keyword">class</span> <span class="title">ToCSV</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">constructor</span>() &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// CSV 버튼에 이벤트 등록</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.querySelector(<span class="string">'#csvDownloadButton'</span>).addEventListener(<span class="string">'click'</span>, e =&gt; &#123;</span></span><br><span class="line">            e.preventDefault()</span><br><span class="line"><span class="actionscript">            <span class="keyword">this</span>.getCSV(<span class="string">'mycsv.csv'</span>)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    downloadCSV(csv, filename) &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> csvFile;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> downloadLink;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// CSV 파일을 위한 Blob 만들기</span></span></span><br><span class="line"><span class="actionscript">        csvFile = <span class="keyword">new</span> Blob([csv], &#123;type: <span class="string">"text/csv"</span>&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Download link를 위한 a 엘리먼스 생성</span></span></span><br><span class="line"><span class="javascript">        downloadLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 다운받을 csv 파일 이름 지정하기</span></span></span><br><span class="line">        downloadLink.download = filename;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 위에서 만든 blob과 링크를 연결</span></span></span><br><span class="line"><span class="javascript">        downloadLink.href = <span class="built_in">window</span>.URL.createObjectURL(csvFile)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 링크가 눈에 보일 필요는 없으니 숨겨줍시다.</span></span></span><br><span class="line"><span class="actionscript">        downloadLink.style.display = <span class="string">"none"</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// HTML 가장 아래 부분에 링크를 붙여줍시다.</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(downloadLink)</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// 클릭 이벤트를 발생시켜 실제로 브라우저가 '다운로드'하도록 만들어줍시다.</span></span></span><br><span class="line">        downloadLink.click()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getCSV(filename) &#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// csv를 담기 위한 빈 Array를 만듭시다.</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> csv = []</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> rows = <span class="built_in">document</span>.querySelectorAll(<span class="string">"#mytable tr"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rows.length; i++) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> row = [], cols = rows[i].querySelectorAll(<span class="string">"td, th"</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; cols.length; j++)</span></span><br><span class="line">                row.push(cols[j].innerText)</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            csv.push(row.join(<span class="string">","</span>))</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">// Download CSV</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.downloadCSV(csv.join(<span class="string">"\n"</span>), filename)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, e =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">new</span> ToCSV()</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>하지만 이렇게하면 한글이 깨지는 문제가 있습니다.</p>
<h2 id="한글-깨지는-문제-해결하기"><a href="#한글-깨지는-문제-해결하기" class="headerlink" title="한글 깨지는 문제 해결하기"></a>한글 깨지는 문제 해결하기</h2><p>앞서 한글이 깨지는 이유는 기본적으로 엑셀이 인코딩을 UTF-8로 인식하지 않기 때문에 문제가 발생합니다.</p>
<p>이때 아래 코드를 csv blob을 만들기 전 추가해주면 됩니다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 한글 처리를 해주기 위해 BOM 추가하기</span></span><br><span class="line"><span class="keyword">const</span> BOM = <span class="string">"\uFEFF"</span>;</span><br><span class="line">csv = BOM + csv</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// downloadCSV 함수를 이렇게 수정해 주세요.</span></span><br><span class="line">downloadCSV(csv, filename) &#123;</span><br><span class="line">    <span class="keyword">let</span> csvFile;</span><br><span class="line">    <span class="keyword">let</span> downloadLink;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 한글 처리를 해주기 위해 BOM 추가하기</span></span><br><span class="line">    <span class="keyword">const</span> BOM = <span class="string">"\uFEFF"</span>;</span><br><span class="line">    csv = BOM + csv</span><br><span class="line"></span><br><span class="line">    <span class="comment">// CSV 파일을 위한 Blob 만들기</span></span><br><span class="line">    csvFile = <span class="keyword">new</span> Blob([csv], &#123;<span class="attr">type</span>: <span class="string">"text/csv"</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Download link를 위한 a 엘리먼스 생성</span></span><br><span class="line">    downloadLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 다운받을 csv 파일 이름 지정하기</span></span><br><span class="line">    downloadLink.download = filename;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 위에서 만든 blob과 링크를 연결</span></span><br><span class="line">    downloadLink.href = <span class="built_in">window</span>.URL.createObjectURL(csvFile)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 링크가 눈에 보일 필요는 없으니 숨겨줍시다.</span></span><br><span class="line">    downloadLink.style.display = <span class="string">"none"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// HTML 가장 아래 부분에 링크를 붙여줍시다.</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(downloadLink)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 클릭 이벤트를 발생시켜 실제로 브라우저가 '다운로드'하도록 만들어줍시다.</span></span><br><span class="line">    downloadLink.click()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/28/Flask-CSV-Response/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/flask.jpg" alt="한글이 보이는 Flask CSV Response 만들기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-27T15:00:00.000Z">2017-11-28</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/flask/">flask</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/28/Flask-CSV-Response/">한글이 보이는 Flask CSV Response 만들기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>웹 사이트를 만들다 보면 테이블 등을 csv파일로 다운받을 수 있도록 만들어달라는 요청이 자주 있습니다. 이번 글에서는 Flask에서 특정 URL로 들어갈 때 CSV파일을 받을 수 있도록 만들고, 다운받은 CSV파일을 엑셀로 열 때 한글이 깨지지 않게 처리해 봅시다.</p>
<p>이번에는 Flask + SQLAlchemy + Pandas를 사용합니다.</p>
<h2 id="Flask-코드짜기"><a href="#Flask-코드짜기" class="headerlink" title="Flask 코드짜기"></a>Flask 코드짜기</h2><p>우선 Flask 코드를 하나 봅시다. <code>app.py</code>라는 이름을 갖고 있다고 생각해 봅시다.</p>
<p>아래 코드는 <code>Post</code>라는 모델을 모두 가져와 <code>df</code>라는 DataFrame객체로 만든 뒤 <code>.to_csv</code>를 통해 csv 객체로 만들어 준 뒤 <code>StringIO</code>를 통해 실제 io가 가능한 바이너리형태로 만들어 줍니다.</p>
<p>또, <code>output</code>을 해주기 전 <code>u&#39;\ufeff&#39;</code>를 미리 넣어줘 이 파일이 ‘UTF-8 with BOM’이라는 방식으로 인코딩 되어있다는 것을 명시적으로 알려줍니다.</p>
<blockquote>
<p>인코딩 명시를 빼면 엑셀에서 파일을 열 때 한글이 깨져서 나옵니다.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, request, Response</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">app = Flask(__name__) <span class="comment"># Flask App 만들기</span></span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'데이터베이스 URI'</span> <span class="comment"># SQLAlchemy DB 연결하기</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line">db.init_app(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 기타 설정을 해줬다고 가정합니다.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/api/post/csv/') # URL 설정하기</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_list_csv</span><span class="params">(self)</span>:</span></span><br><span class="line">    queryset = Post.query.all()</span><br><span class="line">    df = pd.read_sql(queryset.statement, queryset.session.bind) <span class="comment"># Pandas가 SQL을 읽도록 만들어주기</span></span><br><span class="line">    output = StringIO()</span><br><span class="line">    output.write(<span class="string">u'\ufeff'</span>) <span class="comment"># 한글 인코딩 위해 UTF-8 with BOM 설정해주기</span></span><br><span class="line">    df.to_csv(output)</span><br><span class="line">    <span class="comment"># CSV 파일 형태로 브라우저가 파일다운로드라고 인식하도록 만들어주기</span></span><br><span class="line">    response = Response(</span><br><span class="line">        output.getvalue(),</span><br><span class="line">        mimetype=<span class="string">"text/csv"</span>,</span><br><span class="line">        content_type=<span class="string">'application/octet-stream'</span>,</span><br><span class="line">    )</span><br><span class="line">    response.headers[<span class="string">"Content-Disposition"</span>] = <span class="string">"attachment; filename=post_export.csv"</span> <span class="comment"># 다운받았을때의 파일 이름 지정해주기</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/27/EMR-and-PySpark/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/PySpak_n_Hadoop_EMR_and_PySpark.png" alt="PySpark &amp; Hadoop: 2) EMR 클러스터 띄우고 PySpark로 작업 던지기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-26T15:00:00.000Z">2017-11-27</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/pyspark/">pyspark</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/27/EMR-and-PySpark/">PySpark &amp; Hadoop: 2) EMR 클러스터 띄우고 PySpark로 작업 던지기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>이번 글은 <a href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04">PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기</a>와 이어지는 글입니다.</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>이전 글에서 우분투에 JAVA/Hadoop/PySpark를 설치해 spark를 통해 EMR로 작업을 던질 EC2를 하나 생성해보았습니다. 이번에는 동일한 VPC그룹에 EMR 클러스터를 생성하고 PySpark의 <code>yarn</code>설정을 통해 원격 EMR에 작업을 던져봅시다.</p>
<h2 id="EMR-클러스터-띄우기"><a href="#EMR-클러스터-띄우기" class="headerlink" title="EMR 클러스터 띄우기"></a>EMR 클러스터 띄우기</h2><p>AWS 콘솔에 들어가 EMR을 검색해 EMR 대시보드로 들어갑시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2016.52.49.png" alt="AWS 콘솔에서 EMR검색하기"></p>
<p>EMR 대시보드에서 ‘클러스터 생성’을 클릭해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2016.53.53.png" alt="EMR 대시보드 첫화면에서 클러스터 생성 클릭"></p>
<p>이제 아래와 같이 클러스터이름을 적어주고, 시작 모드를 ‘클러스터’로, 릴리즈는 최신 릴리즈 버전(현 5.10이 최신)으로, 애플리케이션은 Spark를 선택해주세요.</p>
<p>그리고 EC2 키 페어를 갖고있다면 기존에 갖고있는 <code>.pem</code>파일을, 없다면 새 키를 만들고 진행하세요.</p>
<p>주황색 표시 한 부분 외에는 기본 설정값 그대로 두면 됩니다. 로깅은 필요한 경우 켜고 필요하지 않은 경우 꺼두면 됩니다.</p>
<p>그리고 할 작업에 따라 인스턴스 유형을 r(많은 메모리), c(많은 CPU), i(많은 스토리지), p(GPU)중 선택하고 인스턴스 개수를 원하는 만큼 선택해주면 됩니다.</p>
<p>많으면 많을수록 Spark작업이 빨리 끝나는 한편 비용도 그만큼 많이 듭니다. 여기서는 기본값인 <code>r3.xlarge</code> 인스턴스 3개로 진행해 봅시다. 인스턴스 3대가 생성되면 한대는 Master 노드가, 나머지 두대는 Core 노드가 됩니다. 앞으로 작업을 던지고 관리하는 부분은 모두 Master노드에서 이루어집니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2016.55.59.png" alt="EMR Spark 클러스터 만들기"></p>
<p>설정이 끝나고 나면 아래 ‘클러스터 생성’ 버튼을 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.06.32.png" alt="클러스터 생성 클릭"></p>
<p>클러스터가 시작되고 ‘준비’ 단계가 될 때까지는 약간의 시간(1~3분)이 걸립니다. ‘마스터 퍼블릭 DNS’가 화면에 뜰 때까지 잠시 기다려 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.11.49.png" alt="클러스터: PySpark화면"></p>
<p>클러스터가 준비가 완료되면 아래와 같이 ‘마스터 퍼블릭 DNS’ 주소가 나옵니다. </p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.19.56.png" alt="클러스터: PySpark DNS나온 화면"></p>
<p>‘마스터 퍼블릭 DNS’는 앞으로 설정할때 자주 사용하기 때문에 미리 복사를 해 둡시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 이번에 만들어진 클러스터의 마스터 퍼블릭 DNS</span></span><br><span class="line">ec2-13-124-83-135.ap-northeast-2.compute.amazonaws.com</span><br></pre></td></tr></table></figure>

<p>이렇게 나오면 우선 클러스터를 사용할 준비가 완료된 것으로 볼 수 있습니다. 이제 다시 앞 글에서 만든 EC2를 설정해봅시다.</p>
<h2 id="EC2-설정-관리하기"><a href="#EC2-설정-관리하기" class="headerlink" title="EC2 설정 관리하기"></a>EC2 설정 관리하기</h2><p>이제 EMR 클러스터가 준비가 완료되었으니 EC2 인스턴스에 다시 ssh로 접속을 해 봅시다.</p>
<p>이전 편인 <a href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04">PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기</a>글을 읽고 따라 왔다면 여러분의 EC2에는 아마 JAVA와 PySpark, 그리고 Hadoop이 설치가 되어있을겁니다.</p>
<p>우리는 Hadoop의 <code>yarn</code>을 통해서 EMR 클러스터에 spark작업을 던져주기 때문에 이 부분을 설정을 조금 해줘야 합니다.</p>
<p>이전 편을 따라왔다면 아래 두 파일을 수정해주면 되고, 만약 따로 Hadoop을 설치해줬다면 <code>which hadoop</code>을 통해서 나오는 주소를 약간 수정해 사용해주면 됩니다.</p>
<p>우선 앞서 우리가 Hadoop을 설치해준 곳은 <code>/usr/local/hadoop/bin/hadoop</code> 입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.32.44.png" alt="which hadoop"></p>
<p>그리고 우리가 수정해줘야 하는 두 파일은 위와 같은 위치에 있는 <code>core-site.xml</code>파일, 그리고 <code>yarn-site.xml</code> 파일입니다. 즉, 절대 경로는 아래와 같습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core-site.xml</span></span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/etc/hadoop/core-site.xml</span><br><span class="line"><span class="comment"># yarn-site.xml</span></span><br><span class="line">/usr/<span class="built_in">local</span>/hadoop/etc/hadoop/yarn-site.xml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>만약 다른 곳에 설치했다면 <code>/하둡을설치한위치/etc/hadoop/</code> 안의 <code>core-site.xml</code>와 <code>yarn-site.xml</code>을 수정하면 됩니다.</p>
</blockquote>
<h3 id="core-site-xml-수정하기"><a href="#core-site-xml-수정하기" class="headerlink" title="core-site.xml 수정하기"></a><code>core-site.xml</code> 수정하기</h3><p>이제 <code>core-site.xml</code>파일을 수정해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.41.59.png" alt="core-site.xml 수정"></p>
<p><code>core-site.xml</code>에는 다음과 같이 <code>fs.defaultFS</code>라는 name을 가진 property를 하나 추가해주면 됩니다. 그리고 그 값을 <code>hdfs://마스터퍼블릭DNS</code>로 넣어줘야 합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- core-site.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://ec2-13-124-83-135.ap-northeast-2.compute.amazonaws.com<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>수정은 <code>vim</code>이나 <code>nano</code>등의 편집기를 이용해주세요.</p>
<h3 id="yarn-site-xml-수정하기"><a href="#yarn-site-xml-수정하기" class="headerlink" title="yarn-site.xml 수정하기"></a><code>yarn-site.xml</code> 수정하기</h3><p>이제 다음 파일인 <code>yarn-site.xml</code>파일을 수정해 봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.46.19.png" alt="yarn-site.xml 수정"></p>
<p><code>yarn-site.xml</code>에는 다음과 같이 두가지 설정을 마스터퍼블릭DNS로 넣어줘야 합니다. <code>address</code>에는 포트도 추가적으로 붙여줘야 합니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>ec2-13-124-83-135.ap-northeast-2.compute.amazonaws.com:8032<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>ec2-13-124-83-135.ap-northeast-2.compute.amazonaws.com<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이렇게 두 파일을 수정해주었으면 EC2에서 설정을 수정할 부분은 끝났습니다.</p>
<h2 id="EMR-클러스터-설정-관리하기"><a href="#EMR-클러스터-설정-관리하기" class="headerlink" title="EMR 클러스터 설정 관리하기"></a>EMR 클러스터 설정 관리하기</h2><h3 id="같은버전-Python-설치하기"><a href="#같은버전-Python-설치하기" class="headerlink" title="같은버전 Python 설치하기"></a>같은버전 Python 설치하기</h3><p>Spark에서 파이썬 함수(혹은 파일)을 실행할 때 Spark가 실행되고있는 파이썬 버전과 PySpark등을 통해 Spark 서버로 요청된 파이썬 함수의 버전과 일치하지 않으면 Exception을 일으킵니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2020.53.05.png" alt="Python driver 3.4_3.5 Exception"></p>
<p>현재 EMR에 설치되어있는 python3은 3.4버전인데, EC2(Ubuntu 16.04)의 파이썬 버전은 3.5버전이기 때문에 Exception이 발생합니다. </p>
<p>아래 세 가지 방법 중 하나를 선택해 해결해주세요.</p>
<h4 id="첫번째-방법-Ubuntu-EC2에-Python3-4를-설치하기"><a href="#첫번째-방법-Ubuntu-EC2에-Python3-4를-설치하기" class="headerlink" title="첫번째 방법: Ubuntu EC2에 Python3.4를 설치하기"></a>첫번째 방법: Ubuntu EC2에 Python3.4를 설치하기</h4><p>Ubuntu16은 공식적으로 Python3.4를 지원하지 않습니다. 하지만 간단한 방법으로 Python3.4를 설치할 수 있습니다.</p>
<p>아래 세 줄을 입력해주세요.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:fkrull/deadsnakes</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install python3.4 -y</span><br></pre></td></tr></table></figure>

<p>이렇게 하면 Python3.4를 사용할 수 있습니다.</p>
<p>막 설치해준 Python3.4에는 아직 <code>pyspark</code>가 설치되어있지 않으니 아래 명령어로 <code>pyspark</code>를 설치해 줍시다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3.4 -m pip install -U pyspark --no-cache</span><br></pre></td></tr></table></figure>

<p>이제 EMR 클러스터에 작업을 던져줍시다.</p>
<h4 id="두번째-방법-EMR을-이루는-인스턴스에-원하는-Python버전-3-5-를-설치하기"><a href="#두번째-방법-EMR을-이루는-인스턴스에-원하는-Python버전-3-5-를-설치하기" class="headerlink" title="두번째 방법: EMR을 이루는 인스턴스에 원하는 Python버전(3.5)를 설치하기"></a>두번째 방법: EMR을 이루는 인스턴스에 원하는 Python버전(3.5)를 설치하기</h4><p>EMR에 python3.5를 설치해 문제를 해결해 봅시다.</p>
<blockquote>
<p>만약 여러분이 Ubuntu 17버전을 사용한다면 기본적으로 Python3.6이 설치되어있기 때문에 아래 코드에서 <code>35</code> 대신 <code>36</code>을 이용해주시면 됩니다.</p>
</blockquote>
<p>이제 SSH를 통해 EMR Master에 접속해 봅시다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 sshkey.pem # ssh-add는 권한을 따집니다. 400으로 읽기권한만 남겨두세요.</span><br><span class="line">ssh-add sshkey.pem # 여러분의 .pem 파일 경로를 넣어주세요.</span><br><span class="line">ssh hadoop@ec2-13-124-83-135.ap-northeast-2.compute.amazonaws.com</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2020.35.28.png" alt="SSH Login EMR"></p>
<p>로그인을 하고 나서 파이썬 버전을 알아봅시다. 파이썬 버전은 아래 사진처럼 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.24.59.png" alt="EMR python은 3.4버전"></p>
<p>파이썬이 3.4버전인것을 확인할 수 있습니다.</p>
<p>한편, EC2의 파이썬은 아래와 같이 3.5버전입니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2017.25.24.png" alt="EC2 python은 3.5버전"></p>
<p>이제 EMR에 Python3.5를 설치해 줍시다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install python35</span><br></pre></td></tr></table></figure>

<p>위 명령어를 입력하면 python3.5버전이 설치됩니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2020.41.22.png" alt="yum install python35"></p>
<p>Y/N을 물어보면 y를 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2020.42.03.png" alt="Press y to install"></p>
<p><code>python3 -V</code>를 입력해보면 성공적으로 파이썬 3.5버전이 설치된 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2020.44.05.png" alt="Python3.5.1"></p>
<blockquote>
<p>이 과정을 Master / Core 각 인스턴스별로 진행해주시면 됩니다. SSH로 접속 후 <code>python35</code>만 설치하면 됩니다.</p>
</blockquote>
<p>이제 EMR 클러스터에 작업을 던져줍시다.</p>
<h4 id="세번째-방법-EMR-클러스터-부트스트랩-이용하기"><a href="#세번째-방법-EMR-클러스터-부트스트랩-이용하기" class="headerlink" title="세번째 방법: EMR 클러스터 부트스트랩 이용하기"></a>세번째 방법: EMR 클러스터 부트스트랩 이용하기</h4><p>두번째 방법과 같이 EMR 클러스터를 이루는 인스턴스 하나하나에 들어가 설치를 진행하는 것은 굉장히 비효율적입니다.</p>
<p>그래서 EMR 클러스터가 생성되기 전에 두번째 방법에서와 같이 EMR 클러스터 내에 Python35, Python36을 모두 설치해두면 앞으로도 문제가 없을거에요.</p>
<p>이때 사용할 수 있는 방법이 ‘bootstrap action’ 입니다. bootstrap action은 EMR 클러스터가 생성되기 전 <code>.sh</code>같은 쉘 파일등을 실행할 수 있습니다.</p>
<p>우선 우리가 실행해줄 <code>installpy3536.sh</code> 파일을 로컬에서 하나 만들어 줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">sudo yum install python34 -y</span><br><span class="line">sudo yum install python35 -y</span><br><span class="line">sudo yum install python36 -y</span><br></pre></td></tr></table></figure>

<p>EMR 클러스터는 아마존리눅스상에서 돌아가기 때문에 <code>yum</code>을 통해 패키지를 설치할 수 있습니다. 각각 python3.4/3.5/3.6버전을 받아 설치해주는 명령어입니다.</p>
<p>이 파일을 s3에 올려줍시다.</p>
<p>우선 빈 버킷 혹은 기존 버킷에 파일을 올려주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.13.13.png" alt="빈 s3 버킷 만들기"></p>
<p>파일 권한은 기본 권한 그대로 두면 됩니다. 그리고 이 파일은 AWS 외부에서 접근하지 않기 때문에 퍼블릭으로 해둘 필요는 없습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.13.46.png" alt="파일 업로드 완료"></p>
<p>이제 EMR을 실행하러 가 봅시다.</p>
<p>앞서서는 ‘빠른 옵션’을 이용했지만 이제 ‘고급 옵션’을 이용해야 합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.15.11.png" alt="새 EMR 클러스터 만들기"></p>
<p>고급 옵션에서 소프트웨어 구성을 다음과 같이 체크하고 ‘다음’을 눌러줍시다. </p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.17.53.png" alt="단계1: 소프트웨어 및 단계"></p>
<p>다음 단계인 ‘하드웨어’는 기본값 혹은 필요한 만큼 설정해준 뒤 ‘다음’을 눌러줍시다. 여기서는 기본값으로 넣어줬습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.20.01.png" alt="단계2: 하드웨어"></p>
<p>이번 단계인 ‘일반 클러스터 설정’이 중요합니다. 여기에서 ‘부트스트랩 작업’을 누르고 ‘사용자 지정 작업’을 선택해주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.21.20.png" alt="단계3: 일반 클러스터 설정"></p>
<p>‘사용자 지정 작업’을 선택한 뒤 ‘구성 및 추가’를 눌러주세요.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.22.06.png" alt="구성 및 추가"></p>
<p>추가를 누르면 다음과 같이 ‘이름’, ‘스크립트 위치’를 찾아줘야 합니다. 이름을 <code>InstallPython343536</code>이라고 지어봅시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.23.32.png" alt=""></p>
<p>이제 스크립트 옆 폴더 버튼을 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.25.01.png" alt=""></p>
<p>아까 만든 <code>installpy3536.sh</code>파일이 있는 버킷에 찾아들어가 <code>installpy3536.sh</code> 파일을 선택해줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.25.18.png" alt=""></p>
<p>선택을 눌러준 뒤 ‘추가’를 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.26.51.png" alt=""></p>
<p>아래와 같이 ‘부트스트랩 작업’에 추가되었다면 ‘다음’을 눌러 클러스터를 만들어 줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.28.00.png" alt=""></p>
<p>이제 마지막으로 SSH접속을 위한 키 페어를 선택한 후 ‘클러스터 생성’을 눌러줍시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2013.29.15.png" alt=""></p>
<p>이제 생성된 EMR 클러스터에는 python3.4/3.5/3.6이 모두 설치되어있습니다. 이 버전 선택은 아래 <code>PYSPARK_PYTHON</code> 값을 설정할때 변경해 사용하면 됩니다.</p>
<h3 id="ubuntu-유저-만들고-hadoop그룹에-추가하기"><a href="#ubuntu-유저-만들고-hadoop그룹에-추가하기" class="headerlink" title="ubuntu 유저 만들고 hadoop그룹에 추가하기"></a><code>ubuntu</code> 유저 만들고 <code>hadoop</code>그룹에 추가하기</h3><p>python 설치를 마쳤다면 이제 <code>ubuntu</code>유저를 만들어줘야 합니다.</p>
<p>EMR 클러스터 마스터 노드에 작업을 추가해 줄 경우 기본적으로 작업을 실행한 유저(우분투 EC2에서 요청시 기본 유저는 <code>ubuntu</code>)의 이름으로 마스터 노드에서 요청한 유저의 홈 폴더를 찾습니다.</p>
<p>만약 EC2에서 EMR로 요청한다면 <code>ubuntu</code>라는 계정 이름으로 EMR 마스터 노드에서 <code>/home/ubuntu</code>라는 폴더를 찾아 이 폴더에 작업할 파이썬 파일과 의존 패키지 등을 두고 작업을 진행합니다. 하지만 EMR은 기본적으로 <code>hadoop</code>이라는 계정을 사용하고, 따라서 <code>ubuntu</code>라는 유저는 추가해줘야 합니다. 그리고 우리가 새로 만들어준 <code>ubuntu</code> 유저는 하둡에 접근할 권한이 없기 때문에 이 유저를 <code>hadoop</code>그룹에 추가해줘야 합니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-27%2019.52.07.png" alt="우분투 계정 만들고 하둡 그룹에 추가"></p>
<p>위 사진처럼 두 명령어를 입력해 줍시다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser ubuntu</span><br><span class="line">sudo usermod -a -G hadoop ubuntu</span><br></pre></td></tr></table></figure>

<p>첫 명령어는 <code>ubuntu</code>라는 유저를 만들고 다음에서 <code>hadoop</code>이라는 그룹에 <code>ubuntu</code>유저를 추가합니다.</p>
<p>이제 우리는 EC2에서 EMR로 분산처리할 함수들을 보낼 수 있습니다.</p>
<h2 id="마무리-파이-pi-계산-예제-실행하기"><a href="#마무리-파이-pi-계산-예제-실행하기" class="headerlink" title="마무리: 파이(pi) 계산 예제 실행하기"></a>마무리: 파이(pi) 계산 예제 실행하기</h2><p>한번 PySpark의 기본 예제중 하나인 <code>pi</code>(원주율) 계산을 진행해 봅시다.</p>
<p>공식 예제: <a href="https://github.com/apache/spark/blob/master/examples/src/main/python/pi.py">https://github.com/apache/spark/blob/master/examples/src/main/python/pi.py</a></p>
<p>공식 예제는 스파크와 하둡을 로컬에서 사용합니다. 하지만 우리는 EMR 클러스터에 작업을 던져줄 것이기 때문에 약간 코드를 변경해줘야 합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pi.py</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">"PYSPARK_PYTHON"</span>] = <span class="string">"/usr/bin/python34"</span> <span class="comment"># python3.5라면 /usr/bin/python35</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">        Usage: pi [partitions]</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 이 부분을 추가해주시고</span></span><br><span class="line">    spark = SparkSession \</span><br><span class="line">        .builder \</span><br><span class="line">        .master(<span class="string">"yarn"</span>) \</span><br><span class="line">        .appName(<span class="string">"PySpark"</span>) \</span><br><span class="line">        .getOrCreate()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 이부분을 주석처리해주세요.</span></span><br><span class="line">    <span class="comment">#spark = SparkSession\</span></span><br><span class="line">    <span class="comment">#    .builder\</span></span><br><span class="line">    <span class="comment">#    .appName("PythonPi")\</span></span><br><span class="line">    <span class="comment">#    .getOrCreate()</span></span><br><span class="line">    </span><br><span class="line">    partitions = int(sys.argv[<span class="number">1</span>]) <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">    n = <span class="number">100000</span> * partitions</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(_)</span>:</span></span><br><span class="line">        x = random() * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">        y = random() * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> x ** <span class="number">2</span> + y ** <span class="number">2</span> &lt;= <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    count = spark.sparkContext.parallelize(range(<span class="number">1</span>, n + <span class="number">1</span>), partitions).map(f).reduce(add)</span><br><span class="line">    print(<span class="string">"Pi is roughly %f"</span> % (<span class="number">4.0</span> * count / n))</span><br><span class="line"></span><br><span class="line">    spark.stop()</span><br></pre></td></tr></table></figure>

<p>기존 코드는 <code>builder</code>를 통해 로컬에서 작업을 던져주지만 이렇게 <code>.master(&quot;yarn&quot;)</code>을 추가해주면 yarn 설정을 통해 아래 작업이 EMR 클러스터에서 동작하게 됩니다.</p>
<p>EC2상에서 아래 명령어로 위 파이썬 파일을 실행해 봅시다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3.4 pi.py</span><br></pre></td></tr></table></figure>

<p>실행을 해 보면 결과가 잘 나오는 것을 볼 수 있습니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-28%2010.29.40.png" alt="pi is roughly 3.144720"></p>
<blockquote>
<p>만약 두번째/세번째 방법으로 Python3.5를 설치해주셨다면 별다른 설정 없이 <code>python3 pi.py</code>로 실행하셔도 됩니다.</p>
</blockquote>
<h3 id="자주-보이는-에러-경고"><a href="#자주-보이는-에러-경고" class="headerlink" title="자주 보이는 에러/경고"></a>자주 보이는 에러/경고</h3><h4 id="WARN-yarn-Client-Same-path-resource"><a href="#WARN-yarn-Client-Same-path-resource" class="headerlink" title="WARN yarn.Client: Same path resource"></a>WARN yarn.Client: Same path resource</h4><p>새 task를 Spark로 넘겨줄 때 마다 패키지를 찾기 때문에 나오는 에러입니다. 무시해도 됩니다.</p>
<h4 id="Initial-job-has-not-accepted-any-resources"><a href="#Initial-job-has-not-accepted-any-resources" class="headerlink" title="Initial job has not accepted any resources"></a>Initial job has not accepted any resources</h4><p>EMR 설정 중 <code>spark.dynamicAllocation.enabled</code>가 <code>True</code>일 경우 생기는 문제입니다.</p>
<p>위 <code>pi.py</code>파일 코드를 일부 수정해주세요.</p>
<p>기존에 있던 <code>spark</code> 생성하는 부분에 아래 <code>config</code> 몇줄을 추가해주세요.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 기존 코드를 지우고</span></span><br><span class="line"><span class="comment"># spark = SparkSession \</span></span><br><span class="line"><span class="comment">#     .builder \</span></span><br><span class="line"><span class="comment">#     .master("yarn") \</span></span><br><span class="line"><span class="comment">#     .appName("PySpark") \</span></span><br><span class="line"><span class="comment">#     .getOrCreate()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래 코드로 바꿔주세요.</span></span><br><span class="line">spark = SparkSession.builder \</span><br><span class="line">    .master(<span class="string">"yarn"</span>) \</span><br><span class="line">    .appName(<span class="string">"PySpark"</span>) \</span><br><span class="line">    .config(<span class="string">"spark.executor.memory"</span>, <span class="string">"512M"</span>) \</span><br><span class="line">    .config(<span class="string">"spark.yarn.am.memory"</span>, <span class="string">"512M"</span>) \</span><br><span class="line">    .config(<span class="string">"spark.executor.cores"</span>, <span class="number">2</span>) \</span><br><span class="line">    .config(<span class="string">"spark.executor.instances"</span>, <span class="number">1</span>) \</span><br><span class="line">    .config(<span class="string">"spark.dynamicAllocation.enabled"</span>, <span class="literal">False</span>) \</span><br><span class="line">    .getOrCreate()</span><br></pre></td></tr></table></figure>

<p>이때 각 config별로 설정되는 값은 여러분이 띄운 EMR에 따라 설정해줘야 합니다. 만약 여러분이 <code>r3.xlarge</code>를 선택했다면 8개의 vCPU, 30.5 GiB 메모리를 사용하기 때문에 저 설정 숫자들을 높게 잡아도 되지만, 만약 <code>c4.large</code>를 선택했다면 2개의 vCPU, 3.8 GiB 메모리를 사용하기 때문에 코드에서 설정한 CPU코어수 혹은 메모리 용량이 클러스터의 CPU개수와 메모리 용량을 초과할 경우 에러가 납니다.</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/20/Deploy-Gitbook-to-Github-Pages/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/gitbook_on_github.jpg" alt="깃헙 Pages에 깃북 배포하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-19T15:00:00.000Z">2017-11-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/blog/">blog</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/blog/github/">github</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/20/Deploy-Gitbook-to-Github-Pages/">깃헙 Pages에 깃북 배포하기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>이번에 ‘나만의 웹 크롤러 만들기’ 가이드 시리즈를 이 블로그에서 관리하던 중, 글이 파편화되어있는 상황이며 가이드가 유의미하게 이어진다는 느낌이 적어서 깃북을 통해 새로 가이드를 배포하기로 결정했다.</p>
<p>깃북의 경우 <code>https://gitbook.io</code>에서 제공하는 자체 호스팅 서비스가 있고 오픈소스로 정적 사이트를 제작하는 <code>Gitbook</code> 프로젝트도 있다.</p>
<p>깃북 웹 사이트의 경우 느려지는 경우도 종종 있어 좀 더 관리의 범위가 넓은 깃헙에서 깃북 레포를 통해 깃북을 관리하려고 생각했다.</p>
<h2 id="Gitbook-설치하기"><a href="#Gitbook-설치하기" class="headerlink" title="Gitbook 설치하기"></a>Gitbook 설치하기</h2><p>우선 깃북의 경우 node.js기반이기 때문에 시스템에 <code>node</code>와 <code>npm</code>이 설치되어있어야 한다. npm은 node.js를 설치할때 보통 같이 설치된다. 글쓴날짜 기준 <code>9.2.0</code>버전이 node.js의 최신 버전이다.</p>
<blockquote>
<p>Node.js설치하기: <a href="https://nodejs.org/en/">https://nodejs.org/en/</a> </p>
</blockquote>
<p>시스템에 <code>npm</code>이 설치 완료되었다면 이제 아래 명령어로 <code>gitbook-cli</code>를 설치해 주자.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 콘솔 / cmd / terminal에서 아래줄을 입력후 엔터!</span></span><br><span class="line">npm install gitbook-cli -g</span><br></pre></td></tr></table></figure>

<h2 id="Gitbook-Init"><a href="#Gitbook-Init" class="headerlink" title="Gitbook Init"></a>Gitbook Init</h2><p>깃북은 <code>SUMMARY.md</code>파일을 통해 화면 좌측의 내비게이션/목록 부분을 만든다.</p>
<p>한번에 폴더와 기본파일을 모두 생성하려면 아래 명령어를 입력해 주자.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 콘솔 / cmd / terminal에서 아래줄을 입력후 엔터!</span></span><br><span class="line">gitbook init my_gitbook</span><br><span class="line"><span class="meta">#</span><span class="bash"> 사용법: gitbook init 사용하려는폴더이름</span></span><br></pre></td></tr></table></figure>

<p>위 명령어를 입력하면 현재 위치 아래 <code>my_gitbook</code>이라는 폴더가 생기고, 그 안에 <code>README.md</code>와 <code>SUMMARY.md</code>가 생긴다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/ss2017-11-20%2021.05.27.png" alt=""></p>
<h2 id="Git-Init"><a href="#Git-Init" class="headerlink" title="Git Init"></a>Git Init</h2><p>깃북을 배포하려면 깃헙에 레포지토리를 만들고 파일을 올려야 하기 때문에 우선 <code>git init</code>으로 현재 폴더를 <code>git</code>이 관리하도록 만들어준다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/ss2017-11-20%2021.06.31.png" alt=""></p>
<h2 id="gh-pages-브랜치-만들기"><a href="#gh-pages-브랜치-만들기" class="headerlink" title="gh-pages 브랜치 만들기"></a><code>gh-pages</code> 브랜치 만들기</h2><p>Github Pages의 경우 크게 3가지 방법으로 호스팅을 진행한다.</p>
<ol>
<li><code>유저이름.github.io</code>라는 레포의 <code>master</code>브랜치 </li>
<li>어떤 레포든 <code>docs</code> 폴더</li>
<li>어떤 레포든 <code>gh-pages</code> 브랜치</li>
</ol>
<p>위 세가지가 충족되는 경우 자동으로 깃헙 페이지용도로 인식하고 <code>https://유저이름.github.io/레포명</code> 주소로 정적 호스팅을 진행해 준다.</p>
<p>이번에는 세번째 방법인 <code>gh-pages</code> 브랜치를 이용한다. </p>
<blockquote>
<p>물론 1,2,3번 모두 커스텀 도메인 사용이 가능하다.</p>
</blockquote>
<h2 id="publish-gitbook-sh-만들기"><a href="#publish-gitbook-sh-만들기" class="headerlink" title="publish_gitbook.sh 만들기"></a><code>publish_gitbook.sh</code> 만들기</h2><p><code>README.md</code>가 있는 곳 옆에 <code>publish_gitbook.sh</code>파일을 다음 내용으로 만들어 주자.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> gitbook 의존 파일을 설치하고 gitbook 빌드를 돌린다.</span></span><br><span class="line">gitbook install &amp;&amp; gitbook build</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> github pages가 바라보는 gh-pages 브랜치를 만든다.</span></span><br><span class="line">git checkout gh-pages</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 최신 gh-pages 브랜치 정보를 가져와 rebase를 진행한다.</span></span><br><span class="line">git pull origin gh-pages --rebase</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> gitbook build로 생긴 _book폴더 아래 모든 정보를 현재 위치로 가져온다.</span></span><br><span class="line">cp -R _book/* .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> node_modules폴더와 _book폴더를 지워준다.</span></span><br><span class="line">git clean -fx node_modules</span><br><span class="line">git clean -fx _book</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOQA</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 커밋커밋!</span></span><br><span class="line">git commit -a -m "Update docs"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> gh-pages 브랜치에 PUSH!</span></span><br><span class="line">git push origin gh-pages</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 다시 master 브랜치로 돌아온다.</span></span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure>

<p>위와 같이 <code>publish_gitbook.sh</code>파일을 만들어 주면, 앞으로 작업을 끝낼때마다 <code>./publish_gitbook.sh</code>라는 명령어로 한번에 깃헙에 작업한 결과물을 빌드해 올릴 수 있다.</p>
<h2 id="SUMMARY-md-관리하기"><a href="#SUMMARY-md-관리하기" class="headerlink" title="SUMMARY.md 관리하기"></a>SUMMARY.md 관리하기</h2><p>깃북이 파일을 관리하는 것은 폴더별 관리라기보다는 <code>SUMMARY.md</code>파일 내의 정보를 기반으로 URL을 만들고 글의 순서와 목차를 관리한다.</p>
<p>보통 카테고리/챕터별로 폴더를 만들어 관리하는 방법을 사용하는 것 같은데, <a href="https://beomi.github.io/gb-crawling/">나만의 웹 크롤러 만들기 깃북</a>의 경우 아래와 같은 형태를 사용하고 있다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Summary</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>[<span class="string">나만의 웹 크롤러 만들기 시리즈</span>](<span class="link">README.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">requests와 BeautifulSoup으로 웹 크롤러 만들기</span>](<span class="link">posts/2017-01-20-HowToMakeWebCrawler.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">Session을 이용해 로그인하기</span>](<span class="link">posts/2017-01-20-HowToMakeWebCrawler-With-Login.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">Selenium으로 무적 크롤러 만들기</span>](<span class="link">posts/2017-02-27-HowToMakeWebCrawler-With-Selenium.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">Django로 크롤링한 데이터 저장하기</span>](<span class="link">posts/2017-03-01-HowToMakeWebCrawler-Save-with-Django.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">웹페이지 업데이트를 알려주는 Telegram 봇</span>](<span class="link">posts/2017-04-20-HowToMakeWebCrawler-Notice-with-Telegram.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">N배빠른 크롤링, multiprocessing</span>](<span class="link">posts/2017-07-05-HowToMakeWebCrawler-with-Multiprocess.md</span>)</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">Headless 크롬으로 크롤링하기</span>](<span class="link">posts/2017-09-28-HowToMakeWebCrawler-Headless-Chrome.md</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>Tips</span><br><span class="line"><span class="bullet">    - </span>[<span class="string">Selenium Implicitly wait vs Explicitly wait</span>](<span class="link">posts/2017-10-29-HowToMakeWebCrawler-ImplicitWait-vs-ExplicitWait.md</span>)</span><br></pre></td></tr></table></figure>

<p>위와 같이 <code>-</code>를 사용해 글과 카테고리를 구별하고 스페이스를 통해 제목과 링크를 마크다운 문법으로 걸어주면 깃북이 이 파일을 읽고 각각의 파일을 <code>html</code>파일로 만들어준다.</p>
<h2 id="유의할점"><a href="#유의할점" class="headerlink" title="유의할점"></a>유의할점</h2><p>깃북에서 <code>![](이미지링크)</code>와 같은 방식을 사용하면 ‘/‘로 시작하는 절대경로 URL을 상대경로인 ‘../‘로 변환해버리는 문제가 있다.</p>
<p>따라서 <code>SUMMARY.md</code>파일과 같은 위치에 <code>book.json</code>파일을 만들어주고 전역 변수를 사용할 수 있다.</p>
<h2 id="book-json-관리하기"><a href="#book-json-관리하기" class="headerlink" title="book.json 관리하기"></a><code>book.json</code> 관리하기</h2><p>깃북은 <code>book.json</code>파일이 세팅 파일이다. 플러그인을 넣고, 지우고, 전역 변수 등을 설정할 수도 있다.</p>
<p>다음은 Google Analytics 플러그인을 ‘넣고’ 소셜 공유 아이콘을 ‘빼고’, ‘BASE_URL’에 블로그 절대경로를 만들기 위해 URL을 등록해둔 부분이다.</p>
<blockquote>
<p>토큰은 Google Analytics에서 받아서 넣어주면 된다.</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"plugins"</span>: [<span class="string">"ga"</span>, <span class="string">"-sharing"</span>],</span><br><span class="line">    <span class="attr">"pluginsConfig"</span>: &#123;</span><br><span class="line">        <span class="attr">"ga"</span>: &#123;</span><br><span class="line">            <span class="attr">"token"</span>: <span class="string">"UA-12341234-1"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"variables"</span>: &#123;</span><br><span class="line">        <span class="attr">"BASE_URL"</span>: <span class="string">"https://beomi.github.io"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/10/Export-HighQuality-Image-with-KeyNote/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2017-11-10-Export-HighQuality-Image-with-KeyNote.jpg" alt="키노트로 고화질 타이틀 이미지 만들기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-09T15:00:00.000Z">2017-11-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/macos/">macos</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/macos/tips/">tips</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/10/Export-HighQuality-Image-with-KeyNote/">키노트로 고화질 타이틀 이미지 만들기</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>이번 글은 애플 키노트를 다루니 당연히 macOS가 대상입니다 :)</p>
</blockquote>
<h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>블로그 글을 맥에서 작성하다보면 자연스럽게 키노트로 메인 타이틀이나 설명을 만드는 경우가 많습니다. 아래 화면처럼 이미지와 글자를 조금 배치하는 방식으로 깔끔한 이미지 하나를 만들게 됩니다. (이번 글 대표 이미지도 이 방식으로 만들었습니다.)</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.24.09.png?dl=1" alt=""></p>
<p>하지만 문제가 있습니다.</p>
<p>애플 키노트에서 기본적으로 제공하는 Export to Image, “다음으로 보내기 -&gt; 이미지..”를 사용하는 방법도 물론 있습니다. 하지만 사실 이렇게 작업하면…</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.25.10.png?dl=1" alt=""></p>
<p>화면에서 바라볼때는 고해상도의 레티나 결과물이 나왔지만, 실제로 Export된 이미지 파일을 보면 이미지 픽셀은 <code>1920*1080</code>으로 충분히 고화질이지만 ppi가 72밖에 되지 않는 것을 볼 수 있습니다. </p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.29.35.png?dl=1" alt=""></p>
<p>(아니 왜 레티나를 샀는데 보여주지를 못하니 ㅠㅠ)</p>
<h2 id="해결방법"><a href="#해결방법" class="headerlink" title="해결방법"></a>해결방법</h2><p>해결방법은 한 단계를 더 거치는데, 다른 프로그램을 사용하는 것이 아니라 맥에 내장되어있는 ‘미리보기’를 이용하는 방법입니다.</p>
<p>단계는 다음과 같습니다.</p>
<ul>
<li>키노트에서 PDF로 내보내기</li>
<li>PDF파일을 ‘미리보기’로 열기</li>
<li>미리보기에서 ‘내보내기’ 기능으로 고해상도 이미지 만들기</li>
</ul>
<p>네, 귀찮습니다. 하지만 레티나 이미지를 포기할 수는 없으니까요. 요즘은 특히 모바일 기기도 해상도가 굉장히 높으니 그에 맞춰 높은 해상도를 제공해주는 것도 좋지 않을까 생각합니다.</p>
<p>그러면 이제 진행해 봅시다.</p>
<h2 id="만들어봅시다"><a href="#만들어봅시다" class="headerlink" title="만들어봅시다!"></a>만들어봅시다!</h2><h3 id="PDF로-내보내기"><a href="#PDF로-내보내기" class="headerlink" title="PDF로 내보내기"></a>PDF로 내보내기</h3><p>우선 위처럼 키노트를 만들어주세요. 그리고 아래 사진처럼 파일 &gt; 다음으로 보내기 &gt; PDF… 순서대로 클릭을 해주시면 됩니다.</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.36.07.png?dl=1" alt=""></p>
<p>클릭을 해주면 다음과 같은 창이 하나 뜹니다. 여기서 유의하셔야되는 점은 ‘이미지 품질’을 ‘최상’으로 해 두셔야 300ppi로 내보내기가 이루어집니다.</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.38.15.png?dl=1" alt=""></p>
<blockquote>
<p>NOTE: 여러분이 글자만 있는 상태라면 (아이콘/사진이 없다면) 굳이 이미지 품질을 신경쓰지는 않으셔도 됩니다. PDF에서 글자는 폰트를 내장해 글자 정보 자체로 읽고 쓰기 때문에 이미지 품질로 인한 차이가 발생하지 않습니다.</p>
</blockquote>
<h3 id="미리보기로-PDF-열기"><a href="#미리보기로-PDF-열기" class="headerlink" title="미리보기로 PDF 열기"></a>미리보기로 PDF 열기</h3><p>앞서 내보내기로 만든 PDF 파일을 아래처럼 열어줍시다. 보기만해도 높은 해상도인것을 느낄 수 있습니다.</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.41.54.png?dl=1" alt="미리보기로 PDF 열어본 모습"></p>
<p>이제 상단 메뉴바 ‘파일’에서 ‘보내기’를 눌러봅시다.</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.41.18.png?dl=1" alt="미리보기에서 내보내기"></p>
<p>이제 아래와 같은 화면이 보일텐데요, PDF가 아니라 JPEG로 바꿔준 뒤 해상도를 150정도로 맞춰준 뒤 저장을 해줍시다.</p>
<p><img src="https://beomi-tech-blog.s3.ap-northeast-2.amazonaws.com/img/dropbox/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2017-11-09+23.46.24.png?dl=1" alt="미리보기 내보내기에서 JPEG, 150PPI로 저장하기"></p>
<h2 id="끝났습니다"><a href="#끝났습니다" class="headerlink" title="끝났습니다!"></a>끝났습니다!</h2><p>이제 여러분은 여러분이 원하는 해상도의 고해상도 이미지를 얻게 되었습니다! </p>
<p>파일 사이즈를 조절하거나 무손실 압축 프로그램등을 사용한다면 좀 더 트래픽량이 줄어 사이트 로딩속도가 빨라질 수 있습니다.</p>
<blockquote>
<p>macOS에서는 ImageOptim을 이용해보세요. 이미지가 단순한 경우 용량이 절반으로 줄어들기도 합니다.</p>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04/" class="image is-7by1">
            <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/PySpark_n_Hadoop_on_Ubuntu_16.jpg" alt="PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2017-11-08T15:00:00.000Z">2017-11-09</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/python/">python</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/python/ubuntu/">ubuntu</a>
                </div>
                
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2017/11/09/Install-PySpark-and-Hadoop-on-Ubuntu-16-04/">PySpark &amp; Hadoop: 1) Ubuntu 16.04에 설치하기</a>
            
        </h1>
        <div class="content">
            <h2 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h2><p>Spark의 Python버전인 PySpark를 사용할 때 서버가 AWS EMR등으로 만들어진 클러스터가 존재하고, 우리가 만든 프로그램과 함수가 해당 클러스터 위에서 돌리기 위해서는 PySpark를 로컬이 아니라 원격 서버에 연결해 동작하도록 만들어야 합니다. </p>
<p>이번 글에서는 PySpark와 Hadoop을 설치하고 설정하는 과정으로 원격 EMR로 함수를 실행시켜봅니다.</p>
<blockquote>
<p>Note: 이번 글은 Ubuntu 16.04 LTS, Python3.5(Ubuntu내장)를 기준으로 진행합니다.</p>
</blockquote>
<p>AWS에서 EC2를 생성해 주세요. VPC는 기본으로 잡아주시면 됩니다. 성능은 <code>t2-micro</code>의 프리티어정도도 괜찮습니다. 무거운 연산은 나중에 다룰 AWS EMR 클러스터에 올려줄 것이기 때문에, 클라이언트 역할을 할 EC2 인스턴스는 저성능이어도 괜찮습니다.</p>
<p>들어가기 전에 우선 apt 업데이트부터 진행해 줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get upgrade -y</span><br></pre></td></tr></table></figure>

<h2 id="PySpark-설치하기"><a href="#PySpark-설치하기" class="headerlink" title="PySpark 설치하기"></a>PySpark 설치하기</h2><p>Ubuntu 16 OS에는 기본적으로 Python3이 설치되어있습니다. 하지만 pip는 설치되어있지 않기 때문에 아래 명령어로 먼저 Python3의 pip를 설치해줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pip/pip3을 사용가능하게 만듭니다.</span></span><br><span class="line">sudo apt-get install python3-pip -y</span><br></pre></td></tr></table></figure>

<p>설치가 완료되면 이제 Python3의 pip를 사용할 수 있습니다. 아래 명령어로 pip를 통해 PySpark를 설치해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 최신 버전의 PySpark를 설치합니다.</span></span><br><span class="line">pip3 install pyspark -U --no-cache</span><br></pre></td></tr></table></figure>

<p>위 명령어에서 <code>-U</code>는 <code>--upgrade</code>의 약자로, 현재 설치가 되어있어도 최신버전으로 업그레이드 하는 것이고, <code>--no-cache</code>는 로컬에 pip 패키지의 캐싱 파일이 있더라도 pypi서버에서 다시 받아오겠다는 의미입니다.</p>
<blockquote>
<p>현재 PySpark 2.2.0은 버전과 다르게 2.2.0.post0라는 버전으로 pypi에 올라가 있습니다. 이로인해 <code>pip install pyspark</code> 로 진행할 경우 <code>Memeory Error</code>가 발생하고 설치가 실패하므로, 2.2.0버전을 설치한다면 위 명령어로 설치를 진행해주세요.</p>
</blockquote>
<h2 id="Hadoop-설치하기"><a href="#Hadoop-설치하기" class="headerlink" title="Hadoop 설치하기"></a>Hadoop 설치하기</h2><h3 id="JAVA-JDK-설치하기"><a href="#JAVA-JDK-설치하기" class="headerlink" title="JAVA JDK 설치하기"></a>JAVA JDK 설치하기</h3><p>Hadoop을 설치하기 위해서는 JAVA(JDK)가 먼저 설치되어야 합니다. 아래 명령어로 openjdk를 설치해주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Java 8을 설치합니다.</span></span><br><span class="line">sudo apt-get install openjdk-8-jre -y</span><br></pre></td></tr></table></figure>

<h3 id="Hadoop-Binary-설치하기"><a href="#Hadoop-Binary-설치하기" class="headerlink" title="Hadoop Binary 설치하기"></a>Hadoop Binary 설치하기</h3><p>Hadoop은 Apache의 홈페이지에서 <a href="http://hadoop.apache.org/releases.html">최신 릴리즈 링크</a>에서 바이너리 파일의 링크를 가져옵시다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.23.26.png" alt=""></p>
<p>원하는 Hadoop 버전의 <code>Binary</code> 링크를 클릭해 바이너리를 받을 수 있는 페이지로 들어갑시다. 글쓰는 시점에는 2.8.2가 최신 버전입니다. 링크를 타고 들어가면 아래와 같이 HTTP로 파일을 받을 수 있는 링크가 나옵니다.</p>
<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.25.04.png" alt=""></p>
<p>글을 보는 시점에는 링크 주소는 다를 수 있지만, HTTP 링크 중 하나를 복사하고 진행하면 됩니다. 이 글에서는 네이버 서버의 미러를 이용합니다.</p>
<p>이제 다시 서버로 돌아가봅시다. 아래 명령어를 통해 wget으로 Hadoop Binary를 서버에 받아줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget 여러분이_복사한_URL</span><br><span class="line"><span class="comment"># 예시</span></span><br><span class="line"><span class="comment"># wget http://mirror.navercorp.com/apache/hadoop/common/hadoop-2.8.2/hadoop-2.8.2.tar.gz</span></span><br></pre></td></tr></table></figure>

<p>이제 압축을 풀어줍시다. 아래 명령어로 압축을 <code>/usr/local</code>에 풀어줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar zxvf ./hadoop-* -C /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>압축을 풀면 <code>/usr/local/hadoop-2.8.2</code>라는 폴더가 생기지만 우리가 사용할때 버전이 붙어있으면 사용하기 귀찮으므로 이름을 <code>/usr/local/hadoop</code>으로 바꾸어줍시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /usr/<span class="built_in">local</span>/hadoop-* /usr/<span class="built_in">local</span>/hadoop</span><br></pre></td></tr></table></figure>

<p>이제 파일을 가져오고 설치는 완료되었지만, 실제로 Hadoop을 PySpark등에 붙여 사용하려면 <code>PATH</code>등록을 해줘야 합니다.</p>
<p>아래 명령어를 전체 복사-붙여넣기로 진행해 주세요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">export JAVA_HOME=<span class="variable">$(readlink -f /usr/bin/java | sed "s:bin/java::")</span></span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$JAVA_HOME/bin</span></span><br><span class="line"><span class="string">export HADOOP_HOME=/usr/local/hadoop</span></span><br><span class="line"><span class="string">export PATH=\$PATH:\$HADOOP_HOME/bin</span></span><br><span class="line"><span class="string">export HADOOP_CONF_DIR=\$HADOOP_HOME/etc/hadoop</span></span><br><span class="line"><span class="string">export YARN_CONF_DIR=\$HADOOP_HOME/etc/hadoop</span></span><br><span class="line"><span class="string">"</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>이제 ssh를 <code>exit</code>한 뒤 다시 서버에 ssh로 접속하신 후, 아래 명령어를 입력해 보세요. 아래 사진처럼 나오면 설치가 성공적으로 진행된 것이랍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/hadoop/bin/hadoop</span><br></pre></td></tr></table></figure>

<p><img src="https://d1sr4ybm5bj1wl.cloudfront.net/img/dropbox/Screenshot%202017-11-09%2015.49.19.png" alt=""></p>
<h2 id="끝이지만-끝이-아닌"><a href="#끝이지만-끝이-아닌" class="headerlink" title="끝이지만 끝이 아닌.."></a>끝이지만 끝이 아닌..</h2><p>사실 PySpark와 Hadoop만을 사용하는 것은 큰 의미가 있는 상황은 아닙니다. AWS EMR와 같은 클러스터를 연결해 막대한 컴퓨팅 파워가 있는 서버에서 돌리는 목적이 Spark를 쓰는 이유입니다. 다음 글에서는 AWS EMR을 구동하고 우리가 방금 설정한 Ubuntu 서버에서 작업을 EMR로 보내는 내용을 다뤄봅니다.</p>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/3/">이전</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/5/">다음</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/3/">3</a></li>
            
            <li><a class="pagination-link is-current" href="/page/4/">4</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/5/">5</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/10/">10</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/profile_beomi.jpg" alt="Junbum Lee">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Junbum Lee
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Beomi&#39;s tech blog
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Seoul, KR</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/beomi">
                
                <i class="fab fa-github"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                카테고리
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/DataCollection/">
            <span class="level-start">
                <span class="level-item">DataCollection</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DataCollection/Twitter/">
            <span class="level-start">
                <span class="level-item">Twitter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/">
            <span class="level-start">
                <span class="level-item">DevEnv</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DevEnv/DataScience/">
            <span class="level-start">
                <span class="level-item">DataScience</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/DeepLearning/">
            <span class="level-start">
                <span class="level-item">DeepLearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Git/">
            <span class="level-start">
                <span class="level-item">Git</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/DevEnv/Ubuntu/">
            <span class="level-start">
                <span class="level-item">Ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Django/">
            <span class="level-start">
                <span class="level-item">Django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Django/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/">
            <span class="level-start">
                <span class="level-item">DjangoTDDStudy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/DjangoTDDStudy/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/MacOS/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/NLP/">
            <span class="level-start">
                <span class="level-item">NLP</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/NLP/LanguageModel/">
            <span class="level-start">
                <span class="level-item">LanguageModel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/NLP/Unsupervised/">
            <span class="level-start">
                <span class="level-item">Unsupervised</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Postmortem/">
            <span class="level-start">
                <span class="level-item">Postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/">
            <span class="level-start">
                <span class="level-item">Python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Python/Celery/">
            <span class="level-start">
                <span class="level-item">Celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/Fabric/">
            <span class="level-start">
                <span class="level-item">Fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Python/MacOS/">
            <span class="level-start">
                <span class="level-item">MacOS</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Tech/">
            <span class="level-start">
                <span class="level-item">Tech</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Translation/">
            <span class="level-start">
                <span class="level-item">Translation</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/aws/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/azure/">
            <span class="level-start">
                <span class="level-item">azure</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/blog/">
            <span class="level-start">
                <span class="level-item">blog</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/blog/github/">
            <span class="level-start">
                <span class="level-item">github</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/django/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/django/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/flask/sqlalchemy/">
            <span class="level-start">
                <span class="level-item">sqlalchemy</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/javascript/webpack/">
            <span class="level-start">
                <span class="level-item">webpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/life/">
            <span class="level-start">
                <span class="level-item">life</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/machinelearning/">
            <span class="level-start">
                <span class="level-item">machinelearning</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/machinelearning/seminar/">
            <span class="level-start">
                <span class="level-item">seminar</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/macos/">
            <span class="level-start">
                <span class="level-item">macos</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/macos/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/nlp/">
            <span class="level-start">
                <span class="level-item">nlp</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/nlp/languagemodel/">
            <span class="level-start">
                <span class="level-item">languagemodel</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/postmortem/">
            <span class="level-start">
                <span class="level-item">postmortem</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/">
            <span class="level-start">
                <span class="level-item">python</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">25</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/python/aws/">
            <span class="level-start">
                <span class="level-item">aws</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/celery/">
            <span class="level-start">
                <span class="level-item">celery</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/dataanalysis/">
            <span class="level-start">
                <span class="level-item">dataanalysis</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/django/">
            <span class="level-start">
                <span class="level-item">django</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/fabric/">
            <span class="level-start">
                <span class="level-item">fabric</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/flask/">
            <span class="level-start">
                <span class="level-item">flask</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/howtomakewebcrawler/">
            <span class="level-start">
                <span class="level-item">howtomakewebcrawler</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/pyspark/">
            <span class="level-start">
                <span class="level-item">pyspark</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/python/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/react/">
            <span class="level-start">
                <span class="level-item">react</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/react/javascript/">
            <span class="level-start">
                <span class="level-item">javascript</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/tips/githubpages/">
            <span class="level-start">
                <span class="level-item">githubpages</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/ubuntu/">
            <span class="level-start">
                <span class="level-item">ubuntu</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/ubuntu/tips/">
            <span class="level-start">
                <span class="level-item">tips</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/vlang/">
            <span class="level-start">
                <span class="level-item">vlang</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            최근 글
        </h3>
        
        <article class="media">
            
            <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/16/1*VZpuai6qP4iNLc7opAkQxA.jpeg" alt="KcBERT Finetune with PyTorch-Lightning v1.3.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-15T15:00:00.000Z">2021-03-16</time></div>
                    <a href="/2021/03/16/KcBERT-Downstream-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT Finetune with PyTorch-Lightning v1.3.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/beomi/blog-img@master/2021/03/15/fine-tuning_methods-20210315151211294.png" alt="KcBERT MLM Finetune으로 Domain adaptation하기">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-03-14T15:00:00.000Z">2021-03-15</time></div>
                    <a href="/2021/03/15/KcBERT-MLM-Finetune/" class="title has-link-black-ter is-size-6 has-text-weight-normal">KcBERT MLM Finetune으로 Domain adaptation하기</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/nlp/">nlp</a> / <a class="has-link-grey -link" href="/categories/nlp/languagemodel/">languagemodel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/12/04/Transformers4/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/image-20201204002610609.277ab6.png" alt="BertForSequenceClassification on Transformers v4.0.0">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-12-03T15:00:00.000Z">2020-12-04</time></div>
                    <a href="/2020/12/04/Transformers4/" class="title has-link-black-ter is-size-6 has-text-weight-normal">BertForSequenceClassification on Transformers v4.0.0</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/NLP/">NLP</a> / <a class="has-link-grey -link" href="/categories/NLP/LanguageModel/">LanguageModel</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/07/01/Review-the-Interview/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/typora/headway-5QgIuuBxKwM-unsplash.74d0f8.jpg" alt="면접에서 나온 통계 질문 리뷰">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-06-30T15:00:00.000Z">2020-07-01</time></div>
                    <a href="/2020/07/01/Review-the-Interview/" class="title has-link-black-ter is-size-6 has-text-weight-normal">면접에서 나온 통계 질문 리뷰</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/postmortem/">postmortem</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/29/Gitlab-for-LFS/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://d1sr4ybm5bj1wl.cloudfront.net/img/2020-05-27-12-22-58-KDTi9H.jpg" alt="딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-28T15:00:00.000Z">2020-05-29</time></div>
                    <a href="/2020/05/29/Gitlab-for-LFS/" class="title has-link-black-ter is-size-6 has-text-weight-normal">딥러닝 프로젝트 100% 재현을 위한 Git-LFS와 Gitlab</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/DevEnv/">DevEnv</a> / <a class="has-link-grey -link" href="/categories/DevEnv/Git/">Git</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            아카이브
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/03/">
                <span class="level-start">
                    <span class="level-item">3월 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/12/">
                <span class="level-start">
                    <span class="level-item">12월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/07/">
                <span class="level-start">
                    <span class="level-item">7월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">5월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">2월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">1월 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">12월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">10월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">7월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">6월 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">11월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">3월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">2월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">1월 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">12월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/11/">
                <span class="level-start">
                    <span class="level-item">11월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">10월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/09/">
                <span class="level-start">
                    <span class="level-item">9월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/08/">
                <span class="level-start">
                    <span class="level-item">8월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/07/">
                <span class="level-start">
                    <span class="level-item">7월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/06/">
                <span class="level-start">
                    <span class="level-item">6월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/04/">
                <span class="level-start">
                    <span class="level-item">4월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/03/">
                <span class="level-start">
                    <span class="level-item">3월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">2월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/01/">
                <span class="level-start">
                    <span class="level-item">1월 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/12/">
                <span class="level-start">
                    <span class="level-item">12월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/11/">
                <span class="level-start">
                    <span class="level-item">11월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/09/">
                <span class="level-start">
                    <span class="level-item">9월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/08/">
                <span class="level-start">
                    <span class="level-item">8월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/07/">
                <span class="level-start">
                    <span class="level-item">7월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/06/">
                <span class="level-start">
                    <span class="level-item">6월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2016/05/">
                <span class="level-start">
                    <span class="level-item">5월 2016</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    Beomi&#39;s Tech Blog
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Junbum Lee&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("ko");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://beomi.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>








<script src="/js/main.js" defer></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

    
</body>
</html>